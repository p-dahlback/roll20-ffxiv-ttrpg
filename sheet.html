<!-- Character name, race and resource stats -->
<!-- build:import header.html -->
<div class="sticky section" spellcheck="false">
    <div class="top fancy section">
        <input type="hidden" class="overrideSwitch" name="attr_override" />

        <div class="type">
            <img name="attr_jobIcon" width="50" />
        </div>

        <div class="name content vertical tight overrideBlocked">
            <span class="header small bold">Name</span>
            <input class="large" name="attr_character_name" type="text">
        </div>
        
        <div class="race content vertical tight overrideBlocked">
            <span class="header small bold">Race</span>
            <input class="large" name="attr_character_race" type="text">
        </div>
        
        <div class="char-size content vertical tight overrideBlocked">
            <span class="header small bold">Size</span>
            <select name="attr_size">
                <option value="normal">Normal</option>
                <option value="large">Large</option>
                <option value="small">Small</option>
            </select>
        </div>
    </div>

    <!-- Shortcut for HP/MP -->

    <div class="stat-shortcut fancy lowkey section">
        <!-- HP -->

        <div class="points section">
            <div class="stat-header"></div>
            <div class="hit-point section">
                <input type="hidden" class="overrideSwitch" name="attr_override" placeholder="placeholder" />
                <span class="text header large" style="width: 1em">HP</span>
                <input class="stat" name="attr_hitPoints" type="number" min="0" value="30">
                <span>/</span>
                <input class="stat max" name="attr_hitPoints_max" type="number" min="0" value="30">
                <span class="text header large">Barrier</span>
                <input class="stat" name="attr_barrierPoints" type="number" min="0" value="0">
            </div>
        </div>
        
        <!-- MP, Resource -->

        <div class="points section">
            <div class="small header bold stat-header">
                <span>Recover</span>
                <span name="attr_mpRecovery"></span>
                <span>MP at the end of the (Adventurer Step)</span>
            </div>
            <input type="hidden" class="monkResourceSwitch" name="attr_job" placeholder="placeholder" />
            <div class="regular-resource">
                <input type="hidden" class="doubleResourceSwitch" name="attr_resource2" placeholder="placeholder" />
                <div class="resource-point single-resource">
                    <input type="hidden" class="overrideSwitch" name="attr_override" placeholder="placeholder" />
                    <span class="text header large" style="width: 1em">MP</span>
                    <input class="stat" name="attr_magicPoints" type="number" min="0" value="5">
                    <span>/</span>
                    <input class="stat max" name="attr_magicPoints_max" type="number" min="0" value="5">

                    <input class="text large resourceSwitch overridable" name="attr_resource" type="text" placeholder=" "/>
                    <input class="stat resource" name="attr_resourceValue" type="number" min="0">
                    <span class="resource">/</span>
                    <input class="stat max resource" name="attr_resourceValue_max" type="number" min="0">
                </div>
                <div class="resource-point double-resource compressed">
                    <input type="hidden" class="overrideSwitch" name="attr_override" placeholder="placeholder" />
                    <span class="text header large" style="width: 1em">MP</span>
                    <input class="stat" name="attr_magicPoints" type="number" min="0" value="5">
                    <span>/</span>
                    <input class="stat max" name="attr_magicPoints_max" type="number" min="0" value="5">

                    <input class="text large overridable" name="attr_resource" type="text" placeholder=" "/>
                    <input class="stat" name="attr_resourceValue" type="number" min="0">
                    <span class="">/</span>
                    <input class="stat max" name="attr_resourceValue_max" type="number" min="0">

                    <input class="text large overridable" name="attr_resource2" type="text" placeholder=" "/>
                    <input class="stat" name="attr_resource2Value" type="number" min="0">
                    <span class="">/</span>
                    <input class="stat max" name="attr_resource2Value_max" type="number" min="0">
                </div>
            </div>
            <div class="monk-resource">
                <div class="resource-point compressed">
                    <input type="hidden" class="overrideSwitch" name="attr_override" placeholder="placeholder" />
                    <span class="text header large" style="width: 1em">MP</span>
                    <input class="stat" name="attr_magicPoints" type="number" min="0" value="5">
                    <span>/</span>
                    <input class="stat max" name="attr_magicPoints_max" type="number" min="0" value="5">
                </div>
                <div class="horizontal">
                    <div class="resource-point ranges compressed">
                        <input type="hidden" class="bestialSwitch" name="attr_hasBestial" placeholder="placeholder" />
                        <input type="hidden" class="nadiSwitch" name="attr_hasNadi" placeholder="placeholder" />
                        <span class="text header large" style="width: 1em">Chakra</span>
                        <div class="radiocontainer">
                            <input class="radiobox transparent" type="checkbox" name="attr_resourceValue" value="0">
                            <input class="radiobox" type="checkbox" name="attr_resourceValue" value="1">
                            <input class="radiobox" type="checkbox" name="attr_resourceValue" value="2">
                            <input class="radiobox" type="checkbox" name="attr_resourceValue" value="3">
                        </div>

                        <span class="text header large bestial" style="width: 1em">Beast</span>
                        <div class="radiocontainer bestial">
                            <input class="radiobox transparent" type="checkbox" name="attr_resource2Value" value="0">
                            <input class="radiobox" type="checkbox" name="attr_resource2Value" value="1">
                            <input class="radiobox" type="checkbox" name="attr_resource2Value" value="2">
                            <input class="radiobox" type="checkbox" name="attr_resource2Value" value="3">
                        </div>

                        <span class="text header large nadi" style="width: 1em">Nadi</span>
                        <div class="radiocontainer nadi">
                            <input class="radiobox transparent" type="checkbox" name="attr_resource3Value" value="0">
                            <input class="radiobox" type="checkbox" name="attr_resource3Value" value="1">
                        </div>
                    </div>
                    <div class="resource-point ranges fury compressed">
                        <input type="hidden" class="opoSwitch" name="attr_hasOpo" placeholder="placeholder" />
                        <span class="text header large opo">Opo's Fury</span>
                        <div class="radiocontainer opo">
                            <input class="radiobox transparent" type="checkbox" name="attr_range1" value="0">
                            <input class="radiobox" type="checkbox" name="attr_range1" value="1">
                        </div>

                        <span class="text header large">Raptor's Fury</span>
                        <div class="radiocontainer">
                            <input class="radiobox transparent" type="checkbox" name="attr_range2" value="0">
                            <input class="radiobox" type="checkbox" name="attr_range2" value="1">
                        </div>
                        
                        <span class="text header large">Coeurl's Fury</span>
                        <div class="radiocontainer">
                            <input class="radiobox transparent" type="checkbox" name="attr_range3" value="0">
                            <input class="radiobox" type="checkbox" name="attr_range3" value="1">
                            <input class="radiobox" type="checkbox" name="attr_range3" value="2">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Advantage -->

        <div class="points advantage" style="width: 25%;">
            <label class="header large stat-header">Advantage</label>
            <div class="horizontal">
                <button class="math-button" type="action" name="act_decreaseAdvantage">-</button>
                <div>
                    <span class="large" style="font-family: dicefontd20;">0</span>
                    <span class="large" name="attr_advantage"></span>
                </div>
                <button class="math-button" type="action" name="act_increaseAdvantage">+</button>
            </div>
            <button type="action" name="act_clearAdvantage">Clear</button>
        </div>
    </div>

    <!-- Tab buttons -->

    <div class="tab">
        <input type="hidden" class="tabstoggle" name="attr_sheetTab" value="character" />
        <button type="action" name="act_character" class="toggle sheet-button0">Character</button>
        <button type="action" name="act_abilities" class="toggle sheet-button2">Abilities</button>
        <button type="action" name="act_items" class="toggle sheet-button1">Inventory</button>

        <div class="mini-effects hidden-controls">
            <fieldset class="repeating_effects">
                <span class="sheet-tooltip">
                    <img class="icon" name="attr_icon" />
                    <span name="attr_name" class="floatLeft"></span>
                </span>
            </fieldset>
        </div>

        <button type="action" name="act_settings" class="toggle sheet-button3">y</button>
    </div>
</div>

<input type="hidden" class="tabstoggle" name="attr_sheetTab" value="character" />

<!-- Profile page -->
<!-- build:import profile.html -->
<div class="character" spellcheck="false">
    <div class="grid fancy lowkey fill">

        <!-- Profile page, Level and Profile -->

        <div class="left section">
            <div class="basic-info fancy horizontal tight">
                <div class="level flex horizontal tight">
                    <input type="hidden" class="overrideSwitch" name="attr_override" placeholder="placeholder" />
                    <span class="header large bold">LV</span>
                    <input class="header large bold" name="attr_level" type="number" value="30">
                </div>
                <div class="job vertical">
                    <input type="hidden" class="overrideSwitch" name="attr_override" placeholder="placeholder" />
                    <span class="header medium bold">Role / Job</span>
                    <input class="job-input header medium" name="attr_role" type="text">
                </div>
            </div>
        
            <div class="image-container section">
                <img class="image" name="attr_character_avatar">
                <div class="fancy overlay"></div>
            </div>

            <!-- Profile -->

            <div class="profile section list">
                <h3 class="small">Profile</h3>

                <!-- Origin  -->
                <div class="origin">
                    <span class="header medium bold floatLeft" style="margin-right:8px;">Origin:</span>
                    <div class="adaptive adaptive--text floatLeft">
                        <span class="mini-input adaptive--text__span"  name="attr_origin"></span>
                        <textarea class="mini-input adaptive--text__textarea" name="attr_origin" placeholder="Ex. Survivor, Urbanite"></textarea>
                    </div>
                </div>

                <!-- Bonds  -->
                <div class="bonds list">
                    <span class="header medium bold">Bonds:</span>
                    <div class="adaptive adaptive--text floatLeft">
                        <span class="mini-input adaptive--text__span"  name="attr_bonds"></span>
                        <textarea class="mini-input adaptive--text__textarea" name="attr_bonds" placeholder="Ex. Debt, Momodi Modi"></textarea>
                    </div>
                </div>

                <hr class="small-hr" />

                <!-- Title  -->

                <div class="title">
                    <span class="header medium bold">Title:</span>
                    <span class="medium" style="margin-left: 8px;" name="attr_selectedTitle">Select a title from Inventory</span>
                </div>
                <div class="title-effect list">
                    <span class="header medium bold">Effect: </span>
                    <span class="medium" name="attr_selectedTitleEffect"></span>
                </div>

                <hr class="small-hr" />

                <!-- Minion -->
                 
                <div class="minion">
                    <span class="header medium bold">Minion:</span> 
                    <span class="medium" style="margin-left: 8px;" name="attr_selectedMinion">Select a minion from Inventory</span>
                </div>
                <div class="minion-effect list">
                    <span class="header medium bold">Effect: </span>
                    <span class="medium" name="attr_selectedMinionEffect"></span>
                </div>
            </div>

            <!-- Traits -->

            <div class="traits fancy lowkey section">
                <div style="height: 27px; padding-bottom: 4px;">
                    <span class="small colored-in floatLeft">Traits</span>
                    <button type="action" class="floatRight" name="act_expandAllTraits">Expand All</button>
                    <button type="action" class="floatRight" name="act_collapseAllTraits">Collapse All</button>
                </div>
                <fieldset class="repeating_traits">
                    <div class="trait list">
                        <input class="expand-checkbox hidden" type="checkbox" name="attr_repeatingExpandItem" />
                        <div class="item-header">
                            <input class="editSwitch" type="hidden" name="attr_editable" />
                            <input type="hidden" class="trait-icon-switch" name="attr_icon" placeholder="I" />
                            <img class="trait-icon" name="attr_icon" />
                            <span class="header medium bold">Trait:</span>
                            <input class="medium editSwitchBlocked" type="text" name="attr_title" placeholder="Title"></span>
                            <button type="action" class="ability-action" style="margin-left: auto;" name="act_share">q</button>
                            <button type="action" class="ability-action" name="act_info">i</button>
                        </div>
                        <div class="item-body list expanded-view">
                            <span class="header medium bold" style="margin-top: 4px;">Effect:</span>
                            <div class="adaptive adaptive--text floatLeft" style="margin-bottom: 8px;">
                                <input class="editSwitch" type="hidden" name="attr_editable" />
                                <span class="mini-input adaptive--text__span"  name="attr_effect"></span>
                                <textarea class="mini-input adaptive--text__textarea editSwitchBlocked" name="attr_effect" placeholder="The trait's effects"></textarea>
                            </div>
                        </div>
                    </div>
                </fieldset>
            </div>
        </div>
        
        <!-- Profile page, Attributes -->

        <div class="right fancy lowkey section">
            <div class="stat section horizontal tight">

                <!-- Primary -->

                <div class="main-stat list">
                    <h3 class="medium">Primary Attributes</h3>
                    <div class="stat-block">
                        <input type="hidden" class="overrideSwitch" name="attr_override" placeholder="placeholder" />
                        <button class="medium roll" name="act_rollStr" type="action">STR</button>
                        <span class="stat-effective large" name="attr_strDisplay"></span>
                        <div class="stat-edit overrideHide">
                            (<input class="stat small" name="attr_str" type="number" min="-5">)
                        </div>
                    </div>
                    
                    <div class="stat-block">
                        <input type="hidden" class="overrideSwitch" name="attr_override" placeholder="placeholder" />
                        <button class="medium roll" name="act_rollDex" type="action">DEX</button>
                        <span class="stat-effective large" name="attr_dexDisplay"></span>
                        <div class="stat-edit overrideHide">
                            (<input class="stat small" name="attr_dex" type="number" min="-5">)
                        </div>
                    </div>
                    
                    <div class="stat-block">
                        <input type="hidden" class="overrideSwitch" name="attr_override" placeholder="placeholder" />
                        <button class="medium roll" name="act_rollVit" type="action">VIT</button>
                        <span class="stat-effective large" name="attr_vitDisplay"></span>
                        <div class="stat-edit overrideHide">
                            (<input class="stat small" name="attr_vit" type="number" min="-5">)
                        </div>
                    </div>
                    
                    <div class="stat-block">
                        <input type="hidden" class="overrideSwitch" name="attr_override" placeholder="placeholder" />
                        <button class="medium roll" name="act_rollInt" type="action">INT</button>
                        <span class="stat-effective large" name="attr_intDisplay"></span>
                        <div class="stat-edit overrideHide">
                            (<input class="stat small" name="attr_int" type="number" min="-5">)
                        </div>
                    </div>
                    
                    <div class="stat-block">
                        <input type="hidden" class="overrideSwitch" name="attr_override" placeholder="placeholder" />
                        <button class="medium roll" name="act_rollMnd" type="action">MND</button>
                        <span class="stat-effective large" name="attr_mndDisplay"></span>
                        <div class="stat-edit overrideHide">
                            (<input class="stat small" name="attr_mnd" type="number" min="-5">)
                        </div>
                    </div>
                </div>
                
                <!-- Secondary -->

                <div class="sub-stat list">
                    <input type="hidden" class="overrideSwitch" name="attr_override" placeholder="placeholder" />

                    <h3 class="medium standard">Secondary Attributes</h3>
                    <div class="stat-block">
                        <input type="hidden" class="overrideSwitch" name="attr_override" placeholder="placeholder" />
                        <span class="header medium bold oneline">Defense</span>
                        <span class="stat-effective medium" name="attr_defenseDisplay"></span>
                        <div class="stat-edit overrideHide">
                            (<input class="stat small" name="attr_defense" type="number" min="-5">)
                        </div>
                    </div>
                    
                    <div class="stat-block">
                        <input type="hidden" class="overrideSwitch" name="attr_override" placeholder="placeholder" />
                        <span class="header medium bold oneline">Magic Defense</span>
                        <span class="stat-effective medium" name="attr_magicDefenseDisplay"></span>
                        <div class="stat-edit overrideHide">
                            (<input class="stat small" name="attr_magicDefense" type="number" min="-5">)
                        </div>
                    </div>
                    
                    <div class="stat-block">
                        <input type="hidden" class="overrideSwitch" name="attr_override" placeholder="placeholder" />
                        <span class="header medium bold oneline">Vigilance</span>
                        <span class="stat-effective medium" name="attr_vigilanceDisplay"></span>
                        <div class="stat-edit overrideHide">
                            (<input class="stat small" name="attr_vigilance" type="number" min="-5">)
                        </div>
                    </div>
                    
                    <div class="stat-block">
                        <input type="hidden" class="overrideSwitch" name="attr_override" placeholder="placeholder" />
                        <span class="header medium bold oneline">Speed</span>
                        <span class="stat-effective medium" name="attr_speedDisplay"></span>
                        <div class="stat-edit overrideHide">
                            (<input class="stat small" name="attr_speed" type="number" min="-5">)
                        </div>
                    </div>
                </div>
            </div>

            <!-- Turn Order / Fortune -->

            <div class="misc-stat fancy lowkey">
                <div class="flex horizontal tight floatLeft">
                    <input type="hidden" class="turnOrderSwitch" name="attr_turnOrderStyle">

                    <span class="header bold medium">Turn Order</span>
                    <input class="stat medium" name="attr_turnOrder" type="number" min="0" value="1">
                    <button class="turn-order reverseTurnOrderContent" name="act_applyTurnOrder" type="action">Add</button>
                    <button class="turn-order roll turnOrderContent" name="act_rollTurnOrder" type="action"></button>
                </div>

                <div class="fortune fancy lowkey flex horizontal tight floatRight">
                    <span class="header bold medium">Fortune</span>
                    <input class="stat medium" name="attr_fortune" type="number" min="0" value="3">
                </div>
            </div>

            <!-- Effects -->

            <div class="effects section">
                <div style="height: 27px; padding-bottom: 4px; background-color: var(--sheet-filled-background);">
                    <span class="small colored-in floatLeft">Effects</span>
                    <button type="action" class="floatRight" name="act_expandAllEffects">Expand All</button>
                    <button type="action" class="floatRight" name="act_collapseAllEffects">Collapse All</button>
                </div>
                <fieldset class="repeating_effects">
                    <div class="effect">
                        <input class="expand-checkbox hidden" type="checkbox" name="attr_repeatingExpandItem" />
                        <div class="effect-header">
                            <input class="expand-checkbox reverse hidden" type="checkbox" name="attr_curable" />
                            <div class="expanded-view-horizontal" style="padding: 2px 0 2px 0;">
                                <div class="color-prefix"></div>
                            </div>
                            <img class="effect-icon" name="attr_icon" />
                            <input type="hidden" class="typeSwitch" name="attr_type" />
                            <input type="hidden" class="editSwitch" name="attr_editable" />
                            <input type="text" class="effect-specialType typeSwitchDisplayed editSwitchBlocked" name="attr_specialType" placeholder="Effect" />
                            <select class="effect-type typeSwitchHidden editSwitchBlocked" name="attr_type">
                                <option value="none">--Select--</option>
                                <option value="roll(x)">Roll Up(X)</option>
                                <option value="dreroll">Damage Reroll</option>
                                <option value="critical(x)">Critical Up(X)</option>
                                <option value="attribute(x)">Attribute Up(X)</option>
                                <option value="regen(x)">Regen(X)</option>
                                <option value="ready(x)">X Ready</option>
                                <option value="advantage">Advantage</option>
                                <option value="unstunnable">Stun Immunity</option>
                                <option value="transcendent">Transcendent</option>
                                <hr />
                                <option value="blind">Blind</option>
                                <option value="bound">Bound</option>
                                <option value="enmity(x)">Enmity(Penalty)</option>
                                <option value="dot(x)">DOT(X)</option>
                                <option value="heavy">Heavy</option>
                                <option value="paralyzed">Paralyzed</option>
                                <option value="petrified">Petrified</option>
                                <option value="prone">Prone</option>
                                <option value="silence">Silence</option>
                                <option value="sleep">Sleep</option>
                                <option value="slow">Slow</option>
                                <option value="stun">Stun</option>
                                <hr />
                                <option value="weak">Weak</option>
                                <option value="brink">Brink of Death</option>
                                <option value="knocked_out">Knocked Out</option>
                                <option value="comatose">Comatose</option>
                                <hr />
                                <option value="special">Special</option>
                            </select>
                            <select class="effect-expiry" name="attr_expiry">
                                <option value="use">On use</option>
                                <hr />
                                <option value="encounterstart">Start of encounter</option>
                                <option value="stepstart">Start of the [Adventurer Step]</option>
                                <option value="start">Start of your turn</option>
                                <option value="turn">End of your turn</option>
                                <option value="step">End of the [Adventurer Step]</option>
                                <option value="round">End of this round</option>
                                <option value="turn2">End of your next turn</option>
                                <option value="phase">End of phase</option>
                                <option value="encounter">End of encounter</option>
                                <hr />
                                <option value="rest">After rest</option>
                                <option value="end">After adventure</option>
                                <option value="permanent">Permanent</option>
                                <hr />
                                <option value="damage">On damage</option>
                            </select>
                            <div class="button-container">
                                <button type="action" class="ability-action floatRight" name="act_info">i</button>
                                <button type="action" class="ability-action floatRight" name="act_share">q</button>
                            </div>
                        </div>
                        <div class="effect-body expanded-view">
                            <div class="status-type">
                                <span class="mini-title floatLeft">Type:</span>
                                <div class="adaptive adaptive--input floatLeft">
                                    <input type="hidden" class="editSwitch" name="attr_editable" />
                                    <span class="mini-input adaptive--input__span" name="attr_statusType"></span>
                                    <input class="mini-input adaptive--input__input editSwitchBlocked" type="text" name="attr_statusType" placeholder="Enhancement/Enfeeblement" />
                                </div>
                            </div>
                            <div>
                                <span class="mini-title floatLeft">Value:</span>
                                <div class="adaptive adaptive--input floatLeft">
                                    <input type="hidden" class="editSwitch" name="attr_editable" />
                                    <span class="mini-input adaptive--input__span" name="attr_value"></span>
                                    <input class="mini-input adaptive--input__input editSwitchBlocked" type="text" name="attr_value" placeholder="X" />
                                </div>
                            </div>
                            <div>
                                <span class="mini-title floatLeft">From:</span>
                                <div class="adaptive adaptive--input floatLeft">
                                    <input type="hidden" class="editSwitch" name="attr_editable" />
                                    <span class="mini-input adaptive--input__span" name="attr_source"></span>
                                    <input class="mini-input adaptive--input__input editSwitchBlocked" type="text" name="attr_source" placeholder="Creator?" />
                                </div>
                            </div>
                            <div>
                                <span class="mini-title floatLeft">Description:</span>
                                <div class="adaptive adaptive--text floatLeft">
                                    <input type="hidden" class="editSwitch" name="attr_editable" />
                                    <span class="mini-input adaptive--text__span" name="attr_description"></span>
                                    <textarea class="mini-input adaptive--text__textarea editSwitchBlocked" type="text" name="attr_description" placeholder="Describe how the effect works"></textarea>
                                </div>
                            </div>
                            <div>
                                <span class="mini-title floatLeft">Curable:</span>
                                <div class="sheet-checkbox-container">
                                    <input type="hidden" class="editSwitch" name="attr_editable" />
                                    <input class="floatLeft sheet-checkbox editSwitchBlocked" style="position: absolute;" type="checkbox" name="attr_curable" /><span class="sheet-checkbox-before"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </fieldset>
            </div>

            <!-- Rest/End of phase -->

            <div class="rest-container colored-in">
                <div>
                    <span class="header medium bold">Reset</span>
                    <span class="small">your attributes and effects</span>
                </div>
                <div class="button-container">
                    <button type="action" class="phase-button" name="act_phase">End of phase</button>
                    <button type="action" class="end-button" name="act_end">End of adventure</button>
                    <button type="action" class="rest-button" name="act_rest">Long rest</button>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Abilities page -->

<div class="char-abilities" spellcheck="false">
    <!-- Top abilities (Bard songs) -->
    <input class="job-type" type="hidden" name="attr_job">

    <div class="ability-top">
        <button type="action" class="floatRight" name="act_expandAllAbilities">Expand All</button>
        <button type="action" class="floatRight" name="act_collapseAllAbilities">Collapse All</button>
    </div>

    <div class="top-abilities ability-sub-category">
        <input class="expand-checkbox hidden" type="checkbox" name="attr_songHeaderExpandItem" />
        <div class="horizontal">
            <h3 class="large">Song Abilities</h3>
            <span class="medium">Song abilities can only be used at the start of your turn.</span>
            <button type="action" class="header-action" name="act_song_info">i</button>
        </div>
        <input type="hidden" class="overrideSwitch" name="attr_override" placeholder="placeholder" />
        <div class="ability-columns expanded-view">
            <div class="ability-column">
                <fieldset class="repeating_song1">
                    <!-- build:import ability.html-->
<div class="ability">
    <div class="header list">
        <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
        <input type="hidden" class="usesFlag" name="attr_uses_max" />
        <input type="hidden" class="costFlag" name="attr_cost" />
        <input type="text" class="conditionFlag hidden" name="attr_condition" placeholder="P" />
        <input type="text" class="triggerFlag hidden" name="attr_trigger" placeholder="P" />
        <input type="text" class="targetFlag hidden" name="attr_target" placeholder="P" />
        <input type="text" class="checkFlag hidden" name="attr_check" placeholder="P" />
        <input type="text" class="crFlag hidden" name="attr_cr" placeholder="P" />
        <input class="expand-checkbox hidden" type="checkbox" name="attr_repeatingExpandItem" />

        <span class="mini flagTitle expanded-view floatLeft">Icon source:</span>
        <input type="text" class="iconSource overrideContent expanded-view mini-input" name="attr_icon" title="Icon" placeholder="icon source" />

        <div class="uses">
            <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
            <input class="max mini-input floatRight" type="number" name="attr_uses_max" min="0" value="0" />
            <span class="floatRight">/</span>
            <input class="mini-input floatRight" type="number" name="attr_uses" min="0" value="0" />
        </div>

        <div class="header-title">
            <img class="ability-icon" name="attr_icon" />
            <div class="title adaptive adaptive--text">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="bold adaptive--text__span"  name="attr_title"></span>
                <textarea class="adaptive--text__textarea" type="text" name="attr_title" placeholder="Paladin Combo (Fast Blade + Riot Blade)"></textarea>
            </div>
        </div>

        <div class="ability-controls">
            <button type="action" class="ability-action-trigger" name="act_trigger">t</button>
            <button type="action" class="ability-action" name="act_info">i</button>
            <button type="action" class="ability-action" name="act_share">q</button>
            <button type="action" name="act_rolldamage" style="display: none;">d</button>
            <button type="action" name="act_rolldamagewithbonus" style="display: none;">d</button>
            <button type="action" name="act_runcombo1" style="display: none;">d</button>
            <button type="action" name="act_runcombo2" style="display: none;">d</button>
            <button type="action" name="act_runcombo3" style="display: none;">d</button>
        </div>

        <div class="type expanded-view">
            <span class="mini-title floatLeft">Type:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input italic adaptive--text__span" name="attr_type"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_type" placeholder="Primary, Physical"></textarea>
            </div>
        </div>
        <div class="cost expanded-view">
            <span class="mini-title floatLeft">Cost:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span" name="attr_cost"></span>
                <input class="mini-input adaptive--input__input" type="number" name="attr_cost" placeholder="X" />
            </div>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span"  name="attr_resource"></span>
                <input class="mini-input adaptive--input__input" type="text" name="attr_resource" placeholder="Conviction" />
            </div>
        </div>
        <div class="condition expanded-view">
            <span class="mini-title floatLeft">Condition:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_condition"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_condition" placeholder="Under the effect of Fang and Claw Bared / Wheel in Motion Ready"></textarea>
            </div>
        </div>
        <div class="trigger expanded-view">
            <span class="mini-title floatLeft">Trigger:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_trigger"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_trigger" placeholder="Immediately after an ability check for an ability that targets you"></textarea>
            </div>
        </div>
        <div class="target expanded-view">
            <span class="mini-title floatLeft">Target:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_target"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_target" placeholder="Single"></textarea>
            </div>
        </div>
        <div class="range expanded-view">
            <span class="mini-title floatLeft">Range:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_range"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_range" placeholder="1 square"></textarea>
            </div>
        </div>
        <div class="check expanded-view">
            <span class="mini-title floatLeft">Check:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input bold adaptive--input__span" name="attr_check"></span>
                <input class="mini-input bold adaptive--input__input" type="text" name="attr_check" placeholder="d20 + STR" />
            </div>
        </div>
        <div class="cr expanded-view">
            <span class="mini-title floatLeft">CR:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span" name="attr_cr"></span>
                <input class="mini-input adaptive--input__input" type="text" name="attr_cr" placeholder="Target's Defense" />
            </div>
        </div>
    </div>

    <div class="body list">
        <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
        <input type="text" class="directHitFlag hidden" name="attr_directHit" placeholder="P" />
        <input type="text" class="effectFlag hidden" name="attr_effectName" placeholder="P" />
        <input type="text" class="limitationFlag hidden" name="attr_limitation" placeholder="P" />
        <input class="expand-checkbox hidden" type="checkbox" name="attr_repeatingExpandItem" />

        <div class="spacer expanded-view"></div>

        <div class="base-effect expanded-view">
            <span class="mini-title floatLeft">Base Effect:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_baseEffect"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_baseEffect" placeholder="Deals 3 damage and inflicts Enmity on the target. Combo: Rage of Halone."></textarea>
            </div>
        </div>
        <div class="ability-effect list expanded-view">
            <div class="adaptive adaptive--input">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-title adaptive--input__span" name="attr_effectName"></span>
                <span class="mini-title" name="attr_effectName">:</span>
                <input class="mini-title adaptive--input__input" type="text" name="attr_effectName" placeholder="My Effect" />
            </div>
            <div class="adaptive adaptive--text">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_effect"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_effect" placeholder="Provides 1 HP Barrier"></textarea>
            </div>
        </div>
        <div class="direct-hit expanded-view">
            <span class="mini-title floatLeft">Direct Hit:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_directHit"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_directHit" placeholder="Deals an additional 2d6 damage"></textarea>
            </div>
        </div>
        <div class="limitation expanded-view">
            <span class="mini-title floatLeft">Limitation:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span" name="attr_limitation"></span>
                <input class="mini-input adaptive--input__input" type="text" name="attr_limitation" placeholder="Once per phase." />
            </div>
        </div>

        <span class="mini flagTitle expanded-view floatLeft">Stat for rolls (used for calculations):</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_stat" title="Stat for rolls" placeholder="STR, DEX, etc"/>
        <span class="mini flagTitle expanded-view floatLeft">Hit dice type (used for display on rolls):</span>
        <select class="overrideContent expanded-view mini-input" name="attr_hitType">
            <option value="Hit">Hit</option>
            <option value="Critical">Critical</option>
            <option value="None">None</option>
        </select>
        <span class="mini flagTitle expanded-view floatLeft">Damage/Healing (used for display on rolls):</span>
        <select class="overrideContent expanded-view mini-input" name="attr_damageType">
            <option value="Damage">Damage</option>
            <option value="Healing">Healing</option>
            <option value="Defense">Defense</option>
            <option value="Effect">Effect</option>
        </select>
        <span class="mini flagTitle expanded-view floatLeft">Hit die (used for rolls):</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_hitDie" title="Hit" placeholder="1d20cs20, 1d8, etc"/>
        <span class="mini flagTitle expanded-view floatLeft">Base effect dice/value (used to calculate damage)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_baseValue" title="Base effect value" placeholder="5, 1d20 + 2, etc" />
        <span class="mini flagTitle expanded-view floatLeft">Direct Hit dice/value (used to calculate extra damage)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_dhValue" title="Direct Hit value" placeholder="5, 1d20 + 2, etc" />
        <span class="mini flagTitle expanded-view floatLeft">Restoration value (used to restore own HP/MP/resource, include space)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_restore" title="Restore value" placeholder="5 MP, 5 HP, 5 Conviction, etc" />
        <span class="mini flagTitle expanded-view floatLeft">Effects on self (used to automatically add effects)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_effectSelf" title="Effect names" placeholder="Astral Fire, Surging Tempest" />
        <span class="mini flagTitle expanded-view floatLeft">Effects on target (used to add effect shortcut button)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_effectTarget" title="Effect names" placeholder="Major Arcana, Mage's Ballad" />
        <span class="mini flagTitle expanded-view floatLeft">Combo name (used for easy chaining to next ability)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_combo" title="Combo value" placeholder="Storm's Path, Storm's Eye" />
    </div>
</div>                </fieldset>
            </div>
            <div class="ability-column">
                <fieldset class="repeating_song2">
                    <!-- build:import ability.html-->
<div class="ability">
    <div class="header list">
        <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
        <input type="hidden" class="usesFlag" name="attr_uses_max" />
        <input type="hidden" class="costFlag" name="attr_cost" />
        <input type="text" class="conditionFlag hidden" name="attr_condition" placeholder="P" />
        <input type="text" class="triggerFlag hidden" name="attr_trigger" placeholder="P" />
        <input type="text" class="targetFlag hidden" name="attr_target" placeholder="P" />
        <input type="text" class="checkFlag hidden" name="attr_check" placeholder="P" />
        <input type="text" class="crFlag hidden" name="attr_cr" placeholder="P" />
        <input class="expand-checkbox hidden" type="checkbox" name="attr_repeatingExpandItem" />

        <span class="mini flagTitle expanded-view floatLeft">Icon source:</span>
        <input type="text" class="iconSource overrideContent expanded-view mini-input" name="attr_icon" title="Icon" placeholder="icon source" />

        <div class="uses">
            <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
            <input class="max mini-input floatRight" type="number" name="attr_uses_max" min="0" value="0" />
            <span class="floatRight">/</span>
            <input class="mini-input floatRight" type="number" name="attr_uses" min="0" value="0" />
        </div>

        <div class="header-title">
            <img class="ability-icon" name="attr_icon" />
            <div class="title adaptive adaptive--text">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="bold adaptive--text__span"  name="attr_title"></span>
                <textarea class="adaptive--text__textarea" type="text" name="attr_title" placeholder="Paladin Combo (Fast Blade + Riot Blade)"></textarea>
            </div>
        </div>

        <div class="ability-controls">
            <button type="action" class="ability-action-trigger" name="act_trigger">t</button>
            <button type="action" class="ability-action" name="act_info">i</button>
            <button type="action" class="ability-action" name="act_share">q</button>
            <button type="action" name="act_rolldamage" style="display: none;">d</button>
            <button type="action" name="act_rolldamagewithbonus" style="display: none;">d</button>
            <button type="action" name="act_runcombo1" style="display: none;">d</button>
            <button type="action" name="act_runcombo2" style="display: none;">d</button>
            <button type="action" name="act_runcombo3" style="display: none;">d</button>
        </div>

        <div class="type expanded-view">
            <span class="mini-title floatLeft">Type:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input italic adaptive--text__span" name="attr_type"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_type" placeholder="Primary, Physical"></textarea>
            </div>
        </div>
        <div class="cost expanded-view">
            <span class="mini-title floatLeft">Cost:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span" name="attr_cost"></span>
                <input class="mini-input adaptive--input__input" type="number" name="attr_cost" placeholder="X" />
            </div>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span"  name="attr_resource"></span>
                <input class="mini-input adaptive--input__input" type="text" name="attr_resource" placeholder="Conviction" />
            </div>
        </div>
        <div class="condition expanded-view">
            <span class="mini-title floatLeft">Condition:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_condition"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_condition" placeholder="Under the effect of Fang and Claw Bared / Wheel in Motion Ready"></textarea>
            </div>
        </div>
        <div class="trigger expanded-view">
            <span class="mini-title floatLeft">Trigger:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_trigger"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_trigger" placeholder="Immediately after an ability check for an ability that targets you"></textarea>
            </div>
        </div>
        <div class="target expanded-view">
            <span class="mini-title floatLeft">Target:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_target"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_target" placeholder="Single"></textarea>
            </div>
        </div>
        <div class="range expanded-view">
            <span class="mini-title floatLeft">Range:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_range"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_range" placeholder="1 square"></textarea>
            </div>
        </div>
        <div class="check expanded-view">
            <span class="mini-title floatLeft">Check:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input bold adaptive--input__span" name="attr_check"></span>
                <input class="mini-input bold adaptive--input__input" type="text" name="attr_check" placeholder="d20 + STR" />
            </div>
        </div>
        <div class="cr expanded-view">
            <span class="mini-title floatLeft">CR:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span" name="attr_cr"></span>
                <input class="mini-input adaptive--input__input" type="text" name="attr_cr" placeholder="Target's Defense" />
            </div>
        </div>
    </div>

    <div class="body list">
        <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
        <input type="text" class="directHitFlag hidden" name="attr_directHit" placeholder="P" />
        <input type="text" class="effectFlag hidden" name="attr_effectName" placeholder="P" />
        <input type="text" class="limitationFlag hidden" name="attr_limitation" placeholder="P" />
        <input class="expand-checkbox hidden" type="checkbox" name="attr_repeatingExpandItem" />

        <div class="spacer expanded-view"></div>

        <div class="base-effect expanded-view">
            <span class="mini-title floatLeft">Base Effect:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_baseEffect"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_baseEffect" placeholder="Deals 3 damage and inflicts Enmity on the target. Combo: Rage of Halone."></textarea>
            </div>
        </div>
        <div class="ability-effect list expanded-view">
            <div class="adaptive adaptive--input">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-title adaptive--input__span" name="attr_effectName"></span>
                <span class="mini-title" name="attr_effectName">:</span>
                <input class="mini-title adaptive--input__input" type="text" name="attr_effectName" placeholder="My Effect" />
            </div>
            <div class="adaptive adaptive--text">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_effect"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_effect" placeholder="Provides 1 HP Barrier"></textarea>
            </div>
        </div>
        <div class="direct-hit expanded-view">
            <span class="mini-title floatLeft">Direct Hit:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_directHit"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_directHit" placeholder="Deals an additional 2d6 damage"></textarea>
            </div>
        </div>
        <div class="limitation expanded-view">
            <span class="mini-title floatLeft">Limitation:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span" name="attr_limitation"></span>
                <input class="mini-input adaptive--input__input" type="text" name="attr_limitation" placeholder="Once per phase." />
            </div>
        </div>

        <span class="mini flagTitle expanded-view floatLeft">Stat for rolls (used for calculations):</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_stat" title="Stat for rolls" placeholder="STR, DEX, etc"/>
        <span class="mini flagTitle expanded-view floatLeft">Hit dice type (used for display on rolls):</span>
        <select class="overrideContent expanded-view mini-input" name="attr_hitType">
            <option value="Hit">Hit</option>
            <option value="Critical">Critical</option>
            <option value="None">None</option>
        </select>
        <span class="mini flagTitle expanded-view floatLeft">Damage/Healing (used for display on rolls):</span>
        <select class="overrideContent expanded-view mini-input" name="attr_damageType">
            <option value="Damage">Damage</option>
            <option value="Healing">Healing</option>
            <option value="Defense">Defense</option>
            <option value="Effect">Effect</option>
        </select>
        <span class="mini flagTitle expanded-view floatLeft">Hit die (used for rolls):</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_hitDie" title="Hit" placeholder="1d20cs20, 1d8, etc"/>
        <span class="mini flagTitle expanded-view floatLeft">Base effect dice/value (used to calculate damage)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_baseValue" title="Base effect value" placeholder="5, 1d20 + 2, etc" />
        <span class="mini flagTitle expanded-view floatLeft">Direct Hit dice/value (used to calculate extra damage)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_dhValue" title="Direct Hit value" placeholder="5, 1d20 + 2, etc" />
        <span class="mini flagTitle expanded-view floatLeft">Restoration value (used to restore own HP/MP/resource, include space)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_restore" title="Restore value" placeholder="5 MP, 5 HP, 5 Conviction, etc" />
        <span class="mini flagTitle expanded-view floatLeft">Effects on self (used to automatically add effects)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_effectSelf" title="Effect names" placeholder="Astral Fire, Surging Tempest" />
        <span class="mini flagTitle expanded-view floatLeft">Effects on target (used to add effect shortcut button)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_effectTarget" title="Effect names" placeholder="Major Arcana, Mage's Ballad" />
        <span class="mini flagTitle expanded-view floatLeft">Combo name (used for easy chaining to next ability)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_combo" title="Combo value" placeholder="Storm's Path, Storm's Eye" />
    </div>
</div>                </fieldset>
            </div>
            <div class="ability-column">
                <fieldset class="repeating_song3">
                    <!-- build:import ability.html-->
<div class="ability">
    <div class="header list">
        <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
        <input type="hidden" class="usesFlag" name="attr_uses_max" />
        <input type="hidden" class="costFlag" name="attr_cost" />
        <input type="text" class="conditionFlag hidden" name="attr_condition" placeholder="P" />
        <input type="text" class="triggerFlag hidden" name="attr_trigger" placeholder="P" />
        <input type="text" class="targetFlag hidden" name="attr_target" placeholder="P" />
        <input type="text" class="checkFlag hidden" name="attr_check" placeholder="P" />
        <input type="text" class="crFlag hidden" name="attr_cr" placeholder="P" />
        <input class="expand-checkbox hidden" type="checkbox" name="attr_repeatingExpandItem" />

        <span class="mini flagTitle expanded-view floatLeft">Icon source:</span>
        <input type="text" class="iconSource overrideContent expanded-view mini-input" name="attr_icon" title="Icon" placeholder="icon source" />

        <div class="uses">
            <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
            <input class="max mini-input floatRight" type="number" name="attr_uses_max" min="0" value="0" />
            <span class="floatRight">/</span>
            <input class="mini-input floatRight" type="number" name="attr_uses" min="0" value="0" />
        </div>

        <div class="header-title">
            <img class="ability-icon" name="attr_icon" />
            <div class="title adaptive adaptive--text">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="bold adaptive--text__span"  name="attr_title"></span>
                <textarea class="adaptive--text__textarea" type="text" name="attr_title" placeholder="Paladin Combo (Fast Blade + Riot Blade)"></textarea>
            </div>
        </div>

        <div class="ability-controls">
            <button type="action" class="ability-action-trigger" name="act_trigger">t</button>
            <button type="action" class="ability-action" name="act_info">i</button>
            <button type="action" class="ability-action" name="act_share">q</button>
            <button type="action" name="act_rolldamage" style="display: none;">d</button>
            <button type="action" name="act_rolldamagewithbonus" style="display: none;">d</button>
            <button type="action" name="act_runcombo1" style="display: none;">d</button>
            <button type="action" name="act_runcombo2" style="display: none;">d</button>
            <button type="action" name="act_runcombo3" style="display: none;">d</button>
        </div>

        <div class="type expanded-view">
            <span class="mini-title floatLeft">Type:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input italic adaptive--text__span" name="attr_type"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_type" placeholder="Primary, Physical"></textarea>
            </div>
        </div>
        <div class="cost expanded-view">
            <span class="mini-title floatLeft">Cost:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span" name="attr_cost"></span>
                <input class="mini-input adaptive--input__input" type="number" name="attr_cost" placeholder="X" />
            </div>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span"  name="attr_resource"></span>
                <input class="mini-input adaptive--input__input" type="text" name="attr_resource" placeholder="Conviction" />
            </div>
        </div>
        <div class="condition expanded-view">
            <span class="mini-title floatLeft">Condition:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_condition"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_condition" placeholder="Under the effect of Fang and Claw Bared / Wheel in Motion Ready"></textarea>
            </div>
        </div>
        <div class="trigger expanded-view">
            <span class="mini-title floatLeft">Trigger:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_trigger"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_trigger" placeholder="Immediately after an ability check for an ability that targets you"></textarea>
            </div>
        </div>
        <div class="target expanded-view">
            <span class="mini-title floatLeft">Target:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_target"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_target" placeholder="Single"></textarea>
            </div>
        </div>
        <div class="range expanded-view">
            <span class="mini-title floatLeft">Range:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_range"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_range" placeholder="1 square"></textarea>
            </div>
        </div>
        <div class="check expanded-view">
            <span class="mini-title floatLeft">Check:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input bold adaptive--input__span" name="attr_check"></span>
                <input class="mini-input bold adaptive--input__input" type="text" name="attr_check" placeholder="d20 + STR" />
            </div>
        </div>
        <div class="cr expanded-view">
            <span class="mini-title floatLeft">CR:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span" name="attr_cr"></span>
                <input class="mini-input adaptive--input__input" type="text" name="attr_cr" placeholder="Target's Defense" />
            </div>
        </div>
    </div>

    <div class="body list">
        <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
        <input type="text" class="directHitFlag hidden" name="attr_directHit" placeholder="P" />
        <input type="text" class="effectFlag hidden" name="attr_effectName" placeholder="P" />
        <input type="text" class="limitationFlag hidden" name="attr_limitation" placeholder="P" />
        <input class="expand-checkbox hidden" type="checkbox" name="attr_repeatingExpandItem" />

        <div class="spacer expanded-view"></div>

        <div class="base-effect expanded-view">
            <span class="mini-title floatLeft">Base Effect:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_baseEffect"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_baseEffect" placeholder="Deals 3 damage and inflicts Enmity on the target. Combo: Rage of Halone."></textarea>
            </div>
        </div>
        <div class="ability-effect list expanded-view">
            <div class="adaptive adaptive--input">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-title adaptive--input__span" name="attr_effectName"></span>
                <span class="mini-title" name="attr_effectName">:</span>
                <input class="mini-title adaptive--input__input" type="text" name="attr_effectName" placeholder="My Effect" />
            </div>
            <div class="adaptive adaptive--text">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_effect"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_effect" placeholder="Provides 1 HP Barrier"></textarea>
            </div>
        </div>
        <div class="direct-hit expanded-view">
            <span class="mini-title floatLeft">Direct Hit:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_directHit"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_directHit" placeholder="Deals an additional 2d6 damage"></textarea>
            </div>
        </div>
        <div class="limitation expanded-view">
            <span class="mini-title floatLeft">Limitation:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span" name="attr_limitation"></span>
                <input class="mini-input adaptive--input__input" type="text" name="attr_limitation" placeholder="Once per phase." />
            </div>
        </div>

        <span class="mini flagTitle expanded-view floatLeft">Stat for rolls (used for calculations):</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_stat" title="Stat for rolls" placeholder="STR, DEX, etc"/>
        <span class="mini flagTitle expanded-view floatLeft">Hit dice type (used for display on rolls):</span>
        <select class="overrideContent expanded-view mini-input" name="attr_hitType">
            <option value="Hit">Hit</option>
            <option value="Critical">Critical</option>
            <option value="None">None</option>
        </select>
        <span class="mini flagTitle expanded-view floatLeft">Damage/Healing (used for display on rolls):</span>
        <select class="overrideContent expanded-view mini-input" name="attr_damageType">
            <option value="Damage">Damage</option>
            <option value="Healing">Healing</option>
            <option value="Defense">Defense</option>
            <option value="Effect">Effect</option>
        </select>
        <span class="mini flagTitle expanded-view floatLeft">Hit die (used for rolls):</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_hitDie" title="Hit" placeholder="1d20cs20, 1d8, etc"/>
        <span class="mini flagTitle expanded-view floatLeft">Base effect dice/value (used to calculate damage)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_baseValue" title="Base effect value" placeholder="5, 1d20 + 2, etc" />
        <span class="mini flagTitle expanded-view floatLeft">Direct Hit dice/value (used to calculate extra damage)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_dhValue" title="Direct Hit value" placeholder="5, 1d20 + 2, etc" />
        <span class="mini flagTitle expanded-view floatLeft">Restoration value (used to restore own HP/MP/resource, include space)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_restore" title="Restore value" placeholder="5 MP, 5 HP, 5 Conviction, etc" />
        <span class="mini flagTitle expanded-view floatLeft">Effects on self (used to automatically add effects)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_effectSelf" title="Effect names" placeholder="Astral Fire, Surging Tempest" />
        <span class="mini flagTitle expanded-view floatLeft">Effects on target (used to add effect shortcut button)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_effectTarget" title="Effect names" placeholder="Major Arcana, Mage's Ballad" />
        <span class="mini flagTitle expanded-view floatLeft">Combo name (used for easy chaining to next ability)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_combo" title="Combo value" placeholder="Storm's Path, Storm's Eye" />
    </div>
</div>                </fieldset>
            </div>
        </div>
        <div class="collapse-overlay collapsed-view "></div>
    </div>

    <!-- Primary abilities -->

    <div class="primary-abilities">
        <input class="expand-checkbox hidden" type="checkbox" name="attr_primaryHeaderExpandItem" />
        <div>
            <button type="action" class="header-action" name="act_primary_info">i</button>
            <h3 class="large">Primary Abilities</h3>
        </div>
        <input type="hidden" class="overrideSwitch" name="attr_override" placeholder="placeholder" />
        <div class="ability-columns expanded-view">
            <div class="ability-column">
                <fieldset class="repeating_primary1">
                    <!-- build:import ability.html-->
<div class="ability">
    <div class="header list">
        <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
        <input type="hidden" class="usesFlag" name="attr_uses_max" />
        <input type="hidden" class="costFlag" name="attr_cost" />
        <input type="text" class="conditionFlag hidden" name="attr_condition" placeholder="P" />
        <input type="text" class="triggerFlag hidden" name="attr_trigger" placeholder="P" />
        <input type="text" class="targetFlag hidden" name="attr_target" placeholder="P" />
        <input type="text" class="checkFlag hidden" name="attr_check" placeholder="P" />
        <input type="text" class="crFlag hidden" name="attr_cr" placeholder="P" />
        <input class="expand-checkbox hidden" type="checkbox" name="attr_repeatingExpandItem" />

        <span class="mini flagTitle expanded-view floatLeft">Icon source:</span>
        <input type="text" class="iconSource overrideContent expanded-view mini-input" name="attr_icon" title="Icon" placeholder="icon source" />

        <div class="uses">
            <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
            <input class="max mini-input floatRight" type="number" name="attr_uses_max" min="0" value="0" />
            <span class="floatRight">/</span>
            <input class="mini-input floatRight" type="number" name="attr_uses" min="0" value="0" />
        </div>

        <div class="header-title">
            <img class="ability-icon" name="attr_icon" />
            <div class="title adaptive adaptive--text">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="bold adaptive--text__span"  name="attr_title"></span>
                <textarea class="adaptive--text__textarea" type="text" name="attr_title" placeholder="Paladin Combo (Fast Blade + Riot Blade)"></textarea>
            </div>
        </div>

        <div class="ability-controls">
            <button type="action" class="ability-action-trigger" name="act_trigger">t</button>
            <button type="action" class="ability-action" name="act_info">i</button>
            <button type="action" class="ability-action" name="act_share">q</button>
            <button type="action" name="act_rolldamage" style="display: none;">d</button>
            <button type="action" name="act_rolldamagewithbonus" style="display: none;">d</button>
            <button type="action" name="act_runcombo1" style="display: none;">d</button>
            <button type="action" name="act_runcombo2" style="display: none;">d</button>
            <button type="action" name="act_runcombo3" style="display: none;">d</button>
        </div>

        <div class="type expanded-view">
            <span class="mini-title floatLeft">Type:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input italic adaptive--text__span" name="attr_type"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_type" placeholder="Primary, Physical"></textarea>
            </div>
        </div>
        <div class="cost expanded-view">
            <span class="mini-title floatLeft">Cost:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span" name="attr_cost"></span>
                <input class="mini-input adaptive--input__input" type="number" name="attr_cost" placeholder="X" />
            </div>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span"  name="attr_resource"></span>
                <input class="mini-input adaptive--input__input" type="text" name="attr_resource" placeholder="Conviction" />
            </div>
        </div>
        <div class="condition expanded-view">
            <span class="mini-title floatLeft">Condition:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_condition"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_condition" placeholder="Under the effect of Fang and Claw Bared / Wheel in Motion Ready"></textarea>
            </div>
        </div>
        <div class="trigger expanded-view">
            <span class="mini-title floatLeft">Trigger:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_trigger"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_trigger" placeholder="Immediately after an ability check for an ability that targets you"></textarea>
            </div>
        </div>
        <div class="target expanded-view">
            <span class="mini-title floatLeft">Target:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_target"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_target" placeholder="Single"></textarea>
            </div>
        </div>
        <div class="range expanded-view">
            <span class="mini-title floatLeft">Range:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_range"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_range" placeholder="1 square"></textarea>
            </div>
        </div>
        <div class="check expanded-view">
            <span class="mini-title floatLeft">Check:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input bold adaptive--input__span" name="attr_check"></span>
                <input class="mini-input bold adaptive--input__input" type="text" name="attr_check" placeholder="d20 + STR" />
            </div>
        </div>
        <div class="cr expanded-view">
            <span class="mini-title floatLeft">CR:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span" name="attr_cr"></span>
                <input class="mini-input adaptive--input__input" type="text" name="attr_cr" placeholder="Target's Defense" />
            </div>
        </div>
    </div>

    <div class="body list">
        <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
        <input type="text" class="directHitFlag hidden" name="attr_directHit" placeholder="P" />
        <input type="text" class="effectFlag hidden" name="attr_effectName" placeholder="P" />
        <input type="text" class="limitationFlag hidden" name="attr_limitation" placeholder="P" />
        <input class="expand-checkbox hidden" type="checkbox" name="attr_repeatingExpandItem" />

        <div class="spacer expanded-view"></div>

        <div class="base-effect expanded-view">
            <span class="mini-title floatLeft">Base Effect:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_baseEffect"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_baseEffect" placeholder="Deals 3 damage and inflicts Enmity on the target. Combo: Rage of Halone."></textarea>
            </div>
        </div>
        <div class="ability-effect list expanded-view">
            <div class="adaptive adaptive--input">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-title adaptive--input__span" name="attr_effectName"></span>
                <span class="mini-title" name="attr_effectName">:</span>
                <input class="mini-title adaptive--input__input" type="text" name="attr_effectName" placeholder="My Effect" />
            </div>
            <div class="adaptive adaptive--text">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_effect"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_effect" placeholder="Provides 1 HP Barrier"></textarea>
            </div>
        </div>
        <div class="direct-hit expanded-view">
            <span class="mini-title floatLeft">Direct Hit:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_directHit"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_directHit" placeholder="Deals an additional 2d6 damage"></textarea>
            </div>
        </div>
        <div class="limitation expanded-view">
            <span class="mini-title floatLeft">Limitation:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span" name="attr_limitation"></span>
                <input class="mini-input adaptive--input__input" type="text" name="attr_limitation" placeholder="Once per phase." />
            </div>
        </div>

        <span class="mini flagTitle expanded-view floatLeft">Stat for rolls (used for calculations):</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_stat" title="Stat for rolls" placeholder="STR, DEX, etc"/>
        <span class="mini flagTitle expanded-view floatLeft">Hit dice type (used for display on rolls):</span>
        <select class="overrideContent expanded-view mini-input" name="attr_hitType">
            <option value="Hit">Hit</option>
            <option value="Critical">Critical</option>
            <option value="None">None</option>
        </select>
        <span class="mini flagTitle expanded-view floatLeft">Damage/Healing (used for display on rolls):</span>
        <select class="overrideContent expanded-view mini-input" name="attr_damageType">
            <option value="Damage">Damage</option>
            <option value="Healing">Healing</option>
            <option value="Defense">Defense</option>
            <option value="Effect">Effect</option>
        </select>
        <span class="mini flagTitle expanded-view floatLeft">Hit die (used for rolls):</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_hitDie" title="Hit" placeholder="1d20cs20, 1d8, etc"/>
        <span class="mini flagTitle expanded-view floatLeft">Base effect dice/value (used to calculate damage)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_baseValue" title="Base effect value" placeholder="5, 1d20 + 2, etc" />
        <span class="mini flagTitle expanded-view floatLeft">Direct Hit dice/value (used to calculate extra damage)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_dhValue" title="Direct Hit value" placeholder="5, 1d20 + 2, etc" />
        <span class="mini flagTitle expanded-view floatLeft">Restoration value (used to restore own HP/MP/resource, include space)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_restore" title="Restore value" placeholder="5 MP, 5 HP, 5 Conviction, etc" />
        <span class="mini flagTitle expanded-view floatLeft">Effects on self (used to automatically add effects)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_effectSelf" title="Effect names" placeholder="Astral Fire, Surging Tempest" />
        <span class="mini flagTitle expanded-view floatLeft">Effects on target (used to add effect shortcut button)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_effectTarget" title="Effect names" placeholder="Major Arcana, Mage's Ballad" />
        <span class="mini flagTitle expanded-view floatLeft">Combo name (used for easy chaining to next ability)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_combo" title="Combo value" placeholder="Storm's Path, Storm's Eye" />
    </div>
</div>                </fieldset>
            </div>
            <div class="ability-column">
                <fieldset class="repeating_primary2">
                    <!-- build:import ability.html-->
<div class="ability">
    <div class="header list">
        <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
        <input type="hidden" class="usesFlag" name="attr_uses_max" />
        <input type="hidden" class="costFlag" name="attr_cost" />
        <input type="text" class="conditionFlag hidden" name="attr_condition" placeholder="P" />
        <input type="text" class="triggerFlag hidden" name="attr_trigger" placeholder="P" />
        <input type="text" class="targetFlag hidden" name="attr_target" placeholder="P" />
        <input type="text" class="checkFlag hidden" name="attr_check" placeholder="P" />
        <input type="text" class="crFlag hidden" name="attr_cr" placeholder="P" />
        <input class="expand-checkbox hidden" type="checkbox" name="attr_repeatingExpandItem" />

        <span class="mini flagTitle expanded-view floatLeft">Icon source:</span>
        <input type="text" class="iconSource overrideContent expanded-view mini-input" name="attr_icon" title="Icon" placeholder="icon source" />

        <div class="uses">
            <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
            <input class="max mini-input floatRight" type="number" name="attr_uses_max" min="0" value="0" />
            <span class="floatRight">/</span>
            <input class="mini-input floatRight" type="number" name="attr_uses" min="0" value="0" />
        </div>

        <div class="header-title">
            <img class="ability-icon" name="attr_icon" />
            <div class="title adaptive adaptive--text">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="bold adaptive--text__span"  name="attr_title"></span>
                <textarea class="adaptive--text__textarea" type="text" name="attr_title" placeholder="Paladin Combo (Fast Blade + Riot Blade)"></textarea>
            </div>
        </div>

        <div class="ability-controls">
            <button type="action" class="ability-action-trigger" name="act_trigger">t</button>
            <button type="action" class="ability-action" name="act_info">i</button>
            <button type="action" class="ability-action" name="act_share">q</button>
            <button type="action" name="act_rolldamage" style="display: none;">d</button>
            <button type="action" name="act_rolldamagewithbonus" style="display: none;">d</button>
            <button type="action" name="act_runcombo1" style="display: none;">d</button>
            <button type="action" name="act_runcombo2" style="display: none;">d</button>
            <button type="action" name="act_runcombo3" style="display: none;">d</button>
        </div>

        <div class="type expanded-view">
            <span class="mini-title floatLeft">Type:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input italic adaptive--text__span" name="attr_type"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_type" placeholder="Primary, Physical"></textarea>
            </div>
        </div>
        <div class="cost expanded-view">
            <span class="mini-title floatLeft">Cost:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span" name="attr_cost"></span>
                <input class="mini-input adaptive--input__input" type="number" name="attr_cost" placeholder="X" />
            </div>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span"  name="attr_resource"></span>
                <input class="mini-input adaptive--input__input" type="text" name="attr_resource" placeholder="Conviction" />
            </div>
        </div>
        <div class="condition expanded-view">
            <span class="mini-title floatLeft">Condition:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_condition"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_condition" placeholder="Under the effect of Fang and Claw Bared / Wheel in Motion Ready"></textarea>
            </div>
        </div>
        <div class="trigger expanded-view">
            <span class="mini-title floatLeft">Trigger:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_trigger"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_trigger" placeholder="Immediately after an ability check for an ability that targets you"></textarea>
            </div>
        </div>
        <div class="target expanded-view">
            <span class="mini-title floatLeft">Target:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_target"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_target" placeholder="Single"></textarea>
            </div>
        </div>
        <div class="range expanded-view">
            <span class="mini-title floatLeft">Range:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_range"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_range" placeholder="1 square"></textarea>
            </div>
        </div>
        <div class="check expanded-view">
            <span class="mini-title floatLeft">Check:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input bold adaptive--input__span" name="attr_check"></span>
                <input class="mini-input bold adaptive--input__input" type="text" name="attr_check" placeholder="d20 + STR" />
            </div>
        </div>
        <div class="cr expanded-view">
            <span class="mini-title floatLeft">CR:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span" name="attr_cr"></span>
                <input class="mini-input adaptive--input__input" type="text" name="attr_cr" placeholder="Target's Defense" />
            </div>
        </div>
    </div>

    <div class="body list">
        <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
        <input type="text" class="directHitFlag hidden" name="attr_directHit" placeholder="P" />
        <input type="text" class="effectFlag hidden" name="attr_effectName" placeholder="P" />
        <input type="text" class="limitationFlag hidden" name="attr_limitation" placeholder="P" />
        <input class="expand-checkbox hidden" type="checkbox" name="attr_repeatingExpandItem" />

        <div class="spacer expanded-view"></div>

        <div class="base-effect expanded-view">
            <span class="mini-title floatLeft">Base Effect:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_baseEffect"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_baseEffect" placeholder="Deals 3 damage and inflicts Enmity on the target. Combo: Rage of Halone."></textarea>
            </div>
        </div>
        <div class="ability-effect list expanded-view">
            <div class="adaptive adaptive--input">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-title adaptive--input__span" name="attr_effectName"></span>
                <span class="mini-title" name="attr_effectName">:</span>
                <input class="mini-title adaptive--input__input" type="text" name="attr_effectName" placeholder="My Effect" />
            </div>
            <div class="adaptive adaptive--text">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_effect"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_effect" placeholder="Provides 1 HP Barrier"></textarea>
            </div>
        </div>
        <div class="direct-hit expanded-view">
            <span class="mini-title floatLeft">Direct Hit:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_directHit"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_directHit" placeholder="Deals an additional 2d6 damage"></textarea>
            </div>
        </div>
        <div class="limitation expanded-view">
            <span class="mini-title floatLeft">Limitation:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span" name="attr_limitation"></span>
                <input class="mini-input adaptive--input__input" type="text" name="attr_limitation" placeholder="Once per phase." />
            </div>
        </div>

        <span class="mini flagTitle expanded-view floatLeft">Stat for rolls (used for calculations):</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_stat" title="Stat for rolls" placeholder="STR, DEX, etc"/>
        <span class="mini flagTitle expanded-view floatLeft">Hit dice type (used for display on rolls):</span>
        <select class="overrideContent expanded-view mini-input" name="attr_hitType">
            <option value="Hit">Hit</option>
            <option value="Critical">Critical</option>
            <option value="None">None</option>
        </select>
        <span class="mini flagTitle expanded-view floatLeft">Damage/Healing (used for display on rolls):</span>
        <select class="overrideContent expanded-view mini-input" name="attr_damageType">
            <option value="Damage">Damage</option>
            <option value="Healing">Healing</option>
            <option value="Defense">Defense</option>
            <option value="Effect">Effect</option>
        </select>
        <span class="mini flagTitle expanded-view floatLeft">Hit die (used for rolls):</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_hitDie" title="Hit" placeholder="1d20cs20, 1d8, etc"/>
        <span class="mini flagTitle expanded-view floatLeft">Base effect dice/value (used to calculate damage)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_baseValue" title="Base effect value" placeholder="5, 1d20 + 2, etc" />
        <span class="mini flagTitle expanded-view floatLeft">Direct Hit dice/value (used to calculate extra damage)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_dhValue" title="Direct Hit value" placeholder="5, 1d20 + 2, etc" />
        <span class="mini flagTitle expanded-view floatLeft">Restoration value (used to restore own HP/MP/resource, include space)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_restore" title="Restore value" placeholder="5 MP, 5 HP, 5 Conviction, etc" />
        <span class="mini flagTitle expanded-view floatLeft">Effects on self (used to automatically add effects)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_effectSelf" title="Effect names" placeholder="Astral Fire, Surging Tempest" />
        <span class="mini flagTitle expanded-view floatLeft">Effects on target (used to add effect shortcut button)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_effectTarget" title="Effect names" placeholder="Major Arcana, Mage's Ballad" />
        <span class="mini flagTitle expanded-view floatLeft">Combo name (used for easy chaining to next ability)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_combo" title="Combo value" placeholder="Storm's Path, Storm's Eye" />
    </div>
</div>                </fieldset>
            </div>
            <div class="ability-column">
                <fieldset class="repeating_primary3">
                    <!-- build:import ability.html-->
<div class="ability">
    <div class="header list">
        <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
        <input type="hidden" class="usesFlag" name="attr_uses_max" />
        <input type="hidden" class="costFlag" name="attr_cost" />
        <input type="text" class="conditionFlag hidden" name="attr_condition" placeholder="P" />
        <input type="text" class="triggerFlag hidden" name="attr_trigger" placeholder="P" />
        <input type="text" class="targetFlag hidden" name="attr_target" placeholder="P" />
        <input type="text" class="checkFlag hidden" name="attr_check" placeholder="P" />
        <input type="text" class="crFlag hidden" name="attr_cr" placeholder="P" />
        <input class="expand-checkbox hidden" type="checkbox" name="attr_repeatingExpandItem" />

        <span class="mini flagTitle expanded-view floatLeft">Icon source:</span>
        <input type="text" class="iconSource overrideContent expanded-view mini-input" name="attr_icon" title="Icon" placeholder="icon source" />

        <div class="uses">
            <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
            <input class="max mini-input floatRight" type="number" name="attr_uses_max" min="0" value="0" />
            <span class="floatRight">/</span>
            <input class="mini-input floatRight" type="number" name="attr_uses" min="0" value="0" />
        </div>

        <div class="header-title">
            <img class="ability-icon" name="attr_icon" />
            <div class="title adaptive adaptive--text">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="bold adaptive--text__span"  name="attr_title"></span>
                <textarea class="adaptive--text__textarea" type="text" name="attr_title" placeholder="Paladin Combo (Fast Blade + Riot Blade)"></textarea>
            </div>
        </div>

        <div class="ability-controls">
            <button type="action" class="ability-action-trigger" name="act_trigger">t</button>
            <button type="action" class="ability-action" name="act_info">i</button>
            <button type="action" class="ability-action" name="act_share">q</button>
            <button type="action" name="act_rolldamage" style="display: none;">d</button>
            <button type="action" name="act_rolldamagewithbonus" style="display: none;">d</button>
            <button type="action" name="act_runcombo1" style="display: none;">d</button>
            <button type="action" name="act_runcombo2" style="display: none;">d</button>
            <button type="action" name="act_runcombo3" style="display: none;">d</button>
        </div>

        <div class="type expanded-view">
            <span class="mini-title floatLeft">Type:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input italic adaptive--text__span" name="attr_type"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_type" placeholder="Primary, Physical"></textarea>
            </div>
        </div>
        <div class="cost expanded-view">
            <span class="mini-title floatLeft">Cost:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span" name="attr_cost"></span>
                <input class="mini-input adaptive--input__input" type="number" name="attr_cost" placeholder="X" />
            </div>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span"  name="attr_resource"></span>
                <input class="mini-input adaptive--input__input" type="text" name="attr_resource" placeholder="Conviction" />
            </div>
        </div>
        <div class="condition expanded-view">
            <span class="mini-title floatLeft">Condition:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_condition"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_condition" placeholder="Under the effect of Fang and Claw Bared / Wheel in Motion Ready"></textarea>
            </div>
        </div>
        <div class="trigger expanded-view">
            <span class="mini-title floatLeft">Trigger:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_trigger"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_trigger" placeholder="Immediately after an ability check for an ability that targets you"></textarea>
            </div>
        </div>
        <div class="target expanded-view">
            <span class="mini-title floatLeft">Target:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_target"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_target" placeholder="Single"></textarea>
            </div>
        </div>
        <div class="range expanded-view">
            <span class="mini-title floatLeft">Range:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_range"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_range" placeholder="1 square"></textarea>
            </div>
        </div>
        <div class="check expanded-view">
            <span class="mini-title floatLeft">Check:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input bold adaptive--input__span" name="attr_check"></span>
                <input class="mini-input bold adaptive--input__input" type="text" name="attr_check" placeholder="d20 + STR" />
            </div>
        </div>
        <div class="cr expanded-view">
            <span class="mini-title floatLeft">CR:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span" name="attr_cr"></span>
                <input class="mini-input adaptive--input__input" type="text" name="attr_cr" placeholder="Target's Defense" />
            </div>
        </div>
    </div>

    <div class="body list">
        <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
        <input type="text" class="directHitFlag hidden" name="attr_directHit" placeholder="P" />
        <input type="text" class="effectFlag hidden" name="attr_effectName" placeholder="P" />
        <input type="text" class="limitationFlag hidden" name="attr_limitation" placeholder="P" />
        <input class="expand-checkbox hidden" type="checkbox" name="attr_repeatingExpandItem" />

        <div class="spacer expanded-view"></div>

        <div class="base-effect expanded-view">
            <span class="mini-title floatLeft">Base Effect:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_baseEffect"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_baseEffect" placeholder="Deals 3 damage and inflicts Enmity on the target. Combo: Rage of Halone."></textarea>
            </div>
        </div>
        <div class="ability-effect list expanded-view">
            <div class="adaptive adaptive--input">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-title adaptive--input__span" name="attr_effectName"></span>
                <span class="mini-title" name="attr_effectName">:</span>
                <input class="mini-title adaptive--input__input" type="text" name="attr_effectName" placeholder="My Effect" />
            </div>
            <div class="adaptive adaptive--text">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_effect"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_effect" placeholder="Provides 1 HP Barrier"></textarea>
            </div>
        </div>
        <div class="direct-hit expanded-view">
            <span class="mini-title floatLeft">Direct Hit:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_directHit"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_directHit" placeholder="Deals an additional 2d6 damage"></textarea>
            </div>
        </div>
        <div class="limitation expanded-view">
            <span class="mini-title floatLeft">Limitation:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span" name="attr_limitation"></span>
                <input class="mini-input adaptive--input__input" type="text" name="attr_limitation" placeholder="Once per phase." />
            </div>
        </div>

        <span class="mini flagTitle expanded-view floatLeft">Stat for rolls (used for calculations):</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_stat" title="Stat for rolls" placeholder="STR, DEX, etc"/>
        <span class="mini flagTitle expanded-view floatLeft">Hit dice type (used for display on rolls):</span>
        <select class="overrideContent expanded-view mini-input" name="attr_hitType">
            <option value="Hit">Hit</option>
            <option value="Critical">Critical</option>
            <option value="None">None</option>
        </select>
        <span class="mini flagTitle expanded-view floatLeft">Damage/Healing (used for display on rolls):</span>
        <select class="overrideContent expanded-view mini-input" name="attr_damageType">
            <option value="Damage">Damage</option>
            <option value="Healing">Healing</option>
            <option value="Defense">Defense</option>
            <option value="Effect">Effect</option>
        </select>
        <span class="mini flagTitle expanded-view floatLeft">Hit die (used for rolls):</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_hitDie" title="Hit" placeholder="1d20cs20, 1d8, etc"/>
        <span class="mini flagTitle expanded-view floatLeft">Base effect dice/value (used to calculate damage)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_baseValue" title="Base effect value" placeholder="5, 1d20 + 2, etc" />
        <span class="mini flagTitle expanded-view floatLeft">Direct Hit dice/value (used to calculate extra damage)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_dhValue" title="Direct Hit value" placeholder="5, 1d20 + 2, etc" />
        <span class="mini flagTitle expanded-view floatLeft">Restoration value (used to restore own HP/MP/resource, include space)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_restore" title="Restore value" placeholder="5 MP, 5 HP, 5 Conviction, etc" />
        <span class="mini flagTitle expanded-view floatLeft">Effects on self (used to automatically add effects)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_effectSelf" title="Effect names" placeholder="Astral Fire, Surging Tempest" />
        <span class="mini flagTitle expanded-view floatLeft">Effects on target (used to add effect shortcut button)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_effectTarget" title="Effect names" placeholder="Major Arcana, Mage's Ballad" />
        <span class="mini flagTitle expanded-view floatLeft">Combo name (used for easy chaining to next ability)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_combo" title="Combo value" placeholder="Storm's Path, Storm's Eye" />
    </div>
</div>                </fieldset>
            </div>
        </div>
        <div class="collapse-overlay collapsed-view "></div>
    </div>

    <!-- Sub-abilities (Ninja jutsu) -->

    <div class="sub-abilities ability-sub-category">
        <input class="expand-checkbox hidden" type="checkbox" name="attr_ninjutsuHeaderExpandItem" />
        <div class="horizontal">
            <h3 class="large">Ninjutsu Abilities</h3>
            <button type="action" class="header-action" name="act_ninjutsu_info">i</button>
        </div>
        <input type="hidden" class="overrideSwitch" name="attr_override" placeholder="placeholder" />
        <div class="ability-columns expanded-view">
            <div class="ability-column">
                <fieldset class="repeating_ninjutsu1">
                    <!-- build:import ability.html-->
<div class="ability">
    <div class="header list">
        <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
        <input type="hidden" class="usesFlag" name="attr_uses_max" />
        <input type="hidden" class="costFlag" name="attr_cost" />
        <input type="text" class="conditionFlag hidden" name="attr_condition" placeholder="P" />
        <input type="text" class="triggerFlag hidden" name="attr_trigger" placeholder="P" />
        <input type="text" class="targetFlag hidden" name="attr_target" placeholder="P" />
        <input type="text" class="checkFlag hidden" name="attr_check" placeholder="P" />
        <input type="text" class="crFlag hidden" name="attr_cr" placeholder="P" />
        <input class="expand-checkbox hidden" type="checkbox" name="attr_repeatingExpandItem" />

        <span class="mini flagTitle expanded-view floatLeft">Icon source:</span>
        <input type="text" class="iconSource overrideContent expanded-view mini-input" name="attr_icon" title="Icon" placeholder="icon source" />

        <div class="uses">
            <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
            <input class="max mini-input floatRight" type="number" name="attr_uses_max" min="0" value="0" />
            <span class="floatRight">/</span>
            <input class="mini-input floatRight" type="number" name="attr_uses" min="0" value="0" />
        </div>

        <div class="header-title">
            <img class="ability-icon" name="attr_icon" />
            <div class="title adaptive adaptive--text">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="bold adaptive--text__span"  name="attr_title"></span>
                <textarea class="adaptive--text__textarea" type="text" name="attr_title" placeholder="Paladin Combo (Fast Blade + Riot Blade)"></textarea>
            </div>
        </div>

        <div class="ability-controls">
            <button type="action" class="ability-action-trigger" name="act_trigger">t</button>
            <button type="action" class="ability-action" name="act_info">i</button>
            <button type="action" class="ability-action" name="act_share">q</button>
            <button type="action" name="act_rolldamage" style="display: none;">d</button>
            <button type="action" name="act_rolldamagewithbonus" style="display: none;">d</button>
            <button type="action" name="act_runcombo1" style="display: none;">d</button>
            <button type="action" name="act_runcombo2" style="display: none;">d</button>
            <button type="action" name="act_runcombo3" style="display: none;">d</button>
        </div>

        <div class="type expanded-view">
            <span class="mini-title floatLeft">Type:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input italic adaptive--text__span" name="attr_type"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_type" placeholder="Primary, Physical"></textarea>
            </div>
        </div>
        <div class="cost expanded-view">
            <span class="mini-title floatLeft">Cost:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span" name="attr_cost"></span>
                <input class="mini-input adaptive--input__input" type="number" name="attr_cost" placeholder="X" />
            </div>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span"  name="attr_resource"></span>
                <input class="mini-input adaptive--input__input" type="text" name="attr_resource" placeholder="Conviction" />
            </div>
        </div>
        <div class="condition expanded-view">
            <span class="mini-title floatLeft">Condition:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_condition"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_condition" placeholder="Under the effect of Fang and Claw Bared / Wheel in Motion Ready"></textarea>
            </div>
        </div>
        <div class="trigger expanded-view">
            <span class="mini-title floatLeft">Trigger:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_trigger"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_trigger" placeholder="Immediately after an ability check for an ability that targets you"></textarea>
            </div>
        </div>
        <div class="target expanded-view">
            <span class="mini-title floatLeft">Target:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_target"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_target" placeholder="Single"></textarea>
            </div>
        </div>
        <div class="range expanded-view">
            <span class="mini-title floatLeft">Range:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_range"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_range" placeholder="1 square"></textarea>
            </div>
        </div>
        <div class="check expanded-view">
            <span class="mini-title floatLeft">Check:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input bold adaptive--input__span" name="attr_check"></span>
                <input class="mini-input bold adaptive--input__input" type="text" name="attr_check" placeholder="d20 + STR" />
            </div>
        </div>
        <div class="cr expanded-view">
            <span class="mini-title floatLeft">CR:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span" name="attr_cr"></span>
                <input class="mini-input adaptive--input__input" type="text" name="attr_cr" placeholder="Target's Defense" />
            </div>
        </div>
    </div>

    <div class="body list">
        <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
        <input type="text" class="directHitFlag hidden" name="attr_directHit" placeholder="P" />
        <input type="text" class="effectFlag hidden" name="attr_effectName" placeholder="P" />
        <input type="text" class="limitationFlag hidden" name="attr_limitation" placeholder="P" />
        <input class="expand-checkbox hidden" type="checkbox" name="attr_repeatingExpandItem" />

        <div class="spacer expanded-view"></div>

        <div class="base-effect expanded-view">
            <span class="mini-title floatLeft">Base Effect:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_baseEffect"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_baseEffect" placeholder="Deals 3 damage and inflicts Enmity on the target. Combo: Rage of Halone."></textarea>
            </div>
        </div>
        <div class="ability-effect list expanded-view">
            <div class="adaptive adaptive--input">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-title adaptive--input__span" name="attr_effectName"></span>
                <span class="mini-title" name="attr_effectName">:</span>
                <input class="mini-title adaptive--input__input" type="text" name="attr_effectName" placeholder="My Effect" />
            </div>
            <div class="adaptive adaptive--text">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_effect"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_effect" placeholder="Provides 1 HP Barrier"></textarea>
            </div>
        </div>
        <div class="direct-hit expanded-view">
            <span class="mini-title floatLeft">Direct Hit:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_directHit"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_directHit" placeholder="Deals an additional 2d6 damage"></textarea>
            </div>
        </div>
        <div class="limitation expanded-view">
            <span class="mini-title floatLeft">Limitation:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span" name="attr_limitation"></span>
                <input class="mini-input adaptive--input__input" type="text" name="attr_limitation" placeholder="Once per phase." />
            </div>
        </div>

        <span class="mini flagTitle expanded-view floatLeft">Stat for rolls (used for calculations):</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_stat" title="Stat for rolls" placeholder="STR, DEX, etc"/>
        <span class="mini flagTitle expanded-view floatLeft">Hit dice type (used for display on rolls):</span>
        <select class="overrideContent expanded-view mini-input" name="attr_hitType">
            <option value="Hit">Hit</option>
            <option value="Critical">Critical</option>
            <option value="None">None</option>
        </select>
        <span class="mini flagTitle expanded-view floatLeft">Damage/Healing (used for display on rolls):</span>
        <select class="overrideContent expanded-view mini-input" name="attr_damageType">
            <option value="Damage">Damage</option>
            <option value="Healing">Healing</option>
            <option value="Defense">Defense</option>
            <option value="Effect">Effect</option>
        </select>
        <span class="mini flagTitle expanded-view floatLeft">Hit die (used for rolls):</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_hitDie" title="Hit" placeholder="1d20cs20, 1d8, etc"/>
        <span class="mini flagTitle expanded-view floatLeft">Base effect dice/value (used to calculate damage)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_baseValue" title="Base effect value" placeholder="5, 1d20 + 2, etc" />
        <span class="mini flagTitle expanded-view floatLeft">Direct Hit dice/value (used to calculate extra damage)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_dhValue" title="Direct Hit value" placeholder="5, 1d20 + 2, etc" />
        <span class="mini flagTitle expanded-view floatLeft">Restoration value (used to restore own HP/MP/resource, include space)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_restore" title="Restore value" placeholder="5 MP, 5 HP, 5 Conviction, etc" />
        <span class="mini flagTitle expanded-view floatLeft">Effects on self (used to automatically add effects)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_effectSelf" title="Effect names" placeholder="Astral Fire, Surging Tempest" />
        <span class="mini flagTitle expanded-view floatLeft">Effects on target (used to add effect shortcut button)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_effectTarget" title="Effect names" placeholder="Major Arcana, Mage's Ballad" />
        <span class="mini flagTitle expanded-view floatLeft">Combo name (used for easy chaining to next ability)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_combo" title="Combo value" placeholder="Storm's Path, Storm's Eye" />
    </div>
</div>                </fieldset>
            </div>
            <div class="ability-column">
                <fieldset class="repeating_ninjutsu2">
                    <!-- build:import ability.html-->
<div class="ability">
    <div class="header list">
        <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
        <input type="hidden" class="usesFlag" name="attr_uses_max" />
        <input type="hidden" class="costFlag" name="attr_cost" />
        <input type="text" class="conditionFlag hidden" name="attr_condition" placeholder="P" />
        <input type="text" class="triggerFlag hidden" name="attr_trigger" placeholder="P" />
        <input type="text" class="targetFlag hidden" name="attr_target" placeholder="P" />
        <input type="text" class="checkFlag hidden" name="attr_check" placeholder="P" />
        <input type="text" class="crFlag hidden" name="attr_cr" placeholder="P" />
        <input class="expand-checkbox hidden" type="checkbox" name="attr_repeatingExpandItem" />

        <span class="mini flagTitle expanded-view floatLeft">Icon source:</span>
        <input type="text" class="iconSource overrideContent expanded-view mini-input" name="attr_icon" title="Icon" placeholder="icon source" />

        <div class="uses">
            <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
            <input class="max mini-input floatRight" type="number" name="attr_uses_max" min="0" value="0" />
            <span class="floatRight">/</span>
            <input class="mini-input floatRight" type="number" name="attr_uses" min="0" value="0" />
        </div>

        <div class="header-title">
            <img class="ability-icon" name="attr_icon" />
            <div class="title adaptive adaptive--text">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="bold adaptive--text__span"  name="attr_title"></span>
                <textarea class="adaptive--text__textarea" type="text" name="attr_title" placeholder="Paladin Combo (Fast Blade + Riot Blade)"></textarea>
            </div>
        </div>

        <div class="ability-controls">
            <button type="action" class="ability-action-trigger" name="act_trigger">t</button>
            <button type="action" class="ability-action" name="act_info">i</button>
            <button type="action" class="ability-action" name="act_share">q</button>
            <button type="action" name="act_rolldamage" style="display: none;">d</button>
            <button type="action" name="act_rolldamagewithbonus" style="display: none;">d</button>
            <button type="action" name="act_runcombo1" style="display: none;">d</button>
            <button type="action" name="act_runcombo2" style="display: none;">d</button>
            <button type="action" name="act_runcombo3" style="display: none;">d</button>
        </div>

        <div class="type expanded-view">
            <span class="mini-title floatLeft">Type:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input italic adaptive--text__span" name="attr_type"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_type" placeholder="Primary, Physical"></textarea>
            </div>
        </div>
        <div class="cost expanded-view">
            <span class="mini-title floatLeft">Cost:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span" name="attr_cost"></span>
                <input class="mini-input adaptive--input__input" type="number" name="attr_cost" placeholder="X" />
            </div>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span"  name="attr_resource"></span>
                <input class="mini-input adaptive--input__input" type="text" name="attr_resource" placeholder="Conviction" />
            </div>
        </div>
        <div class="condition expanded-view">
            <span class="mini-title floatLeft">Condition:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_condition"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_condition" placeholder="Under the effect of Fang and Claw Bared / Wheel in Motion Ready"></textarea>
            </div>
        </div>
        <div class="trigger expanded-view">
            <span class="mini-title floatLeft">Trigger:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_trigger"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_trigger" placeholder="Immediately after an ability check for an ability that targets you"></textarea>
            </div>
        </div>
        <div class="target expanded-view">
            <span class="mini-title floatLeft">Target:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_target"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_target" placeholder="Single"></textarea>
            </div>
        </div>
        <div class="range expanded-view">
            <span class="mini-title floatLeft">Range:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_range"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_range" placeholder="1 square"></textarea>
            </div>
        </div>
        <div class="check expanded-view">
            <span class="mini-title floatLeft">Check:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input bold adaptive--input__span" name="attr_check"></span>
                <input class="mini-input bold adaptive--input__input" type="text" name="attr_check" placeholder="d20 + STR" />
            </div>
        </div>
        <div class="cr expanded-view">
            <span class="mini-title floatLeft">CR:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span" name="attr_cr"></span>
                <input class="mini-input adaptive--input__input" type="text" name="attr_cr" placeholder="Target's Defense" />
            </div>
        </div>
    </div>

    <div class="body list">
        <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
        <input type="text" class="directHitFlag hidden" name="attr_directHit" placeholder="P" />
        <input type="text" class="effectFlag hidden" name="attr_effectName" placeholder="P" />
        <input type="text" class="limitationFlag hidden" name="attr_limitation" placeholder="P" />
        <input class="expand-checkbox hidden" type="checkbox" name="attr_repeatingExpandItem" />

        <div class="spacer expanded-view"></div>

        <div class="base-effect expanded-view">
            <span class="mini-title floatLeft">Base Effect:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_baseEffect"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_baseEffect" placeholder="Deals 3 damage and inflicts Enmity on the target. Combo: Rage of Halone."></textarea>
            </div>
        </div>
        <div class="ability-effect list expanded-view">
            <div class="adaptive adaptive--input">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-title adaptive--input__span" name="attr_effectName"></span>
                <span class="mini-title" name="attr_effectName">:</span>
                <input class="mini-title adaptive--input__input" type="text" name="attr_effectName" placeholder="My Effect" />
            </div>
            <div class="adaptive adaptive--text">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_effect"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_effect" placeholder="Provides 1 HP Barrier"></textarea>
            </div>
        </div>
        <div class="direct-hit expanded-view">
            <span class="mini-title floatLeft">Direct Hit:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_directHit"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_directHit" placeholder="Deals an additional 2d6 damage"></textarea>
            </div>
        </div>
        <div class="limitation expanded-view">
            <span class="mini-title floatLeft">Limitation:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span" name="attr_limitation"></span>
                <input class="mini-input adaptive--input__input" type="text" name="attr_limitation" placeholder="Once per phase." />
            </div>
        </div>

        <span class="mini flagTitle expanded-view floatLeft">Stat for rolls (used for calculations):</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_stat" title="Stat for rolls" placeholder="STR, DEX, etc"/>
        <span class="mini flagTitle expanded-view floatLeft">Hit dice type (used for display on rolls):</span>
        <select class="overrideContent expanded-view mini-input" name="attr_hitType">
            <option value="Hit">Hit</option>
            <option value="Critical">Critical</option>
            <option value="None">None</option>
        </select>
        <span class="mini flagTitle expanded-view floatLeft">Damage/Healing (used for display on rolls):</span>
        <select class="overrideContent expanded-view mini-input" name="attr_damageType">
            <option value="Damage">Damage</option>
            <option value="Healing">Healing</option>
            <option value="Defense">Defense</option>
            <option value="Effect">Effect</option>
        </select>
        <span class="mini flagTitle expanded-view floatLeft">Hit die (used for rolls):</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_hitDie" title="Hit" placeholder="1d20cs20, 1d8, etc"/>
        <span class="mini flagTitle expanded-view floatLeft">Base effect dice/value (used to calculate damage)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_baseValue" title="Base effect value" placeholder="5, 1d20 + 2, etc" />
        <span class="mini flagTitle expanded-view floatLeft">Direct Hit dice/value (used to calculate extra damage)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_dhValue" title="Direct Hit value" placeholder="5, 1d20 + 2, etc" />
        <span class="mini flagTitle expanded-view floatLeft">Restoration value (used to restore own HP/MP/resource, include space)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_restore" title="Restore value" placeholder="5 MP, 5 HP, 5 Conviction, etc" />
        <span class="mini flagTitle expanded-view floatLeft">Effects on self (used to automatically add effects)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_effectSelf" title="Effect names" placeholder="Astral Fire, Surging Tempest" />
        <span class="mini flagTitle expanded-view floatLeft">Effects on target (used to add effect shortcut button)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_effectTarget" title="Effect names" placeholder="Major Arcana, Mage's Ballad" />
        <span class="mini flagTitle expanded-view floatLeft">Combo name (used for easy chaining to next ability)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_combo" title="Combo value" placeholder="Storm's Path, Storm's Eye" />
    </div>
</div>                </fieldset>
            </div>
            <div class="ability-column">
                <fieldset class="repeating_ninjutsu3">
                    <!-- build:import ability.html-->
<div class="ability">
    <div class="header list">
        <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
        <input type="hidden" class="usesFlag" name="attr_uses_max" />
        <input type="hidden" class="costFlag" name="attr_cost" />
        <input type="text" class="conditionFlag hidden" name="attr_condition" placeholder="P" />
        <input type="text" class="triggerFlag hidden" name="attr_trigger" placeholder="P" />
        <input type="text" class="targetFlag hidden" name="attr_target" placeholder="P" />
        <input type="text" class="checkFlag hidden" name="attr_check" placeholder="P" />
        <input type="text" class="crFlag hidden" name="attr_cr" placeholder="P" />
        <input class="expand-checkbox hidden" type="checkbox" name="attr_repeatingExpandItem" />

        <span class="mini flagTitle expanded-view floatLeft">Icon source:</span>
        <input type="text" class="iconSource overrideContent expanded-view mini-input" name="attr_icon" title="Icon" placeholder="icon source" />

        <div class="uses">
            <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
            <input class="max mini-input floatRight" type="number" name="attr_uses_max" min="0" value="0" />
            <span class="floatRight">/</span>
            <input class="mini-input floatRight" type="number" name="attr_uses" min="0" value="0" />
        </div>

        <div class="header-title">
            <img class="ability-icon" name="attr_icon" />
            <div class="title adaptive adaptive--text">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="bold adaptive--text__span"  name="attr_title"></span>
                <textarea class="adaptive--text__textarea" type="text" name="attr_title" placeholder="Paladin Combo (Fast Blade + Riot Blade)"></textarea>
            </div>
        </div>

        <div class="ability-controls">
            <button type="action" class="ability-action-trigger" name="act_trigger">t</button>
            <button type="action" class="ability-action" name="act_info">i</button>
            <button type="action" class="ability-action" name="act_share">q</button>
            <button type="action" name="act_rolldamage" style="display: none;">d</button>
            <button type="action" name="act_rolldamagewithbonus" style="display: none;">d</button>
            <button type="action" name="act_runcombo1" style="display: none;">d</button>
            <button type="action" name="act_runcombo2" style="display: none;">d</button>
            <button type="action" name="act_runcombo3" style="display: none;">d</button>
        </div>

        <div class="type expanded-view">
            <span class="mini-title floatLeft">Type:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input italic adaptive--text__span" name="attr_type"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_type" placeholder="Primary, Physical"></textarea>
            </div>
        </div>
        <div class="cost expanded-view">
            <span class="mini-title floatLeft">Cost:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span" name="attr_cost"></span>
                <input class="mini-input adaptive--input__input" type="number" name="attr_cost" placeholder="X" />
            </div>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span"  name="attr_resource"></span>
                <input class="mini-input adaptive--input__input" type="text" name="attr_resource" placeholder="Conviction" />
            </div>
        </div>
        <div class="condition expanded-view">
            <span class="mini-title floatLeft">Condition:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_condition"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_condition" placeholder="Under the effect of Fang and Claw Bared / Wheel in Motion Ready"></textarea>
            </div>
        </div>
        <div class="trigger expanded-view">
            <span class="mini-title floatLeft">Trigger:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_trigger"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_trigger" placeholder="Immediately after an ability check for an ability that targets you"></textarea>
            </div>
        </div>
        <div class="target expanded-view">
            <span class="mini-title floatLeft">Target:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_target"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_target" placeholder="Single"></textarea>
            </div>
        </div>
        <div class="range expanded-view">
            <span class="mini-title floatLeft">Range:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_range"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_range" placeholder="1 square"></textarea>
            </div>
        </div>
        <div class="check expanded-view">
            <span class="mini-title floatLeft">Check:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input bold adaptive--input__span" name="attr_check"></span>
                <input class="mini-input bold adaptive--input__input" type="text" name="attr_check" placeholder="d20 + STR" />
            </div>
        </div>
        <div class="cr expanded-view">
            <span class="mini-title floatLeft">CR:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span" name="attr_cr"></span>
                <input class="mini-input adaptive--input__input" type="text" name="attr_cr" placeholder="Target's Defense" />
            </div>
        </div>
    </div>

    <div class="body list">
        <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
        <input type="text" class="directHitFlag hidden" name="attr_directHit" placeholder="P" />
        <input type="text" class="effectFlag hidden" name="attr_effectName" placeholder="P" />
        <input type="text" class="limitationFlag hidden" name="attr_limitation" placeholder="P" />
        <input class="expand-checkbox hidden" type="checkbox" name="attr_repeatingExpandItem" />

        <div class="spacer expanded-view"></div>

        <div class="base-effect expanded-view">
            <span class="mini-title floatLeft">Base Effect:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_baseEffect"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_baseEffect" placeholder="Deals 3 damage and inflicts Enmity on the target. Combo: Rage of Halone."></textarea>
            </div>
        </div>
        <div class="ability-effect list expanded-view">
            <div class="adaptive adaptive--input">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-title adaptive--input__span" name="attr_effectName"></span>
                <span class="mini-title" name="attr_effectName">:</span>
                <input class="mini-title adaptive--input__input" type="text" name="attr_effectName" placeholder="My Effect" />
            </div>
            <div class="adaptive adaptive--text">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_effect"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_effect" placeholder="Provides 1 HP Barrier"></textarea>
            </div>
        </div>
        <div class="direct-hit expanded-view">
            <span class="mini-title floatLeft">Direct Hit:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_directHit"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_directHit" placeholder="Deals an additional 2d6 damage"></textarea>
            </div>
        </div>
        <div class="limitation expanded-view">
            <span class="mini-title floatLeft">Limitation:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span" name="attr_limitation"></span>
                <input class="mini-input adaptive--input__input" type="text" name="attr_limitation" placeholder="Once per phase." />
            </div>
        </div>

        <span class="mini flagTitle expanded-view floatLeft">Stat for rolls (used for calculations):</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_stat" title="Stat for rolls" placeholder="STR, DEX, etc"/>
        <span class="mini flagTitle expanded-view floatLeft">Hit dice type (used for display on rolls):</span>
        <select class="overrideContent expanded-view mini-input" name="attr_hitType">
            <option value="Hit">Hit</option>
            <option value="Critical">Critical</option>
            <option value="None">None</option>
        </select>
        <span class="mini flagTitle expanded-view floatLeft">Damage/Healing (used for display on rolls):</span>
        <select class="overrideContent expanded-view mini-input" name="attr_damageType">
            <option value="Damage">Damage</option>
            <option value="Healing">Healing</option>
            <option value="Defense">Defense</option>
            <option value="Effect">Effect</option>
        </select>
        <span class="mini flagTitle expanded-view floatLeft">Hit die (used for rolls):</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_hitDie" title="Hit" placeholder="1d20cs20, 1d8, etc"/>
        <span class="mini flagTitle expanded-view floatLeft">Base effect dice/value (used to calculate damage)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_baseValue" title="Base effect value" placeholder="5, 1d20 + 2, etc" />
        <span class="mini flagTitle expanded-view floatLeft">Direct Hit dice/value (used to calculate extra damage)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_dhValue" title="Direct Hit value" placeholder="5, 1d20 + 2, etc" />
        <span class="mini flagTitle expanded-view floatLeft">Restoration value (used to restore own HP/MP/resource, include space)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_restore" title="Restore value" placeholder="5 MP, 5 HP, 5 Conviction, etc" />
        <span class="mini flagTitle expanded-view floatLeft">Effects on self (used to automatically add effects)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_effectSelf" title="Effect names" placeholder="Astral Fire, Surging Tempest" />
        <span class="mini flagTitle expanded-view floatLeft">Effects on target (used to add effect shortcut button)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_effectTarget" title="Effect names" placeholder="Major Arcana, Mage's Ballad" />
        <span class="mini flagTitle expanded-view floatLeft">Combo name (used for easy chaining to next ability)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_combo" title="Combo value" placeholder="Storm's Path, Storm's Eye" />
    </div>
</div>                </fieldset>
            </div>
        </div>
        <div class="collapse-overlay collapsed-view "></div>
    </div>

    <!-- Secondary abilities -->

    <div class="secondary-abilities">
        <input class="expand-checkbox hidden" type="checkbox" name="attr_secondaryHeaderExpandItem" />
        <button type="action" class="header-action" name="act_secondary_info">i</button>
        <h3 class="large">Secondary Abilities</h3>
        <input type="hidden" class="overrideSwitch" name="attr_override" placeholder="placeholder" />
        <div class="ability-columns expanded-view">
            <div class="ability-column">
                <fieldset class="repeating_secondary1">
                    <!-- build:import ability.html-->
<div class="ability">
    <div class="header list">
        <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
        <input type="hidden" class="usesFlag" name="attr_uses_max" />
        <input type="hidden" class="costFlag" name="attr_cost" />
        <input type="text" class="conditionFlag hidden" name="attr_condition" placeholder="P" />
        <input type="text" class="triggerFlag hidden" name="attr_trigger" placeholder="P" />
        <input type="text" class="targetFlag hidden" name="attr_target" placeholder="P" />
        <input type="text" class="checkFlag hidden" name="attr_check" placeholder="P" />
        <input type="text" class="crFlag hidden" name="attr_cr" placeholder="P" />
        <input class="expand-checkbox hidden" type="checkbox" name="attr_repeatingExpandItem" />

        <span class="mini flagTitle expanded-view floatLeft">Icon source:</span>
        <input type="text" class="iconSource overrideContent expanded-view mini-input" name="attr_icon" title="Icon" placeholder="icon source" />

        <div class="uses">
            <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
            <input class="max mini-input floatRight" type="number" name="attr_uses_max" min="0" value="0" />
            <span class="floatRight">/</span>
            <input class="mini-input floatRight" type="number" name="attr_uses" min="0" value="0" />
        </div>

        <div class="header-title">
            <img class="ability-icon" name="attr_icon" />
            <div class="title adaptive adaptive--text">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="bold adaptive--text__span"  name="attr_title"></span>
                <textarea class="adaptive--text__textarea" type="text" name="attr_title" placeholder="Paladin Combo (Fast Blade + Riot Blade)"></textarea>
            </div>
        </div>

        <div class="ability-controls">
            <button type="action" class="ability-action-trigger" name="act_trigger">t</button>
            <button type="action" class="ability-action" name="act_info">i</button>
            <button type="action" class="ability-action" name="act_share">q</button>
            <button type="action" name="act_rolldamage" style="display: none;">d</button>
            <button type="action" name="act_rolldamagewithbonus" style="display: none;">d</button>
            <button type="action" name="act_runcombo1" style="display: none;">d</button>
            <button type="action" name="act_runcombo2" style="display: none;">d</button>
            <button type="action" name="act_runcombo3" style="display: none;">d</button>
        </div>

        <div class="type expanded-view">
            <span class="mini-title floatLeft">Type:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input italic adaptive--text__span" name="attr_type"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_type" placeholder="Primary, Physical"></textarea>
            </div>
        </div>
        <div class="cost expanded-view">
            <span class="mini-title floatLeft">Cost:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span" name="attr_cost"></span>
                <input class="mini-input adaptive--input__input" type="number" name="attr_cost" placeholder="X" />
            </div>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span"  name="attr_resource"></span>
                <input class="mini-input adaptive--input__input" type="text" name="attr_resource" placeholder="Conviction" />
            </div>
        </div>
        <div class="condition expanded-view">
            <span class="mini-title floatLeft">Condition:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_condition"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_condition" placeholder="Under the effect of Fang and Claw Bared / Wheel in Motion Ready"></textarea>
            </div>
        </div>
        <div class="trigger expanded-view">
            <span class="mini-title floatLeft">Trigger:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_trigger"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_trigger" placeholder="Immediately after an ability check for an ability that targets you"></textarea>
            </div>
        </div>
        <div class="target expanded-view">
            <span class="mini-title floatLeft">Target:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_target"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_target" placeholder="Single"></textarea>
            </div>
        </div>
        <div class="range expanded-view">
            <span class="mini-title floatLeft">Range:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_range"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_range" placeholder="1 square"></textarea>
            </div>
        </div>
        <div class="check expanded-view">
            <span class="mini-title floatLeft">Check:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input bold adaptive--input__span" name="attr_check"></span>
                <input class="mini-input bold adaptive--input__input" type="text" name="attr_check" placeholder="d20 + STR" />
            </div>
        </div>
        <div class="cr expanded-view">
            <span class="mini-title floatLeft">CR:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span" name="attr_cr"></span>
                <input class="mini-input adaptive--input__input" type="text" name="attr_cr" placeholder="Target's Defense" />
            </div>
        </div>
    </div>

    <div class="body list">
        <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
        <input type="text" class="directHitFlag hidden" name="attr_directHit" placeholder="P" />
        <input type="text" class="effectFlag hidden" name="attr_effectName" placeholder="P" />
        <input type="text" class="limitationFlag hidden" name="attr_limitation" placeholder="P" />
        <input class="expand-checkbox hidden" type="checkbox" name="attr_repeatingExpandItem" />

        <div class="spacer expanded-view"></div>

        <div class="base-effect expanded-view">
            <span class="mini-title floatLeft">Base Effect:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_baseEffect"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_baseEffect" placeholder="Deals 3 damage and inflicts Enmity on the target. Combo: Rage of Halone."></textarea>
            </div>
        </div>
        <div class="ability-effect list expanded-view">
            <div class="adaptive adaptive--input">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-title adaptive--input__span" name="attr_effectName"></span>
                <span class="mini-title" name="attr_effectName">:</span>
                <input class="mini-title adaptive--input__input" type="text" name="attr_effectName" placeholder="My Effect" />
            </div>
            <div class="adaptive adaptive--text">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_effect"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_effect" placeholder="Provides 1 HP Barrier"></textarea>
            </div>
        </div>
        <div class="direct-hit expanded-view">
            <span class="mini-title floatLeft">Direct Hit:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_directHit"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_directHit" placeholder="Deals an additional 2d6 damage"></textarea>
            </div>
        </div>
        <div class="limitation expanded-view">
            <span class="mini-title floatLeft">Limitation:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span" name="attr_limitation"></span>
                <input class="mini-input adaptive--input__input" type="text" name="attr_limitation" placeholder="Once per phase." />
            </div>
        </div>

        <span class="mini flagTitle expanded-view floatLeft">Stat for rolls (used for calculations):</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_stat" title="Stat for rolls" placeholder="STR, DEX, etc"/>
        <span class="mini flagTitle expanded-view floatLeft">Hit dice type (used for display on rolls):</span>
        <select class="overrideContent expanded-view mini-input" name="attr_hitType">
            <option value="Hit">Hit</option>
            <option value="Critical">Critical</option>
            <option value="None">None</option>
        </select>
        <span class="mini flagTitle expanded-view floatLeft">Damage/Healing (used for display on rolls):</span>
        <select class="overrideContent expanded-view mini-input" name="attr_damageType">
            <option value="Damage">Damage</option>
            <option value="Healing">Healing</option>
            <option value="Defense">Defense</option>
            <option value="Effect">Effect</option>
        </select>
        <span class="mini flagTitle expanded-view floatLeft">Hit die (used for rolls):</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_hitDie" title="Hit" placeholder="1d20cs20, 1d8, etc"/>
        <span class="mini flagTitle expanded-view floatLeft">Base effect dice/value (used to calculate damage)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_baseValue" title="Base effect value" placeholder="5, 1d20 + 2, etc" />
        <span class="mini flagTitle expanded-view floatLeft">Direct Hit dice/value (used to calculate extra damage)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_dhValue" title="Direct Hit value" placeholder="5, 1d20 + 2, etc" />
        <span class="mini flagTitle expanded-view floatLeft">Restoration value (used to restore own HP/MP/resource, include space)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_restore" title="Restore value" placeholder="5 MP, 5 HP, 5 Conviction, etc" />
        <span class="mini flagTitle expanded-view floatLeft">Effects on self (used to automatically add effects)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_effectSelf" title="Effect names" placeholder="Astral Fire, Surging Tempest" />
        <span class="mini flagTitle expanded-view floatLeft">Effects on target (used to add effect shortcut button)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_effectTarget" title="Effect names" placeholder="Major Arcana, Mage's Ballad" />
        <span class="mini flagTitle expanded-view floatLeft">Combo name (used for easy chaining to next ability)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_combo" title="Combo value" placeholder="Storm's Path, Storm's Eye" />
    </div>
</div>                </fieldset>
            </div>
            <div class="ability-column">
                <fieldset class="repeating_secondary2">
                    <!-- build:import ability.html-->
<div class="ability">
    <div class="header list">
        <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
        <input type="hidden" class="usesFlag" name="attr_uses_max" />
        <input type="hidden" class="costFlag" name="attr_cost" />
        <input type="text" class="conditionFlag hidden" name="attr_condition" placeholder="P" />
        <input type="text" class="triggerFlag hidden" name="attr_trigger" placeholder="P" />
        <input type="text" class="targetFlag hidden" name="attr_target" placeholder="P" />
        <input type="text" class="checkFlag hidden" name="attr_check" placeholder="P" />
        <input type="text" class="crFlag hidden" name="attr_cr" placeholder="P" />
        <input class="expand-checkbox hidden" type="checkbox" name="attr_repeatingExpandItem" />

        <span class="mini flagTitle expanded-view floatLeft">Icon source:</span>
        <input type="text" class="iconSource overrideContent expanded-view mini-input" name="attr_icon" title="Icon" placeholder="icon source" />

        <div class="uses">
            <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
            <input class="max mini-input floatRight" type="number" name="attr_uses_max" min="0" value="0" />
            <span class="floatRight">/</span>
            <input class="mini-input floatRight" type="number" name="attr_uses" min="0" value="0" />
        </div>

        <div class="header-title">
            <img class="ability-icon" name="attr_icon" />
            <div class="title adaptive adaptive--text">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="bold adaptive--text__span"  name="attr_title"></span>
                <textarea class="adaptive--text__textarea" type="text" name="attr_title" placeholder="Paladin Combo (Fast Blade + Riot Blade)"></textarea>
            </div>
        </div>

        <div class="ability-controls">
            <button type="action" class="ability-action-trigger" name="act_trigger">t</button>
            <button type="action" class="ability-action" name="act_info">i</button>
            <button type="action" class="ability-action" name="act_share">q</button>
            <button type="action" name="act_rolldamage" style="display: none;">d</button>
            <button type="action" name="act_rolldamagewithbonus" style="display: none;">d</button>
            <button type="action" name="act_runcombo1" style="display: none;">d</button>
            <button type="action" name="act_runcombo2" style="display: none;">d</button>
            <button type="action" name="act_runcombo3" style="display: none;">d</button>
        </div>

        <div class="type expanded-view">
            <span class="mini-title floatLeft">Type:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input italic adaptive--text__span" name="attr_type"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_type" placeholder="Primary, Physical"></textarea>
            </div>
        </div>
        <div class="cost expanded-view">
            <span class="mini-title floatLeft">Cost:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span" name="attr_cost"></span>
                <input class="mini-input adaptive--input__input" type="number" name="attr_cost" placeholder="X" />
            </div>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span"  name="attr_resource"></span>
                <input class="mini-input adaptive--input__input" type="text" name="attr_resource" placeholder="Conviction" />
            </div>
        </div>
        <div class="condition expanded-view">
            <span class="mini-title floatLeft">Condition:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_condition"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_condition" placeholder="Under the effect of Fang and Claw Bared / Wheel in Motion Ready"></textarea>
            </div>
        </div>
        <div class="trigger expanded-view">
            <span class="mini-title floatLeft">Trigger:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_trigger"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_trigger" placeholder="Immediately after an ability check for an ability that targets you"></textarea>
            </div>
        </div>
        <div class="target expanded-view">
            <span class="mini-title floatLeft">Target:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_target"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_target" placeholder="Single"></textarea>
            </div>
        </div>
        <div class="range expanded-view">
            <span class="mini-title floatLeft">Range:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_range"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_range" placeholder="1 square"></textarea>
            </div>
        </div>
        <div class="check expanded-view">
            <span class="mini-title floatLeft">Check:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input bold adaptive--input__span" name="attr_check"></span>
                <input class="mini-input bold adaptive--input__input" type="text" name="attr_check" placeholder="d20 + STR" />
            </div>
        </div>
        <div class="cr expanded-view">
            <span class="mini-title floatLeft">CR:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span" name="attr_cr"></span>
                <input class="mini-input adaptive--input__input" type="text" name="attr_cr" placeholder="Target's Defense" />
            </div>
        </div>
    </div>

    <div class="body list">
        <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
        <input type="text" class="directHitFlag hidden" name="attr_directHit" placeholder="P" />
        <input type="text" class="effectFlag hidden" name="attr_effectName" placeholder="P" />
        <input type="text" class="limitationFlag hidden" name="attr_limitation" placeholder="P" />
        <input class="expand-checkbox hidden" type="checkbox" name="attr_repeatingExpandItem" />

        <div class="spacer expanded-view"></div>

        <div class="base-effect expanded-view">
            <span class="mini-title floatLeft">Base Effect:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_baseEffect"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_baseEffect" placeholder="Deals 3 damage and inflicts Enmity on the target. Combo: Rage of Halone."></textarea>
            </div>
        </div>
        <div class="ability-effect list expanded-view">
            <div class="adaptive adaptive--input">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-title adaptive--input__span" name="attr_effectName"></span>
                <span class="mini-title" name="attr_effectName">:</span>
                <input class="mini-title adaptive--input__input" type="text" name="attr_effectName" placeholder="My Effect" />
            </div>
            <div class="adaptive adaptive--text">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_effect"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_effect" placeholder="Provides 1 HP Barrier"></textarea>
            </div>
        </div>
        <div class="direct-hit expanded-view">
            <span class="mini-title floatLeft">Direct Hit:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_directHit"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_directHit" placeholder="Deals an additional 2d6 damage"></textarea>
            </div>
        </div>
        <div class="limitation expanded-view">
            <span class="mini-title floatLeft">Limitation:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span" name="attr_limitation"></span>
                <input class="mini-input adaptive--input__input" type="text" name="attr_limitation" placeholder="Once per phase." />
            </div>
        </div>

        <span class="mini flagTitle expanded-view floatLeft">Stat for rolls (used for calculations):</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_stat" title="Stat for rolls" placeholder="STR, DEX, etc"/>
        <span class="mini flagTitle expanded-view floatLeft">Hit dice type (used for display on rolls):</span>
        <select class="overrideContent expanded-view mini-input" name="attr_hitType">
            <option value="Hit">Hit</option>
            <option value="Critical">Critical</option>
            <option value="None">None</option>
        </select>
        <span class="mini flagTitle expanded-view floatLeft">Damage/Healing (used for display on rolls):</span>
        <select class="overrideContent expanded-view mini-input" name="attr_damageType">
            <option value="Damage">Damage</option>
            <option value="Healing">Healing</option>
            <option value="Defense">Defense</option>
            <option value="Effect">Effect</option>
        </select>
        <span class="mini flagTitle expanded-view floatLeft">Hit die (used for rolls):</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_hitDie" title="Hit" placeholder="1d20cs20, 1d8, etc"/>
        <span class="mini flagTitle expanded-view floatLeft">Base effect dice/value (used to calculate damage)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_baseValue" title="Base effect value" placeholder="5, 1d20 + 2, etc" />
        <span class="mini flagTitle expanded-view floatLeft">Direct Hit dice/value (used to calculate extra damage)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_dhValue" title="Direct Hit value" placeholder="5, 1d20 + 2, etc" />
        <span class="mini flagTitle expanded-view floatLeft">Restoration value (used to restore own HP/MP/resource, include space)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_restore" title="Restore value" placeholder="5 MP, 5 HP, 5 Conviction, etc" />
        <span class="mini flagTitle expanded-view floatLeft">Effects on self (used to automatically add effects)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_effectSelf" title="Effect names" placeholder="Astral Fire, Surging Tempest" />
        <span class="mini flagTitle expanded-view floatLeft">Effects on target (used to add effect shortcut button)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_effectTarget" title="Effect names" placeholder="Major Arcana, Mage's Ballad" />
        <span class="mini flagTitle expanded-view floatLeft">Combo name (used for easy chaining to next ability)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_combo" title="Combo value" placeholder="Storm's Path, Storm's Eye" />
    </div>
</div>                </fieldset>
            </div>
            <div class="ability-column">
                <fieldset class="repeating_secondary3">
                    <!-- build:import ability.html-->
<div class="ability">
    <div class="header list">
        <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
        <input type="hidden" class="usesFlag" name="attr_uses_max" />
        <input type="hidden" class="costFlag" name="attr_cost" />
        <input type="text" class="conditionFlag hidden" name="attr_condition" placeholder="P" />
        <input type="text" class="triggerFlag hidden" name="attr_trigger" placeholder="P" />
        <input type="text" class="targetFlag hidden" name="attr_target" placeholder="P" />
        <input type="text" class="checkFlag hidden" name="attr_check" placeholder="P" />
        <input type="text" class="crFlag hidden" name="attr_cr" placeholder="P" />
        <input class="expand-checkbox hidden" type="checkbox" name="attr_repeatingExpandItem" />

        <span class="mini flagTitle expanded-view floatLeft">Icon source:</span>
        <input type="text" class="iconSource overrideContent expanded-view mini-input" name="attr_icon" title="Icon" placeholder="icon source" />

        <div class="uses">
            <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
            <input class="max mini-input floatRight" type="number" name="attr_uses_max" min="0" value="0" />
            <span class="floatRight">/</span>
            <input class="mini-input floatRight" type="number" name="attr_uses" min="0" value="0" />
        </div>

        <div class="header-title">
            <img class="ability-icon" name="attr_icon" />
            <div class="title adaptive adaptive--text">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="bold adaptive--text__span"  name="attr_title"></span>
                <textarea class="adaptive--text__textarea" type="text" name="attr_title" placeholder="Paladin Combo (Fast Blade + Riot Blade)"></textarea>
            </div>
        </div>

        <div class="ability-controls">
            <button type="action" class="ability-action-trigger" name="act_trigger">t</button>
            <button type="action" class="ability-action" name="act_info">i</button>
            <button type="action" class="ability-action" name="act_share">q</button>
            <button type="action" name="act_rolldamage" style="display: none;">d</button>
            <button type="action" name="act_rolldamagewithbonus" style="display: none;">d</button>
            <button type="action" name="act_runcombo1" style="display: none;">d</button>
            <button type="action" name="act_runcombo2" style="display: none;">d</button>
            <button type="action" name="act_runcombo3" style="display: none;">d</button>
        </div>

        <div class="type expanded-view">
            <span class="mini-title floatLeft">Type:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input italic adaptive--text__span" name="attr_type"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_type" placeholder="Primary, Physical"></textarea>
            </div>
        </div>
        <div class="cost expanded-view">
            <span class="mini-title floatLeft">Cost:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span" name="attr_cost"></span>
                <input class="mini-input adaptive--input__input" type="number" name="attr_cost" placeholder="X" />
            </div>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span"  name="attr_resource"></span>
                <input class="mini-input adaptive--input__input" type="text" name="attr_resource" placeholder="Conviction" />
            </div>
        </div>
        <div class="condition expanded-view">
            <span class="mini-title floatLeft">Condition:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_condition"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_condition" placeholder="Under the effect of Fang and Claw Bared / Wheel in Motion Ready"></textarea>
            </div>
        </div>
        <div class="trigger expanded-view">
            <span class="mini-title floatLeft">Trigger:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_trigger"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_trigger" placeholder="Immediately after an ability check for an ability that targets you"></textarea>
            </div>
        </div>
        <div class="target expanded-view">
            <span class="mini-title floatLeft">Target:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_target"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_target" placeholder="Single"></textarea>
            </div>
        </div>
        <div class="range expanded-view">
            <span class="mini-title floatLeft">Range:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_range"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_range" placeholder="1 square"></textarea>
            </div>
        </div>
        <div class="check expanded-view">
            <span class="mini-title floatLeft">Check:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input bold adaptive--input__span" name="attr_check"></span>
                <input class="mini-input bold adaptive--input__input" type="text" name="attr_check" placeholder="d20 + STR" />
            </div>
        </div>
        <div class="cr expanded-view">
            <span class="mini-title floatLeft">CR:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span" name="attr_cr"></span>
                <input class="mini-input adaptive--input__input" type="text" name="attr_cr" placeholder="Target's Defense" />
            </div>
        </div>
    </div>

    <div class="body list">
        <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
        <input type="text" class="directHitFlag hidden" name="attr_directHit" placeholder="P" />
        <input type="text" class="effectFlag hidden" name="attr_effectName" placeholder="P" />
        <input type="text" class="limitationFlag hidden" name="attr_limitation" placeholder="P" />
        <input class="expand-checkbox hidden" type="checkbox" name="attr_repeatingExpandItem" />

        <div class="spacer expanded-view"></div>

        <div class="base-effect expanded-view">
            <span class="mini-title floatLeft">Base Effect:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_baseEffect"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_baseEffect" placeholder="Deals 3 damage and inflicts Enmity on the target. Combo: Rage of Halone."></textarea>
            </div>
        </div>
        <div class="ability-effect list expanded-view">
            <div class="adaptive adaptive--input">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-title adaptive--input__span" name="attr_effectName"></span>
                <span class="mini-title" name="attr_effectName">:</span>
                <input class="mini-title adaptive--input__input" type="text" name="attr_effectName" placeholder="My Effect" />
            </div>
            <div class="adaptive adaptive--text">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_effect"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_effect" placeholder="Provides 1 HP Barrier"></textarea>
            </div>
        </div>
        <div class="direct-hit expanded-view">
            <span class="mini-title floatLeft">Direct Hit:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_directHit"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_directHit" placeholder="Deals an additional 2d6 damage"></textarea>
            </div>
        </div>
        <div class="limitation expanded-view">
            <span class="mini-title floatLeft">Limitation:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span" name="attr_limitation"></span>
                <input class="mini-input adaptive--input__input" type="text" name="attr_limitation" placeholder="Once per phase." />
            </div>
        </div>

        <span class="mini flagTitle expanded-view floatLeft">Stat for rolls (used for calculations):</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_stat" title="Stat for rolls" placeholder="STR, DEX, etc"/>
        <span class="mini flagTitle expanded-view floatLeft">Hit dice type (used for display on rolls):</span>
        <select class="overrideContent expanded-view mini-input" name="attr_hitType">
            <option value="Hit">Hit</option>
            <option value="Critical">Critical</option>
            <option value="None">None</option>
        </select>
        <span class="mini flagTitle expanded-view floatLeft">Damage/Healing (used for display on rolls):</span>
        <select class="overrideContent expanded-view mini-input" name="attr_damageType">
            <option value="Damage">Damage</option>
            <option value="Healing">Healing</option>
            <option value="Defense">Defense</option>
            <option value="Effect">Effect</option>
        </select>
        <span class="mini flagTitle expanded-view floatLeft">Hit die (used for rolls):</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_hitDie" title="Hit" placeholder="1d20cs20, 1d8, etc"/>
        <span class="mini flagTitle expanded-view floatLeft">Base effect dice/value (used to calculate damage)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_baseValue" title="Base effect value" placeholder="5, 1d20 + 2, etc" />
        <span class="mini flagTitle expanded-view floatLeft">Direct Hit dice/value (used to calculate extra damage)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_dhValue" title="Direct Hit value" placeholder="5, 1d20 + 2, etc" />
        <span class="mini flagTitle expanded-view floatLeft">Restoration value (used to restore own HP/MP/resource, include space)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_restore" title="Restore value" placeholder="5 MP, 5 HP, 5 Conviction, etc" />
        <span class="mini flagTitle expanded-view floatLeft">Effects on self (used to automatically add effects)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_effectSelf" title="Effect names" placeholder="Astral Fire, Surging Tempest" />
        <span class="mini flagTitle expanded-view floatLeft">Effects on target (used to add effect shortcut button)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_effectTarget" title="Effect names" placeholder="Major Arcana, Mage's Ballad" />
        <span class="mini flagTitle expanded-view floatLeft">Combo name (used for easy chaining to next ability)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_combo" title="Combo value" placeholder="Storm's Path, Storm's Eye" />
    </div>
</div>                </fieldset>
            </div>
        </div>
        <div class="collapse-overlay collapsed-view "></div>
    </div>

    <!-- Instant abilities -->

    <div class="instant-abilities">
        <input class="expand-checkbox hidden" type="checkbox" name="attr_instantHeaderExpandItem" />
        <button type="action" class="header-action" name="act_instant_info">i</button>
        <h3 class="large">Instant Abilities</h3>
        <input type="hidden" class="overrideSwitch" name="attr_override" placeholder="placeholder" />
        <div class="ability-columns expanded-view">
            <div class="ability-column">
                <fieldset class="repeating_instant1">
                    <!-- build:import ability.html-->
<div class="ability">
    <div class="header list">
        <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
        <input type="hidden" class="usesFlag" name="attr_uses_max" />
        <input type="hidden" class="costFlag" name="attr_cost" />
        <input type="text" class="conditionFlag hidden" name="attr_condition" placeholder="P" />
        <input type="text" class="triggerFlag hidden" name="attr_trigger" placeholder="P" />
        <input type="text" class="targetFlag hidden" name="attr_target" placeholder="P" />
        <input type="text" class="checkFlag hidden" name="attr_check" placeholder="P" />
        <input type="text" class="crFlag hidden" name="attr_cr" placeholder="P" />
        <input class="expand-checkbox hidden" type="checkbox" name="attr_repeatingExpandItem" />

        <span class="mini flagTitle expanded-view floatLeft">Icon source:</span>
        <input type="text" class="iconSource overrideContent expanded-view mini-input" name="attr_icon" title="Icon" placeholder="icon source" />

        <div class="uses">
            <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
            <input class="max mini-input floatRight" type="number" name="attr_uses_max" min="0" value="0" />
            <span class="floatRight">/</span>
            <input class="mini-input floatRight" type="number" name="attr_uses" min="0" value="0" />
        </div>

        <div class="header-title">
            <img class="ability-icon" name="attr_icon" />
            <div class="title adaptive adaptive--text">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="bold adaptive--text__span"  name="attr_title"></span>
                <textarea class="adaptive--text__textarea" type="text" name="attr_title" placeholder="Paladin Combo (Fast Blade + Riot Blade)"></textarea>
            </div>
        </div>

        <div class="ability-controls">
            <button type="action" class="ability-action-trigger" name="act_trigger">t</button>
            <button type="action" class="ability-action" name="act_info">i</button>
            <button type="action" class="ability-action" name="act_share">q</button>
            <button type="action" name="act_rolldamage" style="display: none;">d</button>
            <button type="action" name="act_rolldamagewithbonus" style="display: none;">d</button>
            <button type="action" name="act_runcombo1" style="display: none;">d</button>
            <button type="action" name="act_runcombo2" style="display: none;">d</button>
            <button type="action" name="act_runcombo3" style="display: none;">d</button>
        </div>

        <div class="type expanded-view">
            <span class="mini-title floatLeft">Type:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input italic adaptive--text__span" name="attr_type"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_type" placeholder="Primary, Physical"></textarea>
            </div>
        </div>
        <div class="cost expanded-view">
            <span class="mini-title floatLeft">Cost:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span" name="attr_cost"></span>
                <input class="mini-input adaptive--input__input" type="number" name="attr_cost" placeholder="X" />
            </div>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span"  name="attr_resource"></span>
                <input class="mini-input adaptive--input__input" type="text" name="attr_resource" placeholder="Conviction" />
            </div>
        </div>
        <div class="condition expanded-view">
            <span class="mini-title floatLeft">Condition:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_condition"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_condition" placeholder="Under the effect of Fang and Claw Bared / Wheel in Motion Ready"></textarea>
            </div>
        </div>
        <div class="trigger expanded-view">
            <span class="mini-title floatLeft">Trigger:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_trigger"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_trigger" placeholder="Immediately after an ability check for an ability that targets you"></textarea>
            </div>
        </div>
        <div class="target expanded-view">
            <span class="mini-title floatLeft">Target:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_target"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_target" placeholder="Single"></textarea>
            </div>
        </div>
        <div class="range expanded-view">
            <span class="mini-title floatLeft">Range:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_range"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_range" placeholder="1 square"></textarea>
            </div>
        </div>
        <div class="check expanded-view">
            <span class="mini-title floatLeft">Check:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input bold adaptive--input__span" name="attr_check"></span>
                <input class="mini-input bold adaptive--input__input" type="text" name="attr_check" placeholder="d20 + STR" />
            </div>
        </div>
        <div class="cr expanded-view">
            <span class="mini-title floatLeft">CR:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span" name="attr_cr"></span>
                <input class="mini-input adaptive--input__input" type="text" name="attr_cr" placeholder="Target's Defense" />
            </div>
        </div>
    </div>

    <div class="body list">
        <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
        <input type="text" class="directHitFlag hidden" name="attr_directHit" placeholder="P" />
        <input type="text" class="effectFlag hidden" name="attr_effectName" placeholder="P" />
        <input type="text" class="limitationFlag hidden" name="attr_limitation" placeholder="P" />
        <input class="expand-checkbox hidden" type="checkbox" name="attr_repeatingExpandItem" />

        <div class="spacer expanded-view"></div>

        <div class="base-effect expanded-view">
            <span class="mini-title floatLeft">Base Effect:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_baseEffect"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_baseEffect" placeholder="Deals 3 damage and inflicts Enmity on the target. Combo: Rage of Halone."></textarea>
            </div>
        </div>
        <div class="ability-effect list expanded-view">
            <div class="adaptive adaptive--input">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-title adaptive--input__span" name="attr_effectName"></span>
                <span class="mini-title" name="attr_effectName">:</span>
                <input class="mini-title adaptive--input__input" type="text" name="attr_effectName" placeholder="My Effect" />
            </div>
            <div class="adaptive adaptive--text">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_effect"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_effect" placeholder="Provides 1 HP Barrier"></textarea>
            </div>
        </div>
        <div class="direct-hit expanded-view">
            <span class="mini-title floatLeft">Direct Hit:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_directHit"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_directHit" placeholder="Deals an additional 2d6 damage"></textarea>
            </div>
        </div>
        <div class="limitation expanded-view">
            <span class="mini-title floatLeft">Limitation:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span" name="attr_limitation"></span>
                <input class="mini-input adaptive--input__input" type="text" name="attr_limitation" placeholder="Once per phase." />
            </div>
        </div>

        <span class="mini flagTitle expanded-view floatLeft">Stat for rolls (used for calculations):</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_stat" title="Stat for rolls" placeholder="STR, DEX, etc"/>
        <span class="mini flagTitle expanded-view floatLeft">Hit dice type (used for display on rolls):</span>
        <select class="overrideContent expanded-view mini-input" name="attr_hitType">
            <option value="Hit">Hit</option>
            <option value="Critical">Critical</option>
            <option value="None">None</option>
        </select>
        <span class="mini flagTitle expanded-view floatLeft">Damage/Healing (used for display on rolls):</span>
        <select class="overrideContent expanded-view mini-input" name="attr_damageType">
            <option value="Damage">Damage</option>
            <option value="Healing">Healing</option>
            <option value="Defense">Defense</option>
            <option value="Effect">Effect</option>
        </select>
        <span class="mini flagTitle expanded-view floatLeft">Hit die (used for rolls):</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_hitDie" title="Hit" placeholder="1d20cs20, 1d8, etc"/>
        <span class="mini flagTitle expanded-view floatLeft">Base effect dice/value (used to calculate damage)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_baseValue" title="Base effect value" placeholder="5, 1d20 + 2, etc" />
        <span class="mini flagTitle expanded-view floatLeft">Direct Hit dice/value (used to calculate extra damage)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_dhValue" title="Direct Hit value" placeholder="5, 1d20 + 2, etc" />
        <span class="mini flagTitle expanded-view floatLeft">Restoration value (used to restore own HP/MP/resource, include space)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_restore" title="Restore value" placeholder="5 MP, 5 HP, 5 Conviction, etc" />
        <span class="mini flagTitle expanded-view floatLeft">Effects on self (used to automatically add effects)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_effectSelf" title="Effect names" placeholder="Astral Fire, Surging Tempest" />
        <span class="mini flagTitle expanded-view floatLeft">Effects on target (used to add effect shortcut button)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_effectTarget" title="Effect names" placeholder="Major Arcana, Mage's Ballad" />
        <span class="mini flagTitle expanded-view floatLeft">Combo name (used for easy chaining to next ability)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_combo" title="Combo value" placeholder="Storm's Path, Storm's Eye" />
    </div>
</div>                </fieldset>
            </div>
            <div class="ability-column">
                <fieldset class="repeating_instant2">
                    <!-- build:import ability.html-->
<div class="ability">
    <div class="header list">
        <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
        <input type="hidden" class="usesFlag" name="attr_uses_max" />
        <input type="hidden" class="costFlag" name="attr_cost" />
        <input type="text" class="conditionFlag hidden" name="attr_condition" placeholder="P" />
        <input type="text" class="triggerFlag hidden" name="attr_trigger" placeholder="P" />
        <input type="text" class="targetFlag hidden" name="attr_target" placeholder="P" />
        <input type="text" class="checkFlag hidden" name="attr_check" placeholder="P" />
        <input type="text" class="crFlag hidden" name="attr_cr" placeholder="P" />
        <input class="expand-checkbox hidden" type="checkbox" name="attr_repeatingExpandItem" />

        <span class="mini flagTitle expanded-view floatLeft">Icon source:</span>
        <input type="text" class="iconSource overrideContent expanded-view mini-input" name="attr_icon" title="Icon" placeholder="icon source" />

        <div class="uses">
            <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
            <input class="max mini-input floatRight" type="number" name="attr_uses_max" min="0" value="0" />
            <span class="floatRight">/</span>
            <input class="mini-input floatRight" type="number" name="attr_uses" min="0" value="0" />
        </div>

        <div class="header-title">
            <img class="ability-icon" name="attr_icon" />
            <div class="title adaptive adaptive--text">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="bold adaptive--text__span"  name="attr_title"></span>
                <textarea class="adaptive--text__textarea" type="text" name="attr_title" placeholder="Paladin Combo (Fast Blade + Riot Blade)"></textarea>
            </div>
        </div>

        <div class="ability-controls">
            <button type="action" class="ability-action-trigger" name="act_trigger">t</button>
            <button type="action" class="ability-action" name="act_info">i</button>
            <button type="action" class="ability-action" name="act_share">q</button>
            <button type="action" name="act_rolldamage" style="display: none;">d</button>
            <button type="action" name="act_rolldamagewithbonus" style="display: none;">d</button>
            <button type="action" name="act_runcombo1" style="display: none;">d</button>
            <button type="action" name="act_runcombo2" style="display: none;">d</button>
            <button type="action" name="act_runcombo3" style="display: none;">d</button>
        </div>

        <div class="type expanded-view">
            <span class="mini-title floatLeft">Type:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input italic adaptive--text__span" name="attr_type"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_type" placeholder="Primary, Physical"></textarea>
            </div>
        </div>
        <div class="cost expanded-view">
            <span class="mini-title floatLeft">Cost:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span" name="attr_cost"></span>
                <input class="mini-input adaptive--input__input" type="number" name="attr_cost" placeholder="X" />
            </div>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span"  name="attr_resource"></span>
                <input class="mini-input adaptive--input__input" type="text" name="attr_resource" placeholder="Conviction" />
            </div>
        </div>
        <div class="condition expanded-view">
            <span class="mini-title floatLeft">Condition:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_condition"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_condition" placeholder="Under the effect of Fang and Claw Bared / Wheel in Motion Ready"></textarea>
            </div>
        </div>
        <div class="trigger expanded-view">
            <span class="mini-title floatLeft">Trigger:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_trigger"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_trigger" placeholder="Immediately after an ability check for an ability that targets you"></textarea>
            </div>
        </div>
        <div class="target expanded-view">
            <span class="mini-title floatLeft">Target:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_target"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_target" placeholder="Single"></textarea>
            </div>
        </div>
        <div class="range expanded-view">
            <span class="mini-title floatLeft">Range:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_range"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_range" placeholder="1 square"></textarea>
            </div>
        </div>
        <div class="check expanded-view">
            <span class="mini-title floatLeft">Check:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input bold adaptive--input__span" name="attr_check"></span>
                <input class="mini-input bold adaptive--input__input" type="text" name="attr_check" placeholder="d20 + STR" />
            </div>
        </div>
        <div class="cr expanded-view">
            <span class="mini-title floatLeft">CR:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span" name="attr_cr"></span>
                <input class="mini-input adaptive--input__input" type="text" name="attr_cr" placeholder="Target's Defense" />
            </div>
        </div>
    </div>

    <div class="body list">
        <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
        <input type="text" class="directHitFlag hidden" name="attr_directHit" placeholder="P" />
        <input type="text" class="effectFlag hidden" name="attr_effectName" placeholder="P" />
        <input type="text" class="limitationFlag hidden" name="attr_limitation" placeholder="P" />
        <input class="expand-checkbox hidden" type="checkbox" name="attr_repeatingExpandItem" />

        <div class="spacer expanded-view"></div>

        <div class="base-effect expanded-view">
            <span class="mini-title floatLeft">Base Effect:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_baseEffect"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_baseEffect" placeholder="Deals 3 damage and inflicts Enmity on the target. Combo: Rage of Halone."></textarea>
            </div>
        </div>
        <div class="ability-effect list expanded-view">
            <div class="adaptive adaptive--input">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-title adaptive--input__span" name="attr_effectName"></span>
                <span class="mini-title" name="attr_effectName">:</span>
                <input class="mini-title adaptive--input__input" type="text" name="attr_effectName" placeholder="My Effect" />
            </div>
            <div class="adaptive adaptive--text">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_effect"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_effect" placeholder="Provides 1 HP Barrier"></textarea>
            </div>
        </div>
        <div class="direct-hit expanded-view">
            <span class="mini-title floatLeft">Direct Hit:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_directHit"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_directHit" placeholder="Deals an additional 2d6 damage"></textarea>
            </div>
        </div>
        <div class="limitation expanded-view">
            <span class="mini-title floatLeft">Limitation:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span" name="attr_limitation"></span>
                <input class="mini-input adaptive--input__input" type="text" name="attr_limitation" placeholder="Once per phase." />
            </div>
        </div>

        <span class="mini flagTitle expanded-view floatLeft">Stat for rolls (used for calculations):</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_stat" title="Stat for rolls" placeholder="STR, DEX, etc"/>
        <span class="mini flagTitle expanded-view floatLeft">Hit dice type (used for display on rolls):</span>
        <select class="overrideContent expanded-view mini-input" name="attr_hitType">
            <option value="Hit">Hit</option>
            <option value="Critical">Critical</option>
            <option value="None">None</option>
        </select>
        <span class="mini flagTitle expanded-view floatLeft">Damage/Healing (used for display on rolls):</span>
        <select class="overrideContent expanded-view mini-input" name="attr_damageType">
            <option value="Damage">Damage</option>
            <option value="Healing">Healing</option>
            <option value="Defense">Defense</option>
            <option value="Effect">Effect</option>
        </select>
        <span class="mini flagTitle expanded-view floatLeft">Hit die (used for rolls):</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_hitDie" title="Hit" placeholder="1d20cs20, 1d8, etc"/>
        <span class="mini flagTitle expanded-view floatLeft">Base effect dice/value (used to calculate damage)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_baseValue" title="Base effect value" placeholder="5, 1d20 + 2, etc" />
        <span class="mini flagTitle expanded-view floatLeft">Direct Hit dice/value (used to calculate extra damage)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_dhValue" title="Direct Hit value" placeholder="5, 1d20 + 2, etc" />
        <span class="mini flagTitle expanded-view floatLeft">Restoration value (used to restore own HP/MP/resource, include space)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_restore" title="Restore value" placeholder="5 MP, 5 HP, 5 Conviction, etc" />
        <span class="mini flagTitle expanded-view floatLeft">Effects on self (used to automatically add effects)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_effectSelf" title="Effect names" placeholder="Astral Fire, Surging Tempest" />
        <span class="mini flagTitle expanded-view floatLeft">Effects on target (used to add effect shortcut button)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_effectTarget" title="Effect names" placeholder="Major Arcana, Mage's Ballad" />
        <span class="mini flagTitle expanded-view floatLeft">Combo name (used for easy chaining to next ability)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_combo" title="Combo value" placeholder="Storm's Path, Storm's Eye" />
    </div>
</div>                </fieldset>
            </div>
            <div class="ability-column">
                <fieldset class="repeating_instant3">
                    <!-- build:import ability.html-->
<div class="ability">
    <div class="header list">
        <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
        <input type="hidden" class="usesFlag" name="attr_uses_max" />
        <input type="hidden" class="costFlag" name="attr_cost" />
        <input type="text" class="conditionFlag hidden" name="attr_condition" placeholder="P" />
        <input type="text" class="triggerFlag hidden" name="attr_trigger" placeholder="P" />
        <input type="text" class="targetFlag hidden" name="attr_target" placeholder="P" />
        <input type="text" class="checkFlag hidden" name="attr_check" placeholder="P" />
        <input type="text" class="crFlag hidden" name="attr_cr" placeholder="P" />
        <input class="expand-checkbox hidden" type="checkbox" name="attr_repeatingExpandItem" />

        <span class="mini flagTitle expanded-view floatLeft">Icon source:</span>
        <input type="text" class="iconSource overrideContent expanded-view mini-input" name="attr_icon" title="Icon" placeholder="icon source" />

        <div class="uses">
            <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
            <input class="max mini-input floatRight" type="number" name="attr_uses_max" min="0" value="0" />
            <span class="floatRight">/</span>
            <input class="mini-input floatRight" type="number" name="attr_uses" min="0" value="0" />
        </div>

        <div class="header-title">
            <img class="ability-icon" name="attr_icon" />
            <div class="title adaptive adaptive--text">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="bold adaptive--text__span"  name="attr_title"></span>
                <textarea class="adaptive--text__textarea" type="text" name="attr_title" placeholder="Paladin Combo (Fast Blade + Riot Blade)"></textarea>
            </div>
        </div>

        <div class="ability-controls">
            <button type="action" class="ability-action-trigger" name="act_trigger">t</button>
            <button type="action" class="ability-action" name="act_info">i</button>
            <button type="action" class="ability-action" name="act_share">q</button>
            <button type="action" name="act_rolldamage" style="display: none;">d</button>
            <button type="action" name="act_rolldamagewithbonus" style="display: none;">d</button>
            <button type="action" name="act_runcombo1" style="display: none;">d</button>
            <button type="action" name="act_runcombo2" style="display: none;">d</button>
            <button type="action" name="act_runcombo3" style="display: none;">d</button>
        </div>

        <div class="type expanded-view">
            <span class="mini-title floatLeft">Type:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input italic adaptive--text__span" name="attr_type"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_type" placeholder="Primary, Physical"></textarea>
            </div>
        </div>
        <div class="cost expanded-view">
            <span class="mini-title floatLeft">Cost:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span" name="attr_cost"></span>
                <input class="mini-input adaptive--input__input" type="number" name="attr_cost" placeholder="X" />
            </div>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span"  name="attr_resource"></span>
                <input class="mini-input adaptive--input__input" type="text" name="attr_resource" placeholder="Conviction" />
            </div>
        </div>
        <div class="condition expanded-view">
            <span class="mini-title floatLeft">Condition:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_condition"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_condition" placeholder="Under the effect of Fang and Claw Bared / Wheel in Motion Ready"></textarea>
            </div>
        </div>
        <div class="trigger expanded-view">
            <span class="mini-title floatLeft">Trigger:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_trigger"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_trigger" placeholder="Immediately after an ability check for an ability that targets you"></textarea>
            </div>
        </div>
        <div class="target expanded-view">
            <span class="mini-title floatLeft">Target:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_target"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_target" placeholder="Single"></textarea>
            </div>
        </div>
        <div class="range expanded-view">
            <span class="mini-title floatLeft">Range:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_range"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_range" placeholder="1 square"></textarea>
            </div>
        </div>
        <div class="check expanded-view">
            <span class="mini-title floatLeft">Check:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input bold adaptive--input__span" name="attr_check"></span>
                <input class="mini-input bold adaptive--input__input" type="text" name="attr_check" placeholder="d20 + STR" />
            </div>
        </div>
        <div class="cr expanded-view">
            <span class="mini-title floatLeft">CR:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span" name="attr_cr"></span>
                <input class="mini-input adaptive--input__input" type="text" name="attr_cr" placeholder="Target's Defense" />
            </div>
        </div>
    </div>

    <div class="body list">
        <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
        <input type="text" class="directHitFlag hidden" name="attr_directHit" placeholder="P" />
        <input type="text" class="effectFlag hidden" name="attr_effectName" placeholder="P" />
        <input type="text" class="limitationFlag hidden" name="attr_limitation" placeholder="P" />
        <input class="expand-checkbox hidden" type="checkbox" name="attr_repeatingExpandItem" />

        <div class="spacer expanded-view"></div>

        <div class="base-effect expanded-view">
            <span class="mini-title floatLeft">Base Effect:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_baseEffect"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_baseEffect" placeholder="Deals 3 damage and inflicts Enmity on the target. Combo: Rage of Halone."></textarea>
            </div>
        </div>
        <div class="ability-effect list expanded-view">
            <div class="adaptive adaptive--input">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-title adaptive--input__span" name="attr_effectName"></span>
                <span class="mini-title" name="attr_effectName">:</span>
                <input class="mini-title adaptive--input__input" type="text" name="attr_effectName" placeholder="My Effect" />
            </div>
            <div class="adaptive adaptive--text">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_effect"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_effect" placeholder="Provides 1 HP Barrier"></textarea>
            </div>
        </div>
        <div class="direct-hit expanded-view">
            <span class="mini-title floatLeft">Direct Hit:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_directHit"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_directHit" placeholder="Deals an additional 2d6 damage"></textarea>
            </div>
        </div>
        <div class="limitation expanded-view">
            <span class="mini-title floatLeft">Limitation:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span" name="attr_limitation"></span>
                <input class="mini-input adaptive--input__input" type="text" name="attr_limitation" placeholder="Once per phase." />
            </div>
        </div>

        <span class="mini flagTitle expanded-view floatLeft">Stat for rolls (used for calculations):</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_stat" title="Stat for rolls" placeholder="STR, DEX, etc"/>
        <span class="mini flagTitle expanded-view floatLeft">Hit dice type (used for display on rolls):</span>
        <select class="overrideContent expanded-view mini-input" name="attr_hitType">
            <option value="Hit">Hit</option>
            <option value="Critical">Critical</option>
            <option value="None">None</option>
        </select>
        <span class="mini flagTitle expanded-view floatLeft">Damage/Healing (used for display on rolls):</span>
        <select class="overrideContent expanded-view mini-input" name="attr_damageType">
            <option value="Damage">Damage</option>
            <option value="Healing">Healing</option>
            <option value="Defense">Defense</option>
            <option value="Effect">Effect</option>
        </select>
        <span class="mini flagTitle expanded-view floatLeft">Hit die (used for rolls):</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_hitDie" title="Hit" placeholder="1d20cs20, 1d8, etc"/>
        <span class="mini flagTitle expanded-view floatLeft">Base effect dice/value (used to calculate damage)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_baseValue" title="Base effect value" placeholder="5, 1d20 + 2, etc" />
        <span class="mini flagTitle expanded-view floatLeft">Direct Hit dice/value (used to calculate extra damage)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_dhValue" title="Direct Hit value" placeholder="5, 1d20 + 2, etc" />
        <span class="mini flagTitle expanded-view floatLeft">Restoration value (used to restore own HP/MP/resource, include space)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_restore" title="Restore value" placeholder="5 MP, 5 HP, 5 Conviction, etc" />
        <span class="mini flagTitle expanded-view floatLeft">Effects on self (used to automatically add effects)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_effectSelf" title="Effect names" placeholder="Astral Fire, Surging Tempest" />
        <span class="mini flagTitle expanded-view floatLeft">Effects on target (used to add effect shortcut button)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_effectTarget" title="Effect names" placeholder="Major Arcana, Mage's Ballad" />
        <span class="mini flagTitle expanded-view floatLeft">Combo name (used for easy chaining to next ability)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_combo" title="Combo value" placeholder="Storm's Path, Storm's Eye" />
    </div>
</div>                </fieldset>
            </div>
        </div>
        <div class="collapse-overlay collapsed-view "></div>
    </div>

    <!-- Conditional abilities (Monk techniques) -->

    <input class="techniqueSwitch" type="hidden" name="attr_hasTechniques">
    <div class="conditional-abilities">
        <input class="expand-checkbox hidden" type="checkbox" name="attr_techniqueHeaderExpandItem" />
        <button type="action" class="header-action" name="act_technique_info">i</button>
        <h3 class="large">Techniques</h3>
        <input type="hidden" class="overrideSwitch" name="attr_override" placeholder="placeholder" />
        <div class="ability-columns expanded-view">
            <div class="ability-column">
                <fieldset class="repeating_technique1">
                    <!-- build:import ability.html -->
<div class="ability">
    <div class="header list">
        <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
        <input type="hidden" class="usesFlag" name="attr_uses_max" />
        <input type="hidden" class="costFlag" name="attr_cost" />
        <input type="text" class="conditionFlag hidden" name="attr_condition" placeholder="P" />
        <input type="text" class="triggerFlag hidden" name="attr_trigger" placeholder="P" />
        <input type="text" class="targetFlag hidden" name="attr_target" placeholder="P" />
        <input type="text" class="checkFlag hidden" name="attr_check" placeholder="P" />
        <input type="text" class="crFlag hidden" name="attr_cr" placeholder="P" />
        <input class="expand-checkbox hidden" type="checkbox" name="attr_repeatingExpandItem" />

        <span class="mini flagTitle expanded-view floatLeft">Icon source:</span>
        <input type="text" class="iconSource overrideContent expanded-view mini-input" name="attr_icon" title="Icon" placeholder="icon source" />

        <div class="uses">
            <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
            <input class="max mini-input floatRight" type="number" name="attr_uses_max" min="0" value="0" />
            <span class="floatRight">/</span>
            <input class="mini-input floatRight" type="number" name="attr_uses" min="0" value="0" />
        </div>

        <div class="header-title">
            <img class="ability-icon" name="attr_icon" />
            <div class="title adaptive adaptive--text">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="bold adaptive--text__span"  name="attr_title"></span>
                <textarea class="adaptive--text__textarea" type="text" name="attr_title" placeholder="Paladin Combo (Fast Blade + Riot Blade)"></textarea>
            </div>
        </div>

        <div class="ability-controls">
            <button type="action" class="ability-action-trigger" name="act_trigger">t</button>
            <button type="action" class="ability-action" name="act_info">i</button>
            <button type="action" class="ability-action" name="act_share">q</button>
            <button type="action" name="act_rolldamage" style="display: none;">d</button>
            <button type="action" name="act_rolldamagewithbonus" style="display: none;">d</button>
            <button type="action" name="act_runcombo1" style="display: none;">d</button>
            <button type="action" name="act_runcombo2" style="display: none;">d</button>
            <button type="action" name="act_runcombo3" style="display: none;">d</button>
        </div>

        <div class="type expanded-view">
            <span class="mini-title floatLeft">Type:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input italic adaptive--text__span" name="attr_type"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_type" placeholder="Primary, Physical"></textarea>
            </div>
        </div>
        <div class="cost expanded-view">
            <span class="mini-title floatLeft">Cost:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span" name="attr_cost"></span>
                <input class="mini-input adaptive--input__input" type="number" name="attr_cost" placeholder="X" />
            </div>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span"  name="attr_resource"></span>
                <input class="mini-input adaptive--input__input" type="text" name="attr_resource" placeholder="Conviction" />
            </div>
        </div>
        <div class="condition expanded-view">
            <span class="mini-title floatLeft">Condition:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_condition"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_condition" placeholder="Under the effect of Fang and Claw Bared / Wheel in Motion Ready"></textarea>
            </div>
        </div>
        <div class="trigger expanded-view">
            <span class="mini-title floatLeft">Trigger:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_trigger"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_trigger" placeholder="Immediately after an ability check for an ability that targets you"></textarea>
            </div>
        </div>
        <div class="target expanded-view">
            <span class="mini-title floatLeft">Target:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_target"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_target" placeholder="Single"></textarea>
            </div>
        </div>
        <div class="range expanded-view">
            <span class="mini-title floatLeft">Range:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_range"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_range" placeholder="1 square"></textarea>
            </div>
        </div>
        <div class="check expanded-view">
            <span class="mini-title floatLeft">Check:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input bold adaptive--input__span" name="attr_check"></span>
                <input class="mini-input bold adaptive--input__input" type="text" name="attr_check" placeholder="d20 + STR" />
            </div>
        </div>
        <div class="cr expanded-view">
            <span class="mini-title floatLeft">CR:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span" name="attr_cr"></span>
                <input class="mini-input adaptive--input__input" type="text" name="attr_cr" placeholder="Target's Defense" />
            </div>
        </div>
    </div>

    <div class="body list">
        <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
        <input type="text" class="directHitFlag hidden" name="attr_directHit" placeholder="P" />
        <input type="text" class="effectFlag hidden" name="attr_effectName" placeholder="P" />
        <input type="text" class="limitationFlag hidden" name="attr_limitation" placeholder="P" />
        <input class="expand-checkbox hidden" type="checkbox" name="attr_repeatingExpandItem" />

        <div class="spacer expanded-view"></div>

        <div class="base-effect expanded-view">
            <span class="mini-title floatLeft">Base Effect:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_baseEffect"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_baseEffect" placeholder="Deals 3 damage and inflicts Enmity on the target. Combo: Rage of Halone."></textarea>
            </div>
        </div>
        <div class="ability-effect list expanded-view">
            <div class="adaptive adaptive--input">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-title adaptive--input__span" name="attr_effectName"></span>
                <span class="mini-title" name="attr_effectName">:</span>
                <input class="mini-title adaptive--input__input" type="text" name="attr_effectName" placeholder="My Effect" />
            </div>
            <div class="adaptive adaptive--text">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_effect"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_effect" placeholder="Provides 1 HP Barrier"></textarea>
            </div>
        </div>
        <div class="direct-hit expanded-view">
            <span class="mini-title floatLeft">Direct Hit:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_directHit"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_directHit" placeholder="Deals an additional 2d6 damage"></textarea>
            </div>
        </div>
        <div class="limitation expanded-view">
            <span class="mini-title floatLeft">Limitation:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span" name="attr_limitation"></span>
                <input class="mini-input adaptive--input__input" type="text" name="attr_limitation" placeholder="Once per phase." />
            </div>
        </div>

        <span class="mini flagTitle expanded-view floatLeft">Stat for rolls (used for calculations):</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_stat" title="Stat for rolls" placeholder="STR, DEX, etc"/>
        <span class="mini flagTitle expanded-view floatLeft">Hit dice type (used for display on rolls):</span>
        <select class="overrideContent expanded-view mini-input" name="attr_hitType">
            <option value="Hit">Hit</option>
            <option value="Critical">Critical</option>
            <option value="None">None</option>
        </select>
        <span class="mini flagTitle expanded-view floatLeft">Damage/Healing (used for display on rolls):</span>
        <select class="overrideContent expanded-view mini-input" name="attr_damageType">
            <option value="Damage">Damage</option>
            <option value="Healing">Healing</option>
            <option value="Defense">Defense</option>
            <option value="Effect">Effect</option>
        </select>
        <span class="mini flagTitle expanded-view floatLeft">Hit die (used for rolls):</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_hitDie" title="Hit" placeholder="1d20cs20, 1d8, etc"/>
        <span class="mini flagTitle expanded-view floatLeft">Base effect dice/value (used to calculate damage)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_baseValue" title="Base effect value" placeholder="5, 1d20 + 2, etc" />
        <span class="mini flagTitle expanded-view floatLeft">Direct Hit dice/value (used to calculate extra damage)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_dhValue" title="Direct Hit value" placeholder="5, 1d20 + 2, etc" />
        <span class="mini flagTitle expanded-view floatLeft">Restoration value (used to restore own HP/MP/resource, include space)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_restore" title="Restore value" placeholder="5 MP, 5 HP, 5 Conviction, etc" />
        <span class="mini flagTitle expanded-view floatLeft">Effects on self (used to automatically add effects)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_effectSelf" title="Effect names" placeholder="Astral Fire, Surging Tempest" />
        <span class="mini flagTitle expanded-view floatLeft">Effects on target (used to add effect shortcut button)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_effectTarget" title="Effect names" placeholder="Major Arcana, Mage's Ballad" />
        <span class="mini flagTitle expanded-view floatLeft">Combo name (used for easy chaining to next ability)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_combo" title="Combo value" placeholder="Storm's Path, Storm's Eye" />
    </div>
</div>                </fieldset>
            </div>
            <div class="ability-column">
                <fieldset class="repeating_technique2">
                    <!-- build:import ability.html -->
<div class="ability">
    <div class="header list">
        <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
        <input type="hidden" class="usesFlag" name="attr_uses_max" />
        <input type="hidden" class="costFlag" name="attr_cost" />
        <input type="text" class="conditionFlag hidden" name="attr_condition" placeholder="P" />
        <input type="text" class="triggerFlag hidden" name="attr_trigger" placeholder="P" />
        <input type="text" class="targetFlag hidden" name="attr_target" placeholder="P" />
        <input type="text" class="checkFlag hidden" name="attr_check" placeholder="P" />
        <input type="text" class="crFlag hidden" name="attr_cr" placeholder="P" />
        <input class="expand-checkbox hidden" type="checkbox" name="attr_repeatingExpandItem" />

        <span class="mini flagTitle expanded-view floatLeft">Icon source:</span>
        <input type="text" class="iconSource overrideContent expanded-view mini-input" name="attr_icon" title="Icon" placeholder="icon source" />

        <div class="uses">
            <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
            <input class="max mini-input floatRight" type="number" name="attr_uses_max" min="0" value="0" />
            <span class="floatRight">/</span>
            <input class="mini-input floatRight" type="number" name="attr_uses" min="0" value="0" />
        </div>

        <div class="header-title">
            <img class="ability-icon" name="attr_icon" />
            <div class="title adaptive adaptive--text">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="bold adaptive--text__span"  name="attr_title"></span>
                <textarea class="adaptive--text__textarea" type="text" name="attr_title" placeholder="Paladin Combo (Fast Blade + Riot Blade)"></textarea>
            </div>
        </div>

        <div class="ability-controls">
            <button type="action" class="ability-action-trigger" name="act_trigger">t</button>
            <button type="action" class="ability-action" name="act_info">i</button>
            <button type="action" class="ability-action" name="act_share">q</button>
            <button type="action" name="act_rolldamage" style="display: none;">d</button>
            <button type="action" name="act_rolldamagewithbonus" style="display: none;">d</button>
            <button type="action" name="act_runcombo1" style="display: none;">d</button>
            <button type="action" name="act_runcombo2" style="display: none;">d</button>
            <button type="action" name="act_runcombo3" style="display: none;">d</button>
        </div>

        <div class="type expanded-view">
            <span class="mini-title floatLeft">Type:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input italic adaptive--text__span" name="attr_type"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_type" placeholder="Primary, Physical"></textarea>
            </div>
        </div>
        <div class="cost expanded-view">
            <span class="mini-title floatLeft">Cost:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span" name="attr_cost"></span>
                <input class="mini-input adaptive--input__input" type="number" name="attr_cost" placeholder="X" />
            </div>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span"  name="attr_resource"></span>
                <input class="mini-input adaptive--input__input" type="text" name="attr_resource" placeholder="Conviction" />
            </div>
        </div>
        <div class="condition expanded-view">
            <span class="mini-title floatLeft">Condition:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_condition"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_condition" placeholder="Under the effect of Fang and Claw Bared / Wheel in Motion Ready"></textarea>
            </div>
        </div>
        <div class="trigger expanded-view">
            <span class="mini-title floatLeft">Trigger:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_trigger"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_trigger" placeholder="Immediately after an ability check for an ability that targets you"></textarea>
            </div>
        </div>
        <div class="target expanded-view">
            <span class="mini-title floatLeft">Target:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_target"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_target" placeholder="Single"></textarea>
            </div>
        </div>
        <div class="range expanded-view">
            <span class="mini-title floatLeft">Range:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_range"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_range" placeholder="1 square"></textarea>
            </div>
        </div>
        <div class="check expanded-view">
            <span class="mini-title floatLeft">Check:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input bold adaptive--input__span" name="attr_check"></span>
                <input class="mini-input bold adaptive--input__input" type="text" name="attr_check" placeholder="d20 + STR" />
            </div>
        </div>
        <div class="cr expanded-view">
            <span class="mini-title floatLeft">CR:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span" name="attr_cr"></span>
                <input class="mini-input adaptive--input__input" type="text" name="attr_cr" placeholder="Target's Defense" />
            </div>
        </div>
    </div>

    <div class="body list">
        <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
        <input type="text" class="directHitFlag hidden" name="attr_directHit" placeholder="P" />
        <input type="text" class="effectFlag hidden" name="attr_effectName" placeholder="P" />
        <input type="text" class="limitationFlag hidden" name="attr_limitation" placeholder="P" />
        <input class="expand-checkbox hidden" type="checkbox" name="attr_repeatingExpandItem" />

        <div class="spacer expanded-view"></div>

        <div class="base-effect expanded-view">
            <span class="mini-title floatLeft">Base Effect:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_baseEffect"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_baseEffect" placeholder="Deals 3 damage and inflicts Enmity on the target. Combo: Rage of Halone."></textarea>
            </div>
        </div>
        <div class="ability-effect list expanded-view">
            <div class="adaptive adaptive--input">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-title adaptive--input__span" name="attr_effectName"></span>
                <span class="mini-title" name="attr_effectName">:</span>
                <input class="mini-title adaptive--input__input" type="text" name="attr_effectName" placeholder="My Effect" />
            </div>
            <div class="adaptive adaptive--text">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_effect"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_effect" placeholder="Provides 1 HP Barrier"></textarea>
            </div>
        </div>
        <div class="direct-hit expanded-view">
            <span class="mini-title floatLeft">Direct Hit:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_directHit"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_directHit" placeholder="Deals an additional 2d6 damage"></textarea>
            </div>
        </div>
        <div class="limitation expanded-view">
            <span class="mini-title floatLeft">Limitation:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span" name="attr_limitation"></span>
                <input class="mini-input adaptive--input__input" type="text" name="attr_limitation" placeholder="Once per phase." />
            </div>
        </div>

        <span class="mini flagTitle expanded-view floatLeft">Stat for rolls (used for calculations):</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_stat" title="Stat for rolls" placeholder="STR, DEX, etc"/>
        <span class="mini flagTitle expanded-view floatLeft">Hit dice type (used for display on rolls):</span>
        <select class="overrideContent expanded-view mini-input" name="attr_hitType">
            <option value="Hit">Hit</option>
            <option value="Critical">Critical</option>
            <option value="None">None</option>
        </select>
        <span class="mini flagTitle expanded-view floatLeft">Damage/Healing (used for display on rolls):</span>
        <select class="overrideContent expanded-view mini-input" name="attr_damageType">
            <option value="Damage">Damage</option>
            <option value="Healing">Healing</option>
            <option value="Defense">Defense</option>
            <option value="Effect">Effect</option>
        </select>
        <span class="mini flagTitle expanded-view floatLeft">Hit die (used for rolls):</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_hitDie" title="Hit" placeholder="1d20cs20, 1d8, etc"/>
        <span class="mini flagTitle expanded-view floatLeft">Base effect dice/value (used to calculate damage)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_baseValue" title="Base effect value" placeholder="5, 1d20 + 2, etc" />
        <span class="mini flagTitle expanded-view floatLeft">Direct Hit dice/value (used to calculate extra damage)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_dhValue" title="Direct Hit value" placeholder="5, 1d20 + 2, etc" />
        <span class="mini flagTitle expanded-view floatLeft">Restoration value (used to restore own HP/MP/resource, include space)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_restore" title="Restore value" placeholder="5 MP, 5 HP, 5 Conviction, etc" />
        <span class="mini flagTitle expanded-view floatLeft">Effects on self (used to automatically add effects)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_effectSelf" title="Effect names" placeholder="Astral Fire, Surging Tempest" />
        <span class="mini flagTitle expanded-view floatLeft">Effects on target (used to add effect shortcut button)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_effectTarget" title="Effect names" placeholder="Major Arcana, Mage's Ballad" />
        <span class="mini flagTitle expanded-view floatLeft">Combo name (used for easy chaining to next ability)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_combo" title="Combo value" placeholder="Storm's Path, Storm's Eye" />
    </div>
</div>                </fieldset>
            </div>
            <div class="ability-column">
                <fieldset class="repeating_technique3">
                    <!-- build:import ability.html -->
<div class="ability">
    <div class="header list">
        <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
        <input type="hidden" class="usesFlag" name="attr_uses_max" />
        <input type="hidden" class="costFlag" name="attr_cost" />
        <input type="text" class="conditionFlag hidden" name="attr_condition" placeholder="P" />
        <input type="text" class="triggerFlag hidden" name="attr_trigger" placeholder="P" />
        <input type="text" class="targetFlag hidden" name="attr_target" placeholder="P" />
        <input type="text" class="checkFlag hidden" name="attr_check" placeholder="P" />
        <input type="text" class="crFlag hidden" name="attr_cr" placeholder="P" />
        <input class="expand-checkbox hidden" type="checkbox" name="attr_repeatingExpandItem" />

        <span class="mini flagTitle expanded-view floatLeft">Icon source:</span>
        <input type="text" class="iconSource overrideContent expanded-view mini-input" name="attr_icon" title="Icon" placeholder="icon source" />

        <div class="uses">
            <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
            <input class="max mini-input floatRight" type="number" name="attr_uses_max" min="0" value="0" />
            <span class="floatRight">/</span>
            <input class="mini-input floatRight" type="number" name="attr_uses" min="0" value="0" />
        </div>

        <div class="header-title">
            <img class="ability-icon" name="attr_icon" />
            <div class="title adaptive adaptive--text">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="bold adaptive--text__span"  name="attr_title"></span>
                <textarea class="adaptive--text__textarea" type="text" name="attr_title" placeholder="Paladin Combo (Fast Blade + Riot Blade)"></textarea>
            </div>
        </div>

        <div class="ability-controls">
            <button type="action" class="ability-action-trigger" name="act_trigger">t</button>
            <button type="action" class="ability-action" name="act_info">i</button>
            <button type="action" class="ability-action" name="act_share">q</button>
            <button type="action" name="act_rolldamage" style="display: none;">d</button>
            <button type="action" name="act_rolldamagewithbonus" style="display: none;">d</button>
            <button type="action" name="act_runcombo1" style="display: none;">d</button>
            <button type="action" name="act_runcombo2" style="display: none;">d</button>
            <button type="action" name="act_runcombo3" style="display: none;">d</button>
        </div>

        <div class="type expanded-view">
            <span class="mini-title floatLeft">Type:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input italic adaptive--text__span" name="attr_type"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_type" placeholder="Primary, Physical"></textarea>
            </div>
        </div>
        <div class="cost expanded-view">
            <span class="mini-title floatLeft">Cost:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span" name="attr_cost"></span>
                <input class="mini-input adaptive--input__input" type="number" name="attr_cost" placeholder="X" />
            </div>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span"  name="attr_resource"></span>
                <input class="mini-input adaptive--input__input" type="text" name="attr_resource" placeholder="Conviction" />
            </div>
        </div>
        <div class="condition expanded-view">
            <span class="mini-title floatLeft">Condition:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_condition"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_condition" placeholder="Under the effect of Fang and Claw Bared / Wheel in Motion Ready"></textarea>
            </div>
        </div>
        <div class="trigger expanded-view">
            <span class="mini-title floatLeft">Trigger:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_trigger"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_trigger" placeholder="Immediately after an ability check for an ability that targets you"></textarea>
            </div>
        </div>
        <div class="target expanded-view">
            <span class="mini-title floatLeft">Target:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_target"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_target" placeholder="Single"></textarea>
            </div>
        </div>
        <div class="range expanded-view">
            <span class="mini-title floatLeft">Range:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_range"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_range" placeholder="1 square"></textarea>
            </div>
        </div>
        <div class="check expanded-view">
            <span class="mini-title floatLeft">Check:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input bold adaptive--input__span" name="attr_check"></span>
                <input class="mini-input bold adaptive--input__input" type="text" name="attr_check" placeholder="d20 + STR" />
            </div>
        </div>
        <div class="cr expanded-view">
            <span class="mini-title floatLeft">CR:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span" name="attr_cr"></span>
                <input class="mini-input adaptive--input__input" type="text" name="attr_cr" placeholder="Target's Defense" />
            </div>
        </div>
    </div>

    <div class="body list">
        <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
        <input type="text" class="directHitFlag hidden" name="attr_directHit" placeholder="P" />
        <input type="text" class="effectFlag hidden" name="attr_effectName" placeholder="P" />
        <input type="text" class="limitationFlag hidden" name="attr_limitation" placeholder="P" />
        <input class="expand-checkbox hidden" type="checkbox" name="attr_repeatingExpandItem" />

        <div class="spacer expanded-view"></div>

        <div class="base-effect expanded-view">
            <span class="mini-title floatLeft">Base Effect:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_baseEffect"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_baseEffect" placeholder="Deals 3 damage and inflicts Enmity on the target. Combo: Rage of Halone."></textarea>
            </div>
        </div>
        <div class="ability-effect list expanded-view">
            <div class="adaptive adaptive--input">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-title adaptive--input__span" name="attr_effectName"></span>
                <span class="mini-title" name="attr_effectName">:</span>
                <input class="mini-title adaptive--input__input" type="text" name="attr_effectName" placeholder="My Effect" />
            </div>
            <div class="adaptive adaptive--text">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_effect"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_effect" placeholder="Provides 1 HP Barrier"></textarea>
            </div>
        </div>
        <div class="direct-hit expanded-view">
            <span class="mini-title floatLeft">Direct Hit:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_directHit"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_directHit" placeholder="Deals an additional 2d6 damage"></textarea>
            </div>
        </div>
        <div class="limitation expanded-view">
            <span class="mini-title floatLeft">Limitation:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span" name="attr_limitation"></span>
                <input class="mini-input adaptive--input__input" type="text" name="attr_limitation" placeholder="Once per phase." />
            </div>
        </div>

        <span class="mini flagTitle expanded-view floatLeft">Stat for rolls (used for calculations):</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_stat" title="Stat for rolls" placeholder="STR, DEX, etc"/>
        <span class="mini flagTitle expanded-view floatLeft">Hit dice type (used for display on rolls):</span>
        <select class="overrideContent expanded-view mini-input" name="attr_hitType">
            <option value="Hit">Hit</option>
            <option value="Critical">Critical</option>
            <option value="None">None</option>
        </select>
        <span class="mini flagTitle expanded-view floatLeft">Damage/Healing (used for display on rolls):</span>
        <select class="overrideContent expanded-view mini-input" name="attr_damageType">
            <option value="Damage">Damage</option>
            <option value="Healing">Healing</option>
            <option value="Defense">Defense</option>
            <option value="Effect">Effect</option>
        </select>
        <span class="mini flagTitle expanded-view floatLeft">Hit die (used for rolls):</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_hitDie" title="Hit" placeholder="1d20cs20, 1d8, etc"/>
        <span class="mini flagTitle expanded-view floatLeft">Base effect dice/value (used to calculate damage)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_baseValue" title="Base effect value" placeholder="5, 1d20 + 2, etc" />
        <span class="mini flagTitle expanded-view floatLeft">Direct Hit dice/value (used to calculate extra damage)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_dhValue" title="Direct Hit value" placeholder="5, 1d20 + 2, etc" />
        <span class="mini flagTitle expanded-view floatLeft">Restoration value (used to restore own HP/MP/resource, include space)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_restore" title="Restore value" placeholder="5 MP, 5 HP, 5 Conviction, etc" />
        <span class="mini flagTitle expanded-view floatLeft">Effects on self (used to automatically add effects)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_effectSelf" title="Effect names" placeholder="Astral Fire, Surging Tempest" />
        <span class="mini flagTitle expanded-view floatLeft">Effects on target (used to add effect shortcut button)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_effectTarget" title="Effect names" placeholder="Major Arcana, Mage's Ballad" />
        <span class="mini flagTitle expanded-view floatLeft">Combo name (used for easy chaining to next ability)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_combo" title="Combo value" placeholder="Storm's Path, Storm's Eye" />
    </div>
</div>                </fieldset>
            </div>
        </div>
        <div class="collapse-overlay collapsed-view "></div>
    </div>

    <!-- Limit Break -->

    <div class="limit">
        <h3 class="large">Limit Break</h3>
        <input type="hidden" class="overrideSwitch" name="attr_override" placeholder="placeholder" />
        <fieldset class="repeating_limit">
            <!-- build:import ability.html-->
<div class="ability">
    <div class="header list">
        <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
        <input type="hidden" class="usesFlag" name="attr_uses_max" />
        <input type="hidden" class="costFlag" name="attr_cost" />
        <input type="text" class="conditionFlag hidden" name="attr_condition" placeholder="P" />
        <input type="text" class="triggerFlag hidden" name="attr_trigger" placeholder="P" />
        <input type="text" class="targetFlag hidden" name="attr_target" placeholder="P" />
        <input type="text" class="checkFlag hidden" name="attr_check" placeholder="P" />
        <input type="text" class="crFlag hidden" name="attr_cr" placeholder="P" />
        <input class="expand-checkbox hidden" type="checkbox" name="attr_repeatingExpandItem" />

        <span class="mini flagTitle expanded-view floatLeft">Icon source:</span>
        <input type="text" class="iconSource overrideContent expanded-view mini-input" name="attr_icon" title="Icon" placeholder="icon source" />

        <div class="uses">
            <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
            <input class="max mini-input floatRight" type="number" name="attr_uses_max" min="0" value="0" />
            <span class="floatRight">/</span>
            <input class="mini-input floatRight" type="number" name="attr_uses" min="0" value="0" />
        </div>

        <div class="header-title">
            <img class="ability-icon" name="attr_icon" />
            <div class="title adaptive adaptive--text">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="bold adaptive--text__span"  name="attr_title"></span>
                <textarea class="adaptive--text__textarea" type="text" name="attr_title" placeholder="Paladin Combo (Fast Blade + Riot Blade)"></textarea>
            </div>
        </div>

        <div class="ability-controls">
            <button type="action" class="ability-action-trigger" name="act_trigger">t</button>
            <button type="action" class="ability-action" name="act_info">i</button>
            <button type="action" class="ability-action" name="act_share">q</button>
            <button type="action" name="act_rolldamage" style="display: none;">d</button>
            <button type="action" name="act_rolldamagewithbonus" style="display: none;">d</button>
            <button type="action" name="act_runcombo1" style="display: none;">d</button>
            <button type="action" name="act_runcombo2" style="display: none;">d</button>
            <button type="action" name="act_runcombo3" style="display: none;">d</button>
        </div>

        <div class="type expanded-view">
            <span class="mini-title floatLeft">Type:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input italic adaptive--text__span" name="attr_type"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_type" placeholder="Primary, Physical"></textarea>
            </div>
        </div>
        <div class="cost expanded-view">
            <span class="mini-title floatLeft">Cost:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span" name="attr_cost"></span>
                <input class="mini-input adaptive--input__input" type="number" name="attr_cost" placeholder="X" />
            </div>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span"  name="attr_resource"></span>
                <input class="mini-input adaptive--input__input" type="text" name="attr_resource" placeholder="Conviction" />
            </div>
        </div>
        <div class="condition expanded-view">
            <span class="mini-title floatLeft">Condition:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_condition"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_condition" placeholder="Under the effect of Fang and Claw Bared / Wheel in Motion Ready"></textarea>
            </div>
        </div>
        <div class="trigger expanded-view">
            <span class="mini-title floatLeft">Trigger:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_trigger"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_trigger" placeholder="Immediately after an ability check for an ability that targets you"></textarea>
            </div>
        </div>
        <div class="target expanded-view">
            <span class="mini-title floatLeft">Target:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_target"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_target" placeholder="Single"></textarea>
            </div>
        </div>
        <div class="range expanded-view">
            <span class="mini-title floatLeft">Range:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_range"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_range" placeholder="1 square"></textarea>
            </div>
        </div>
        <div class="check expanded-view">
            <span class="mini-title floatLeft">Check:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input bold adaptive--input__span" name="attr_check"></span>
                <input class="mini-input bold adaptive--input__input" type="text" name="attr_check" placeholder="d20 + STR" />
            </div>
        </div>
        <div class="cr expanded-view">
            <span class="mini-title floatLeft">CR:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span" name="attr_cr"></span>
                <input class="mini-input adaptive--input__input" type="text" name="attr_cr" placeholder="Target's Defense" />
            </div>
        </div>
    </div>

    <div class="body list">
        <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
        <input type="text" class="directHitFlag hidden" name="attr_directHit" placeholder="P" />
        <input type="text" class="effectFlag hidden" name="attr_effectName" placeholder="P" />
        <input type="text" class="limitationFlag hidden" name="attr_limitation" placeholder="P" />
        <input class="expand-checkbox hidden" type="checkbox" name="attr_repeatingExpandItem" />

        <div class="spacer expanded-view"></div>

        <div class="base-effect expanded-view">
            <span class="mini-title floatLeft">Base Effect:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_baseEffect"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_baseEffect" placeholder="Deals 3 damage and inflicts Enmity on the target. Combo: Rage of Halone."></textarea>
            </div>
        </div>
        <div class="ability-effect list expanded-view">
            <div class="adaptive adaptive--input">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-title adaptive--input__span" name="attr_effectName"></span>
                <span class="mini-title" name="attr_effectName">:</span>
                <input class="mini-title adaptive--input__input" type="text" name="attr_effectName" placeholder="My Effect" />
            </div>
            <div class="adaptive adaptive--text">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_effect"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_effect" placeholder="Provides 1 HP Barrier"></textarea>
            </div>
        </div>
        <div class="direct-hit expanded-view">
            <span class="mini-title floatLeft">Direct Hit:</span>
            <div class="adaptive adaptive--text floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--text__span" name="attr_directHit"></span>
                <textarea class="mini-input adaptive--text__textarea" type="text" name="attr_directHit" placeholder="Deals an additional 2d6 damage"></textarea>
            </div>
        </div>
        <div class="limitation expanded-view">
            <span class="mini-title floatLeft">Limitation:</span>
            <div class="adaptive adaptive--input floatLeft">
                <input type="hidden" class="overrideSwitch" name="attr_repeatingOverride" />
                <span class="mini-input adaptive--input__span" name="attr_limitation"></span>
                <input class="mini-input adaptive--input__input" type="text" name="attr_limitation" placeholder="Once per phase." />
            </div>
        </div>

        <span class="mini flagTitle expanded-view floatLeft">Stat for rolls (used for calculations):</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_stat" title="Stat for rolls" placeholder="STR, DEX, etc"/>
        <span class="mini flagTitle expanded-view floatLeft">Hit dice type (used for display on rolls):</span>
        <select class="overrideContent expanded-view mini-input" name="attr_hitType">
            <option value="Hit">Hit</option>
            <option value="Critical">Critical</option>
            <option value="None">None</option>
        </select>
        <span class="mini flagTitle expanded-view floatLeft">Damage/Healing (used for display on rolls):</span>
        <select class="overrideContent expanded-view mini-input" name="attr_damageType">
            <option value="Damage">Damage</option>
            <option value="Healing">Healing</option>
            <option value="Defense">Defense</option>
            <option value="Effect">Effect</option>
        </select>
        <span class="mini flagTitle expanded-view floatLeft">Hit die (used for rolls):</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_hitDie" title="Hit" placeholder="1d20cs20, 1d8, etc"/>
        <span class="mini flagTitle expanded-view floatLeft">Base effect dice/value (used to calculate damage)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_baseValue" title="Base effect value" placeholder="5, 1d20 + 2, etc" />
        <span class="mini flagTitle expanded-view floatLeft">Direct Hit dice/value (used to calculate extra damage)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_dhValue" title="Direct Hit value" placeholder="5, 1d20 + 2, etc" />
        <span class="mini flagTitle expanded-view floatLeft">Restoration value (used to restore own HP/MP/resource, include space)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_restore" title="Restore value" placeholder="5 MP, 5 HP, 5 Conviction, etc" />
        <span class="mini flagTitle expanded-view floatLeft">Effects on self (used to automatically add effects)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_effectSelf" title="Effect names" placeholder="Astral Fire, Surging Tempest" />
        <span class="mini flagTitle expanded-view floatLeft">Effects on target (used to add effect shortcut button)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_effectTarget" title="Effect names" placeholder="Major Arcana, Mage's Ballad" />
        <span class="mini flagTitle expanded-view floatLeft">Combo name (used for easy chaining to next ability)</span>
        <input type="text" class="overrideContent expanded-view mini-input" name="attr_combo" title="Combo value" placeholder="Storm's Path, Storm's Eye" />
    </div>
</div>        </fieldset>
    </div>
</div>

<!-- Items page -->
<!-- build:import items.html -->
<div class="items" spellcheck="false">

    <div class="ability-top">
        <button type="action" class="floatRight" name="act_expandAllItems">Expand All</button>
        <button type="action" class="floatRight" name="act_collapseAllItems">Collapse All</button>
    </div>

    <div class="grid">
        <div class="left fancy lowkey section list">

            <!-- Title List -->

            <h3 class="small colored-in">Titles</h3> 
            <fieldset class="repeating_titles">
                <div class="trait list">
                    <input class="expand-checkbox hidden" type="checkbox" name="attr_repeatingExpandItem" />
                    <div class="grid3 item-header">
                        <input class="medium" type="text" name="attr_title" placeholder="Enter the title name"></span>
                        <button type="action" class="ability-action" style="margin-left: auto;" name="act_share">q</button>
                        <button type="action" class="ability-action" name="act_info">i</button>
                    </div>
                    <div class="item-body list expanded-view">
                        <span class="header medium bold" style="margin-top: 4px;">Effect:</span>
                        <div class="adaptive adaptive--text floatLeft" style="margin-bottom: 8px;">
                            <span class="mini-input adaptive--text__span"  name="attr_effect"></span>
                            <textarea class="mini-input adaptive--text__textarea" name="attr_effect" placeholder="The effect provided by the Title"></textarea>
                        </div>
                        <div class="equip-container">
                            <button type="action" class="select floatRight" name="act_select">Equip</button>
                        </div>
                    </div>
                </div>
            </fieldset>

            <!-- Minion List -->

            <h3 class="small colored-in">Minions</h3>
            <fieldset class="repeating_minions">
                <div class="trait list">
                    <input class="expand-checkbox hidden" type="checkbox" name="attr_repeatingExpandItem" />
                    <div class="grid3 item-header">
                        <input class="medium" type="text" name="attr_title" placeholder="Enter the minion's name"></span>
                        <button type="action" class="ability-action" style="margin-left: auto;" name="act_share">q</button>
                        <button type="action" class="ability-action" name="act_info">i</button>
                    </div>
                    <div class="item-body list expanded-view">
                        <span class="header medium bold" style="margin-top: 4px;">Effect:</span>
                        <div class="adaptive adaptive--text floatLeft" style="margin-bottom: 8px;">
                            <span class="mini-input adaptive--text__span"  name="attr_effect"></span>
                            <textarea class="mini-input adaptive--text__textarea" name="attr_effect" placeholder="The effect provided by the Minion"></textarea>
                        </div>
                        <div class="equip-container">
                            <button type="action" class="select floatRight" name="act_select">Equip</button>
                        </div>
                    </div>
                </div>
            </fieldset>
        </div>

        <!-- Item List -->

        <div class="right fancy lowkey section list vertical-span2">
            <h3 class="small colored-in">Items</h3>
            <fieldset class="repeating_items">

                <div class="trait list">
                    <input class="expand-checkbox hidden" type="checkbox" name="attr_repeatingExpandItem" />
                    <div class="grid4 item-header">
                        <input class="medium" name="attr_title" type="text" placeholder="Item name" />
                        <input class="medium stat" name="attr_count" type="number" value="1" min="0" />
                        <button type="action" class="ability-action" style="margin-left: auto;" name="act_share">q</button>
                        <button type="action" class="ability-action" name="act_info">i</button>
                    </div>
                    <div class="item-body list expanded-view">
                        <span class="header medium bold" style="margin-top: 4px;">Effect:</span>
                        <div class="adaptive adaptive--text floatLeft" style="margin-bottom: 8px;">
                            <span class="mini-input adaptive--text__span"  name="attr_effect"></span>
                            <textarea class="mini-input adaptive--text__textarea" name="attr_effect" placeholder="The item's effect"></textarea>
                        </div>
                    </div>
                </div>
            </fieldset>
        </div>
    </div>
</div>
<!-- Settings page -->
<!-- build:import settings.html -->
<div class="char-settings" spellcheck="false">
    <input type="hidden" class="overrideSwitch" name="attr_override" />

    <div class="grid">
        <div class="entry fancy lowkey">
            <h3>Character type</h3>
            <p class="medium" style="margin-top: 8px;">Determines if calculations use the selected token or the character sheet.</p>
            <select name="attr_sheet_type">
                <option value="generic">Generic</option>
                <option value="unique">Unique</option>
            </select>
        </div>

        <div class="entry fancy lowkey">
            <h3>Team</h3>
            <p class="medium" style="margin-top: 8px;">Determines at which step in turn order the character regenerates MP.</p>
            <select name="attr_team">
                <option value="">--Select--</option>
                <option value="adventurer">Adventurer</option>
                <option value="enemy">Enemy</option>
            </select>
        </div>

        <div class="entry fancy lowkey">
            <h3>Job selector</h3>
            <p class="medium" style="margin-top: 8px;">Assigns the job, with automatically added actions (only some jobs supported)</p>
            <select name="attr_job">
                <option value="">--Select--</option>
                <option value="DRK">Dark Knight</option>
                <!--
                <option value="GNB">Gunbreaker</option>
                !-->
                <option value="PLD">Paladin</option>
                <option value="WAR">Warrior</option>
                <hr />
                <option value="AST">Astrologian</option>
                <!--
                <option value="SGE">Sage</option>
                !-->
                <option value="SCH">Scholar</option>
                <option value="WHM">White Mage</option>
                <hr />
                <option value="DRG">Dragoon</option>
                <option value="MNK">Monk</option>
                <option value="NIN">Ninja</option>
                <!--
                <option value="RPR">Reaper</option>
                <option value="SAM">Samurai</option>
                <option value="VIP">Viper</option>
                <hr />
                !-->
                <option value="BRD">Bard</option>
                <!--
                <option value="DNC">Dancer</option>
                !-->
                <option value="MCH">Machinist</option>
                <hr />
                <option value="BLM">Black Mage</option>
                <!--
                <option value="PCT">Pictomancer</option>
                <option value="RDM">Red Mage</option>
                <option value="SMN">Summoner</option>
                <hr />
                <option value="BLU">Blue Mage</option>
                -->
                <hr />
                <option value="NPC">NPC (initial setup only)</option>
            </select>
        </div>


        <div class="entry fancy lowkey">
            <h3>Turn order type</h3>
            <p class="medium" style="margin-top: 8px;">Players decide on their own turn order within the adventurer phase by setting a specific value.</p>
            <p class="medium">For enemies, you can randomly distribute their turns within the enemy phase.</p>
            <p class="medium">"Roll" is the default style for Enemies.</p>
            <select name="attr_turnOrderStyle" style="margin-top: 8px;">
                <option value="set">Set to value</option>
                <option value="roll">Roll d20 + value</option>
            </select>
        </div>
    </div>

    <div class="override fancy lowkey">
        <h3>Manual Override</h3>
        <p class="medium" style="margin-top: 8px;">Enables manual input for things the player would normally not mess with, things used mostly during initial sheet creation.</p>
        <p class="medium">Mess with at your own risk!</p>
        <input type="text" class="large" name="attr_override" placeholder="Enter 'auto' to disable manual editing" value="" />
    </div>

    <div class="override overrideContent fancy lowkey">
        <h3>Roll visibility</h3>
        
        <div class="vertical">
            <select name="attr_whisper" style="margin-top: 8px;">
                <option value="">Public</option>
                <option value="/w gm ">Whisper to GM</option>
            </select>

            <input type="hidden" class="whisperSwitch" name="attr_whisper" />
            <div class="whisperContent">
                <span class="mini-title">Always show Ability Rolls:</span>
                <div class="sheet-checkbox-container">
                    <input class="floatLeft sheet-checkbox" style="position: absolute;" type="checkbox" name="attr_whisperExemptAbilities" /><span class="sheet-checkbox-before"></span>
                </div>
            </div>
        </div>
    </div>
</div> 
<div class="attribution list">
    <span class="mini">FXIV TTRPG Character Sheet for Roll20. Fan-made, no association with Square Enix.</span>
    <span class="mini">Custom borders and icons for jobs, abilities and effects are property of Square Enix Ltd.</span>
</div>

<!-- build:import rolltemplates.html -->
<rolltemplate class="sheet-rolltemplate-roll">
    <div class="sheet-template-container">
        <div class="sheet-header">
            <h3 class="sheet-title">{{title}}</h3>
        </div>
        <div class="sheet-body">
            <span class="sheet-subtitle">Result:</span>
            <span class="sheet-roll">{{computed::roll}}</span>
        </div>
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-ability">
    <div class="sheet-ability-template">
        <div class="sheet-header sheet-list">
            <div class="sheet-header-title">
                <div class="sheet-ability-icon">
                    {{icon}}
                </div>
                <div class="sheet-title">
                    <span class="sheet-bold">{{name}}</span>
                </div>
            </div>
            <div class="sheet-header-subtitle sheet-list">
                <div>
                    <span class="sheet-mini-title sheet-floatLeft">Type:</span>
                    <span class="sheet-mini-input sheet-floatLeft sheet-italic">{{type}}</span>
                </div>
                <div>
                    <span class="sheet-mini-title sheet-floatLeft">{{costTitle}}</span>
                    <span class="sheet-mini-input sheet-floatLeft">{{cost}}</span>
                    <span class="sheet-mini-input sheet-floatLeft" style="margin-left: 4px;">{{resourceType}}</span>
                </div>
                <div>
                    <span class="sheet-mini-title sheet-floatLeft">{{conditionTitle}}</span>
                    <span class="sheet-mini-input sheet-floatLeft">{{condition}}</span>
                </div>
                <div>
                    <span class="sheet-mini-title sheet-floatLeft">{{triggerTitle}}</span>
                    <span class="sheet-mini-input sheet-floatLeft">{{trigger}}</span>
                </div>
                <div>
                    <span class="sheet-mini-title sheet-floatLeft">{{targetTitle}}</span>
                    <span class="sheet-mini-input sheet-floatLeft">{{target}}</span>
                </div>
                <div>
                    <span class="sheet-mini-title sheet-floatLeft">{{rangeTitle}}</span>
                    <span class="sheet-mini-input sheet-floatLeft">{{range}}</span>
                </div>
                <div>
                    <span class="sheet-mini-title sheet-floatLeft">{{checkTitle}}</span>
                    <span class="sheet-mini-input sheet-floatLeft sheet-bold">{{check}}</span>
                </div>
                <div>
                    <span class="sheet-mini-title sheet-floatLeft">{{crTitle}}</span>
                    <span class="sheet-mini-input sheet-floatLeft">{{cr}}</span>
                </div>
            </div>
        </div>
        <div class="sheet-body">
            <div>
                <span class="sheet-mini-title sheet-floatLeft">{{baseEffectTitle}}</span>
                <span class="sheet-mini-input sheet-floatLeft">{{baseEffect}}</span>
            </div>
            <div>
                <span class="sheet-mini-title sheet-floatLeft">{{effectTitle}}</span>
                <span class="sheet-mini-input sheet-floatLeft">{{effect}}</span>
            </div>
            <div>
                <span class="sheet-mini-title sheet-floatLeft">{{directHitTitle}}</span>
                <span class="sheet-mini-input sheet-floatLeft">{{directHit}}</span>
            </div>
            <div>
                <span class="sheet-mini-title sheet-floatLeft">{{limitationTitle}}</span>
                <span class="sheet-mini-input sheet-floatLeft">{{limitation}}</span>
            </div>
        </div>
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-hit">
    <div class="sheet-ability-template">
        <div class="sheet-header">
            <div class="sheet-header-title">
                <div class="sheet-ability-icon">
                    {{icon}}
                </div>
                <div class="sheet-title">
                    <span class="sheet-bold">{{name}}</span>
                </div>
            </div>
            <div class="sheet-header-subtitle">
                <h4>{{cost}}</h4>
                <h4>{{type}}</h4>
                <div>
                    <span class="sheet-mini-title">{{conditionTitle}}</span>
                    <span class="sheet-mini-input">{{condition}}</span>
                </div>
            </div>
        </div>
        <div class="sheet-body sheet-list">
            <div>
                <span class="sheet-mini-title">Base Effect:</span>
                <span class="sheet-mini-input">{{baseEffect}}</span>
            </div>
            <div>
                <span class="sheet-mini-title sheet-floatLeft">{{effectTitle}}</span>
                <span class="sheet-mini-input sheet-floatLeft">{{effect}}</span>
            </div>
            <div>
                <span class="sheet-mini-title">{{directHitTitle}}</span>
                <span class="sheet-mini-input">{{directHit}}</span>
            </div>
            <h4>{{hitTitle}}{{computed::hit}}</h4>
            <h4>{{cr}}</h4>
            <span class="sheet-hidden-switch">{{button}}</span>
            <div class="sheet-button-container sheet-hidable">{{button}}</div>
        </div>
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-damage">
    <div class="sheet-template-container">
        <div class="sheet-header">
            <h4 class="sheet-title">{{title}}</h4>
            <div class="sheet-list">
                <span class="sheet-mini-input">{{cost}}</span>
                <span class="sheet-mini-input sheet-hideinline">{{computed::proc}}</span>
            </div>
            <h4>{{damageTitle}}{{computed::damage}}</h4>
            <h4>{{directHitTitle}}{{computed::directHit}}</h4>
        </div>
        <span class="sheet-hidden-switch">{{totalTitle}}{{targetEffectTitle}}{{comboTitle}}</span>
        <div class="sheet-body sheet-hidable">
            <div class="sheet-total-container">
                <h4 class="sheet-top-header">{{totalTitle}}</h4><h4 class="sheet-hideinline" style="margin-top: auto; margin-bottom: auto;">{{computed::total}}</h4>
            </div>
            <span class="sheet-hidden-switch sheet-effect-switch">{{targetEffectTitle}}</span>
            <div class="sheet-effects sheet-button-container">
                <h4 class="sheet-button-header">{{targetEffectTitle}}</h4>
                {{targetEffects}}
            </div>
            <span class="sheet-hidden-switch sheet-combo-switch">{{comboTitle}}</span>
            <div class="sheet-combo sheet-button-container">
                <h4 class="sheet-button-header">{{comboTitle}}</h4>
                {{button}}
            </div>
        </div>
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-item">
    <div class="sheet-template-container">
        <div class="sheet-header">
            <h3 class="sheet-type">
                <div class="sheet-ability-icon">{{icon}}</div>
                <span>{{type}}</span>
            </h3>
            <h3 class="sheet-title">{{title}}</h3>
        </div>
        <div class="sheet-body">
            <span class="sheet-subtitle">Effect:</span>
            <span class="sheet-paragraph">{{effect}}</span>
        </div>
    </div>
</rolltemplate>

<!-- -----------------SHEET WORKERS (version 1.0.0)----------------- -->


<script type="text/worker">

// Build (version 1.0.0), generated file tabs

const tabsImports = new (function() {
    this.export = {};

const workerName = "tabs"


})();

// Build: Source/workers/tabs.js


// Tabs

const buttonlist = ["character", "items", "abilities", "settings"];
buttonlist.forEach(button => {
    on(`clicked:${button}`, () => {
        setAttrs({
            sheetTab: button
        });
    });
});

// Initial setup
on("sheet:opened", () => {
    getAttrs([
        "d20",
        "advantage",
        "mpRecovery",
        "mpRecoveryBlock",
        "resourceRecovery",
        "resource2Recovery",
        "resource",
        "resource2"
    ], values => {
        setAttrs({
            d20: values.d20 ?? "1d20",
            advantage: values.advantage ?? 0,
            mpRecovery: values.mpRecovery ?? 2,
            mpRecoveryBlock: values.mpRecoveryBlock ?? "off",
            resourceRecovery: values.resourceRecovery ?? 0,
            resource2Recovery: values.resource2Recovery ?? 0,
            resource: values.resource ?? "",
            resource2: values.resource2 ?? "none"
        });
    });
});

</script>

<script type="text/worker">

// Build (version 1.0.0), generated file attributes

const attributesImports = new (function() {
    this.export = {};

const workerName = "attributes"


})();

// Build: Source/workers/attributes.js


// Advantage management

function addAdvantage(change) {
    getAttrs(["advantage"], values => {
        const advantage = Math.min(Math.max(values.advantage + change, -3), 3);
        let numberOfAdvantageDice = Math.abs(advantage);
        let numberOfDice = 1 + numberOfAdvantageDice;
        let keepMarker;
        if (advantage == 0) {
            keepMarker = "";
        } else if (advantage > 0) {
            keepMarker = "kh1";
        } else {
            keepMarker = "kl1";
        }
        setAttrs({
            advantage: advantage,
            d20: numberOfDice + "d20" + keepMarker
        });
    });
}

on("clicked:increaseAdvantage", () => {
    addAdvantage(1);
});

on("clicked:decreaseAdvantage", () => {
    addAdvantage(-1);
});

on("clicked:clearAdvantage", () => {
    setAttrs({
        advantage: 0,
        d20: "1d20"
    });
});

// HP Max
on("change:hitPoints", () => {
    getAttrs(["hitPoints", "hitPoints_max"], values => {
        if (values.hitPoints > values.hitPoints_max) {
            setAttrs({
                hitPoints: values.hitPoints_max
            });
        }
    });
});

// Barrier Max
on("change:barrierPoints", (eventInfo) => {
    log("Set barrier " + JSON.stringify(eventInfo));
    getAttrs(["barrierPoints"], values => {
        setAttrs({
            barrierPoints_max: values.barrierPoints
        });
    });
});

// Resource Max
on("change:resourceValue", () => {
    getAttrs(["resourceValue", "resourceValue_max"], values => {
        if (values.resourceValue > values.resourceValue_max) {
            log("Reset resource");
            setAttrs({
                resourceValue: values.resourceValue_max
            });
        }
    });
});

// Effective attributes
on("change:str change:dex change:vit change:int change:mnd change:defense change:magicDefense change:vigilance change:speed", (eventInfo) => {
    if (eventInfo.sourceType === "sheetworker") {
        return;
    }

    log("Attribute changed: " + JSON.stringify(eventInfo));
    let attribute = eventInfo.sourceAttribute;
    let previousValue = parseInt(eventInfo.previousValue);
    if (isNaN(previousValue)) {
        previousValue = 0;
    }
    let newValue = parseInt(eventInfo.newValue);
    if (isNaN(newValue)) {
        newValue = 0;
    }
    let diff = newValue - previousValue;
    getAttrs([`${attribute}`, `${attribute}Effective`], values => {
        let existingValue = parseInt(values[`${attribute}Effective`]);
        var newAttributes = {};
        let rawValue = values[attribute];
        let bottomValue = Math.min(rawValue, 0);
        if (isNaN(existingValue)) {
            newAttributes[`${attribute}Effective`] = newValue;
            newAttributes[`${attribute}Display`] = Math.max(newValue, bottomValue);
        } else {
            let effectiveValue = existingValue + diff;
            newAttributes[`${attribute}Effective`] = effectiveValue;
            newAttributes[`${attribute}Display`] = Math.max(effectiveValue, bottomValue);
        }
        setAttrs(newAttributes);
    });
});

</script>

<script type="text/worker">

// Build (version 1.0.0), generated file items

const itemsImports = new (function() {
    this.export = {};

const workerName = "items"


})();

// Build: Source/workers/items.js



// Items

function shareItemToChat(eventInfo) {
    const sourceAttributes = eventInfo.sourceAttribute.split("_");
    const section = sourceAttributes[1];
    const rowId = sourceAttributes[2];
    getAttrs([
        `repeating_${section}_${rowId}_title`,
        `repeating_${section}_${rowId}_effect`
    ], values => {
        const title = values[`repeating_${section}_${rowId}_title`];
        const effect = values[`repeating_${section}_${rowId}_effect`];

        var type;
        switch (section) {
            case "items":
                type = "Item";
                break;
            case "titles":
                type = "Title";
                break;
            case "minions":
                type = "Minion";
                break;
            case "traits":
                type = "Trait";
                break;
            default:
                log("Unrecognized item type " + section);
                return;
        }

        startRoll(`&{template:item} {{title=${title}}} {{type=${type}}} {{effect=${effect}}}`, results => {
            finishRoll(results.rollId);
        });
    });
}

// Remove items with zero content
on("change:repeating_items:count", eventInfo => {
    const sourceAttributes = eventInfo.sourceAttribute.split("_");
    const section = sourceAttributes[1];
    const rowId = sourceAttributes[2];

    let newValue = parseInt(eventInfo.newValue);
    if (isNaN(newValue)) {
        log("Cannot manage items with NaN count");
        return;
    }
    if (newValue <= 0) {
        log("Removing consumed item");
        removeRepeatingRow(`repeating_${section}_${rowId}`);
    }
});

on("clicked:repeating_titles:share clicked:repeating_minions:share clicked:repeating_items:share clicked:repeating_traits:share", eventInfo => {
    shareItemToChat(eventInfo);
});

on("clicked:repeating_titles:select", eventInfo => {
    const rowid = eventInfo.sourceAttribute.split("_")[2];
    getAttrs([
        `repeating_titles_${rowid}_title`, 
        `repeating_titles_${rowid}_effect`
    ], values => {
        // Assign selected title
        setAttrs({
            selectedTitleId: rowid,
            selectedTitle: values[`repeating_titles_${rowid}_title`],
            selectedTitleEffect: values[`repeating_titles_${rowid}_effect`]
        });
    });
});

// Minion selection
on("clicked:repeating_minions:select", eventInfo => {
    const rowid = eventInfo.sourceAttribute.split("_")[2];
    getAttrs([
        `repeating_minions_${rowid}_title`, 
        `repeating_minions_${rowid}_effect`
    ], values => {
        // Assign selected minion
        setAttrs({
            selectedMinionId: rowid,
            selectedMinion: values[`repeating_minions_${rowid}_title`],
            selectedMinionEffect: values[`repeating_minions_${rowid}_effect`]
        });
    });
});

</script>

<script type="text/worker">

// Build (version 1.0.0), generated file override

const overrideImports = new (function() {
    this.export = {};

const workerName = "override"

// Build (version 1.0.0): Source/workers/common/abilitySections.js


const abilitySections = [
    "limit", 
    "song1", "song2", "song3", 
    "primary1", "primary2", "primary3", 
    "ninjutsu1", "ninjutsu2", "ninjutsu3", 
    "secondary1", "secondary2", "secondary3", 
    "instant1", "instant2", "instant3", 
    "technique1", "technique2", "technique3"
];

this.export.abilitySections = abilitySections;


})();

// Build: Source/workers/override.js



const imports = overrideImports.export;

// Assign override state
on('change:override', () => {
    getAttrs(['override'], values => {
        log("Changed override to " + values.override);
        for (let section of imports.abilitySections) {
            getSectionIDs(`repeating_${section}`, ids => {
                const output = {};
                ids.forEach(id => output[`repeating_${section}_${id}_repeatingOverride`] = values.override);
                setAttrs(output);
            });
        }
    });
});

</script>

<script type="text/worker">

// Build (version 1.0.0), generated file main

const mainImports = new (function() {
    this.export = {};

const workerName = "main"

// Build (version 1.0.0): Source/workers/main/effects/manualEffectTypeChange.js


const ManualEffectTypeChange = function() {
    this.resolve = function (eventInfo) {
        if (eventInfo.sourceType === "sheetworker") {
            return;
        }
        engine.logd(JSON.stringify(eventInfo));
        const sourceAttributes = eventInfo.sourceAttribute.split("_");
        const rowId = sourceAttributes[2];

        let triggerName = eventInfo.triggerName.toLowerCase();
        let newValue = eventInfo.newValue.trim().toLowerCase();
        if (triggerName.includes("_specialtype") && newValue === "none") {
            // Reset
            var attributes = {};
            attributes[`repeating_effects_${rowId}_type`] = "";
            attributes[`repeating_effects_${rowId}_specialType`] = "";
            setAttrs(attributes);
            return;
        }

        if (triggerName.includes("_specialtype")) {
            this.resolveSpecialTypeChange(rowId, newValue);
        }

        let previousValue;
        if (eventInfo.previousValue) {
            previousValue = effectUtilities.searchableName(eventInfo.previousValue.trim());
        } else {
            previousValue = "";
        }
        getAttrs([
            `repeating_effects_${rowId}_type`,
            `repeating_effects_${rowId}_specialType`,
            `repeating_effects_${rowId}_value`,
            `repeating_effects_${rowId}_expiry`,
            `repeating_effects_${rowId}_description`,
            `repeating_effects_${rowId}_attribute`,
            `repeating_effects_${rowId}_attributeValue`
        ], values => {
            let type = values[`repeating_effects_${rowId}_type`];
            let specialType = values[`repeating_effects_${rowId}_specialType`];
            let adjustedName = effectUtilities.searchableName(specialType || type);
            this.resolveAttributes(rowId, adjustedName, previousValue, values);
            this.resolveEffects(rowId, adjustedName, previousValue);
        });
    };

    this.resolveEffects = function(rowId, name, previousName) {
        removeEffects.resetSpecialEffects(previousName);
        switch (name) {
            case "comatose":
            case "knocked_out":
                engine.getEffects(effects => {
                    log("Removing effects due to comatose/knocked out");
                    for (let effect of effects.effects) {
                        if (effect.type === "weak" || effect.type === "brink") {
                            continue;
                        }
                        if (effect.id === rowId || effect.expiry == "end" || effect.expiry == "permanent") {
                            continue;
                        }
                        removeEffects.remove(effect);
                    }
                    // Disable MP recovery for knocked out characters
                    setAttrs({
                        mpRecoveryBlock: "on"
                    });
                });
                break;
            case "transcendent": {
                engine.getEffects(effects => {
                    log("Clearing all enfeeblements");
                    for (let effect of effects.effects) {
                        if (effect.statusType.trim().toLowerCase() === "enfeeblement") {
                            log(`Clearing ${effect.data.name}`);
                            removeEffects.remove(effect);
                        }
                    }
                });
                break;
            }
        }
    };

    this.resolveSpecialTypeChange = function(rowId, newValue) {
        if (["astral fire", "umbral ice"].includes(newValue)) {
            log("Removing astral/umbral to ensure a single instance of " + newValue);
            // Remove Astral Fire and Umbral Ice excepting the current instance.
            // This ensures there's only one Astral Fire or Umbral Ice active at any point.
            removeEffects.removeAll(["astral fire", "umbral ice"], rowId);
            if (newValue === "umbral ice") {
                log("Resetting MP recovery in case of Astral Fire removal");
                setAttrs({
                    mpRecoveryBlock: "off"
                });
            } else {
                log("Disabling MP recovery due to Astral Fire");
                setAttrs({
                    mpRecoveryBlock: "on"
                });
            }
        } else if (["coeurl form", "opo-opo form", "raptor form"].includes(newValue)) {
            log("Removing Monk Forms to ensure a single form is active");
            // Remove all Monk Forms excepting the current instance.
            // This ensures there's only one Form active at any point.
            removeEffects.removeAll(["coeurl form", "opo-opo form", "raptor form"], rowId);
        } else {
            // Remove duplicates of special effects
            removeEffects.removeAll([newValue], rowId);

            switch (newValue) {
                case "lucid dreaming":
                    log("Incrementing MP recovery due to Lucid Dreaming");
                    setAttrs({
                        mpRecovery: 3
                    });
                    break;
            }
        }
    };

    this.resolveAttributes = function(rowId, name, oldName, values) {
        let value = values[`repeating_effects_${rowId}_value`];
        let data = effectData.effects[name];

        var attributes = {};
        if (data) {
            const iconUrl = effectData.icon(data);
            let expiry = data.expiry || values[`repeating_effects_${rowId}_expiry`];

            attributes[`repeating_effects_${rowId}_icon`] = iconUrl;
            attributes[`repeating_effects_${rowId}_name`] = effectData.hoverDescription(data.name, value, expiry, data.curable ? "on" : "off");
            attributes[`repeating_effects_${rowId}_statusType`] = data.statusType;
            attributes[`repeating_effects_${rowId}_description`] = data.description || values[`repeating_effects_${rowId}_description`];
            attributes[`repeating_effects_${rowId}_expiry`] = expiry;
            attributes[`repeating_effects_${rowId}_curable`] = data.curable ? "on" : "off";
        } else {
            attributes[`repeating_effects_${rowId}_icon`] = "";
        }

        addEffects.resolveAbilities(name, values[`repeating_effects_${rowId}_value`]);

        let attributeName = values[`repeating_effects_${rowId}_attribute`];
        let attributeValue = values[`repeating_effects_${rowId}_attributeValue`];
        if (attributeName) {
            attributes[`repeating_effects_${rowId}_attribute`] = "";
            attributes[`repeating_effects_${rowId}_attributeValue`] = "";
            removeEffects.resetAttributeChanges(oldName, attributeName, attributeValue, () => {
                addEffects.resolveAttributes(rowId, name, value);
            });
        } else {
            addEffects.resolveAttributes(rowId, name, value);
        }

        setAttrs(attributes);
    };
};

const manualEffectTypeChange = new ManualEffectTypeChange();
this.export.ManualEffectTypeChange = ManualEffectTypeChange;
this.export.manualEffectTypeChange = manualEffectTypeChange;

// Build (version 1.0.0): Source/workers/main/effects/manualEffectRemoval.js


const ManualEffectRemoval = function() {
    this.resolve = function(eventInfo) {
        if (eventInfo.sourceType === "sheetworker") {
            return;
        }
        engine.logd("Removing repeating effect");
        const sourceAttributes = eventInfo.sourceAttribute.split("_");
        const rowId = sourceAttributes[2];

        let type = eventInfo.removedInfo[`repeating_effects_${rowId}_type`];
        let specialType = eventInfo.removedInfo[`repeating_effects_${rowId}_specialType`];
        let value = eventInfo.removedInfo[`repeating_effects_${rowId}_value`];
        let affectedAttribute = eventInfo.removedInfo[`repeating_effects_${rowId}_attribute`];
        let affectedAttributeValue = parseInt(eventInfo.removedInfo[`repeating_effects_${rowId}_attributeValue`]);
        let adjustedName = effectUtilities.searchableName(specialType || type);
        if (!adjustedName) {
            return;
        }
        removeEffects.removeAbility(adjustedName, value);
        removeEffects.resetSpecialEffects(adjustedName);
        removeEffects.resetAttributeChanges(adjustedName, affectedAttribute, affectedAttributeValue);
    };
};

const manualEffectRemoval = new ManualEffectRemoval();
this.export.ManualEffectRemoval = ManualEffectRemoval;
this.export.manualEffectRemoval = manualEffectRemoval;

// Build (version 1.0.0): Source/workers/main/effects/manualEffectValueChange.js


const ManualEffectValueChange = function() {
    this.resolve = function(eventInfo) {
        if (eventInfo.sourceType === "sheetworker") {
            return;
        }
        const sourceAttributes = eventInfo.sourceAttribute.split("_");
        const rowId = sourceAttributes[2];

        let value = eventInfo.newValue.trim();


        getAttrs([
            `repeating_effects_${rowId}_type`,
            `repeating_effects_${rowId}_specialType`,
            `repeating_effects_${rowId}_attribute`,
            `repeating_effects_${rowId}_attributeValue`,
            `repeating_effects_${rowId}_curable`,
            `repeating_effects_${rowId}_expiry`
        ], values => {
            let type = values[`repeating_effects_${rowId}_type`];
            let specialType = values[`repeating_effects_${rowId}_specialType`];
            let attributeName = values[`repeating_effects_${rowId}_attribute`];
            let attributeValue = values[`repeating_effects_${rowId}_attributeValue`];
            let curable = values[`repeating_effects_${rowId}_curable`];
            let expiry = values[`repeating_effects_${rowId}_expiry`];
            let adjustedName = effectUtilities.searchableName(specialType || type);
            let data = effectData.effects[adjustedName];

            var attributes = {};
            attributes[`repeating_effects_${rowId}_name`] = effectData.hoverDescription(data.name, value, expiry, curable);
            setAttrs(attributes);

            if (adjustedName === "attribute" || adjustedName === "defenders_boon") {
                log(`New attribute values: ${attributeName}, ${attributeValue}`);
                if (attributeName || attributeValue) {
                    removeEffects.resetAttributeChanges(adjustedName, attributeName, attributeValue, () => {
                        addEffects.resolveAttributes(rowId, adjustedName, value);
                    });
                } else {
                    addEffects.resolveAttributes(rowId, adjustedName, value);
                }
            }
        });
    };
};

const manualEffectValueChange = new ManualEffectValueChange();
this.export.ManualEffectValueChange = ManualEffectValueChange;
this.export.manualEffectValueChange = manualEffectValueChange;

// Build (version 1.0.0): Source/workers/main/effects/manualEffectCurableChange.js


const ManualEffectCurableChange = function() {
    this.resolve = function(eventInfo) {
        if (eventInfo.sourceType === "sheetworker") {
            return;
        }
        const sourceAttributes = eventInfo.sourceAttribute.split("_");
        const rowId = sourceAttributes[2];

        let curable = eventInfo.newValue.trim();

        getAttrs([
            `repeating_effects_${rowId}_type`,
            `repeating_effects_${rowId}_specialType`,
            `repeating_effects_${rowId}_value`,
            `repeating_effects_${rowId}_expiry`
        ], values => {
            let type = values[`repeating_effects_${rowId}_type`];
            let specialType = values[`repeating_effects_${rowId}_specialType`];
            let value = values[`repeating_effects_${rowId}_value`];
            let expiry = values[`repeating_effects_${rowId}_expiry`];
            let adjustedName = effectUtilities.searchableName(specialType || type);
            let data = effectData.effects[adjustedName];

            var attributes = {};
            attributes[`repeating_effects_${rowId}_name`] = effectData.hoverDescription(data.name, value, expiry, curable);
            setAttrs(attributes);
        });
    };
};

const manualEffectCurableChange = new ManualEffectCurableChange();
this.export.ManualEffectValueChange = ManualEffectCurableChange;
this.export.manualEffectCurableChange = manualEffectCurableChange;

// Build (version 1.0.0): Source/workers/main/rolls/rollTemplates.js


const RollTemplates = function() {
    this.unpackValueWithTitle = function(title, value) {
        if (value) {
            return [title, value];
        }
        return ["", ""];
    };
};

const rollTemplates = new RollTemplates();
this.export.RollTemplates = RollTemplates;
this.export.rollTemplates = rollTemplates;

// Build (version 1.0.0): Source/workers/main/rolls/abilityInfo.js


const AbilityInfo = function() {
    // Share ability details to chat
    this.share = function(eventInfo) {
        const sourceAttributes = eventInfo.sourceAttribute.split("_");
        const section = sourceAttributes[1];
        const rowId = sourceAttributes[2];
        getAttrs([
            `repeating_${section}_${rowId}_icon`,
            `repeating_${section}_${rowId}_title`,
            `repeating_${section}_${rowId}_type`,
            `repeating_${section}_${rowId}_cost`,
            `repeating_${section}_${rowId}_resource`,
            `repeating_${section}_${rowId}_condition`,
            `repeating_${section}_${rowId}_trigger`,

            `repeating_${section}_${rowId}_target`,
            `repeating_${section}_${rowId}_range`,
            `repeating_${section}_${rowId}_check`,
            `repeating_${section}_${rowId}_cr`,

            `repeating_${section}_${rowId}_baseEffect`,
            `repeating_${section}_${rowId}_directHit`,
            `repeating_${section}_${rowId}_effectName`,
            `repeating_${section}_${rowId}_effect`,
            `repeating_${section}_${rowId}_limitation`,

            `whisper`
        ], values => {
            const icon = values[`repeating_${section}_${rowId}_icon`];
            const title = values[`repeating_${section}_${rowId}_title`];
            const type = rollTemplates.unpackValueWithTitle("Type:", values[`repeating_${section}_${rowId}_type`]);
            const condition = rollTemplates.unpackValueWithTitle("Condition:", values[`repeating_${section}_${rowId}_condition`]);
            const trigger = rollTemplates.unpackValueWithTitle("Trigger:", values[`repeating_${section}_${rowId}_trigger`]);
            const target = rollTemplates.unpackValueWithTitle("Target:", values[`repeating_${section}_${rowId}_target`]);
            const range = rollTemplates.unpackValueWithTitle("Range:", values[`repeating_${section}_${rowId}_range`]);
            const check = rollTemplates.unpackValueWithTitle("Check:", values[`repeating_${section}_${rowId}_check`]);
            const cr = rollTemplates.unpackValueWithTitle("CR:", values[`repeating_${section}_${rowId}_cr`]);
            const baseEffect = rollTemplates.unpackValueWithTitle("Base Effect:", values[`repeating_${section}_${rowId}_baseEffect`]);
            const directHit = rollTemplates.unpackValueWithTitle("Direct Hit:", values[`repeating_${section}_${rowId}_directHit`]);
            const effectName = values[`repeating_${section}_${rowId}_effectName`];
            const effect = values[`repeating_${section}_${rowId}_effect`];
            const limitation = rollTemplates.unpackValueWithTitle("Limitation:", values[`repeating_${section}_${rowId}_limitation`]);

            var cost = rollTemplates.unpackValueWithTitle("Cost:", values[`repeating_${section}_${rowId}_cost`]);
            var resourceType = values[`repeating_${section}_${rowId}_resource`];
            if (cost[1] <= 0) {
                cost = ["", ""];
                resourceType = "";
            }

            startRoll(`${values["whisper"]}&{template:ability} {{icon=[icon](${icon})}} {{name=${title}}} {{costTitle=${cost[0]}}} {{cost=${cost[1]}}} {{resourceType=${resourceType}}}` +
                `{{typeTitle=${type[0]}}} {{type=${type[1]}}} {{conditionTitle=${condition[0]}}} {{condition=${condition[1]}}}` +
                `{{triggerTitle=${trigger[0]}}} {{trigger=${trigger[1]}}} {{targetTitle=${target[0]}}} {{target=${target[1]}}}` +
                `{{rangeTitle=${range[0]}}} {{range=${range[1]}}} {{checkTitle=${check[0]}}} {{check=${check[1]}}}` +
                `{{crTitle=${cr[0]}}} {{cr=${cr[1]}}} {{baseEffectTitle=${baseEffect[0]}}} {{baseEffect=${baseEffect[1]}}}` +
                `{{directHitTitle=${directHit[0]}}} {{directHit=${directHit[1]}}} {{effectTitle=${effectName}}} {{effect=${effect}}}` +
                `{{limitationTitle=${limitation[0]}}} {{limitation=${limitation[1]}}}`, results => {
                    finishRoll(results.rollId);
                });
        });
    };
};

const abilityInfo = new AbilityInfo();
this.export.AbilityInfo = AbilityInfo;
this.export.abilityInfo = abilityInfo;

// Build (version 1.0.0): Source/workers/main/rolls/effectInfo.js


const EffectInfo = function() {
    this.share = function(eventInfo) {
        const sourceAttributes = eventInfo.sourceAttribute.split("_");
        const rowId = sourceAttributes[2];
        getAttrs([
            `repeating_effects_${rowId}_icon`,
            `repeating_effects_${rowId}_type`,
            `repeating_effects_${rowId}_specialType`,
            `repeating_effects_${rowId}_value`,
            `repeating_effects_${rowId}_expiry`,
            `repeating_effects_${rowId}_curable`,
            `repeating_effects_${rowId}_description`,
            `repeating_effects_${rowId}_source`
        ], values => {
            let icon = values[`repeating_effects_${rowId}_icon`];
            let type = values[`repeating_effects_${rowId}_type`];
            let specialType = values[`repeating_effects_${rowId}_specialType`];
            let value = values[`repeating_effects_${rowId}_value`];
            let curable = values[`repeating_effects_${rowId}_curable`];
            let expiry = values[`repeating_effects_${rowId}_expiry`];
            let description = values[`repeating_effects_${rowId}_description`];

            let adjustedName = effectUtilities.searchableName(specialType || type);
            let data = effectData.effects[adjustedName];

            var itemType = "Effect";
            let title;
            var descriptions = [];
            if (description) {
                descriptions.push(description);
            }
            if (data) {
                title = data.name;
                if (data.description && descriptions.length == 0) {
                    descriptions.push(data.description);
                }
                if (data.maskedType == "augment") {
                    itemType = "Augment";
                } else if (data.maskedType == "item") {
                    itemType = "Item Effect";
                }
            } else {
                title = specialType || type;
            }

            if (value) {
                descriptions.push(`Value: ${value}`);
            }
            descriptions.push(`Expires: ${effectData.expiries[expiry]}`);

            if (curable === "on") {
                descriptions.push("Can be cured.");
            }

            var iconDefinition = "";
            if (icon) {
                iconDefinition = `[icon](${icon})`;
            }
            let fullDescription = descriptions.join("\n\n");

            startRoll(`&{template:item} {{icon=${iconDefinition}}} {{title=${title}}} {{type=${itemType}}} {{effect=${fullDescription}}}`, results => {
                finishRoll(results.rollId);
            });
        });
    };
};

const effectInfo = new EffectInfo();
this.export.EffectInfo = EffectInfo;
this.export.effectInfo = effectInfo;

// Build (version 1.0.0): Source/workers/main/rolls/rollModifiers.js


const RollModifiers = function() {

    this.addEffectsToHitRoll = function(effects, rollMacro, rollType) {
        var penalty = 0;
        var hasParalysis = false;
        var criticalUp = 0;
        var attributeUp = {};
        var blindPenalty = 0;
        var hasHawksEye = false;
        for (let effect of effects.effects) {
            var effectName = effect.type;
            if (effect.type == "special") {
                effectName = effect.specialType.trim().toLowerCase();
            }
            switch (effectName) {
                case "blind":
                    blindPenalty = 2;
                    break;
                case "brink":
                    penalty += 5;
                    break;
                case "critical(x)":
                    if (effect.value) {
                        criticalUp += parseInt(effect.value);
                    }
                    break;
                case "hawk's eye":
                    hasHawksEye = true;
                    break;
                case "paralyzed":
                    if (rollType == "primary") {
                        hasParalysis = true;
                    }
                    break;
                case "petrified":
                    penalty += 5;
                    break;
                case "prone":
                    penalty += 2;
                    break;
                case "sleep":
                    penalty += 3;
                    break;
                case "slow":
                    penalty += 2;
                    break;
                case "stun":
                    penalty += 5;
                    break;
                case "weak":
                    penalty += 2;
                    break;
            }
        }
        var updatedMacro = rollMacro;
        if (hasParalysis) {
            updatedMacro = updatedMacro.replace(/cs>?20/, "cs>20cf<5[chance of paralysis]");
        }
        if (criticalUp > 0) {
            updatedMacro = updatedMacro.replace(/cs>?20/, `cs>${20 - criticalUp}`);
        }
        if (!hasHawksEye) {
            // Hawk's Eye nullifies penalty from Blind
            penalty += blindPenalty;
        }
        if (penalty > 0) {
            updatedMacro = `${updatedMacro} - ${penalty}[penalty]`;
        }
        const matches = [...updatedMacro.matchAll(/@\{([a-z]{3})\}/g)];
        for (let match of matches) {
            const attributeName = match[1];
            const attributeValue = attributeUp[attributeName];
            if (!attributeValue) {
                continue;
            }
            updatedMacro = updatedMacro.replace(
                match[0],
                `${match[0]}[${attributeName.toUpperCase()}] + ${attributeUp[attributeName]}[${attributeName.toUpperCase()} bonus]`
            );
        }
        return updatedMacro;
    };

    this.applyCriticalMultiplierIfNeeded = function(damageRoll, effects) {
        // Calculate hit roll with added bonuses
        var bonusValue = 0;
        if (damageRoll.useRollBonus) {
            bonusValue = effects.reduce(
                (accumulator, currentValue) => {
                    if (currentValue.data.maskedType != "roll(x)") {
                        return accumulator;
                    }
                    if (currentValue.value) {
                        return accumulator + parseInt(currentValue.value);
                    }
                    return accumulator;
                }, 0
            );
        }

        // Determine critical multiplier
        var criticalMultiplier = 1;
        if (damageRoll.hitRoll) {
            criticalMultiplier = damageRoll.hitRoll + bonusValue >= effects.criticalThreshold ? 2 : 1;
        }
        let baseRoll = damageRoll.baseRoll;
        var modifiedRoll = damageRoll;
        if (criticalMultiplier > 1) {
            if (baseRoll && baseRoll.includes("d")) {
                modifiedRoll.baseRoll = "[[" + criticalMultiplier + "[crit multiplier] * " + baseRoll[0] + "]]" + baseRoll.substring(1);;
            }
        }

        // Monk's Opo-Opo Form forces crits in two particular circumstances:
        // - 1. 'Bootshine' Direct Hits
        // - 2. 'Bestial Fury: Opo-Opo' when comboed from a Direct Hitting Bootshine
        if (damageRoll.monkForm === "Opo-Opo Form") {
            if (damageRoll.title === "Bootshine") {
                // Force crit on 'Bootshine' Direct Hit
                criticalMultiplier = 2;
            } else if (damageRoll.title === "Bestial Fury: Opo-Opo" && criticalMultiplier < 2) {
                // If the initial hit roll was an outright crit, it's already been applied as a modifier to the base roll and we don't need to do anything here.
                // Otherwise, we handle the forced crit scenario by adding a duplicate roll to Direct Hit to simulate the forced crit.
                // I.e.: Base Roll + Direct Hit Roll = 2 x Base Roll, which is the same as a crit.
                // This way players can choose the base value or the full damage total depending on if the ability Direct Hits (crits) their chosen target.
                modifiedRoll.directHitRoll = baseRoll;
                return modifiedRoll;
            }
        }

        if (criticalMultiplier > 1) {
            let directHitRoll = modifiedRoll.directHitRoll;
            if (directHitRoll && directHitRoll.includes("d")) {
                modifiedRoll.directHitRoll = "[[" + criticalMultiplier + "[crit multiplier] * " + directHitRoll[0] + "]]" + directHitRoll.substring(1);
            }
            return modifiedRoll;
        } else {
            return damageRoll;
        }
    };

    this.applyEffectModifiersToDamageRolls = function(damageRoll, characterLevel, effects) {
        var adds = [];
        var negatives = [];
        var summaries = [];

        let isFireType = damageRoll.type.toLowerCase().includes("fire-aspect");
        if (isFireType && effects.astralFire) {
            let addedDamage = characterLevel >= 50 ? "2d6" : "1d6";
            adds.push(`${addedDamage}[Astral Fire]`);
            summaries.push("Astral Fire proc");
        }

        if (effects.dpsChanges && damageRoll.damageType === "Damage") {
            for (let effect of effects.dpsChanges) {
                if (effect.data.name == "Raging Strikes" && !damageRoll.type.includes("Primary")) {
                    // This effect only applies to primary abilities
                    continue;
                }
                if (effect.data.maskedType === "ddown(x)" || parseInt(effect.value) < 0) {
                    negatives.push(`${effect.value}[${effect.data.name}]`);
                } else {
                    adds.push(`${effect.value}[${effect.data.name}]`);
                }
                summaries.push(`${effect.data.name} proc`);
            }
        }

        // Insert empty elements so the joined string starts with an operator +/-
        if (adds.length > 0) {
            adds.splice(0, 0, "");
        }
        if (negatives.length > 0) {
            negatives.splice(0, 0, "");
        }

        if (adds.length > 0 || negatives.length > 0) {
            engine.logd("Adding damage to roll");
            var modifiedRoll = damageRoll;
            let baseRoll = modifiedRoll.baseRoll;
            let directHitRoll = modifiedRoll.directHitRoll;
            if (baseRoll) {
                baseRoll = `${baseRoll}${adds.join(" + ")}${negatives.join(" - ")}`;
                modifiedRoll.baseRoll = baseRoll;
            } else if(directHitRoll) {
                directHitRoll = `${directHitRoll}${adds.join(" + ")}${negatives.join(" - ")}`;
                modifiedRoll.directHitRoll = directHitRoll;
            }
            return {
                damageRoll: modifiedRoll,
                summaries: summaries
            };
        } else {
            return {
                damageRoll: damageRoll,
                summaries: []
            };
        }
    };

    this.applyEffectModifiersAfterDamageRolls = function(effects, damageType, damageRolls) {
        var result = {};
        var summaries = [];
        if (damageType == "Damage" && effects.damageRerolls && damageRolls.some(roll => roll.dice && roll.dice.length > 0)) {
            summaries.push(`Damage reroll available (${effects.damageRerolls.join(", ")})`);
        }

        if (effects.surgingTempest) {
            var rolls = [];
            var total = 0;
            var appliedSurgingTempest = false;
            for (let roll of damageRolls) {
                if (!roll || !roll.result) {
                    rolls.push("");
                    continue;
                }

                let dice = roll.dice;
                if (!dice || dice.length == 0) {
                    total += roll.result;
                    rolls.push(roll.result);
                    continue;
                }
                let diceResult = dice.reduce(
                    (accumulator, currentValue) => {
                        if (currentValue == 1) {
                            appliedSurgingTempest = true;
                            return 2 + accumulator;
                        }
                        return currentValue + accumulator;
                    },
                    0
                );
                let rawAdditions = roll.expression.split("+").reduce(
                    (accumulator, currentValue) => {
                        let trimmed = currentValue.trim();
                        if (trimmed.includes("d")) {
                            return accumulator;
                        }
                        let value = parseInt(trimmed);
                        if (isNaN(value)) {
                            log(`Unexpected NaN ${trimmed} from expression ${roll.expression}`);
                            return accumulator;
                        }
                        return accumulator + parseInt(trimmed);
                    },
                    0
                );

                let newResult = diceResult + rawAdditions;
                total += newResult;
                rolls.push(newResult);
            }
            result.rolls = rolls;
            result.total = total;
            if (appliedSurgingTempest) {
                summaries.push("Surging Tempest proc");
            }
        } else {
            let rolls = damageRolls.map(roll => roll.result);
            let total = rolls.reduce(
                (accumulator, currentValue) => (currentValue ?? 0) + accumulator,
                0
            );
            result.rolls = rolls;
            result.total = total;
        }
        result.summary = summaries.join(", ");

        return result;
    };

    this.applyAdvantage = function(advantage, dice) {
        if (advantage == 0) {
            return dice;
        }
        if (!dice.includes("d")) {
            return dice;
        }
        const highOrLow = advantage > 0 ? "kh" : "kl";
        const multiplier = Math.abs(advantage) + 1;

        var searchString = dice;
        var newDice = "";
        var index;
        while ((index = searchString.indexOf("d")) >= 0) {
            let numberOfDice;
            if (index == 0) {
                numberOfDice = 1;
                searchString = `1${searchString}`;
                index = 1;
            } else {
                newDice += searchString.substring(0, index - 1);
                numberOfDice = searchString.substring(index - 1, index);
            }
            const numberOfDiceWithMultiplier = numberOfDice * multiplier;

            // Find end of roll
            let match = /[-+* /)]/.exec(searchString.substring(index));
            if (match) {
                const matchIndex = match.index + index;
                newDice += `${numberOfDiceWithMultiplier}${searchString.substring(index, matchIndex)}${highOrLow}${numberOfDice}`;
                searchString = searchString.substring(matchIndex);
            } else {
                newDice += `${numberOfDiceWithMultiplier}${searchString.substring(index).trim()}${highOrLow}${numberOfDice}`;
                searchString = "";
                break;
            }
        }
        newDice += searchString;
        return newDice;
    };
};

const rollModifiers = new RollModifiers();
this.export.RollModifiers = RollModifiers;
this.export.rollModifiers = rollModifiers;

// Build (version 1.0.0): Source/workers/main/rolls/abilityRolls.js


const TargetEffects = function(source) {
    let match  = source.match(/^(?:([-'\s\w]+):)?((?:[-'\s\w()]+,)*)([-'\s\w()]+)$/);
    if (match && match.length > 1) {
        this.name = match[1];
    } else {
        this.name = null;
        this.effects = [];
        return;
    }

    this.effects = [];
    if (match.length > 2 && match[2]) {
        let commaSeparatedEffects = match[2].slice(0, -1);
        this.effects = this.effects.concat(commaSeparatedEffects.split(",").map(value => value.trim()));
    }
    if (match.length > 3 && match[3]) {
        this.effects = this.effects.concat(match[3].trim());
    }
};

const DamageRoll = function({
    title, type, damageType, baseRoll, directHitRoll="", hitRoll="", condition="", combos="", cost=0, resource="", 
    selfEffects="", targetEffects="", restoration="", monkForm="", useRollBonus=false, whisperPrefix=""
}) {

    this.title = title;
    this.type = type;
    this.damageType = damageType;
    this.baseRoll = baseRoll;
    this.directHitRoll = directHitRoll;
    this.hitRoll = hitRoll;
    this.condition = condition;
    this.combos = combos;
    this.comboTitle = combos ? "Combo" : "";
    this.cost = parseInt(cost);
    this.resource = resource;
    this.selfEffects = selfEffects;
    this.targetEffects = targetEffects;
    this.restoration = restoration;
    this.monkForm = monkForm;
    this.useRollBonus = useRollBonus;
    this.whisperPrefix = whisperPrefix;

    this.baseEffectTitle = function() {
        return this.baseRoll ? `${this.damageType}: ` : "";
    };

    this.baseEffectDice = function() {
        return this.baseRoll ? `[[${this.baseRoll}]]` : "";
    };
    
    this.directHitTitle = function() {
        return this.directHitRoll ? "Direct Hit: " : "";
    };

    this.directHitDice = function() {
        return this.directHitRoll ? `[[${this.directHitRoll}]]` : "";
    };

    this.totalTitle = function() {
        return this.baseRoll && this.directHitRoll ? `Full ${this.damageType}: ` : "";
    };
};

const damageAbilityAttributes = function(section, rowId) {
    return [
        `repeating_${section}_${rowId}_title`,
        `repeating_${section}_${rowId}_type`,
        `repeating_${section}_${rowId}_damageType`,
        `repeating_${section}_${rowId}_baseValue`,
        `repeating_${section}_${rowId}_dhValue`,
        `repeating_${section}_${rowId}_combo`,
        `repeating_${section}_${rowId}_currentRoll`,
        `repeating_${section}_${rowId}_currentMonkForm`,

        `repeating_${section}_${rowId}_cost`,
        `repeating_${section}_${rowId}_uses`,
        `repeating_${section}_${rowId}_uses_max`,
        `repeating_${section}_${rowId}_restore`,
        `repeating_${section}_${rowId}_resource`,

        `repeating_${section}_${rowId}_effectSelf`,
        `repeating_${section}_${rowId}_effectTarget`,
        `repeating_${section}_${rowId}_condition`
    ];
};
const damageCharacterAttributes = [
    "level", "barrierPoints",
    "hitPoints", "hitPoints_max",
    "magicPoints", "magicPoints_max",
    "resource", "resourceValue", "resourceValue_max",
    "resource2", "resource2Value", "resource2Value_max",
    "resource3", "resource3Value", "resource3Value_max",
    "range1", "range1_max", "range2", "range2_max", "range3", "range3_max",

    "speedEffective", "speedBlock", "speedUnblocked", "speedOriginal",

    "character_name", "sheet_type",

    "whisper", "whisperExemptAbilities"
];

const AbilityRolls = function() {

    // Roll ability
    this.roll = function(eventInfo) {
        engine.logd("Activate ability " + JSON.stringify(eventInfo));
        const sourceAttributes = eventInfo.sourceAttribute.split("_");
        const section = sourceAttributes[1];
        const rowId = sourceAttributes[2];

        engine.getAttrsAndEffects([
            `repeating_${section}_${rowId}_icon`,
            `repeating_${section}_${rowId}_title`,
            `repeating_${section}_${rowId}_type`,
            `repeating_${section}_${rowId}_cost`,
            `repeating_${section}_${rowId}_resource`,
            `repeating_${section}_${rowId}_condition`,
            `repeating_${section}_${rowId}_trigger`,
            `repeating_${section}_${rowId}_uses`,
            `repeating_${section}_${rowId}_uses_max`,

            `repeating_${section}_${rowId}_target`,
            `repeating_${section}_${rowId}_range`,

            `repeating_${section}_${rowId}_baseEffect`,
            `repeating_${section}_${rowId}_directHit`,

            `repeating_${section}_${rowId}_effectName`,
            `repeating_${section}_${rowId}_effect`,
            `repeating_${section}_${rowId}_effectSelf`,
            `repeating_${section}_${rowId}_effectTarget`,

            `repeating_${section}_${rowId}_stat`,
            `repeating_${section}_${rowId}_damageType`,
            `repeating_${section}_${rowId}_hitType`,
            `repeating_${section}_${rowId}_hitDie`,
            `repeating_${section}_${rowId}_baseValue`,
            `repeating_${section}_${rowId}_cr`,
            `repeating_${section}_${rowId}_restore`,
            `repeating_${section}_${rowId}_combo`,

            "strDisplay", "dexDisplay", "vitDisplay", "intDisplay", "mndDisplay",
            "magicPoints", "magicPoints_max", "resourceValue", "resourceValue_max",
            "advantage", "character_name",

            "whisper", "whisperExemptAbilities"
        ], (values, effects) => {
            // Perform roll
            const title = values[`repeating_${section}_${rowId}_title`];
            const icon = values[`repeating_${section}_${rowId}_icon`];
            const usesMax = values[`repeating_${section}_${rowId}_uses_max`];

            const cost = values[`repeating_${section}_${rowId}_cost`];

            const statType = values[`repeating_${section}_${rowId}_stat`].toLowerCase();
            const damageType = values[`repeating_${section}_${rowId}_damageType`];
            const hitType = values[`repeating_${section}_${rowId}_hitType`];
            const restoration = values[`repeating_${section}_${rowId}_restore`];
            const statValue = values[`${statType}Display`];
            const baseEffect = values[`repeating_${section}_${rowId}_baseEffect`];
            const baseValue = values[`repeating_${section}_${rowId}_baseValue`];
            const directHit = values[`repeating_${section}_${rowId}_directHit`];
            const effectName = values[`repeating_${section}_${rowId}_effectName`];
            const effect = values[`repeating_${section}_${rowId}_effect`];
            const effectSelf = values[`repeating_${section}_${rowId}_effectSelf`];
            const effectTarget = values[`repeating_${section}_${rowId}_effectTarget`];

            const combo = values[`repeating_${section}_${rowId}_combo`];
            const crString = this.stringWithTitle("CR:", values[`repeating_${section}_${rowId}_cr`]);
            const typeString = this.stringWithTitle("Type:", values[`repeating_${section}_${rowId}_type`]);
            const condition = rollTemplates.unpackValueWithTitle("Condition:", values[`repeating_${section}_${rowId}_condition`]);
            const triggerString = this.stringWithTitle("Trigger:", values[`repeating_${section}_${rowId}_trigger`]);

            var hitDie = values[`repeating_${section}_${rowId}_hitDie`];
            hitDie = rollModifiers.applyAdvantage(values.advantage, hitDie);

            var hitTitle = "";
            var hitDefinition = "";
            var button = "";

            if (effects.isStunned) {
                button = "Abilities cannot be used when stunned!";
            } else if (effects.isSilenced && typeString.toLowerCase().includes("invoked")) {
                button = "Invoked ability cannot be used when silenced!";
            } else if (hitDie || baseValue) {
                var bonusButton = "";
                if (hitType != "None" && hitDie) {
                    hitTitle = `${hitType}: `;
                    if (statValue > 0) {
                        hitDie = `${hitDie} + @{${statType}Display}`;
                    }
                    hitDie = rollModifiers.addEffectsToHitRoll(effects, hitDie, section);
                    hitDefinition = `[[${hitDie}]]`;

                    // Option to improve the hit roll
                    if (effects.effects.some((effect) => effect.type == "roll(x)")) {
                        bonusButton = ` [${damageType} + Roll Up(X)](~${values.character_name}|repeating_${section}_${rowId}_rolldamagewithbonus)`;
                    }
                }
                button = `[${damageType}](~${values.character_name}|repeating_${section}_${rowId}_rolldamage)${bonusButton}`;
            } else if (cost > 0 || usesMax > 0 || restoration || combo || effectSelf || effectTarget) {
                button = `[Effect](~${values.character_name}|repeating_${section}_${rowId}_rolldamage)`;
            }

            var directHitTitle = "";
            if (directHit) {
                directHitTitle = "Direct Hit:";
            }

            var attributes = {};
            attributes[`repeating_${section}_${rowId}_currentRoll`] = "";
            attributes[`repeating_${section}_${rowId}_currentMonkForm`] = effects.monkForm ? effects.monkForm.specialType : "";
            setAttrs(attributes);

            let whisper = values.whisper;
            if (values.whisper && values.whisperExemptAbilities === "on") {
                whisper = "";
            }
            let rollTemplate = `${whisper}&{template:hit} {{icon=[icon](${icon})}} {{name=${title}}} ` +
                `{{type=${typeString}}} {{conditionTitle=${condition[0]}}} {{condition=${condition[1]}}} {{trigger=${triggerString}}} ` +
                `{{hitTitle=${hitTitle}}} {{hit=${hitDefinition}}} {{cr=${crString}}} {{baseEffect=${baseEffect}}} ` +
                `{{directHitTitle=${directHitTitle}}} {{directHit=${directHit}}} {{effectTitle=${effectName}}} {{effect=${effect}}}` +
                `{{button=${button}}}`;
            engine.logd(rollTemplate);
            startRoll(rollTemplate, results => {
                var hitRoll = results.results.hit;
                if (!hitRoll) {
                    hitRoll = {
                        result: undefined,
                        dice: undefined,
                        expression: undefined
                    };
                }
                const hitValue = hitRoll.result;
                var computedValue = hitValue;
                if (hitRoll.dice) {
                    var die;
                    if (hitRoll.expression.includes("kl")) {
                        die = Math.min(...hitRoll.dice);
                    }
                    else {
                        die = Math.max(...hitRoll.dice);
                    }
                    let attributes = {};
                    attributes[`repeating_${section}_${rowId}_currentRoll`] = die;
                    setAttrs(attributes);
                }
                if (hitValue && parseInt(computedValue) < 0) {
                    computedValue = 0;
                }

                finishRoll(results.rollId, {
                    hit: computedValue
                });
            });
        });
    };

    this.rollDamage = function(useRollBonus, eventInfo) {
        engine.logd("Roll damage " + JSON.stringify(eventInfo));
        const sourceAttributes = eventInfo.sourceAttribute.split("_");
        const section = sourceAttributes[1];
        const rowId = sourceAttributes[2];
        let attributes = damageAbilityAttributes(section, rowId).concat(damageCharacterAttributes);
        engine.getAttrsAndEffects(attributes, (values, effects) => {
            let damageRoll = new DamageRoll({
                title: values[`repeating_${section}_${rowId}_title`],
                type: values[`repeating_${section}_${rowId}_type`],
                damageType: values[`repeating_${section}_${rowId}_damageType`],
                baseRoll: values[`repeating_${section}_${rowId}_baseValue`],
                directHitRoll: values[`repeating_${section}_${rowId}_dhValue`],
                hitRoll: parseInt(values[`repeating_${section}_${rowId}_currentRoll`]),
                condition: values[`repeating_${section}_${rowId}_condition`],
                combos: values[`repeating_${section}_${rowId}_combo`],
                cost: values[`repeating_${section}_${rowId}_cost`],
                resource: values[`repeating_${section}_${rowId}_resource`],
                selfEffects: values[`repeating_${section}_${rowId}_effectSelf`],
                targetEffects: values[`repeating_${section}_${rowId}_effectTarget`],
                restoration: values[`repeating_${section}_${rowId}_restore`],
                monkForm: values[`repeating_${section}_${rowId}_currentMonkForm`],
                useRollBonus: useRollBonus,
                whisperPrefix: values.whisperExemptAbilities === "on" ? "" : values.whisper
            });
            let abilityId = new AbilityId(section, rowId);
            this.performDamageRoll(damageRoll, abilityId, values, effects);
        });
    };

    this.performDamageRoll = function(damageRoll, abilityId=null, values, effects) {
        let modifiedRoll = rollModifiers.applyCriticalMultiplierIfNeeded(damageRoll, effects);
        let summariedRoll = rollModifiers.applyEffectModifiersToDamageRolls(modifiedRoll, values.level, effects);
        let modifierSummaries = summariedRoll.summaries;
        modifiedRoll = summariedRoll.damageRoll;

        const comboButtons = abilityCombos.resolveAvailableCombos(modifiedRoll.combos, abilityId, values);
        const comboTitle = comboButtons ? "Combo" : "";

        const resourceCost = performAbility.resolveResources(modifiedRoll, abilityId, values, effects);
        const hasDamage = modifiedRoll.baseRoll || modifiedRoll.directHitRoll;
        const hasEffects = modifiedRoll.selfEffects || modifiedRoll.targetEffects;
        if (!hasDamage && !hasEffects && !resourceCost && !comboButtons) {
            engine.logd("No reason to roll damage");
            return;
        }

        var targetEffectTitle = "";
        let targetEffectButton = "";
        if (modifiedRoll.targetEffects) {
            let calculatedEffects = new TargetEffects(modifiedRoll.targetEffects);
            targetEffectButton = this.buttonForTargetEffects(calculatedEffects, values.character_name);
            if (targetEffectButton) {
                targetEffectTitle = "Effect";
            }
        }

        // Roll damage
        let rollTemplate = `${modifiedRoll.whisperPrefix}&{template:damage} {{title=${modifiedRoll.title}}} ` + 
            `{{damageTitle=${modifiedRoll.baseEffectTitle()}}} {{damage=${modifiedRoll.baseEffectDice()}}} ` +
            `{{directHitTitle=${modifiedRoll.directHitTitle()}}} {{directHit=${modifiedRoll.directHitDice()}}} ` +
            `{{totalTitle=${modifiedRoll.totalTitle()}}} {{total=[[0]]}}` +
            `{{comboTitle=${comboTitle}}} {{button=${comboButtons}}} {{cost=${resourceCost}}} {{proc=[[0]]}} ` +
            `{{targetEffectTitle=${targetEffectTitle}}} {{targetEffects=${targetEffectButton}}}`;
        engine.logd(rollTemplate);
        startRoll(rollTemplate, results => {
            const damageRoll = results.results.damage ?? { result: 0, dice: [], expression: "" };
            const directHitRoll = results.results.directHit ?? { result: 0, dice: [], expression: "" };

            let computedResults = rollModifiers.applyEffectModifiersAfterDamageRolls(effects, modifiedRoll.damageType, [damageRoll, directHitRoll]);
            let consumedEffectSummary = removeEffects.consumeOnAbility(modifiedRoll.title, modifiedRoll.condition, effects);

            let state = new EffectState(
                values.hitPoints, 
                values.hitPoints_max, 
                values.barrierPoints, 
                {
                    hit: modifiedRoll.hitRoll,
                    damage: damageRoll,
                    directHit: directHitRoll
                }, 
                effects
            );
            let effectSummary = addEffects.addBySpecificationString(state, modifiedRoll.selfEffects.split(","));
            let fullSummary = modifierSummaries.concat([computedResults.summary, consumedEffectSummary, effectSummary]).filter(element => element).join(", ");

            if (abilityId) {
                var attributes = {};
                attributes[`repeating_${abilityId.section}_${abilityId.rowId}_currentCriticalMultiplier`] = 1;
                setAttrs(attributes);
            }

            finishRoll(
                results.rollId,
                {
                    proc: fullSummary,
                    damage: computedResults.rolls[0],
                    directHit: computedResults.rolls[1],
                    total: modifiedRoll.totalTitle() ? computedResults.total : ""
                }
            );
        });
    };

    this.activateCombo = function(eventInfo, index) {
        const sourceAttributes = eventInfo.sourceAttribute.split("_");
        const section = sourceAttributes[1];
        const rowId = sourceAttributes[2];
        engine.logd("Combo activated " + JSON.stringify(eventInfo));
        getAttrs([
            `repeating_${section}_${rowId}_combo`,
            `repeating_${section}_${rowId}_currentRoll`,
            `repeating_${section}_${rowId}_currentMonkForm`,

            "whisper", "whisperExemptAbilities"
        ], values => {
            const combo = values[`repeating_${section}_${rowId}_combo`];
            var chosenCombo = combo;
            if (combo.includes(",")) {
                const choices = combo.split(",");
                if (index < choices.length) {
                    chosenCombo = choices[index];
                } else {
                    engine.logi(`Combo index out of bonds: selected ${index}, not in ${combo}`);
                    return;
                }
            }
            let comboSpecifications = abilityCombos.parseCombo(chosenCombo);
            let comboSpecification = comboSpecifications ? comboSpecifications[0] : null;
            if (comboSpecification.roll || comboSpecification.cost) {
                // Custom combo, roll the specified damage and spend the given cost
                let damageRoll = new DamageRoll({
                    title: comboSpecification.name,
                    type: "Special",
                    damageType: "Damage",
                    baseRoll: comboSpecification.roll,
                    hitRoll: values[`repeating_${section}_${rowId}_currentRoll`],
                    cost: comboSpecification.cost,
                    resource: comboSpecification.cost_resource,
                    monkForm: values[`repeating_${section}_${rowId}_currentMonkForm`],
                    whisperPrefix: values.whisperExemptAbilities ? "" : values.whisper
                });
                // TODO: Bootshine combo into Bestial Fury may trigger Bestial Fury: Opo-Opo to crit if it's a DH.
                // Proposed solve: Bootshine: Opo-Opo has a DH-roll of 1d6, so we get base (1d6) optionally + DH (1d6).
                // User can then determine to use just base or total value depending on how the hit roll compares to target CR.
                engine.logd("Activating custom combo " + JSON.stringify(comboSpecification));
                engine.getAttrsAndEffects(damageCharacterAttributes, (values, effects) => {
                    this.performDamageRoll(damageRoll, null, values, effects);
                });
            } else {
                // Search abilities for the chosen combo
                let abilityName = comboSpecification.name.toLowerCase();
                let rawSection = section.replace(/[\d]+/, "");
                let sections = [1, 2, 3].map(index => `${rawSection}${index}`);
                engine.allSectionIDs(sections, sectionIds => {
                    const attributes = sectionIds.map((element) => `${element}_title`);
                    getAttrs(attributes, values => {
                        for (let i = 0; i < sectionIds.length; i++) {
                            const sectionId = sectionIds[i];
                            const attribute = attributes[i];
                            if (values[attribute].trim().toLowerCase().startsWith(abilityName)) {
                                const triggerEvent = {
                                    sourceAttribute: `${sectionId}_runcomboFrom_${rowId}`
                                };
                                engine.logd("Activating " + abilityName);
                                this.roll(triggerEvent);
                                return;
                            }
                        }
                        engine.logd("Couldn't find ability with name " + abilityName);
                    });
                });
            }
        });
    };

    this.buttonForTargetEffects = function(effects, characterName) {
        if (effects.effects.length === 0) {
            return null;
        }
        var effectDefinitions = [];

        engine.logd("Preparing target effects: " + JSON.stringify(effects));
        let initialName = "";
        for (let effect of effects.effects) {
            let adjustedEffect = effectUtilities.searchableName(effect.trim());
            let data = effectData.effects[adjustedEffect];
            if (!data) {
                engine.logi("Unhandled effect " + adjustedEffect);
                continue;
            }

            var value = "";
            let match = effect.match(/\(([-|\s\w]+)\)/);
            if (match && match.length >= 2) {
                value = match[1];
            }

            if (!initialName) {
                initialName = data.name.replace("(X)", `(${value})`);
            }
            let valueDefinition = value ? `[${value}]` : "";
            let effectName = (data.specialType || data.type).replace(/\([Xx]{1}\)/, "");
            let effectDefinition = `${effectName}${valueDefinition}`;
            effectDefinitions.push(effectDefinition);
        }
        return `[${effects.name || initialName}](!ffe --${effectDefinitions.join(",")} --source ${characterName} --edit ${0})`;
    };

    this.stringWithTitle = function(title, value) {
        if (value) {
            return `${title} ${value}`;
        }
        return "";
    };
};

const abilityRolls = new AbilityRolls();
this.export.AbilityRolls = AbilityRolls;
this.export.DamageRoll = DamageRoll;
this.export.abilityRolls = abilityRolls;

// Build (version 1.0.0): Source/workers/main/rolls/turnorder.js


const TurnOrder = function() {

    this.apply = function() {
        engine.get([
            "turnOrder", "whisper"
        ], (values) => {
            let rollTemplate = `${values.whisper}&{template:roll} {{title=Turn Order}} {{roll=[[${values.turnOrder} &{tracker}]]}}`;
            engine.logd(`Rolling turn order ${rollTemplate}`);
            startRoll(rollTemplate, results => {
                finishRoll(results.rollId);
            });
        });
    };

    this.roll = function() {
        engine.get([
            "turnOrder", "whisper"
        ], (values) => {
            let rollTemplate = `${values.whisper}&{template:roll} {{title=Turn Order}} {{roll=[[d20 + ${values.turnOrder} &{tracker}]]}}`;
            engine.logd(`Rolling turn order ${rollTemplate}`);
            startRoll(rollTemplate, results => {
                finishRoll(results.rollId);
            });
        });
    };
};

const turnOrder = new TurnOrder();
this.export.TurnOrder = TurnOrder;
this.export.turnOrder = turnOrder;

// Build (version 1.0.0): Source/workers/main/rolls/statRolls.js


const StatRoll = function() {

    this.roll = function(stat, statName) {
        engine.getAttrsAndEffects([
            "d20", "whisper"
        ], (values, effects) => {
            var roll = `${values.d20} + @{${stat}}`;
            roll = rollModifiers.addEffectsToHitRoll(effects, roll, "stat");

            let rollTemplate = `${values["whisper"]}&{template:roll} {{title=${statName}}} {{roll=[[${roll}]]}}`;
            engine.logd(`Rolling stat ${rollTemplate}`);
            startRoll(rollTemplate, results => {
                const rollResult = results.results.roll.result;
                finishRoll(results.rollId, {
                    roll: Math.max(rollResult, 0)
                });
            });
        });
    };
};

const statRoll = new StatRoll();
this.export.StatRoll = StatRoll;
this.export.statRoll = statRoll;

// Build (version 1.0.0): Source/workers/main/rest/rest.js


const Rest = function() {
    this.attributeList = [
        "hitPoints_max",
        "magicPoints_max",
        "resourceValue_max", "resourceReset"
    ];
    this.phaseAttributeList = [
        "resourceValue_max", "resourceReset"
    ];

    this.rest = function() {
        engine.logd("Initiating rest");
        this.reset(this.attributeList, ["end", "permanent"], "rest");
    };

    this.phase = function() {
        engine.logd("Initiating phase reset");
        // Keep all effects except those that expire on phase change
        let expiries = Object.keys(effectData.expiries).filter(name => name !== "phase");
        this.reset(this.phaseAttributeList, expiries, "phase");
    };

    this.end = function() {
        engine.logd("Initiating end of adventure reset");
        this.reset(this.attributeList, ["permanent"], "end");
    };

    this.reset = function(attributes, exceptedEffectExpiries, resetType) {
        engine.getAttrsAndEffects(attributes, (values, effects) => {
            engine.logd("Removing effects");
            for (let effect of effects.effects) {
                if (exceptedEffectExpiries.includes(effect.expiry)) {
                    continue;
                }
                removeEffects.remove(effect);
            }
            this.resetAttributes(attributes, values, resetType);
        });

        performAbility.resetAllUses();
    };

    this.resetAttributes = function(attributes, values, resetType) {
        engine.logd("Resetting HP/MP");
        var newAttributes = {};
        for (let attribute of attributes) {
            if (!attribute.includes("_max")) {
                continue;
            }
            let baseAttribute = attribute.replace("_max", "");
            if (baseAttribute === "resourceValue") {
                // Some jobs start encounters/phases with full job resource
                if (resetType === "phase" && values.resourceReset !== "full") {
                    continue;
                }
                newAttributes.resourceValue = values.resourceReset === "full" ? values.resourceValue_max : 0;
            } else {
                log("Setting " + baseAttribute + " to " + attribute + ": " + values[attribute]);
                newAttributes[baseAttribute] = values[attribute];
            }
        }

        if (resetType !== "phase") {
            newAttributes.barrierPoints = 0;
            // No jobs start with full secondary reset
            newAttributes.resource2Value = 0;
        }

        setAttrs(newAttributes);
    };
};

const rest = new Rest();
this.export.Rest = Rest;
this.export.rest = rest;

// Build (version 1.0.0): Source/workers/../common/utilities.js


const Logger = function(scriptName, debug) {

    this.scriptName = scriptName;
    this.debug = debug;

    this.d = (string) => {
        if (this.debug) {
            log(`${this.scriptName}: ${string}`);
        }
    };

    this.i = (string) => {
        log(`${this.scriptName}: ${string}`);
    };
};

const unpackNaN = function(value, defaultValue = 0) {
    let intValue = parseInt(value);
    if (isNaN(intValue)) {
        return defaultValue;
    }
    return intValue;
};

this.export.Logger = Logger;
this.export.unpackNaN = unpackNaN;

// Build (version 1.0.0): Source/workers/../common/effectUtilities.js


const EffectUtilities = function() {
    
    this.searchableName = function(name) {
        if (!name) {
            return "";
        }
        return name
            .replaceAll(/(\([-|\s\w]+\))|(\[[-+><=\w]+\])|'/g, "")
            .replaceAll(/[ -]/g, "_")
            .trim().toLowerCase();
    };
    
    this.classify = function(effects) {
        var result = {
            effects: [],
            criticalThreshold: 20
        };
        for (var effect of effects) {
            let adjustedName = this.searchableName(effect.specialType || effect.type);
            if (!adjustedName) {
                continue;
            }
            effect.adjustedName = adjustedName;
            effect.data = effectData.effects[adjustedName];
            result.effects.push(effect);

            switch (effect.data.maskedType || effect.type) {
                case "advantage":
                    if (effect.expiry === "ability" || effect.specialType.trim().toLowerCase() === "hidden") {
                        if (result.abilityAdvantages) {
                            result.abilityAdvantages.push(effect);
                        } else {
                            result.abilityAdvantages = [effect];
                        }
                    }
                    break;
                case "augment":
                    if (effect.specialType.trim().toLowerCase() == "aetherial focus") {
                        result.mpMaxIncrease = true;
                    }
                    break;
                case "brink":
                    result.isBrink = true;
                    break;
                case "critical(x)":
                    if (effect.value) {
                        result.criticalThreshold -= parseInt(effect.value);
                    }
                    break;
                case "ddown(x)":
                case "dps(x)":
                    if (result.dpsChanges) {
                        result.dpsChanges.push(effect);
                    } else {
                        result.dpsChanges = [effect];
                    }
                    log("dpsChanges: " + JSON.stringify(result.dpsChanges));
                    break;
                case "dreroll":
                    if (result.damageRerolls) {
                        result.damageRerolls.push(effect.data.name);
                    } else {
                        result.damageRerolls = [effect.data.name];
                    }
                    break;
                case "silence":
                    result.isSilenced = true;
                    break;
                case "stun":
                    result.isStunned = true;
                    break;
                case "weak":
                    result.isWeak = true;
                    break;
                default:
                    break;
            }
            if (effect.type == "special") {
                switch (effect.specialType.trim().toLowerCase()) {
                    case "astral fire":
                        result.astralFire = effect;
                        break;
                    case "coeurl form":
                    case "opo-opo form":
                    case "raptor form":
                        result.monkForm = effect;
                        break;
                    case "hawk's eye":
                        result.hawksEye = effect;
                        break;
                    case "surging tempest":
                        result.surgingTempest = effect;
                        break;
                    case "umbral ice":
                        result.umbralIce= effect;
                        break;
                    default:
                        break;
                }
            }
        }
        return result;
    };
};

const effectUtilities = new EffectUtilities();
this.export.EffectUtilities = EffectUtilities;
this.export.effectUtilities = effectUtilities;

// Build (version 1.0.0): Source/workers/../common/effects.js


const EffectData = function() {
    this.effects = {
        aero: { matches: ["aero"], type: "special", maskedType: "dot(x)", specialType: "Aero", statusType: "Enfeeblement", marker: "aero", name: "Aero", expiry: "phase", curable: true, duplicate: "bigger", description: "Damages the character by a given amount at the end of the [Adventurer Step]." },
        aetherial_focus: { matches: ["afocus", "aetherial focus"], type: "special", maskedType: "augment", specialType: "Aetherial Focus", statusType: "Enhancement", name: "Aetherial Focus", expiry: "end", duplicate: "block", description: "Begin encounters with X MP. This effect does not increase Max MP." },
        addle: { matches: ["addle"], type: "special", maskedType: "ddown", statusType: "Enfeeblement", specialType: "Addle", marker: "addle", name: "Addle", expiry: "turn", description: "Reduces the damage dealt by your abilities." },
        advantage: { matches: ["adv", "advantage"], type: "advantage", maskedType: "advantage", statusType: "Enhancement", name: "Advantage", expiry: "use", description: "Provides an advantage die that can be used once for any ability roll." },
        astral_fire: { matches: ["afire", "astralf", "astral fire"], type: "special", specialType: "Astral Fire", statusType: "Enhancement", name: "Astral Fire", expiry: "turn2", duplicate: "replace", description: "While under the effect of Astral Fire your fire-aspected abilities deal an additional 1d6 damage* and you do not recover MP at the end of the [Adventurer Step].\n\nAstral Fire is removed when you are granted Umbral Ice or, if the effect is not renewed, at the end of your next turn. \n\n*After attaining level 50, this damage increases to 2d6." },
        attribute: { matches: ["attr", "attribute"], type: "attribute(x)", maskedType: "attribute(x)", statusType: "Enhancement", name: "Attribute Up (X)", expiry: "turn", description: "Improves the given attribute by a set value." },
        barrier: { matches: ["barrier"], type: "special", specialType: "Barrier(X)", statusType: "Enhancement", name: "Barrier (X)", expiry: "ephemeral" },
        berserk: { matches: ["berserk"], type: "special", maskedType: "dps(x)", specialType: "Berserk", statusType: "Enhancement", name: "Berserk", expiry: "turn", duplicate: "block", description: "Your abilities deal an additional 2 damage until the end of this turn." },
        bio_ii: { matches: ["bio", "bio ii", "bio2", "bio 2" ], type: "special", maskedType: "dot(x)", specialType: "Bio II", statusType: "Enfeeblement", marker: "bio", name: "Bio II", expiry: "phase", duplicate: "bigger", description: "Damages the character by a given amount at the end of the [Adventurer Step]." },
        blind: { matches: ["blind"], type: "blind", maskedType: "blind", statusType: "Enfeeblement", marker: "blind", name: "Blind", expiry: "encounter", curable: true, duplicate: "block", description: "You cannot see and automatically fail any checks that rely entirely on vision. You incur a -2 penalty on all checks, and characters receive one advantage die when targeting you." },
        bloodbath: { matches: ["bloodbath"], type: "special", maskedType: "drain", specialType: "Bloodbath", statusType: "Enhancement", name: "Bloodbath", expiry: "turn", duplicate: "bigger", description: "You regain HP each time you deal damage this turn. When using abilities that affect multiple targets or deal multiple instances of damage, HP is recovered for each target damaged or each instance of damage dealt." },
        bound: { matches: ["bind", "bound"], type: "bound", maskedType: "bound", statusType: "Enfeeblement", marker: "bound", name: "Bound", expiry: "encounter", curable: true, duplicate: "block", description: "When Bound, Small and Medium characters' Speed falls to 0, while larger characters' Speed is reduced by 2.\n\nCharacters receive one advantage die when targeting you." },
        brink: { matches: ["brink", "brink of death"], type: "brink", maskedType: "brink", statusType: "Enfeeblement", marker: "brink", name: "Brink of Death", expiry: "rest", duplicate: "block", description: "You take a -5 penalty on all checks. If you are targeted by another effect that inflicts Weak, you are inflicted with Comatose instead.\n\nBrink of Death can only be removed by completing a rest or by effects that specifically remove it." },
        chicken: { matches: ["chicken"], type: "chicken", statusType: "Enfeeblement", marker: "chicken", name: "Chicken", expiry: "turn", duplicate: "replace", description: "You are a chicken." },
        clear_enfeeblements: { matches: ["clear", "cleare", "clear enfeeblements"], type: "special", specialType: "Clear Enfeeblements", statusType: "Enhancement", name: "Clear Enfeeblements", expiry: "ephemeral" },
        coeurl_form: { matches: ["coeurl form", "coeurl", "cform", "monk3", "m3"], type: "special", maskedType: "ready(x)", specialType: "Coeurl Form", statusType: "Enhancement", name: "Coeurl Form", expiry: "turn2", duplicate: "replace", description: "Enables you to perform Snap Punch or Demolish." },
        consume: { matches: ["consume", "consume item"], type: "special", specialType: "Consume(X)", statusType: "Enhancement", name: "Consume (X)", expiry: "ephemeral" },
        comatose: { matches: ["coma", "comatose"], type: "comatose", maskedType: "comatose", statusType: "Enfeeblement", marker: "comatose", name: "Comatose", expiry: "rest", duplicate: "block", description: "A Comatose character is treated as if they were Knocked Out for gameplay purposes.\nComatose can only be removed by spending one full day in a location where appropriate medical treatment is available, as determined by the GM.\n\nA Comatose character has all enhancements and enfeeblements removed. They cannot be granted any enhancements or afflicted with further enfeeblements other than Death." },
        combust: { matches: ["combust"], type: "special", maskedType: "dot(x)", specialType: "Combust", statusType: "Enfeeblement", marker: "combust", name: "Combust", expiry: "phase", curable: true, duplicate: "bigger", description: "Damages the character by a given amount at the end of the [Adventurer Step]." },
        critical: { matches: ["crit", "critical", "critical up"], type: "critical(x)", maskedType: "critical(x)", statusType: "Enfeeblement", name: "Critical Up (X)", expiry: "use", description: "Reduces the roll needed to score a critical hit by the given value." },
        curecast_focus: { matches: ["ccast", "curecast", "curecast focus"], type: "special", maskedType: "augment", augmentType: "ability", ability: "cure", specialType: "Curecast Focus", statusType: "Enhancement", name: "Curecast Focus", expiry: "end", duplicate: "block", description: "Grants the Cure ability." },
        damage: { matches: ["damage"], type: "special", specialType: "Damage", statusType: "Enfeeblement", name: "Damage", expiry: "ephemeral" },
        ddown: { matches: ["ddown", "damage down"], type: "ddown(x)", maskedType: "ddown(x)", statusType: "Enfeeblement", name: "Damage Down (X)", expiry: "turn", curable: true, description: "Reduces damage dealt by this character's abilities by the given value." },
        dreroll: { matches: ["dreroll", "damage reroll"], type: "dreroll", maskedType: "dreroll", statusType: "Enhancement", name: "Damage Reroll", expiry: "use", description: "Allows the option to re-roll any one damage die. The value of the new roll cannot be further re-rolled and has to be used for the damage calculation." },
        dps: { matches: ["dps", "dup", "damage up"], type: "dps(x)", maskedType: "dps(x)", statusType: "Enhancement", name: "Damage Up (X)", expiry: "turn", duplicate: "allow", description: "Increments all damage dealt by the character's abilities by a given value." },
        darkside: { matches: ["dside", "darkside"], type: "special", specialType: "Darkside", statusType: "Enhancement", name: "Darkside", expiry: "turn2", duplicate: "replace", description: "While under the effect of Darkside, you may spend 2 MP when you score a direct hit on an enemy with a single-target ability to treat any roll of 1. 2, or 3 as if it were a 0 and any roll of 4, 5, or 6 as if it were a 10 when determining damage. Darkside is removed at the end of your next turn it the effect is not renewed." },
        defenders_boon: { matches: ["dboon", "defender's boon", "defenders boon"], type: "special", maskedType: "augment", specialType: "Defender's Boon", statusType: "Enhancement", name: "Defender's Boon", expiry: "end", duplicate: "block", description: "Increases Defense or Magic Defense by 1. This applies to the lower of the two attributes; if they have the same value, this augmentation has no effect." },
        deflecting_edge: { matches: ["edge", "dedge", "deflecting", "deflecting edge"], type: "special", maskedType: "augment", augmentType: "ability", ability: "parry", specialType: "Deflecting Edge", statusType: "Enhancement", name: "Deflecting Edge", expiry: "end", duplicate: "block", description: "Grants the Parry ability." },
        dot: { matches: ["dot"], type: "dot(x)", maskedType: "dot(x)", statusType: "Enfeeblement", marker: "dot", name: "DOT (X)", expiry: "phase", curable: true, duplicate: "bigger", description: "Damages the character by a given amount at the end of the [Adventurer Step]." },
        elemental_veil: { matches: ["eveil", "eveil1", "eveili", "eveil 1", "eveil i", "elemental veil", "elementail veil 1", "elemental veil i"], type: "special", maskedType: "augment", specialType: "Elemental Veil", statusType: "Enhancement", name: "Elemental Veil", expiry: "end", duplicate: "block", description: "Reduces the damage taken from abilities of one type chosen from the following list by 1: fire-aspected, ice-aspected, wind-aspected, earth-aspected, lightning-aspected, water-aspected. Choose the type when purchasing this augmentation." },
        elemental_veil_ii: { matches: ["eveil2", "eveilii", "eveil 2", "eveil ii", "elemental veil 2", "elemental veil ii"], type: "special", maskedType: "augment", specialType: "Elemental Veil", statusType: "Enhancement", name: "Elemental Veil II", expiry: "end", duplicate: "block", description: "Reduces the damage taken from abilities of three type chosen from the following list by 1: fire-aspected, ice-aspected, wind-aspected, earth-aspected, lightning-aspected, water-aspected. Choose the type(s) when purchasing this augmentation." },
        enmity: { matches: ["enmity"], type: "enmity(x)", maskedType: "enmity(x)", statusType: "Enfeeblement", marker: "enmity", name: "Enmity (X)", expiry: "turn", duplicate: "replace", description: "For any ability this character makes that does not target the source of the Enmity effect, a penalty of the given value is applied to the ability roll." },
        feint: { matches: ["feint"], type: "special", maskedType: "ddown", statusType: "Enfeeblement", specialType: "Feint", marker: "feint", name: "Feint", expiry: "turn", description: "Reduces the damage dealt by your abilities." },
        fight_or_flight: { matches: ["fflight", "fight or flight"], type: "special", specialType: "Fight or Flight", statusType: "Enhancement", name: "Fight or Flight", expiry: "turn", duplicate: "block", description: "Grants one advantage die on your next ability check this turn." },
        flamecast_focus: { matches: ["fcast", "flamecast", "flamecast focus"], type: "special", maskedType: "augment", augmentType: "ability", ability: "fire", specialType: "Flamecast Focus", statusType: "Enhancement", name: "Flamecast Focus", expiry: "end", duplicate: "block", description: "Grants the Fire ability." },
        hawks_eye: { matches: ["hawk", "hawke", "heye", "hawkeye", "hawk's eye", "hawks eye"], type: "special", maskedType: "Straight Shot Ready", specialType: "Hawk's Eye", statusType: "Enhancement", name: "Hawk's Eye", expiry: "use", duplicate: "block", description: "While under the effect of Hawk's Eye, you ignore the penalty incurred on ability checks made while Blinded." },
        heal: { matches: ["heal"], type: "special", specialType: "Heal(X)", statusType: "Enhancement", name: "Heal (X)", expiry: "ephemeral" },
        heavy: { matches: ["heavy"], type: "heavy", maskedType: "heavy", statusType: "Enfeeblement", marker: "heavy", name: "Heavy", expiry: "turn", curable: true, duplicate: "block", description: "Your Speed is halved (rounded up) and cannot be affected by effects which would add to their Speed.\n\nAbility checks targeting you automatically result in direct hits." },
        hidden: { matches: ["hidden", "hide"], type: "special", maskedType: "advantage", specialType: "Hidden", statusType: "Enhancement", name: "Hidden", expiry: "damage", duplicate: "block", description: "Receive one advantage die on your ability checks. Hidden is removed when you take or deal damage or perform a primary or secondary action." },
        icecast_focus: { matches: ["icast", "icecast", "icecast focus"], type: "special", maskedType: "augment", augmentType: "ability", ability: "ice", specialType: "Icecast Focus", statusType: "Enhancement", name: "Icecast Focus", expiry: "end", duplicate: "block", description: "Grants the Ice ability." },
        improved_padding: { matches: ["ipad", "ipadding", "improved padding"], type: "special", maskedType: "augment", specialType: "Improved Padding", statusType: "Enhancement", name: "Improved Padding", expiry: "end", duplicate: "block", description: "Grants a barrier of 1 HP at the start of the [Adventurer Step]." },
        knocked_out: { matches: ["ko", "kout", "knocked", "knocked out"], type: "knocked_out", maskedType: "knocked_out", name: "Knocked Out", statusType: "Enfeeblement", marker: "ko", expiry: "rest", duplicate: "block", description: "A character that has been Knocked Out is unconscious and cannot perceive their surroundings. They cannot use abilities or perform other actions during their turn.\n\nThey are treated as both Prone and Stunned.\n\nThey cannot recover HP or MP.\n\nKnocked Out can only be removed by effects that specifically remove it.\n\nA character that has been knocked out has all enhancements and enfeeblements removed. They cannot be granted any enhancements or afflicted with further enfeeblements other than Comatose." },
        lance_charge: { matches: ["lance charge", "lcharge"], type: "special", maskedType: "dps(x)", specialType: "Lance Charge", name: "Lance Charge", statusType: "Enhancement", expiry: "turn", duplicate: "bigger", description: "Your abilities deal extra damage until the end of this turn." },
        life_surge: { matches: ["life surge", "lsurge"], type: "special", maskedType: "drain(x)", specialType: "Life Surge", name: "Life Surge", statusType: "Enhancement", expiry: "turn", duplicate: "bigger", description: "You regain HP each time you deal damage this turn. When using abilities that affect multiple targets or deal multiple instances of damage, HP is recovered for each target damaged or each instance of damage dealt.\n\nYou also receive one advantage die on your next ability check this turn." },
        lightweight_refit: { matches: ["refit", "lrefit", "lightweight refit"], type: "special", maskedType: "augment", specialType: "Lightweight Refit", statusType: "Enhancement", name: "Lightweight Refit", expiry: "end", duplicate: "block", description: "Increases Speed by 1 during this character's first turn of an encounter." },
        lucid_dreaming: { matches: ["lucid", "ldreaming", "lucid dreaming"], type: "special", specialType: "Lucid Dreaming", statusType: "Enhancement", name: "Lucid Dreaming", expiry: "step", duplicate: "replace", description: "Recover an additional 1 MP at the end of this round's [Adventurer Step)." },
        mages_ballad: { matches: ["mballad", "mage's ballad", "mages ballad", "mballad"], type: "special", maskedType: "dreroll", specialType: "Mage's Ballad", statusType: "Enhancement", name: "Mage's Ballad", expiry: "use", duplicate: "block", description: "While under the effect of Mage's Ballad, you may reroll a single die when determining the amount of damage dealt by an ability." },
        magic_damper: { matches: ["damper", "mdamper", "magic damper"], type: "special", maskedType: "augment", augmentType: "ability", ability: "aetherwall", specialType: "Magic Damper", statusType: "Enhancement", name: "Magic Damper", expiry: "end", duplicate: "block", description: "Grants the Aetherwall ability." },
        major_arcana: { matches: ["marcana", "major arcana"], type: "special", maskedType: "dreroll", specialType: "Major Arcana", statusType: "Enhancement", name: "Major Arcana", expiry: "turn", duplicate: "replace", description: "While a character is under the effect of Major Arcana, they may reroll a single die of their choosing when determining the amount of damage dealt by an ability. Any die rerolled in this way cannot be rerolled again, and its result must be used.\n\nMajor Arcana is removed when its effect is resolved or at the end of the character's turn." },
        mana_conduit: { matches: ["mconduit", "mana conduit"], type: "special", maskedType: "augment", specialType: "Mana Conduit", statusType: "Enhancement", name: "Mana Conduit", expiry: "end", duplicate: "block", description: "This character may spend 5 MP immediately before making an ability check to increase its total by 1." },
        masterwork_ornamentation: { matches: ["mwork", "masterwork", "ornament", "ornamentation", "masterwork ornamentation"], type: "special", maskedType: "augment", specialType: "Masterwork Ornamentation", statusType: "Enhancement", name: "Masterwork Ornamentation", expiry: "end", duplicate: "block", description: "Grants one advantage die on checks involving speech. This effect cannot be used if the other character is hostile or is unable to see this character." },
        ninjutsu_cooldown: { matches: ["ninjutsu cooldown", "ncooldown", "ninjutsu"], type: "special", specialType: "Ninjutsu Cooldown", name: "Ninjutsu Cooldown", statusType: "Enhancement", expiry: "turn2", duplicate: "replace", description: "You cannot use Ninjutsu abilities. Ninjutsu Cooldown cannot be removed by effects that remove enfeeblements." },
        opo_opo_form: { matches: ["opo-opo form", "opo", "opo form", "opo opo form", "oform", "monk1", "m1"], type: "special", maskedType: "ready(x)", specialType: "Opo-Opo Form", statusType: "Enhancement", name: "Opo-Opo Form", expiry: "turn2", duplicate: "replace", description: "Enhances Bootshine and Dragon Kick." },
        overheated: { matches: ["overheated", "overheat", "heat"], type: "special", specialType: "Overheated", name: "Overheated", statusType: "Enhancement", expiry: "start", duplicate: "block", description: "While under the effect of Overheated, use the lower of the target's Defense or Magic Defense as the CR for your ability checks." },
        paralyzed: { matches: ["paralysis", "paralyze", "paralyzed"], type: "paralyzed", maskedType: "paralyzed", statusType: "Enfeeblement", marker: "paralyzed", name: "Paralyzed", expiry: "turn", curable: true, duplicate: "block", description: "If you use a Primary ability and roll a 5 or lower for its ability check, Paralysis interrupts the ability, negating it completely. Do not resolve any of its effects or spend any resources." },
        petrified: { matches: ["petrify", "petrified"], type: "petrified", maskedType: "petrified", statusType: "Enfeeblement", marker: "petrified", name: "Petrified", expiry: "turn2", curable: true, duplicate: "block", description: "You cannot act during your turn or use Instant abilities. You incur a -5 penalty on all checks.\n\nCharacters targeting you receive one advantage die on their ability check." },
        power_surge: { matches: ["power surge", "psurge"], type: "special", maskedType: "dps(x)", specialType: "Power Surge", name: "Power Surge", statusType: "Enhancement", expiry: "phase", duplicate: "bigger", description: "Your abilities deal additional damage." },
        precision_opener: { matches: ["popener", "precision opener"], type: "special", maskedType: "augment", specialType: "Precision Opener", statusType: "Enhancement", name: "Precision Opener", expiry: "end", duplicate: "block", description: "Grants one advantage die on the first ability check this character makes during their first turn of an encounter." },
        prone: { matches: ["prone"], type: "prone", maskedType: "prone", statusType: "Enfeeblement", marker: "prone", name: "Prone", expiry: "encounter", curable: true, duplicate: "block", description: "You cannot take standard movement action on you turn unless you spend half your Speed (rounded up) to get back on your feet.\n\nProne characters incur a -2 penalty on all checks.\n\nCharacters targeting you receive one advantage die when making an ability check." },
        raging_strikes: { matches: ["rstrikes", "raging strikes"], type: "special", maskedType: "dps(x)", specialType: "Raging Strikes", statusType: "Enhancement", name: "Raging Strikes", expiry: "turn", duplicate: "block", description: "Your primary abilities deal an additional 2 damage until the end of this turn." },
        raise: { matches: ["raise", "ascend" ], type: "special", specialType: "Raise", statusType: "Enhancement", name: "Raise", expiry: "ephemeral" },
        rampart: { matches: ["rampart"], type: "special", maskedType: "defense(x)", specialType: "Rampart", statusType: "Enhancement", name: "Rampart", expiry: "start", duplicate: "block", description: "Reduces the damage you take from abilities by 2 until the start of your next turn." },
        raptor_form: { matches: ["raptor form", "raptor", "rform", "monk2", "m2"], type: "special", maskedType: "ready(x)", specialType: "Raptor Form", statusType: "Enhancement", name: "Raptor Form", expiry: "turn2", duplicate: "replace", description: "Enables you to perform True Strike, Twin Snakes or Four-Point Fury." },
        ready: { matches: ["ready"], type: "ready(x)", maskedType: "ready(x)", statusType: "Enhancement", name: "(X) Ready", expiry: "use", duplicate: "block", description: "You may use an ability that requires you to be under this enhancement. X Ready is removed after the ability is used." },
        reassemble: { matches: ["reassemble"], type: "special", specialType: "Reassemble", name: "Reassemble", statusType: "Enhancement", expiry: "turn", description: "The next ability you use this turn automatically scores a critical unless it is interrupted or otherwise negated." },
        regen: { matches: ["regen", "revivify"], type: "regen(x)", maskedType: "regen(x)", statusType: "Enhancement", name: "Regen (X)", expiry: "phase", description: "Restores a given amount of HP at the end of the [Adventurer Step]." },
        reprisal: { matches: ["repr", "reprisal"], type: "special", maskedType: "ddown(x)", specialType: "Reprisal", statusType: "Enfeeblement", marker: "reprisal", name: "Reprisal", expiry: "round", duplicate: "block", description: "Reduces the damage you deal with abilities by 2 until the end of this round." },
        restore: { matches: ["restore"], type: "restore(x)", maskedType: "restore(x)", statusType: "Enhancement", name: "Restore uses of Y by (X)", expiry: "ephemeral" },
        restore_magic: { matches: ["restorem", "restore magic"], type: "special", specialType: "Restore Magic", statusType: "Enhancement", name: "Restore Magic", expiry: "ephemeral" },
        roll: { matches: ["roll", "roll up"], type: "roll(x)", maskedType: "roll(x)", statusType: "Enhancement", name: "Increment Ability Roll (X)", expiry: "use", description: "Allows the option to increment the value of an ability roll for purposes of achieving a Direct Hit or a Critical." },
        silence: { matches: ["silence"], type: "silence", maskedType: "silence", statusType: "Enfeeblement", marker: "silence", name: "Silence", expiry: "turn", curable: true, duplicate: "block", description: "You cannot use invoked abilities." },
        sleep: { matches: ["sleep"], type: "sleep", maskedType: "sleep", statusType: "Enfeeblement", marker: "sleep", name: "Sleep", expiry: "damage", curable: true, duplicate: "block", description: "You incur a -3 penalty on all checks. Sleep is removed when you take damage.\n\nCharacters may use a Primary action to wake a Sleeping character in an adjacent square." },
        slow: { matches: ["slow"], type: "slow", maskedType: "slow", statusType: "Enfeeblement", marker: "slow", name: "Slow", expiry: "encounter", curable: true, duplicate: "block", description: "Your Speed is halved (rounded up) and cannot be affected by effects which would add to your Speed.\n\nYou incur a -2 penalty on all checks." },
        stun: { matches: ["stun"], type: "stun", maskedType: "stun", statusType: "Enfeeblement", marker: "stun", name: "Stun", expiry: "turn", duplicate: "block", description: "You cannot act during your turn or use Instant abilities.\n\nAny and all markers for which a Stunned character is the creator are removed.\n\nYou incur a -5 penalty to all checks.\n\nCharacters targeting you receive one advantage die on ability checks.\n\nStun cannot be removed by effects that remove enfeeblements.\n\nA character that has been Stunned cannot be Stunned again in the same encounter." },
        unstunnable: { matches: ["unstun", "unstunnable", "stunresist", "stun resistance"], type: "unstunnable", maskedType: "unstunnable", statusType: "Enhancement", name: "Stun Immunity", expiry: "encounter", duplicate: "block", description: "You are immune to Stun effects for this encounter." },
        surging_tempest: { matches: ["stempest", "surging tempest"], type: "special", specialType: "Surging Tempest", statusType: "Enhancement", name: "Surging Tempest", expiry: "encounter", duplicate: "block", description: "While under the effect of Surging Tempest, treat any roll of 1 when determining damage as if it were a 2." },
        transcendent: { matches: ["trans", "transcendent"], type: "transcendent", maskedType: "transcendent", statusType: "Enhancement", name: "Transcendent", expiry: "start", duplicate: "block", description: "You are immune to damage and enfeeblements inflicted by enemy abilities, traits and encounter mechanics. Transcendent is removed at the start of the character's turn or when the character uses an ability." },
        transpose: { matches: ["transpose"], type: "special", specialType: "Transpose", name: "Transpose", expiry: "ephemeral" },
        thrill_of_battle: { matches: ["thrill", "tbattle", "thrill of battle"], type: "special", specialType: "Thrill of Battle", statusType: "Enhancement", name: "Thrill of Battle", expiry: "ephemeral", duplicate: "allow" },
        thunder: { matches: ["thunder"], type: "special", maskedType: "dot(x)", specialType: "Thunder", statusType: "Enfeeblement", marker: "thunder", name: "Thunder", expiry: "phase", curable: true, duplicate: "bigger", description: "Damages the character by a given amount at the end of the [Adventurer Step]." },
        thunderhead_ready: { matches: ["tready", "thunderhead", "thunderhead ready"], type: "special", maskedType: "ready(x)", specialType: "Thunderhead Ready", statusType: "Enhancement", name: "Thunderhead Ready", expiry: "use", duplicate: "block", description: "Enables one use of a Lightning-aspected ability, such as Thunder or Thunder II." },
        umbral_ice: { matches: ["uice", "umbral ice"], type: "special", specialType: "Umbral Ice", statusType: "Enhancement", name: "Umbral Ice", expiry: "turn2", duplicate: "replace", description: "While under the effect of Umbral Ice, your ice-aspected abilities restore 5 MP each time they deal damage.\n\nUmbral Ice is removed when you are granted Astral Fire or, if the effect is not renewed, at the end of your next turn." },
        venomous_bite: { matches: ["venom", "vbite", "wbite", "windbite", "venomous bite"], type: "special", specialType: "Venomous Bite", maskedType:"dot(x)", marker: "venomous-bite", statusType: "enfeeblement", name: "Venomous Bite", expiry: "phase", curable: true, duplicate: "bigger", description: "Damages the character by a given amount at the end of the [Adventurer Step]." },
        warding_talisman: { matches: ["ward", "talisman", "wtalisman", "warding talisman"], type: "special", maskedType: "item", augmentType: "ability", ability: "protective_ward", specialType: "Warding Talisman", statusType: "Enhancement", name: "Warding Talisman", expiry: "permanent", duplicate: "allow", description: "When this item is obtained, the GM chooses a specific enemy or character classification. So long as the owner possesses this item, grants the Protective Ward ability. This ability can only be used once, after which the talisman loses its power and has no further effect." },
        weak: { matches: ["weak", "weakness"], type: "weak", maskedType: "weak", name: "Weak", statusType: "Enfeeblement", marker: "weak", expiry: "rest", duplicate: "block", description: "A Weakened character incurs a -2 penalty on all checks. If you are afflicted with Weakness from another effect, you are instead afflicted with Brink of Death.\n\nWeakness can only be removed by completing a rest or by effects that specifically remove it." }
    };

    this.matches = Object.values(this.effects);

    this.expiries = {
        encounterstart: "Start of an encounter",
        stepstart: "Start of the [Adventurer Step]",
        start: "Start of your turn",
        turn: "End of your turn",
        turn2: "End of your next turn",
        step: "End of the [Adventurer Step]",
        round: "End of this round",
        phase: "End of phase",
        encounter: "End of encounter",
        rest: "After rest",
        end: "After adventure",
        permanent: "Permanent",
        use: "On use",
        damage: "On damage"
    };

    this.expiryTypes = Object.keys(this.expiries);

    this.abilities = {
        aetherwall: {
            instant: [
                { title: "Aetherwall", type: "Instant, Augment", cost: 0, uses: 1, uses_max: 1, trigger: "Immediately after an ability check for an ability that targets you", baseEffect: "Increases your Magic Defense by 1 for the ability check that triggered Parry.", limitation: "Once per phase", hitType: "None", damageType: "Magic Defense", baseValue: "1", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/General/augment.png" }
            ]
        },
        cure: {
            secondary: [
                { title: "Cure", type: "Secondary, Magic, Invoked, Augment", cost: 2, resource: "MP", uses: 0, uses_max: 0, target: "Single", Range: "10 squares", baseEffect: "Restores 2 HP to the target.", hitType: "None", damageType: "Healing", baseValue: "2", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/General/augment.png" }
            ]
        },
        fire: {
            primary: [
                { title: "Fire", type: "Primary, Magic, Fire-Aspected, Invoked, Augment", cost: 2, resource: "MP", uses: 0, uses_max: 0, target: "Single", Range: "10 squares", check: "INT + d20", cr: "Target's Magic Defense", baseEffect: "Deals 2 damage to the target.", directHit: "Deals an additional 1d6 damage.", hitType: "Hit", damageType: "Damage", baseValue: "2", dhValue: "1d6", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/General/augment.png" }
            ]
        },
        ice: {
            primary: [
                { title: "Ice", type: "Primary, Magic, Ice-Aspected, Invoked, Augment", cost: 2, resource: "MP", uses: 0, uses_max: 0, target: "Single", Range: "10 squares", check: "INT + d20", cr: "Target's Magic Defense", baseEffect: "Deals 2 damage to the target.", directHit: "Deals an additional 1d6 damage.", hitType: "Hit", damageType: "Damage", baseValue: "2", dhValue: "1d6", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/General/augment.png" }
            ]
        },
        parry: {
            instant: [
                { title: "Parry", type: "Instant, Augment", cost: 0, uses: 1, uses_max: 1, trigger: "Immediately after an ability check for an ability that targets you", baseEffect: "Increases your Defense by 1 for the ability check that triggered Parry.", limitation: "Once per phase", hitType: "None", damageType: "Defense", baseValue: "1", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/General/augment.png" }
            ]
        },
        protective_ward: {
            instant: [
                { title: "Protective Ward", type: "Instant, Item, {value} ward", cost: 0, uses: 1, uses_max: 1, condition: "Protective Ward can be used in addition to another instant ability this turn", trigger: "When an ability used by the specific enemy or an enemy with the classification {value} scores a critical", baseEffect: "The ability that triggered Protective Ward scores a direct hit but not a critical.", limitation: "Once", hitType: "None", damageType: "Effect", effectSelf: "consume(Warding Talisman|{value})", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Items/warding_talisman.png" }
            ]
        }
    };

    this.icon = function (effect) {
        if (!effect || effect.type == "none") {
            return "";
        }

        if (effect.maskedType == "augment") {
            return `https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Effects/augment.png`;
        }

        if (effect.type === "special" && effect.specialType) {
            let imageName = effect.specialType.toLowerCase().replaceAll("'", "").replaceAll(" ", "-");
            return `https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Effects/${imageName}.png`;
        }

        let imageName = effect.type.replace("(x)", "-x");
        return `https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Effects/${imageName}.png`;
    };

    this.hoverDescription = function (name, value, expiry, curable) {
        var descriptions = [];
        if (value) {
            descriptions.push(`${name.replace("(X)", `(${value.toUpperCase()})`)}`);
        } else {
            descriptions.push(name);
        }
        descriptions.push(`expires ${this.expiries[expiry]}`);
        if (curable === "on") {
            descriptions.push("can be cured");
        }

        return descriptions.join(", ");
    };
};

const effectData = new EffectData();
this.export.EffectData = EffectData;
this.export.effectData = effectData;

// Build (version 1.0.0): Source/workers/common/workerengine.js


const WorkerEngine = function(logger) {
    this.logger = logger;

    this.set = function(attributes) {
        setAttrs(attributes);
    };

    this.get = function(attributes, completion) {
        getAttrs(attributes, completion);
    };

    this.getAttrsAndEffects = function(bonusAttributes, completion) {
        getSectionIDs("repeating_effects", ids => {
            const attributes = ids.flatMap((element) => [
                `repeating_effects_${element}_type`,
                `repeating_effects_${element}_specialType`,
                `repeating_effects_${element}_statusType`,
                `repeating_effects_${element}_value`,
                `repeating_effects_${element}_expiry`,
                `repeating_effects_${element}_source`,
                `repeating_effects_${element}_curable`,
                `repeating_effects_${element}_description`,
                `repeating_effects_${element}_attribute`,
                `repeating_effects_${element}_attributeValue`
            ]);
            getAttrs(attributes.concat(bonusAttributes), values => {
                var sortedValues = {};
                const effectKeys = Object.keys(values).filter((key) => key.includes("repeating_effects"));
                for (let attribute of effectKeys) {
                    let components = attribute.split("_");
                    let id = components[2];
                    let attributeName = components[3];
                    if (!sortedValues[id]) {
                        sortedValues[id] = {
                            id: id,
                            fullId: `repeating_effects_${id}`
                        };
                    }
                    sortedValues[id][attributeName] = values[attribute];
                }
                const valueObjects = Object.values(sortedValues);
                completion(values, effectUtilities.classify(valueObjects));
            });
        });
    };

    this.getEffects = function(completion) {
        this.getAttrsAndEffects([], (_, effects) => {
            completion(effects);
        });
    };

    this.getSectionValues = function(sections, attributes, completion) {
        this.allSectionIDs(sections, sectionedIds => {
            let fullAttributes = sectionedIds.flatMap(sectionedId => {
                return attributes.map(attribute => `${sectionedId}_${attribute}`);
            });

            getAttrs(fullAttributes, values => {
                var items = [];
                for (let sectionedId of sectionedIds) {
                    let match = sectionedId.match(/^repeating_[-\w]+_([-\w]+)/);
                    if (!match || match.length < 2) {
                        this.logi("Missing id: " + sectionedId);
                        continue;
                    }
                    let id = match[1];
                    let item = {
                        id: id,
                        fullId: sectionedId
                    };
                    for (let attribute of attributes) {
                        item[attribute] = values[`${sectionedId}_${attribute}`];
                    }
                    items.push(item);
                }
                completion(items);
            });
        });
    };

    this.remove = function(object) {
        removeRepeatingRow(object.fullId);
    };

    this.generateId = function() {
        return generateRowID();
    };

    this.logi = function(value) {
        this.logger.i(value);
    };

    this.logd = function(value) {
        this.logger.d(value);
    };

    this.allSectionIDs = function(sections, completion) {
        let length = sections.length;
        let index = 0;
        var sectionsWithIds = [];

        let recursionBlock = function(ids) {
            let namedIds = ids.map(id => `repeating_${sections[index]}_${id}`);
            sectionsWithIds = sectionsWithIds.concat(namedIds);
            index = index + 1;

            if (index >= length) {
                completion(sectionsWithIds);
            } else {
                getSectionIDs(sections[index], recursionBlock);
            }
        };

        getSectionIDs(sections[0], recursionBlock);
    };
};

const engine = new WorkerEngine(new Logger(workerName, true));
this.export.WorkerEngine = WorkerEngine;
this.export.engine = engine;

// Build (version 1.0.0): Source/workers/common/abilitySections.js


const abilitySections = [
    "limit", 
    "song1", "song2", "song3", 
    "primary1", "primary2", "primary3", 
    "ninjutsu1", "ninjutsu2", "ninjutsu3", 
    "secondary1", "secondary2", "secondary3", 
    "instant1", "instant2", "instant3", 
    "technique1", "technique2", "technique3"
];

this.export.abilitySections = abilitySections;

// Build (version 1.0.0): Source/workers/../common/addEffects.js


const EffectState = function(hitPoints, hitPoints_max, barrierPoints, dice, existingEffects) {
    this.hitPoints = hitPoints;
    this.hitPoints_max = hitPoints_max;
    this.barrierPoints = barrierPoints;
    this.dice = dice;
    this.existingEffects = existingEffects;

    this.existingEffectTypes = existingEffects.effects.map(effect => {
        return effect.adjustedName;
    });
};

const AddEffects = function(customEngine, customRemove) {
    this.customEngine = customEngine;
    this.customRemove = customRemove;

    this.engine = function() {
        return this.customEngine ?? engine;
    };

    this.removeEffects = function() {
        return this.customRemove ?? removeEffects;
    };

    this.addBySpecificationString = function(state, effects) {
        let builtEffects = effects.map(effect => this.effectFromSpecification(effect));
        return this.add(state, builtEffects);
    };
    
    this.add = function(state, effects) {
        var attributes = {};
        var summaries = [];

        this.engine().logd("Adding effects");
        for (let effect of effects) {
            if (!effect || !effect.adjustedName) {
                continue;
            }
            if (!this.matchesCondition(state, effect)) {
                this.engine().logi("Condition not fulfilled; skipping effect " + effect.adjustedName);
                continue;
            }

            let replacement = this.replacementEffect(state, effect);
            if (!replacement.valid) {
                this.logi("Discarding effect " + effect.adjustedName + ", invalid replacement");
                continue;
            }
            let adjustedEffect = replacement.effect;
            let data = adjustedEffect.data;
            if (!data) {
                this.engine().logi("Unhandled effect " + JSON.stringify(adjustedEffect));
                continue;
            }
            let duplicatesResult = this.resolveDuplicates(state, adjustedEffect);
            if (!duplicatesResult.result) {
                continue;
            }
            summaries = summaries.concat(duplicatesResult.summaries);

            var value = null;
            if (adjustedEffect.value) {
                value = adjustedEffect.value;
            } else if (effect.specification) {
                let match = effect.specification.match(/\(([-|\s\w]+)\)/);
                if (match && match.length >= 2) {
                    value = match[1];
                }
            }

            let initValues = {
                id: this.engine().generateId(),
                type: data.type,
                specialType: data.specialType,
                statusType: data.statusType,
                value: value,
                source: adjustedEffect.source ?? "Self",
                description: data.description,
                expiry: adjustedEffect.expiry ?? data.expiry,
                curable:  adjustedEffect.curable ?? (data.curable ? "on" : "off")
            };

            let specialEffectResult = this.resolveSpecialEffects(state, initValues.id, adjustedEffect, value);
            summaries = summaries.concat(specialEffectResult.summaries.filter(element => element));
            if (specialEffectResult.skip) {
                this.engine().logi("Skipping ephemeral effect " + adjustedEffect.adjustedName);
                continue;
            }

            attributes = specialEffectResult.attributes;
            attributes[`repeating_effects_${initValues.id}_type`] = initValues.type;
            if (initValues.specialType) {
                attributes[`repeating_effects_${initValues.id}_specialType`] = initValues.specialType;
            }
            if (initValues.value) {
                attributes[`repeating_effects_${initValues.id}_value`] = initValues.value;
            }
            attributes[`repeating_effects_${initValues.id}_icon`] = effectData.icon(data);
            attributes[`repeating_effects_${initValues.id}_statusType`] = initValues.statusType;
            attributes[`repeating_effects_${initValues.id}_expiry`] = initValues.expiry;
            attributes[`repeating_effects_${initValues.id}_source`] = initValues.source;
            attributes[`repeating_effects_${initValues.id}_description`] = initValues.description;
            attributes[`repeating_effects_${initValues.id}_curable`] = initValues.curable;
            attributes[`repeating_effects_${initValues.id}_editable`] = "off";
            attributes[`repeating_effects_${initValues.id}_origin`] = "automatic";
            attributes[`repeating_effects_${initValues.id}_repeatingExpandItem`] = "on";
            attributes[`repeating_effects_${initValues.id}_name`] = effectData.hoverDescription(data.name, initValues.value, initValues.expiry, initValues.curable);

            if (duplicatesResult.summaries.length === 0) {
                summaries.push(`Activated ${data.name.replace("(X)", initValues.value)}`);
            }
        }
        if (Object.keys(attributes).length > 0) {
            this.engine().set(attributes);
        }
        return summaries.join(", ");
    };

    this.resolveAttributes = function(id, effectName, value) {
        this.engine().logd("Resolving attributes " + effectName);
        switch (effectName) {
            case "attribute": {
                this.engine().logd("Resolving attributes for attribute(x)");
                if (!value) {
                    // Unable to deal with this until value has been set
                    return;
                }
                let definition = value.split(",");
                if (!definition) {
                    log("Invalid value " + value);
                    return;
                }
                let attributeName = definition[0];
                let attributeValue;
                if (definition[1]) {
                    attributeValue = unpackNaN(definition[1].trim(), 1);
                } else {
                    attributeValue = 1;
                }
                this.engine().get([`${attributeName}`, `${attributeName}Effective`, `${attributeName}Override`, `${attributeName}Unblocked`], values => {
                    var attributes = {};
                    let baseAttributeName;
                    let isBlocked = unpackNaN(values[`${attributeName}Override`], 0) > 0;
                    if (isBlocked) {
                        baseAttributeName = `${attributeName}Unblocked`;
                    } else {
                        baseAttributeName = `${attributeName}Effective`;
                    }

                    let currentValue = unpackNaN(values[`${baseAttributeName}`], 0);
                    let rawValue = unpackNaN(values[attributeName]);
                    let newValue = currentValue + attributeValue;
                    this.engine().logd(`${attributeName}: ${newValue}, unblocked: ${values[`${attributeName}Unblocked`]}`);
                    attributes[`repeating_effects_${id}_attribute`] = attributeName;
                    attributes[`repeating_effects_${id}_attributeValue`] = attributeValue;
                    
                    attributes[baseAttributeName] = newValue;
                    if (!isBlocked) {
                        let bottomValue = Math.min(rawValue, 0);
                        attributes[`${attributeName}Display`] = Math.max(newValue, bottomValue);
                    }
                    this.engine().logd(`Setting ${baseAttributeName} to ${newValue}`);
                    this.engine().set(attributes);
                });
                break;
            }
            case "bound": {
                this.engine().logd("Resolving attributes for bound");
                this.engine().get(["size", "speed", "speedEffective", "speedOverride", "speedUnblocked"], values => {
                    let speed = unpackNaN(values.speedEffective, 0);
                    let unblocked = unpackNaN(values.speedUnblocked ?? values.speed, 0);
                    let newValue;
                    let diff;
                    if (values.size === "large") {
                        newValue = Math.max(speed - 2, 0);
                        unblocked = Math.max(unblocked - 2, 0);
                        diff = 2;
                    } else {
                        newValue = -99;
                        diff = speed - newValue;
                        unblocked -= diff;
                    }

                    var attributes = {};
                    if (unpackNaN(values.speedOverride, 0) > 0) {
                        attributes.speedUnblocked = unblocked;
                    }
                    this.engine().logd(`speed: ${newValue}, unblocked: ${attributes.speedUnblocked}`);
                    let rawValue = unpackNaN(values.speed);
                    let bottomValue = Math.min(rawValue, 0);
                    attributes.speedEffective = newValue;
                    attributes.speedDisplay = Math.max(newValue, bottomValue);
                    attributes[`repeating_effects_${id}_attribute`] = "speed";
                    attributes[`repeating_effects_${id}_attributeValue`] = -diff;
                    this.engine().set(attributes);
                });
                break;
            }
            case "defenders_boon": {
                this.engine().logd("Resolving attributes for Defender's Boon");
                let attributeValue;
                if (value) {
                    attributeValue = unpackNaN(value.trim(), 1);
                } else {
                    attributeValue = 1;
                }
                this.engine().get(["defense", "magicDefense"], values => {
                    let defense = unpackNaN(values.defense, 0);
                    let magicDefense = unpackNaN(values.magicDefense, 0);
                    let attributeName;
                    let newValue;
                    let rawValue;
                    if (defense === magicDefense) {
                        // Do nothing
                        return;
                    } else if (defense < magicDefense) {
                        attributeName = "defense";
                        newValue = defense + attributeValue;
                        rawValue = defense;
                    } else if (magicDefense < defense) {
                        attributeName = "magicDefense";
                        newValue = magicDefense + attributeValue;
                        rawValue = magicDefense;
                    }

                    let bottomValue = Math.min(rawValue, 0);
                    var attributes = {};
                    attributes[`${attributeName}Effective`] = newValue;
                    attributes[`${attributeName}Display`] = Math.max(newValue, bottomValue);
                    attributes[`repeating_effects_${id}_attribute`] = attributeName;
                    attributes[`repeating_effects_${id}_attributeValue`] = attributeValue;
                    log(`Setting ${attributeName} to ${newValue}`);
                    this.engine().set(attributes);
                });
                break;
            }
            case "slow":
            case "heavy": {
                this.engine().logd(`Resolving attributes for ${effectName}`);
                this.engine().get(["speed", "speedEffective", "speedOverride", "speedOverrideSources", "speedUnblocked"], values => {
                    let speed = unpackNaN(values.speed, 0);
                    let newValue = Math.floor(speed / 2) + speed % 2;
                    let diff = speed - newValue;
                    var attributes = {};
                    if (unpackNaN(values.speedOverride, 0) > 0) {
                        log(`Speed was already blocked when activating ${effectName}`);
                        attributes.speedOverrideSources = unpackNaN(values.speedOverrideSources, 1) + 1;
                    } else {
                        attributes.speedOverride = newValue;
                        attributes.speedOverrideSources = 1;
                        attributes.speedUnblocked = values.speedEffective;

                        log(`speed: ${newValue}, unblocked: ${attributes.speedUnblocked}`);
                        let effectiveValue = Math.min(newValue, values.speedEffective - diff);
                        let bottomValue = Math.min(speed, 0);
                        attributes.speedEffective = effectiveValue;
                        attributes.speedDisplay = Math.max(effectiveValue, bottomValue);
                    }
                    attributes[`repeating_effects_${id}_attribute`] = "speed";
                    attributes[`repeating_effects_${id}_attributeValue`] = -diff;
                    this.engine().set(attributes);
                });
                break;
            }
        }
    };

    this.resolveAbilities = function(adjustedName, value = "") {
        let data = effectData.effects[adjustedName];
        if (!data || !data.ability) {
            return;
        }

        let abilityDefinition = effectData.abilities[data.ability];
        if (!abilityDefinition) {
            return;
        }
        var attributes = {};
        for (let section of Object.entries(abilityDefinition)) {
            for (let ability of section[1]) {
                log("Generating effect ability " + ability.title);
                let id = this.engine().generateId();
                for (let entry of Object.entries(ability)) {
                    var attributeValue = entry[1];
                    if (value && attributeValue && isNaN(attributeValue)) {
                        attributeValue = attributeValue.replace("{value}", value);
                    }
                    attributes[`repeating_${section[0]}_${id}_${entry[0]}`] = attributeValue;
                }
                attributes[`repeating_${section[0]}_${id}_repeatingOverride`] = "auto";
                attributes[`repeating_${section[0]}_${id}_augment`] = "1";
            }
        }
        this.engine().set(attributes);
    };

    this.resolveDuplicates = function(state, effect) {
        if (effect.data.duplicate === "block" && state.existingEffectTypes.includes(effect.adjustedName)) {
            this.engine().logd("Effect " + effect.name + " already exists, skipping");
            return { result: false, summaries: [] };
        }

        var summaries = [];
        if (effect.data.duplicate == "replace") {
            for (let replacable of state.existingEffects.effects) {
                if (replacable.type == effect.data.type && replacable.specialType == effect.data.specialType) {
                    summaries.push(`Reactivated ${effect.data.specialType ?? effect.data.type}`);
                    this.engine().remove(replacable);
                }
            }
        } else if (effect.data.duplicate == "bigger") {
            var didReplace = false;
            var hadDuplicate = false;
            for (let replacable of state.existingEffects.effects) {
                if (
                    replacable.type === effect.data.type
                    && replacable.specialType === effect.data.specialType
                    && replacable.source === effect.source
                ) {
                    hadDuplicate = true;
                    if (effect.value > replacable.value) {
                        summaries.push(`Reactivated ${effect.data.specialType ?? effect.data.type}`);
                        this.engine().remove(replacable);
                        didReplace = true;
                    }
                }
            }
            if (hadDuplicate && !didReplace) {
                // Couldn't replace - the effect was blocked.
                this.engine.logd("Skipping effect; already an identical or greater effect from the same source");
                return { result: false, summaries: [] };
            }
        }

        return { result: true, summaries: summaries };
    };

    this.resolveSpecialEffects = function(state, id, effect, value) {
        var attributes = {};
        var summaries = [];
        let skip = effect.data.expiry === "ephemeral";

        this.resolveAbilities(effect.adjustedName);
        this.resolveAttributes(id, effect.adjustedName, value);
        switch (effect.adjustedName) {
            case "astral_fire":
                // Clear MP recovery
                attributes.mpRecoveryBlock = "on";

                // Remove Umbral Ice
                if (state.existingEffects.umbralIce) {
                    summaries.push("Removed Umbral Ice");
                    this.engine().remove(state.existingEffects.umbralIce);
                }
                summaries.push(this.addBySpecificationString(state, ["Thunderhead Ready"]));
                break;
            case "barrier": {
                let barrierValue = Math.max(parseInt(state.barrierPoints), parseInt(value));
                this.engine().set({
                    barrierPoints: barrierValue,
                    barrierPoints_max: barrierValue
                });
                summaries.push(`Granted ${value} HP barrier`);
                break;
            }
            case "clear_enfeeblements":
            case "transcendent": {
                this.engine().logd("Clearing all enfeeblements");
                for (let existingEffect of state.existingEffects.effects) {
                    if (existingEffect.statusType.trim().toLowerCase() === "enfeeblement") {
                        this.engine().logd(`Clearing ${existingEffect.data.name}`);
                        this.removeEffects().remove(existingEffect);
                    }
                }
                break;
            }
            case "coeurl_form":
            case "opo_opo_form":
            case "raptor_form": {
                this.engine().logd("Monk Form to replace: " + JSON.stringify(state.existingEffects.monkForm));
                if (state.existingEffects.monkForm) {
                    summaries.push(`Removed ${state.existingEffects.monkForm.data.name}`);
                    this.engine().remove(state.existingEffects.monkForm);
                }
                break;
            }
            case "consume": {
                let specification = value.split("|");
                let item = specification[0].trim();
                var effectValue = "";
                if (specification.length > 1) {
                    effectValue = specification[1];
                }

                // Consume item
                this.engine().logd("Consuming item");
                summaries.push(`Consumed item ${item}`);
                let itemAttributes = ["title", "effect", "count"];
                this.engine().getSectionValues(["items"], itemAttributes, items => {
                    for (let existingItem of items) {
                        let title = existingItem.title.trim();
                        let itemDescription = existingItem.effect;
                        if (effectValue && !itemDescription.toLowerCase().includes(effectValue.toLowerCase())) {
                            continue;
                        }

                        if (item.toLowerCase() !== title.toLowerCase()) {
                            continue;
                        }

                        let count = parseInt(existingItem.count);
                        if (isNaN(count) || count <= 1) {
                            log("Removing item linked to ability");
                            this.engine().remove(item);
                        } else {
                            log("Removing one count of item linked to ability");
                            var newAttributes = {};
                            newAttributes[`repeating_items_${id}_count`] = count - 1;
                            this.engine().set(newAttributes);
                        }
                    }
                });

                // Remove effect
                let adjustedItemName = effectUtilities.searchableName(item);
                for (let existingEffect of state.existingEffects.effects) {
                    let adjustedSpecialType = effectUtilities.searchableName(existingEffect.specialType);
                    if (adjustedSpecialType !== adjustedItemName) {
                        continue;
                    }
                    this.removeEffects().remove(existingEffect);
                }
                break;
            }
            case "comatose":
            case "knocked_out": {
                // Clear all non-permanent/adventure-wide effects
                this.engine().logd(`Clearing all non-permanent/adventure-wide effects from ${effect.type}`);
                for (let existingEffect of state.existingEffects.effects) {
                    if (existingEffect.type === "weak" || existingEffect.type === "brink") {
                        continue;
                    }
                    if (existingEffect.expiry !== "end" && existingEffect.expiry !== "permanent") {
                        log(`Removing ${existingEffect.data.name}`);
                        this.removeEffects().remove(existingEffect);
                    }
                }
                attributes.hitPoints = 0;
                attributes.barrierPoints = 0;
                attributes.mpRecoveryBlock = "on";
                break;
            }
            case "damage": {
                let damageValue = parseInt(value);
                let barrierDamage = 0;
                let remainingDamage = damageValue;
                let barrierPoints = parseInt(state.barrierPoints);
                let hitPoints = parseInt(state.hitPoints);
                let barrierValue = barrierPoints;
                if (barrierPoints > 0) {
                    barrierDamage = Math.min(barrierPoints, damageValue);
                    barrierValue = barrierPoints - barrierDamage;
                    remainingDamage = damageValue - barrierDamage;
                }
                this.engine().set({
                    barrierPoints: barrierValue,
                    barrierPoints_max: barrierValue,
                    hitPoints: Math.max(hitPoints - remainingDamage, 0)
                });
                summaries.push(`Dealt ${value} damage`);
                break;
            }
            case "heal": {
                let hitPoints = parseInt(state.hitPoints);
                let healValue = parseInt(value);
                let newValue = Math.min(parseInt(state.hitPoints_max), hitPoints + healValue);
                this.engine().set({
                    hitPoints: newValue
                });
                summaries.push(`Granted ${newValue - hitPoints} HP`);
                break;
            }
            case "lucid_dreaming":
                attributes.mpRecovery = 3;
                break;
            case "raise": {
                // Add/upgrade weak status and add transcendent
                let weakness = state.existingEffects.isWeak ? "brink" : "weak";
                summaries.push(this.addBySpecificationString(state, ["transcendent"]));
                summaries.push(this.addBySpecificationString(state, [weakness]));
                break;
            }
            case "restore": {
                let components = value.split("-");
                let section = components[0].toLowerCase();
                let sections = [1,2,3].map(index => `${section}${index}`);
                let abilityName = components[1];
                let normalizedName = abilityName.toLowerCase();
                let increment = parseInt(components[2]);
                if (isNaN(increment)) {
                    log("Cannot read value for effect " + effect.adjustedName);
                }

                summaries.push(`Restored ${increment} use(s) of ${abilityName}`);
                this.engine().logd("Restoring uses of " + abilityName);

                let abilityAttributes = ["title", "uses", "uses_max"];
                this.engine().getSectionValues(sections, abilityAttributes, abilities => {
                    for (let ability of abilities) {
                        let title = ability.title;
                        if (title.toLowerCase() === normalizedName) {
                            let uses = ability.uses;
                            let max = ability.uses_max;
                            if (uses < max) {
                                this.engine().logd("Restored " + abilityName);
                                var attributes = {};
                                attributes[`${ability.fullId}_uses`] = Math.min(uses + increment, max);
                                this.engine().set(attributes);
                            }
                            return;
                        }
                    }
                    this.engine().logi("Failed to find " + abilityName);
                });
                break;
            }
            case "restore_magic": {
                let magicPoints = parseInt(state.magicPoints);
                let restoreValue = parseInt(value);
                let newValue = Math.min(parseInt(state.magicPoints_max), magicPoints + restoreValue);
                this.engine().set({
                    magicPoints: newValue
                });
                summaries.push(`Granted ${newValue - magicPoints} MP`);
                break;
            }
            case "thrill_of_battle": {
                // Heal by roll total and add a barrier for anything that exceeds max HP
                let result = parseInt(state.dice.damage.result);
                if (isNaN(result) || result === 0) {
                    this.engine().logi("Invalid dice roll for Thrill of Battle: " + JSON.stringify(state.dice.damage));
                } else {
                    let difference = state.hitPoints_max - state.hitPoints;
                    var hitPointsToAdd = Math.min(result, difference);

                    if (hitPointsToAdd >= 0) {
                        var barrierPoints = state.barrierPoints;
                        if (difference > 0) {
                            summaries.push(`Healed ${hitPointsToAdd} HP`);
                        }
                        if (result > difference) {
                            let remainder = result - difference;
                            barrierPoints = Math.max(barrierPoints, remainder);
                            summaries.push(`Added a ${remainder} HP barrier`);
                        }
                        this.engine().set({
                            hitPoints: hitPointsToAdd + state.hitPoints,
                            barrierPoints: barrierPoints,
                            barrierPoints_max: barrierPoints
                        });
                    }
                }
                break;
            }
            case "umbral_ice":
                if (state.existingEffects.astralFire) {
                    summaries.push("Removed Astral Fire");
                    this.engine().remove(state.existingEffects.astralFire);

                    // Reset MP recovery
                    attributes.mpRecoveryBlock = "off";
                }
                summaries.push(this.addBySpecificationString(state, ["Thunderhead Ready"]));
                break;
            default:
                break;
        }

        return { attributes: attributes, summaries: summaries, skip: skip };
    };

    this.matchesCondition = function(state, effect) {
        if (!state.dice || !effect.specification) {
            return true;
        }

        let conditionMatch = effect.specification.match(/\[([-+><=\w]+)\]/);
        if (!conditionMatch || conditionMatch.length < 2) {
            return true;
        }

        let operator = conditionMatch[1].match(/[><=]+/)[0];
        let operands = conditionMatch[1].split(operator);
        var value;
        if (operands[0].toLowerCase() == "d") {
            value = state.dice.hit;
        } else {
            this.engine().logi("Unrecognized operand " + operands[0]);
            return false;
        }

        let compareTo = parseInt(operands[1]);
        if (isNaN(value) || isNaN(compareTo)) {
            this.engine().logi("Unrecognized operands " + conditionMatch[1]);
            return false;
        }

        switch (operator) {
            case ">": return value > compareTo;
            case "<": return value < compareTo;
            case ">=": return value >= compareTo;
            case "<=": return value <= compareTo;
            case "=":
            case "==":
                return value == compareTo;
            default:
                this.engine().logi("Unrecognized operator " + operator);
                return false;
        }
    };

    this.replacementEffect = function(state, effect) {
        switch (effect.adjustedName) {
            case "knocked_out": {
                if (state.existingEffects.isBrink) {
                    let adjustedEffect = this.effectFromSpecification("comatose");
                    adjustedEffect.source = effect.source;
                    return { effect: adjustedEffect, valid: true };
                }
                break;
            }
            case "lightweight_refit_proc": {
                let adjustedEffect = this.effectFromSpecification("attribute");
                adjustedEffect.value = "speed,1";
                adjustedEffect.source = effect.source;
                adjustedEffect.expiry = "turn";
                return { effect: adjustedEffect, valid: true };
            }
            case "transpose": {
                let adjustedEffect;
                if (state.existingEffects.astralFire) {
                    this.engine().logd("Replacing effect Transpose with Umbral Ice");
                    adjustedEffect = this.effectFromSpecification("umbral_ice");
                } else if (state.existingEffects.umbralIce) {
                    this.engine().logd("Replacing effect Transpose with Astral Fire");
                    adjustedEffect = this.effectFromSpecification("astral_fire");
                } else {
                    this.engine().logi("Cannot use transpose when missing both astral fire/umbral ice");
                    return { valid: false };
                }
                adjustedEffect.source = effect.source;
                return { effect: adjustedEffect, valid: true };
            }
        }
        return { effect: effect, valid: true };
    };

    this.effectFromSpecification = function(specification) {
        let adjustedName = effectUtilities.searchableName(specification);
        let data = effectData.effects[adjustedName];
        return {
            specification: specification,
            adjustedName: adjustedName,
            data: data
        };
    };
};

const addEffects = new AddEffects();

this.export.EffectState = EffectState;
this.export.AddEffects = AddEffects;
this.export.addEffects = addEffects;

// Build (version 1.0.0): Source/workers/../common/removeEffects.js


const RemoveEffects = function(customEngine) {
    this.customEngine = customEngine;

    this.engine = function() {
        return this.customEngine ?? engine;
    };

    this.remove = function(effect) {
        let adjustedName = effectUtilities.searchableName(effect.specialType || effect.type);
        if (effect.data.ability) {
            this.removeAbility(adjustedName, effect.value);
        }
        this.engine().remove(effect);
        this.resetSpecialEffects(adjustedName);
        this.resetAttributeChanges(adjustedName, effect.attribute, effect.attributeValue);
    };

    this.removeAll = function(names, skipId) {
        this.engine().getEffects(effects => {
            let matches = effects.effects.filter(effect => {
                if (effect.id == skipId) {
                    return false;
                }
                return names.includes(effect.type) || names.includes(effect.specialType.trim().toLowerCase());
            });
            for (let match of matches) {
                this.engine().logd(`Removing effect ${match.id} with the type ${match.specialType || match.type}`);
                this.remove(match);
            }
        });
    };

    this.consumeOnAbility = function(name, condition, effects) {
        var summaries = [];
        for (let effect of effects.effects) {
            let normalizedName = name.toLowerCase();
            let normalizedCondition = condition.toLowerCase();
            let specialType = (effect.specialType ?? "").toLowerCase();
            let maskedType = (effect.data.maskedType ?? "").toLowerCase();
            let value = (effect.value ?? "").toLowerCase();
            let isReadyType = effect.type == "ready(x)";

            if (!isReadyType && !specialType.includes(" ready") && !maskedType.includes(" ready")) {
                continue;
            }

            if (
                specialType.includes(normalizedName) ||
                normalizedCondition.includes(specialType) ||
                (isReadyType && value == normalizedName) ||
                (isReadyType && normalizedCondition.includes(value))
            ) {
                this.engine().logd("Consuming effect " + JSON.stringify(effect));
                // Consume X Ready
                this.engine().remove(effect);

                let effectName = effect.specialType || effectData.effects[effect.type.replace("(x)", "")].name;
                summaries.push(`Consumed ${(effectName.replace("(X)", effect.value))}`);
            }
        }
        return summaries.join(", ");
    };

    this.resetSpecialEffects = function(name) {
        switch (name) {
            case "astral_fire":
                this.engine().logd("Astral Fire removed; resetting mp recovery");
                this.engine().set({
                    mpRecoveryBlock: "off"
                });
                break;
            case "comatose":
            case "knocked_out":
                this.engine().logd(`${effectData.effects[name].name}; resetting mp recovery`);
                this.engine().set({
                    mpRecoveryBlock: "off"
                });
                break;
            case "lucid_dreaming":
                this.engine().logd("Lucid Dreaming removed; resetting mp recovery");
                this.engine().set({
                    mpRecovery: 2
                });
                break;
            default:
                break;
        };
    };

    this.resetAttributeChanges = function(name, attribute, value, completion) {
        this.engine().logd("Resetting effect attributes for " + attribute);
        let attributeValue = parseInt(value);
        if (!attribute || isNaN(attributeValue)) {
            this.engine().logd("No effect attributes to reset");
            if (completion) {
                completion();
            }
            return;
        }
        this.engine().get([`${attribute}`, `${attribute}Effective`, `${attribute}Override`, `${attribute}OverrideSources`, `${attribute}Unblocked`], values => {
            let baseAttributeName;
            let currentValue;
            let newValue;
            var newAttributes = {};
            this.engine().logd(`${attribute}: ${values[`${attribute}Effective`]}, unblocked: ${values[`${attribute}Unblocked`]}`);
            if (name === "heavy" || name === "slow") {
                let overrideSources = Math.max(unpackNaN(values.speedOverrideSources, 1) - 1, 0);
                newAttributes.speedOverrideSources = overrideSources;
                if (overrideSources === 0) {
                    baseAttributeName = "speedEffective";
                    currentValue = values.speedEffective;
                    newAttributes.speedOverride = 0;
                    newAttributes.speedEffective = values.speedUnblocked;
                    newAttributes.speedDisplay = values.speedUnblocked;
                    this.engine().logd(`Unblocking speed, ${currentValue} -> ${values.speedUnblocked}`);
                }
            } else {
                let isBlocked = unpackNaN(values[`${attribute}Override`]) > 0;
                if (isBlocked) {
                    baseAttributeName = `${attribute}Unblocked`;
                    if (attributeValue < 0) {
                        let rawValue = unpackNaN(values[attribute]);
                        let bottomValue = Math.min(rawValue, 0);
                        let adjustedValue = unpackNaN(values[`${attribute}Effective`], 1000) - attributeValue;
                        let effectiveValue = Math.min(adjustedValue, values.speedOverride);
                        newAttributes[`${attribute}Effective`] = effectiveValue;
                        newAttributes[`${attribute}Display`] = Math.max(effectiveValue, bottomValue);
                    }
                } else {
                    baseAttributeName = `${attribute}Effective`;
                }
                currentValue = unpackNaN(values[baseAttributeName], 0);
                newValue = currentValue - attributeValue;

                if (isNaN(currentValue)) {
                    this.engine().logi(`Unable to reset attribute ${baseAttributeName}, value is not a number: ${values[baseAttributeName]}`);
                    return;
                }
                newAttributes[baseAttributeName] = newValue;
                if (!isBlocked) {
                    let rawValue = unpackNaN(values[attribute]);
                    let bottomValue = Math.min(rawValue, 0);
                    newAttributes[`${attribute}Display`] = Math.max(newValue, bottomValue);
                }
                this.engine().logd(`Resetting ${baseAttributeName}, ${currentValue} - ${attributeValue} = ${newValue}`);
            }
            this.engine().set(newAttributes);
            if (completion) {
                completion();
            }
        });
    };

    this.removeAbility = function(effect, value) {
        let data = effectData.effects[effect];
        if (!data || !data.ability) {
            return;
        }
        let abilityDefinition = effectData.abilities[data.ability];
        if (!abilityDefinition) {
            return;
        }

        this.engine().logd("Removing ability " + JSON.stringify(data));
        // Delete ability
        for (let section of Object.keys(abilityDefinition)) {
            let titles = abilityDefinition[section].map(ability => ability.title);
            let attributeNames = ["title", "type", "augment"];
            this.engine().getSectionValues([section], attributeNames, abilities => {
                for (let ability of abilities) {
                    let title = ability.title;
                    let type = ability.type;
                    let augment = ability.augment;

                    if (value && !type.includes(value)) {
                        continue;
                    }

                    if (augment === "1" && titles.includes(title)) {
                        this.engine().logd("Removed augment ability " + title);
                        this.engine().remove(ability);
                    }
                }
            });
        }
    };
};

const removeEffects = new RemoveEffects();
this.export.RemoveEffects = RemoveEffects;
this.export.removeEffects = removeEffects;

// Build (version 1.0.0): Source/workers/main/abilities/abilityCombos.js


const AbilityCombos = function() {

    this.resolveAvailableCombos = function(combo, abilityId, values) {
        engine.logd("Resolving available combos");
        if (!combo || !abilityId) {
            return "";
        }
        let specifications = this.parseCombo(combo);
        return this.buttonsForComboSpecifications(specifications, abilityId, values);
    };

    this.parseCombo = function(combo) {
        let choices = combo.split(",");
        return choices.map(choice => {
            let matches = choice.match(/([\w ':-]+)(\([\w |':-]*\))?/);
            if (!matches || !matches[1]) {
                engine.logd("Unable to parse combo " + choice);
                return null;
            }
            return this.specificationForCombo(matches[1], matches[2]);
        }).filter(spec => spec);
    };

    this.specificationForCombo = function(name, parameters) {
        var specification = {
            name: name
        };
        if (parameters) {
            engine.logd("Parsing combo parameters");
            let parameterList = parameters.split("|");
            for (let parameter of parameterList) {
                let matches = parameter.match(/([\w-]+):\s*([\w-]+)\s*([\w-]+)?/);
                let key = matches[1];
                let value = matches[2];
                let resource = matches[3];
                if (!key || !value) {
                    engine.logd("Unable to parse combo parameter " + parameter);
                    continue;
                }
                specification[key] = value;
                if (resource) {
                    specification[`${key}_resource`] = resource;
                }
            }
        }
        return specification;
    };

    this.buttonsForComboSpecifications = function(comboSpecifications, abilityId, values) {
        if (!abilityId) {
            return "";
        }
        var buttons = "";
        for (let index = 0; index < comboSpecifications.length; index++)  {
            let combo = comboSpecifications[index];
            if (combo.cost && combo.cost_resource) {
                let currentValue = parseInt(values[combo.cost_resource]);
                if (isNaN(currentValue)) {
                    engine.logd("Unrecognized resource " + combo.cost_resource);
                    continue;
                }
                let cost = parseInt(combo.cost);
                if (isNaN(cost)) {
                    engine.logd("Cannot parse combo cost " + combo.cost);
                    continue;
                }
                if (cost > currentValue) {
                    engine.logd(`Skipping ${combo.name}; cost too high (${cost} > ${currentValue})`);
                    continue;
                }
            }
            buttons += `[${combo.name}](~${values.character_name}|repeating_${abilityId.section}_${abilityId.rowId}_runcombo${index + 1})`;
        }
        return buttons;
    };
};

const abilityCombos = new AbilityCombos();
this.export.AbilityCombos = AbilityCombos;
this.export.abilityCombos = abilityCombos;

// Build (version 1.0.0): Source/workers/main/abilities/performAbility.js


const AbilityId = function(section, rowId) {
    this.section = section;
    this.rowId = rowId;
};

const PerformAbility = function() {

    this.resolveResources = function(damageRoll, abilityId, values, effects) {
        
        const uses = abilityId ? values[`repeating_${abilityId.section}_${abilityId.rowId}_uses`] : 0;
        const usesMax = abilityId ? values[`repeating_${abilityId.section}_${abilityId.rowId}_uses_max`] : 0;

        const isGeneric = values.sheet_type != "unique";

        var summaries = [];
        var resourceResult = false;
        if (damageRoll.cost > 0) {
            let specification = this.resourceSpecification(damageRoll.resource, values);
            if (specification) {
                engine.logd("Spending resources");
                let result = this.spend(
                    isGeneric,
                    damageRoll.cost,
                    specification.resourceType,
                    values[specification.attributeName],
                    values[specification.attributeNameMax],
                    specification.attributeName
                );
                resourceResult = result[0];
                summaries.push(result[1]);
            }
        }

        if (damageRoll.cost > 0 && !resourceResult) {
            return "";
        }

        // Special handling for Ninja's Mudra
        summaries.push(this.clearMudraIfNeeded(damageRoll, values));

        // Spend uses if there are any
        if (abilityId && usesMax > 0) {
            engine.logd("Spending uses");
            let result = this.spend(
                isGeneric,
                1,
                "uses",
                uses,
                usesMax,
                `repeating_${abilityId.section}_${abilityId.rowId}_uses`
            );
            if (result[1]) {
                summaries.push(result[1]);
            }
        }

        // Restore resources
        engine.logd("Checking to restore");
        if (damageRoll.restoration) {
            summaries.push(this.restore(isGeneric, damageRoll.restoration, values));
        } else {
            engine.logd("No restore");
        }
        // Perform Umbral Ice restoration if applicable
        let isIceType = damageRoll.type.toLowerCase().includes("ice-aspect");
        if (isIceType && effects.umbralIce) {
            summaries.push(`${this.restore(isGeneric, "5 mp", values)} (Umbral Ice)`);
        }
        return summaries.filter(element => element).join("\n");
    };

    this.resetAllUses = function() {
        for (let section of abilitySections) {
            this.resetUses(section);
        }
    };

    this.resourceSpecification = function(resourceType, values) {
        if (!resourceType) {
            return null;
        }

        const resourceNames = [values.resource, values.resource2, values.resource3].filter(name => name);
        const ranges = [
            { key: "range1", name: "Opo-opo's Fury" },
            { key: "range2", name: "Raptor's Fury" },
            { key: "range3", name: "Coeurl's Fury" }
        ];
        let resourceTypeLowerCase = resourceType.toLowerCase();
        if (resourceTypeLowerCase === "mp") {
            return {
                resourceType: "MP",
                attributeName: "magicPoints",
                attributeNameMax: "magicPoints_max"
            };
        } else if (resourceTypeLowerCase === "hp") {
            return {
                resourceType: "HP",
                attributeName: "hitPoints",
                attributeNameMax: "hitPoints_max"
            };
        } else if (resourceTypeLowerCase.startsWith("range")) {
            let index = ranges.findIndex(obj => obj.key === resourceTypeLowerCase);
            if (index !== -1) {
                return {
                    resourceType: ranges[index].name,
                    attributeName: ranges[index].key,
                    attributeNameMax: `${ranges[index].key}_max`
                };
            }
        } else {
            let index = resourceNames.findIndex(name => name.toLowerCase() === resourceTypeLowerCase);
            if (index !== -1) {
                let key = index === 0 ? "resourceValue" : `resource${index}`;
                return {
                    resourceType: resourceNames[index],
                    attributeName: key,
                    attributeNameMax: `${key}_max`
                };
            }
        }
        engine.logi("Don't recognize resource " + resourceType);
        return null;
    };

    this.spend = function(isGeneric, cost, resourceType, value, value_max, attributeName) {
        if (isGeneric) {
            return [true, `Spend ${cost} ${resourceType}`];
        }

        if (cost > 0 && resourceType && value >= 0 && value_max >= 0) {
            if (value < cost) {
                return [false, `${cost} ${resourceType} - Insufficient (${value}/${value_max})`];
            } else {
                const newValue = value - cost;
                var attributes = {};
                attributes[attributeName] = newValue;
                setAttrs(attributes);
                const resultString = `Spent ${cost} ${resourceType} (${newValue}/${value_max})`;
                engine.logd(resultString);
                return [true, resultString];
            }
        } else {
            return [false, `${cost} ${resourceType} - Character has no ${resourceType}!`];
        }
    };

    this.restore = function(isGeneric, restoration, values) {
        const restoreValues = restoration.split(",");
        var attributes = [];
        var summary = isGeneric ? "Restore " : "Restored ";
        var didRestore = false;
        for (let i = 0; i < restoreValues.length; i++) {
            var parts = restoreValues[i].trim().split(" ");
            if (parts.length < 2) {
                engine.logi("Invalid restore declaration " + restoreValues[i]);
                continue;
            }
            if (parts.length > 2) {
                // Account for resources that have spaces in the name
                parts = [parts[0], parts.slice(1).join(" ")];
            }
            const typeForValue = parts[1];
            let specification = this.resourceSpecification(typeForValue, values);
            if (!specification) {
                engine.logi("Unrecognized restore type " + typeForValue);
                continue;
            }
            didRestore = true;
            engine.logi(`Restoring ${parts[0]} ${specification.attributeName}`);
            attributes.push({
                name: specification.attributeName,
                value: parts[0]
            });
            summary += `${parts[0]} ${specification.resourceType}, `;
        }

        if (!didRestore) {
            return "";
        }

        if (!isGeneric) {
            const attributeNames = attributes.flatMap((element) => [element.name, element.name + "_max"]);
            getAttrs(attributeNames, values => {
                var newValues = {};
                for (let attribute of attributes) {
                    const value = values[attribute.name];
                    const max = values[attribute.name + "_max"];
                    const sum = +value + +attribute.value;
                    const newValue = Math.min(sum, max);
                    newValues[attribute.name] = newValue;
                    engine.logd("Restored " + attribute.name + " to " + newValue);
                }
                setAttrs(newValues);
            });
        }

        return summary.substring(0, summary.length - 2);
    };

    this.resetUses = function(section) {
        engine.logd("Resetting uses for section " + section);
        getSectionIDs(`repeating_${section}`, ids => {
            let attributes = ids.flatMap(id => [`repeating_${section}_${id}_uses`, `repeating_${section}_${id}_uses_max`]);
            getAttrs(attributes, values => {
                var updatedAttributes = {};
                for (let id of ids) {
                    if (parseInt(values[`repeating_${section}_${id}_uses_max`]) > 0) {
                        updatedAttributes[`repeating_${section}_${id}_uses`] = values[`repeating_${section}_${id}_uses_max`];
                    }
                }
                setAttrs(updatedAttributes);
            });
        });
    };

    this.clearMudraIfNeeded = function(damageRoll, values) {
        if (values.resource.toLowerCase() !== "mudra") {
            return null;
        }
        let title = damageRoll.title;
        if (title === "Ritual Weave" || title === "Kassatsu" || title === "Ninjutsu") {
            return null;
        }

        engine.logd("Clearing Mudra");

        //  Reset Mudra resource when rolling unrelated abilities on Ninja
        setAttrs({
            resourceValue: 0
        });
        return "Cleared Mudra";
    };
};

const performAbility = new PerformAbility();
this.export.PerformAbility = PerformAbility;
this.export.AbilityId = AbilityId;
this.export.performAbility = performAbility;

// Build (version 1.0.0): Source/workers/main/setup/sheets.js


const sheets = {
    template: {
        job: "",
        jobIcon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Jobs/X.png",
        role: "X / Y",
        level: 30,
        resources: { 
            hitPoints: 24, hitPoints_max: 24, magicPoints: 5, magicPoints_max: 5, 
            resource: "", resourceValue: 0, resourceValue_max: 0, 
            resource2: "none", resource2Value: 0, resource2Value_max: 0, 
            resource3: "none", resource3Value: 0, resource3Value_max: 0, 
            range1: 0, range1_max: 0, range2: 0, range2_max: 0, range3: 0, range3_max: 0, 
            resourceReset: "", hasBestial: "false", hasNadi: "false", hasOpo: "false", hasTechniques: "false" 
        },
        attributes: { str: 1, dex: 4, vit: 2, int: 3, mnd: 2, defense: 13, magicDefense: 13, vigilance: 12, speed: 5 },
        traits: [
            { title: "", effect: "" }
        ],
        abilities: {
            primary: [
                { title: "", type: "", cost: 0, uses: 0, uses_max: 0, resource: "MP", target: "Single", range: "10 squares", check: "INT (d20 + 5)", cr: "Target's X", baseEffect: "", directHit: "", stat: "INT", hitType: "Hit", damageType: "Damage", hitDie: "1d20cs20", baseValue: "", dhValue: "", effectSelf: "", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/BLM/blizzard.png" }
            ]
        }
    },
    npc: {
        job: "NPC",
        jobIcon: "",
        role: "",
        level: 30,
        override: "manual",
        resources: { 
            hitPoints: 0, hitPoints_max: 0, magicPoints: 0, magicPoints_max: 0, 
            resource: "", resourceValue: 0, resourceValue_max: 0, 
            resource2: "none", resource2Value: 0, resource2Value_max: 0, 
            resource3: "none", resource3Value: 0, resource3Value_max: 0, 
            range1: 0, range1_max: 0, range2: 0, range2_max: 0, range3: 0, range3_max: 0, 
            resourceReset: "", hasBestial: "false", hasNadi: "false", hasOpo: "false", hasTechniques: "false" 
        },
        attributes: { str: 0, dex: 0, vit: 0, int: 0, mnd: 0, defense: 0, magicDefense: 0, vigilance: 0, speed: 0 }
    },

    level30: {
        ast: {
            job: "AST",
            jobIcon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Jobs/AST.png",
            role: "Healer / Astrologian",
            level: 30,
            resources: { 
                hitPoints: 24, hitPoints_max: 24, magicPoints: 5, magicPoints_max: 5,
                resource: "", resourceValue: 0, resourceValue_max: 0, 
                resource2: "none", resource2Value: 0, resource2Value_max: 0, 
                resource3: "none", resource3Value: 0, resource3Value_max: 0, 
                range1: 0, range1_max: 0, range2: 0, range2_max: 0, range3: 0, range3_max: 0, 
                resourceReset: "", hasBestial: "false", hasNadi: "false", hasOpo: "false", hasTechniques: "false" 
            },
            attributes: { str: 2, dex: 2, vit: 2, int: 2, mnd: 4, defense: 12, magicDefense: 13, vigilance: 14, speed: 5 },
            traits: [
                { title: "Play Arcana", effect: "At the start of your turn, grant a single ally of your choosing within 10 squares Major Arcana and a barrier of 1 HP." },
                { title: "Major Arcana", effect: "While a character is under the effect of Major Arcana, they may reroll a single die of their choosing when determining the amount of damage dealt by an ability. Any die rerolled in this way cannot be rerolled again, and its result must be used.\n\nMajor Arcana is removed when its effect is resolved or at the end of the character's turn." }
            ],
            abilities: {
                primary: [
                    { title: "Play Arcana", type: "Trait, Free action", cost: 0, uses: 0, uses_max: 0, target: "Single", range: "10 squares", condition: "May only be used at the start of your turn", baseEffect: "Grants the target Major Arcana and a barrier of 1 HP.", hitType: "None", damageType: "Effect", effectTarget: "Major Arcana, Barrier(1)", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/AST/play-arcana.png" },
                    { title: "Malefic", type: "Primary, Magic, Invoked", cost: 1, uses: 0, uses_max: 0, resource: "MP", target: "Single", range: "10 squares", check: "MND (d20 + 4)", cr: "Target's Magic Defense", baseEffect: "Deals 2 damage to the target.", directHit: "Deals an additional 1d6 damage.", stat: "MND", hitType: "Hit", damageType: "Damage", hitDie: "1d20cs20", baseValue: "2", dhValue: "1d6", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/AST/malefic.png" },
                    { title: "Helios", type: "Primary, Magic, Invoked", cost: 2, uses: 0, uses_max: 0, resource: "MP", target: "All allies within range", range: "A 5x5 area centered on this character", check: "Special (d20, Critical)", baseEffect: "Restores 1d6 + 2 HP to all targets.", hitType: "Critical", damageType: "Healing", hitDie: "1d20cs20", baseValue: "1d6 + 2", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/AST/helios.png" },
                    { title: "Repose", type: "Primary, Magic, Invoked", cost: 2, uses: 0, uses_max: 0, resource: "MP", target: "Single", range: "10 squares", check: "MND (d20 + 4)", cr: "Target's Magic Defense", baseEffect: "Inflicts Sleep on target.", directHit: "Removes all markers generated by the target.", stat: "MND", hitType: "Hit", damageType: "Effect", hitDie: "1d20cs20", effectTarget: "Sleep", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/Healer/repose.png" },
                    { title: "Ascend", type: "Primary, Magic, Invoked", cost: 3, uses: 0, uses_max: 0, resource: "MP", target: "1 Knocked Out character", range: "5 squares*", check: "Special (d20, Critical)", baseEffect: "Removes Knocked Out from the target, then restores 1d6 + 2 HP, grants Transcendent, and afflicts them with Weakness. *This ability can also target a character outside the encounter map. When doing so, move the target to an empty square within range after resolving the ability's effects.", hitType: "Critical", damageType: "Healing", hitDie: "1d20cs20", baseValue: "1d6 + 2", effectTarget: "Raise", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/AST/ascend.png" },
                    { title: "Benefic II", type: "Primary, Magic, Invoked", cost: 2, uses: 0, uses_max: 0, resource: "MP", target: "Single", range: "10 squares", check: "Special (d20, Critical)", baseEffect: "Restores 2d6 + 4 HP to the target.", hitType: "Critical", damageType: "Healing", hitDie: "1d20cs20", baseValue: "2d6 + 4", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/AST/benefic-ii.png" }
                ],
                secondary: [
                    { title: "Benefic", type: "Secondary, Magic, Invoked", cost: 1, uses: 0, uses_max: 0, resource: "MP", target: "Single", range: "10 squares", check: "Special (d20, Critical)", baseEffect: "Restores 1d6 HP to the target.", hitType: "Critical", damageType: "Healing", hitDie: "1d20cs20", baseValue: "1d6", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/AST/benefic.png" },
                    { title: "Lightspeed", type: "Secondary", cost: 0, uses: 2, uses_max: 2, baseEffect: "Immediately use one of your magic abilities.", limitation: "Twice per phase", hitType: "None", damageType: "Effect", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/AST/lightspeed.png" },
                    { title: "Lucid Dreaming", type: "Secondary", cost: 0, uses: 1, uses_max: 1, baseEffect: "Recover an additional 1 MP at the end of this round's [Adventurer Step].", limitation: "Once per phase", hitType: "None", damageType: "Effect", effectSelf: "Lucid Dreaming", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/Caster/lucid-dreaming.png" },
                    { title: "Combust", type: "Secondary, Magic", cost: 1, uses: 0, uses_max: 0, resource: "MP", target: "Single", range: "10 squares", baseEffect: "Inflicts a DOT (3) on the target.", hitType: "None", damageType: "Effect", effectTarget: "Combust(3)", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/AST/combust.png" },
                    { title: "Esuna", type: "Secondary, Magic, Invoked", cost: 1, uses: 0, uses_max: 0, resource: "MP", target: "Single", range: "10 squares", baseEffect: "Removes a single enfeeblement of the target's choosing.", hitType: "None", damageType: "Effect", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/Healer/esuna.png" }
                ],
                instant: [
                    { title: "Swiftcast", type: "Instant", cost: 0, uses: 1, uses_max: 1, trigger: "When any character ends their turn", baseEffect: "Immediately use one of your magic abilities.", limitation: "Once per phase", hitType: "None", damageType: "Effect", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/Caster/swiftcast.png" },
                    { title: "Essential Dignity", type: "Instant, Magic", cost: 0, uses: 1, uses_max: 1, trigger: "When any character ends their turn", target: "Single", range: "10 squares", check: "Special (d20, Critical)", baseEffect: "Restores 1d6 HP to the target. If the target's HP is less than or equal to half of their Max HP (rounded up), restores 2d6 + 2HP instead.", limitation: "Once per phase", hitType: "Critical", damageType: "Healing", hitDie: "1d20cs20", baseValue: "1d6", dhValue: "1d6 + 2", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/AST/essential-dignity.png" }
                ],
                limit: [
                    { title: "Astral Stasis", type: "Limit Break", cost: 0, uses: 1, uses_max: 1, trigger: "Any time", condition: "Limit Breaks have been made available for this encounter.", target: "All allied adventurers within range", range: "The entire encounter map*", baseEffect: "Removes all enfeeblements from all targets, fully restores their HP, and grants them Major Arcana. Astral Stasis can remove Knocked Out, Weakness and Brink of Death. *This ability also targets characters outside the encounter map. When doing so, move these targets to an empty square within 5 squares of this character after resolving the ability's effects.", hitType: "None", damageType: "Effect", effectTarget: "Astral Statis:Clear Enfeeblements,Heal(999),Major Arcana", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/General/limit-break.png" }
                ]
            }
        },
        blm: {
            job: "BLM",
            jobIcon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Jobs/BLM.png",
            role: "DPS / Black Mage",
            level: 30,
            resources: { 
                hitPoints: 21, hitPoints_max: 21, magicPoints: 5, magicPoints_max: 5, 
                resource: "", resourceValue: 0, resourceValue_max: 0, 
                resource2: "none", resource2Value: 0, resource2Value_max: 0, 
                resource3: "none", resource3Value: 0, resource3Value_max: 0, 
                range1: 0, range1_max: 0, range2: 0, range2_max: 0, range3: 0, range3_max: 0, 
                resourceReset: "", hasBestial: "false", hasNadi: "false", hasOpo: "false", hasTechniques: "false"
            },
            attributes: { str: 0, dex: 2, vit: 1, int: 5, mnd: 4, defense: 11, magicDefense: 15, vigilance: 14, speed: 5 },
            traits: [
                { title: "Consecutive Invocation", effect: "On your turn, after resolving the effects of an ability that enables this trait, you may forgo all standard movement until the end of your turn to use a additional invoked primary ability. You may choose a new target when using this additional ability. Consecutive Invocation can only be used once per turn, and does not prevent you from using focus to perform additional secondary action." },
                { title: "Umbral Ice", effect: "Certain effects grant you Umbral Ice. While under the effect of Umbral Ice, your ice-aspected abilities restore 5 MP each time they deal damage. Umbral Ice is removed when you are granted Astral Fire or, if the effect is not renewed, at the end of your next turn." },
                { title: "Astral Fire", effect: "Certain effects grant you Astral Fire. While under the effect of Astral Fire your fire-aspected abilities deal an additional 1d6 damage and you do not recover MP at the end of the [Adventurer Step].\n\nAstral Fire is removed when you are granted Umbral Ice or, if the effect is not renewed, at the end of your next turn." },
                { title: "Thunderhead Ready", effect: "Whenever you are granted Umbral Ice while not under the effect of Umbral Ice, or Astral Fire while not under the effect of Astral Fire grant Thunderhead Ready*.\n\n*You cannot use a thunder spell ability to inflict a DOT on a character already suffering from a DOT inflicted by one of your thunder spell abilities." }
            ],
            abilities: {
                primary: [
                    { title: "Blizzard", type: "Primary, Magic, Ice-Aspected, Invoked", cost: 1, uses: 0, uses_max: 0, resource: "MP", target: "Single", range: "10 squares", check: "INT (d20 + 5)", cr: "Target's Magic Defense", baseEffect: "Deals 3 damage to the target, grants Umbral Ice, and enables Consecutive Invocation.", directHit: "Deals an additional 1d6 damage.", stat: "INT", hitType: "Hit", damageType: "Damage", hitDie: "1d20cs20", baseValue: "3", dhValue: "1d6", effectSelf: "Umbral Ice", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/BLM/blizzard.png" },
                    { title: "Fire", type: "Primary, Magic, Fire-Aspected, Invoked", cost: 2, uses: 0, uses_max: 0, resource: "MP", target: "Single", range: "10 squares", check: "INT (d20 + 5)", cr: "Target's Magic Defense", baseEffect: "Deals 3 damage to the target, grants Astral Fire, and enables Consecutive Invocation.", directHit: "Deals an additonal 1d6 damage.", stat: "INT", hitType: "Hit", damageType: "Damage", hitDie: "1d20cs20", baseValue: "3", dhValue: "1d6", effectSelf: "Astral Fire", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/BLM/fire.png" },
                    { title: "Sleep", type: "Primary, Magic, Invoked", cost: 2, resource: "MP", uses: 0, uses_max: 0, target: "All enemies within range", range: "A 5x5 area within 10 squares of this character", check: "INT (d20 + 5)", cr: "Target's Magic Defense", baseEffect: "Inflicts Sleep on all targets.", directHit: "Removes all markers generated by all targets.", stat: "INT", hitType: "Hit", damageType: "Effect", hitDie: "1d20cs20", baseValue: "", dhValue: "", effectSelf: "", effectTarget: "Sleep", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/Caster/sleep.png" },
                    { title: "Blizzard II", type: "Primary, Magic, Ice-Aspected, Invoked", cost: 2, resource: "MP", uses: 0, uses_max: 0, target: "All enemies within range", range: "A 5x5 area within 10 squares of this character", check: "INT (d20 + 5)", cr: "Target's Magic Defense", baseEffect: "Deals 3 damage to all targets and grants Umbral Ice.", directHit: "Deals an additional 1d6 damage.", stat: "INT", hitType: "Hit", damageType: "Damage", hitDie: "1d20cs20", baseValue: "3", dhValue: "1d6", effectSelf: "Umbral Ice", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/BLM/blizzard-ii.png" },
                    { title: "Fire II", type: "Primary, Magic, Fire-Aspected, Invoked", cost: 3, resource: "MP", uses: 0, uses_max: 0, target: "All enemies within range", range: "A 5x5 area within 10 squares of this character", check: "INT (d20 + 5)", cr: "Target's Magic Defense", baseEffect: "Deals 3 damage to all targets and grants Astral Fire", directHit: "Deals an additional 1d6 damage.", stat: "INT", hitType: "Hit", damageType: "Damage", hitDie: "1d20cs20", baseValue: "3", dhValue: "1d6", effectSelf: "Astral Fire", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/BLM/fire-ii.png" }
                ],
                secondary: [
                    { title: "Transpose", type: "Secondary", cost: 0, uses: 0, uses_max: 0, baseEffect: "Removes Umbral Ice and grants Astral Fire, or removes Astral Fire and grants Umbral Ice. Transpose can only be used once per turn.", hitType: "None", damageType: "Effect", effectSelf: "Transpose", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/BLM/transpose.png" },
                    { title: "Thunder", type: "Secondary, Magic, Lightning-Aspected, Thunder-Spell", condition: "Under the effect of Thunderhead Ready", cost: 0, uses: 0, uses_max: 0, target: "Single", range: "10 squares", baseEffect: "Deals 2 damage and inflicts a DOT (3) on the target.", hitType: "None", damageType: "Damage", baseValue: "2", effectTarget: "Thunder(3)", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/BLM/thunder.png" },
                    { title: "Manafont", type: "Secondary", condition: "Under the effect of Astral Fire", cost: 0, uses: 1, uses_max: 1, baseEffect: "Fully restores MP and grants Thunderhead Ready.", limitation: "Once per phase.", hitType: "None", damageType: "Effect", restore: "5 MP", effectSelf: "Thunderhead Ready", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/BLM/manafont.png" },
                    { title: "Lucid Dreaming", type: "Secondary", cost: 0, uses: 1, uses_max: 1, baseEffect: "Recover an additional 1 MP at the end of this round's [Adventurer Step].", limitation: "Once per phase.", hitType: "None", damageType: "Effect", effectSelf: "Lucid Dreaming", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/Caster/lucid-dreaming.png" },
                    { title: "Thunder II", type: "Secondary, Magic, Lightning-Aspected, Thunder Spell", condition: "Under the effect of Thunderhead Ready", cost: 0, uses: 0, uses_max: 0, target: "All enemies within range", range: "A 5x5 area within 10 squares of this character.", baseEffect: "Inflicts a DOT (3) on all targets.", hitType: "None", damageType: "Effect", effectTarget: "Thunder(3)", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/BLM/thunder-ii.png" },
                    { title: "Manaward", type: "Secondary", cost: 0, uses: 1, uses_max: 1, baseEffect: "Grants a barrier of 2 HP.", limitation: "Once per phase.", hitType: "None", damageType: "Effect", effectSelf: "Barrier(2)", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/BLM/manaward.png" },
                    { title: "Scathe", type: "Secondary, Magic", cost: 1, resource: "MP", uses: 0, uses_max: 0, target: "Single", range: "10 squares", baseEffect: "Deals 4 damage to the target.", hitType: "None", damageType: "Damage", baseValue: "4", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/BLM/scathe.png" }
                ],
                instant: [
                    { title: "Addle", type: "Instant", cost: 0, uses: 1, uses_max: 1, trigger: "Immediately before an ability used by an enemy is resolved.", target: "The enemy that triggered this ability.", range: "5 squares", baseEffect: "Reduces the damage dealt by the target's abilities by 2 until the end of this turn.", limitation: "Once per phase", hitType: "None", damageType: "Effect", effectTarget: "Addle", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/Caster/addle.png" },
                    { title: "Swiftcast", type: "Instant", cost: 0, uses: 1, uses_max: 1, trigger: "When any character ends their turn", baseEffect: "Immediately use on of your magic abilities.", limitation: "Once per phase", hitType: "None", damageType: "Damage", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/Caster/swiftcast.png" }
                ],
                limit: [
                    { title: "Meteor", type: "Limit Break, Magic, Fire-Aspected", cost: 0, uses: 1, uses_max: 1, condition: "Limit Breaks have been made available for this encounter.", trigger: "Any time", target: "All enemies within range", range: "A 5x5 area within 10 squares of this character", baseEffect: "Deals 4d6 damage to all targets.", hitType: "None", damageType: "Damage", baseValue: "4d6", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/General/limit-break.png" }
                ]
            }
        },
        brd: {
            job: "BRD",
            jobIcon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Jobs/BRD.png",
            role: "DPS / Bard",
            level: 30,
            resources: { 
                hitPoints: 24, hitPoints_max: 24, magicPoints: 5, magicPoints_max: 5, 
                resource: "", resourceValue: 0, resourceValue_max: 0, 
                resource2: "none", resource2Value: 0, resource2Value_max: 0, 
                resource3: "none", resource3Value: 0, resource3Value_max: 0, 
                range1: 0, range1_max: 0, range2: 0, range2_max: 0, range3: 0, range3_max: 0, 
                resourceReset: "", hasBestial: "false", hasNadi: "false", hasOpo: "false", hasTechniques: "false" 
            },
            attributes: { str: 1, dex: 4, vit: 2, int: 3, mnd: 2, defense: 13, magicDefense: 13, vigilance: 12, speed: 5 },
            traits: [
                { title: "Arrow Flurry", effect: "On your turn, after resolving the effects of an ability that enables this trait, you may use an additional flurry ability. You may choose a new target when using this additional ability.\n\nArrow Flurry can only be used once per turn." },
                { title: "Bardsong", effect: "At the start of your turn, you may use one of your song abilities as a free action. Song effects are removed at the start of your next turn, at the end of a phase, or when you are Knocked Out." },
                { title: "Hawk's Eye", effect: "While under the effect of Hawk's Eye, you may use Straight Shot or Wide Volley and ignore the penalty incurred on ability checks made while Blinded.\n\nHawk's Eye is removed after using Straight Shot or Wide Volley." }
            ],
            abilities: {
                song: [
                    { title: "Minstrel's Refrain", type: "Magic, Song", cost: 0, uses: 0, uses_max: 0, baseEffect: "Grants the song effect of a single song ability of your choosing that you have already used this phase.", hitType: "None", damageType: "Effect", effectTarget: "Mage's Ballad", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/BRD/minstrels-refrain.png" },
                    { title: "Mage's Ballad", type: "Magic, Song", cost: 0, uses: 1, uses_max: 1, baseEffect: "Restores one use of Bloodletter and grants the following song effect.", effectName: "Mage's Ballad:", effect: "All allies may each reroll a single die when determining the amount of damage dealt by an ability.", limitation: "Once per phase", hitType: "None", damageType: "Effect", effectSelf: "restore(instant-Bloodletter-1)", effectTarget: "Mage's Ballad", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/BRD/mages-ballad.png" }
                ],
                primary: [
                    { title: "Heavy Shot", type: "Primary, Physical, Ranged, Flurry", cost: 0, uses: 0, uses_max: 0, target: "Single", range: "10 squares", check: "DEX (d20 + 4)", cr: "Target's Defense", baseEffect: "Deals 2 damage to the target and enables Arrow Flurry. If the die rolled for this ability check lands on a 15 or higher, the following proc effect triggers.", effectName: "Heavier Shot:", effect: "Grants Hawk's Eye.", directHit: "Deals an additional 1d6 damage.", stat: "DEX", hitType: "Hit", damageType: "Damage", hitDie: "1d20cs20", baseValue: "2", dhValue: "1d6", effectSelf: "Hawk's Eye[d>=15]", combo: "Heavy Shot, Straight Shot", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/BRD/heavy-shot.png" },
                    { title: "Venomous Bite + Windbite", type: "Primary, Physical, Ranged, Wind-Aspected, Poison", cost: 0, uses: 0, uses_max: 0, target: "Single", range: "10 squares", check: "DEX (d20 + 4)", cr: "Target's Defense", baseEffect: "Inflicts a DOT (4) on the target and enables Arrow Flurry.", directHit: "Deals 1d6 damage to the target.", stat: "DEX", hitType: "Hit", damageType: "Damage", hitDie: "1d20cs20", baseValue: "", dhValue: "1d6", effectTarget: "Venomous Bite(4)", combo: "Heavy Shot, Straight Shot", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/BRD/venomous-bite%2Bwindbite.png" },
                    { title: "Wide Volley", type: "Primary, Physical, Ranged", cost: 0, uses: 0, uses_max: 0, condition: "Under the effect of Hawk's Eye", target: "All enemies within range", range: "A 5x5 area within 10 squares of this character", check: "DEX (d20 + 4)", cr: "Target's Defense", baseEffect: "Deals 5 damage to all targets", directHit: "Deals an additional 1d6 damage.", stat: "DEX", hitType: "Hit", damageType: "Damage", hitDie: "1d20cs20", baseValue: "5", dhValue: "1d6", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/BRD/wide-volley.png" },
                    { title: "Straight Shot", type: "Primary, Physical, Ranged, Flurry", cost: 0, uses: 0, uses_max: 0, condition: "Under the effect of Hawk's Eye", target: "Single", range: "10 squares", check: "DEX (d20 + 4)", cr: "Target's Defense", baseEffect: "Deals 5 damage to the target and enables Arrow Flurry.", directHit: "Deals an additional 1d6 damage.", stat: "DEX", hitType: "Hit", damageType: "Damage", hitDie: "1d20cs20", baseValue: "5", dhValue: "1d6", combo: "Heavy Shot, Straight Shot", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/BRD/straight-shot.png" },
                    { title: "Quick Nock", type: "Primary, Physical, Ranged", cost: 0, uses: 0, uses_max: 0, target: "All enemies within range", range: "A 3x3 area adjacent to this character", check: "DEX (d20 + 4)", cr: "Target's Defense", baseEffect: "Deals 3 damage to all targets. If the die rolled for this ability check lands on a 15 or higher, the following proc effect triggers.", effectName: "Enhanced Quick Nock:", effect: "Grant's Hawk's Eye", directHit: "Deals an additional 1d6 damage.", stat: "DEX", hitType: "Hit", damageType: "Damage", hitDie: "1d20cs20", baseValue: "3", dhValue: "1d6", effectSelf: "Hawk's Eye[d>=15]", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/BRD/quick-nock.png" }
                ],
                secondary: [
                    { title: "Raging Strikes", type: "Secondary", cost: 0, uses: 2, uses_max: 2, baseEffect: "Your primary abilities deal an additional 2 damage until the end of this turn.", limitation: "Twice per phase", hitType: "None", damageType: "Effect", effectSelf: "Raging Strikes(2)", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/BRD/raging-strikes.png" }
                ],
                instant: [
                    { title: "Leg Graze", type: "Instant", cost: 0, uses: 1, uses_max: 1, trigger: "Immediately after an enemy makes an ability check", target: "The enemy that triggered this ability", range: "10 squares", baseEffect: "Reduces the total of the ability check that triggered Leg Graze by 1d6.", limitation: "Once per phase", hitType: "None", damageType: "Effect", baseValue: "1d6", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/Ranged/leg-graze.png" },
                    { title: "Foot Graze", type: "Instant, Physical, Ranged", cost: 0, uses: 1, uses_max: 1, trigger: "Immediately before an enemy moves", target: "The enemy that triggered this ability", range: "10 squares", check: "DEX (d20 + 4)", cr: "Target's Defense", baseEffect: "None.", directHit: "Inflicts Bound on the target until the end of this turn.", limitation: "Once per phase", stat: "DEX", hitType: "Hit", damageType: "Effect", hitDie: "1d20cs20", effectTarget: "bound", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/Ranged/foot-graze.png" },
                    { title: "Repelling Shot", type: "Instant, Physical, Ranged", cost: 0, uses: 1, uses_max: 1, trigger: "When any character ends their turn", target: "Single", range: "10 squares", baseEffect: "Move up to 3 squares. You cannot end this movement in a square that is closer to the target than where you began.", limitation: "Once per phase", hitType: "None", damageType: "Effect", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/BRD/repelling-shot.png" },
                    { title: "Second Wind", type: "Instant", cost: 0, uses: 1, uses_max: 1, trigger: "When any character ends their turn", baseEffect: "Restores 1d6 + 2 HP", limitation: "Once per phase", hitType: "None", damageType: "Healing", baseValue: "1d6 + 2", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/dps/second-wind.png" },
                    { title: "Bloodletter", type: "Instant, Physical, Ranged", cost: 0, uses: 2, uses_max: 2, trigger: "When any character ends their turn", target: "Single", range: "10 squares", baseEffect: "Deals 4 damage to the target.", limitation: "Twice per phase", hitType: "None", damageType: "Damage", baseValue: "4", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/BRD/bloodletter.png" },
                    { title: "Head Graze", type: "Instant, Physical, Ranged", cost: 0, uses: 1, uses_max: 1, trigger: "When an enemy within 10 squares of this character uses an invoked ability, or is using an invoked ability to generate a marker", target: "The enemy that triggered this ability", range: "10 squares", baseEffect: "Interrupts the invoked ability that triggered Head Graze, negating it completely.", limitation: "Once per phase", hitType: "None", damageType: "Effect", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/Ranged/head-graze.png" }
                ],
                limit: [
                    { title: "Sagittarius Arrow", type: "Limit Break, Physical", cost: 0, uses: 1, uses_max: 1, condition: "Limit Breaks have been made available for this encounter.", trigger: "Any time", target: "All enemies within range", range: "A 5x area extending in a straight line across the entire encounter map from 1 square adjacent to this character.", baseEffect: "Deals 6d6 damage divided evenly (rounded up) amongst all targets and inflicts a DOT (4) on all targets.", hitType: "None", damageType: "Damage", baseValue: "6d6", effectTarget: "DOT(4)", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/General/limit-break.png" }
                ]
            }
        },
        drg: {
            job: "DRG",
            jobIcon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Jobs/DRG.png",
            role: "DPS / Dragoon",
            level: 30,
            resources: { 
                hitPoints: 26, hitPoints_max: 26, magicPoints: 5, magicPoints_max: 5, 
                resource: "", resourceValue: 0, resourceValue_max: 0, 
                resource2: "none", resource2Value: 0, resource2Value_max: 0, 
                resource3: "none", resource3Value: 0, resource3Value_max: 0, 
                range1: 0, range1_max: 0, range2: 0, range2_max: 0, range3: 0, range3_max: 0, 
                resourceReset: "", hasBestial: "false", hasNadi: "false", hasOpo: "false", hasTechniques: "false" 
            },
            attributes: { str: 5, dex: 3, vit: 2, int: 1, mnd: 1, defense: 14, magicDefense: 11, vigilance: 11, speed: 5 },
            traits: [
                { title: "Power Surge", effect: "While under the effect of Power Surge, your abilities deal an additional 2 damage." },
                { title: "Combo", effect: "After resolving the effects of an ability with Combo, you may use one of the specified abilities at any point during your turn. You may move before doing so, and may choose a new target when using this additional ability." }
            ],
            abilities: {
                primary: [
                    { title: "True Thrust", type: "Primary, Physical", cost: 0, uses: 0, uses_max: 0, target: "Single", range: "1 square", check: "STR(d20 + 5)", cr: "Target's Defense", baseEffect: "Deals 3 damage to the target. Combo: Dragoon Combo or Disembowel.", directHit: "Deals an additional 2d6 damage.", stat: "STR", hitType: "Hit", damageType: "Damage", hitDie: "1d20cs20", baseValue: "3", dhValue: "2d6", combo: "Dragoon Combo,Disembowel", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/DRG/true-thrust.png" },
                    { title: "Piercing Talon", type: "Primary, Physical", cost: 0, uses: 0, uses_max: 0, target: "Single", range: "5 squares", check: "STR (d20 + 5)", cr: "Target's Defense", baseEffect: "Deals 3 damage to the target.", directHit: "Deals an additional 2d6 damage.", stat: "STR", hitType: "Hit", damageType: "Damage", hitDie: "1d20cs20", baseValue: "3", dhValue: "2d6", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/DRG/piercing-talon.png" },
                    { title: "Jump", type: "Primary, Physical", cost: 0, uses: 1, uses_max: 1, target: "Single", range: "5 squares", check: "STR (d20 + 5)", cr: "Target's Defense", baseEffect: "Deals 2d6 + 3 damage to the target.", directHit: "Deals an additional 2d6 damage.", limitation: "Once per phase", stat: "STR", hitType: "Hit", damageType: "Damage", hitDie: "1d20cs20", baseValue: "2d6 + 3", dhValue: "2d6", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/DRG/jump.png" },
                    { title: "Dragoon Combo (Vorpal Thrust + Full Thrust)", type: "Primary, Physical", cost: 0, uses: 0, uses_max: 0, target: "Single", range: "1 square", check: "STR (d20 + 5)", cr: "Target's Defense", baseEffect: "Deals 3 damage to the target.", directHit: "Deals an additional 2d6 damage.", stat: "STR", hitType: "Hit", damageType: "Damage", hitDie: "1d20cs20", baseValue: "3", dhValue: "2d6", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/DRG/dragoon-combo.png" },
                    { spacer: true },
                    { spacer: true },
                    { title: "Disembowel", type: "Primary, Physical", cost: 0, uses: 0, uses_max: 0, target: "Single", range: "1 square", check: "STR (d20 + 5)", cr: "Target's Defense", baseEffect: "Deals 3 damage to the target and grants Power Surge.", directHit: "Deals an additional 1d6 damage.", stat: "STR", hitType: "Hit", damageType: "Damage", hitDie: "1d20cs20", baseValue: "3", dhValue: "1d6", effectSelf: "Power Surge(2)", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/DRG/disembowel.png" }
                ],
                secondary: [
                    { title: "Life Surge", type: "Secondary", cost: 0, uses: 1, uses_max: 1, baseEffect: "Grants Drain(2) until the end of this turn and one advantage die on your next ability check this turn.", limitation: "Once per phase", hitType: "None", damageType: "Effect", effectSelf: "Life Surge(2)", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/DRG/life-surge.png" },
                    { title: "Bloodbath", type: "Secondary", cost: 0, uses: 1, uses_max: 1, baseEffect: "Grants Drain(2) until the end of this turn.", limitation: "Once per phase", hitType: "None", damageType: "Effect", effectSelf: "Bloodbath(2)", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/Melee/bloodbath.png" },
                    { title: "Lance Charge", type: "Secondary", cost: 0, uses: 2, uses_max: 2, baseEffect: "Your abilities deal an additional 2 damage until the end of this turn.", limitation: "Twice per phase", hitType: "None", damageType: "Effect", effectSelf: "Lance Charge(2)", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/DRG/lance-charge.png" },
                    { title: "Leg Sweep", type: "Secondary, Physical", cost: 0, uses: 1, uses_max: 1, target: "Single", range: "1 square", baseEffect: "Stuns the target until the end of this turn.", limitation: "Once per phase", hitType: "None", damageType: "Effect", effectTarget: "Stun", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/Melee/leg-sweep.png" }
                ],
                instant: [
                    { title: "Second Wind", type: "Instant", cost: 0, uses: 1, uses_max: 1, trigger: "When any character ends their turn", baseEffect: "Restores 1d6 + 2 HP", limitation: "Once per phase", hitType: "None", damageType: "Healing", baseValue: "1d6 + 2", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/dps/second-wind.png" },
                    { title: "Feint", type: "Instant, Physical", cost: 0, uses: 1, uses_max: 1, trigger: "Immediately before an ability used by an enemy is resolved.", target: "The enemy that triggered this ability.", range: "2 squares", baseEffect: "Reduces the damage dealt by the target's abilities by 2 until the end of this turn.", limitation: "Once per phase", hitType: "None", damageType: "Effect", effectTarget: "Feint", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/Melee/feint.png" }
                ],
                limit: [
                    { title: "Dragonsong Dive", type: "Limit Break, Physical", cost: 0, uses: 1, uses_max: 1, condition: "Limit Breaks have been made available for this encounter.", trigger: "Any time", target: "Single", range: "5 squares", baseEffect: "Deals 6d6 damage to the target, then move to an empty square adjacent to the target if one is available.", hitType: "None", damageType: "Damage", baseValue: "6d6", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/General/limit-break.png" }
                ]
            }
        },
        drk: {
            job: "DRK",
            jobIcon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Jobs/DRK.png",
            role: "Tank / Dark Knight",
            level: 30,
            resources: { 
                hitPoints: 32, hitPoints_max: 32, magicPoints: 5, magicPoints_max: 5, 
                resource: "", resourceValue: 0, resourceValue_max: 0, 
                resource2: "none", resource2Value: 0, resource2Value_max: 0, 
                resource3: "none", resource3Value: 0, resource3Value_max: 0, 
                range1: 0, range1_max: 0, range2: 0, range2_max: 0, range3: 0, range3_max: 0, 
                resourceReset: "", hasBestial: "false", hasNadi: "false", hasOpo: "false", hasTechniques: "false" 
            },
            attributes: { str: 4, dex: 0, vit: 4, int: 0, mnd: 4, defense: 15, magicDefense: 14, vigilance: 14, speed: 5 },
            traits: [
                { title: "Darkside", effect: "While under the effect of Darkside, you may spend 2 MP when you score a direct hit on an enemy with a single-target ability to treat any roll of 1. 2, or 3 as if it were a 0 and any roll of 4, 5, or 6 as if it were a 10 when determining damage. Darkside is removed at the end of your next turn it the effect is not renewed." },
                { title: "Combo", effect: "After resolving the effects of an ability with Combo, you may use one of the specified abilities at any point during your turn. You may move before doing so, and may choose a new target when using this additional ability." }
            ],
            abilities: {
                primary: [
                    { title: "Dark Knight Combo (Hard Slash + Siphon Strike)", type: "Primary, Physical", cost: 0, uses: 0, uses_max: 0, resource: "MP", target: "Single", range: "1 square", check: "STR (d20 + 4)", cr: "Target's Defense", baseEffect: "Deals 2 damage and inflicts Enmity on the target. Restores 1 MP. Combo: Souleater", directHit: "Deals an additional 1d6 damage.", stat: "STR", hitType: "Hit", damageType: "Damage", hitDie: "1d20cs20", baseValue: "2", dhValue: "1d6", restore: "1MP", effectTarget: "Enmity(5)", combo: "Souleater", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/DRK/dark-knight-combo.png" },
                    { title: "Unleash", type: "Primary, Magic", cost: 0, uses: 0, uses_max: 0, resource: "MP", target: "All enemies within range", range: "A 5x5 area centered on this character", check: "MND (d20 + 4)", cr: "Target's Magic Defense", baseEffect: "Inflicts Enmity on all targets.", directHit: "Deals 2 damage to all targets.", stat: "MND", hitType: "Hit", damageType: "Damage", hitDie: "1d20cs20", baseValue: "", dhValue: "2", effectTarget: "Enmity(5)", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/DRK/unleash.png" },
                    { title: "Unmend", type: "Primary, Magic", cost: 0, uses: 0, uses_max: 0, resource: "MP", target: "Single", range: "5 squares", check: "MND (d20 + 4)", cr: "Target's Magic Defense", baseEffect: "Deals 3 damage and inflicts Enmity on the target.", directHit: "Deals an additional 1d6 damage.", stat: "MND", hitType: "Hit", damageType: "Damage", hitDie: "1d20cs20", baseValue: "3", dhValue: "1d6", effectTarget: "Enmity(5)", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/DRK/unmend.png" },
                    { title: "Souleater", type: "Primary, Physical", cost: 0, uses: 0, uses_max: 0, resource: "MP", target: "Single", range: "1 square", check: "STR (d20 + 4)", cr: "Target's Defense", baseEffect: "Deals 2 damage and inflicts Enmity on the target. Restores 2HP.", directHit: "Deals an additional 1d6 damage.", stat: "STR", hitType: "Hit", damageType: "Damage", hitDie: "1d20cs20", baseValue: "2", dhValue: "1d6", restore: "2 HP", effectTarget: "Enmity(5)", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/DRK/souleater.png" }
                ],
                secondary: [
                    { title: "Rampart", type: "Secondary", cost: 0, uses: 1, uses_max: 1, baseEffect: "Reduces the damage you take from abilities by 2 until the start of your next turn.", limitation: "Once per phase", hitType: "None", damageType: "Effect", effectSelf: "Rampart(2)", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/Tank/rampart.png" },
                    { title: "Low Blow", type: "Secondary, Physical", cost: 0, uses: 0, uses_max: 0, target: "Single", range: "1 square", baseEffect: "Stuns the target until the end of this turn.", hitType: "None", damageType: "Effect", effectTarget: "Stun", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/Tank/low-blow.png" },
                    { title: "Flood of Darkness", type: "Secondary, Magic", cost: 2, uses: 0, uses_max: 0, resource: "MP", target: "All enemies within range", range: "A 3x3 area adjacent to this character", baseEffect: "Deals 2 damage to all targets and grants Darkside.", hitType: "None", damageType: "Damage", baseValue: "2", effectSelf: "Darkside", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/DRK/flood-of-darkness.png" }
                ],
                instant: [
                    { title: "Provoke", type: "Instant", cost: 0, uses: 1, uses_max: 1, trigger: "When an enemy begins their turn", target: "The enemy that triggered this ability", range: "10 squares", baseEffect: "Inflicts Enmity on the target.", limitation: "Once per phase", hitType: "None", damageType: "Effect", effectTarget: "Enmity(5)", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/Tank/provoke.png" },
                    { title: "Interject", type: "Instant", cost: 0, uses: 1, uses_max: 1, trigger: "When an adjacent enemy uses an invoked ability, or is using an invoked ability to generate a marker", target: "The enemy that triggered this ability", range: "1 square", baseEffect: "Interrupts the invoked ability that triggered Interject, negating it completely.", limitation: "Once per phase", hitType: "None", damageType: "Effect", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/Tank/interject.png" },
                    { title: "Reprisal", type: "Instant", cost: 0, uses: 1, uses_max: 1, trigger: "Immediately before an ability used by an enemy within 2 squares is resolved", target: "All enemies within range", range: "A 5x5 area centered on this character", baseEffect: "Reduces the damage dealt by the abilities of all targets by 2 until the end of this round.", limitation: "Once per phase", hitType: "None", damageType: "Effect", effectTarget: "Reprisal(2)", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/Tank/reprisal.png" }
                ],
                limit: [
                    { title: "Dark Force", type: "Limit Break", cost: 0, uses: 1, uses_max: 1, condition: "Limit Breaks have been made available for this encounter.", trigger: "Immediately before an effect that deals damage or inflicts enfeeblements is resolved", target: "Single", baseEffect: "Prevents all damage and enfeeblements that the effect that triggered Dark Force inflicts on the target.", hitType: "None", damageType: "Effect", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/General/limit-break.png" }
                ]
            }
        },
        mch: {
            job: "MCH",
            jobIcon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Jobs/MCH.png",
            role: "DPS / Machinist",
            level: 30,
            resources: { 
                hitPoints: 24, hitPoints_max: 24, magicPoints: 5, magicPoints_max: 5, 
                resource: "Heat", resourceValue: 0, resourceValue_max: 4, 
                resource2: "none", resource2Value: 0, resource2Value_max: 0, 
                resource3: "none", resource3Value: 0, resource3Value_max: 0, 
                range1: 0, range1_max: 0, range2: 0, range2_max: 0, range3: 0, range3_max: 0, 
                resourceReset: "", hasBestial: "false", hasNadi: "false", hasOpo: "false", hasTechniques: "false" 
            },
            attributes: { str: 3, dex: 4, vit: 2, int: 2, mnd: 1, defense: 14, magicDefense: 12, vigilance: 11, speed: 5 },
            traits: [
                { title: "Mechanized Sharpshooter", effect: "You may use any number of instant abilities on your turn." },
                { title: "Thermal Trap", effect: "Certain effects grant you Heat. You can have up to 4 Heat at any time." },
                { title: "Overheated", effect: "While under the effect of Overheated, use the lower of the target's Defense or Magic Defense as the CR for your ability checks. Overheated is removed at the start of your next turn." }
            ],
            abilities: {
                primary: [
                    { title: "Machinist Combo (Split Shot + Slug Shot)", type: "Primary, Physical, Ranged", cost: 0, uses: 0, uses_max: 0, target: "Single", range: "10 squares", check: "DEX (d20 + 4)", cr: "Target's Defense", baseEffect: "Deals 4 damage to the target and grants 1 Heat. Combo: Clean Shot.", directHit: "Deals an additional 1d6 damage.", stat: "DEX", hitType: "Hit", damageType: "Damage", hitDie: "1d20cs20", baseValue: "4", dhValue: "1d6", restore: "1 Heat", combo: "Clean Shot", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/MCH/machinist-combo.png" },
                    { title: "Hot Shot", type: "Primary, Physical, Ranged", cost: 0, uses: 1, uses_max: 1, target: "Single", range: "10 squares", check: "DEX (d20 + 4)", cr: "Target's Defense", baseEffect: "Deals 7 damage to the target.", directHit: "Deals an additional 2d6 damage.", limitation: "Once per phase.", stat: "DEX", hitType: "Hit", damageType: "Damage", hitDie: "1d20cs20", baseValue: "7", dhValue: "2d6", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/MCH/hot-shot.png" },
                    { title: "Spread Shot", type: "Primary, Physical, Ranged", cost: 0, uses: 0, uses_max: 0, target: "All enemies within range", range: "A 5x5 area adjacent to this character", check: "DEX (d20 + 4)", cr: "Target's Defense", baseEffect: "Deals 4 damage to all targets and grants 1 Heat.", directHit: "Deals an additional 1d6 damage.", stat: "DEX", hitType: "Hit", damageType: "Damage", hitDie: "1d20cs20", baseValue: "4", dhValue: "1d6", restore: "1 Heat", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/MCH/spread-shot.png" },
                    { title: "Clean Shot", type: "Primary, Physical, Ranged", cost: 0, uses: 0, uses_max: 0, target: "Single", range: "10 squares", check: "DEX (d20 + 4)", cr: "Target's Defense", baseEffect: "Deals 4 damage to the target and grants 1 Heat.", directHit: "Deals an additional 1d6 damage.", stat: "DEX", hitType: "Hit", damageType: "Damage", hitDie: "1d20cs20", baseValue: "4", dhValue: "1d6", restore: "1 Heat", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/MCH/clean-shot.png" }
                ],
                secondary: [
                    { title: "Reassemble", type: "Secondary", cost: 0, uses: 1, uses_max: 1, baseEffect: "The next ability you use this turn automatically scores a critical unless it is interrupted or otherwise negated.", limitation: "Once per phase", hitType: "None", damageType: "Effect", effectSelf: "Reassemble", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/MCH/reassemble.png" },
                    { title: "Hypercharge", type: "Secondary", cost: 2, resource: "Heat", uses: 0, uses_max: 0, baseEffect: "Grants Overheated until the start of your next turn.", hitType: "None", damageType: "Effect", effectSelf: "Overheated", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/MCH/hypercharge.png" }
                ],
                instant: [
                    { title: "Leg Graze", type: "Instant", cost: 0, uses: 1, uses_max: 1, trigger: "Immediately after an enemy makes an ability check", target: "The enemy that triggered this ability", range: "10 squares", baseEffect: "Reduces the total of the ability check that triggered Leg Graze by 1d6.", limitation: "Once per phase", hitType: "None", damageType: "Effect", baseValue: "1d6", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/Ranged/leg-graze.png" },
                    { title: "Foot Graze", type: "Instant, Physical, Ranged", cost: 0, uses: 1, uses_max: 1, trigger: "Immediately before an enemy moves", target: "The enemy that triggered this ability", range: "10 squares", check: "DEX (d20 + 4)", cr: "Target's Defense", baseEffect: "None.", directHit: "Inflicts Bound on the target until the end of this turn.", limitation: "Once per phase", stat: "DEX", hitType: "Hit", damageType: "Effect", hitDie: "1d20cs20", effectTarget: "bound", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/Ranged/foot-graze.png" },
                    { title: "Head Graze", type: "Instant, Physical, Ranged", cost: 0, uses: 1, uses_max: 1, trigger: "When an enemy within 10 squares of this character uses an invoked ability, or is using an invoked ability to generate a marker", target: "The enemy that triggered this ability", range: "10 squares", baseEffect: "Interrupts the invoked ability that triggered Head Graze, negating it completely.", limitation: "Once per phase", hitType: "None", damageType: "Effect", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/Ranged/head-graze.png" },
                    { title: "Second Wind", type: "Instant", cost: 0, uses: 1, uses_max: 1, trigger: "When any character ends their turn", baseEffect: "Restores 1d6 + 2 HP", limitation: "Once per phase", hitType: "None", damageType: "Healing", baseValue: "1d6 + 2", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/dps/second-wind.png" },
                    { title: "Gauss Round", type: "Instant, Physical, Ranged", cost: 0, uses: 1, uses_max: 1, trigger: "Any time", target: "Single", range: "10 squares", baseEffect: "Deals 5 damage to the target.", limitation: "Once per phase", hitType: "None", damageType: "Damage", baseValue: "5", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/MCH/gauss-round.png" }
                ],
                limit: [
                    { title: "Satellite Beam", type: "Limit Break, Physical", cost: 0, uses: 1, uses_max: 1, condition: "Limit Breaks have been made available for this encounter.", trigger: "Any time during your turn as a primary action", target: "All enemies within range", range: "A 5x area extending in a straight line across the entire encounter map from 1 square adjacent to this character.", baseEffect: "Deals 6d6 + 20 damage to all targets.", hitType: "None", damageType: "Damage", baseValue: "6d6 + 20", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/General/limit-break.png" }
                ]
            }
        },
        mnk: {
            job: "MNK",
            jobIcon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Jobs/MNK.png",
            role: "DPS / Monk",
            level: 30,
            resources: { 
                hitPoints: 26, hitPoints_max: 26, magicPoints: 5, magicPoints_max: 5, 
                resource: "Chakra", resourceValue: 3, resourceValue_max: 3, 
                resource2: "none", resource2Value: 0, resource2Value_max: 0, 
                resource3: "none", resource3Value: 0, resource3Value_max: 0, 
                range1: 0, range1_max: 0, range2: 0, range2_max: 1, range3: 0, range3_max: 2, 
                resourceReset: "full", hasBestial: "false", hasNadi: "false", hasOpo: "false", hasTechniques: "false"
            },
            attributes: { str: 4, dex: 3, vit: 2, int: 1, mnd: 2, defense: 14, magicDefense: 13, vigilance: 12, speed: 5 },
            traits: [
                { title: "Martial Forms", effect: "Certain effects grant you Opo-Opo Form, Raptor Form, or Coeur Form. While under the effect of a form, receive one advantage die on you ability checks for physical abilities.\n\nIf an effect grants you a new form, your current form is removed and the new form immediately takes effect. Forms are removed at the end your next turn." },
                { title: "Deep Meditation", effect: "Certain effects grant you Chakra. You can have up to 3 Chakra at any given time. At the start of an encounter, gain 3 Chakra." },
                { title: "Bestial Fury", effect: "Certain effects grant you Raptor's Fury and Coeurl's Fury. You can have up to 1 stack of Raptor's Fury and 2 stacks of Coeurl's Fury at any given time.\n\nWhenever you resolve the effects of an ability that enables this trait, you may spend 1 stack of the corresponding beast's Fury to deal an additional 1d6 damage and move up to 2 squares." }
            ],
            abilities: {
                primary: [
                    { title: "Monk Combo", type: "Primary", cost: 0, uses: 0, uses_max: 0, baseEffect: "You may perform up to three additional primary actions this turn. They primary actions granted by this effect can only be used for physical primary abilities.", hitType: "None", damageType: "Effect", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/MNK/monk-combo.png" },
                    { title: "True Strike", type: "Primary, Physical", condition: "Under the effect of Raptor Form", cost: 0, uses: 0, uses_max: 0, target: "Single", range: "1 square", check: "STR (d20 + 4)", cr: "Target's Defense", baseEffect: "Deals 2 damage to the target, grants Coeurl Form, and enables Bestial Fury: Raptor.", directHit: "Deals an additional 1d6 damage.", stat: "STR", hitType: "Hit", damageType: "Damage", hitDie: "1d20cs20", baseValue: "2", dhValue: "1d6", effectSelf: "Coeurl Form", combo: "Bestial Fury: Raptor(cost:1 range2|roll:1d6)", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/MNK/true-strike.png" },
                    { title: "Snap Punch", type: "Primary, Physical", condition: "Under the effect of Coeurl Form", cost: 0, uses: 0, uses_max: 0, target: "Single", range: "1 square", check: "STR (d20 + 4)", cr: "Target's Defense", baseEffect: "Deals 2 damage to the target, grants Opo-Opo Form, and enables Bestial Fury: Coeurl.", directHit: "Deals an additional 1d6 damage.", stat: "STR", hitType: "Hit", damageType: "Damage", hitDie: "1d20cs20", baseValue: "2", dhValue: "1d6", effectSelf: "Opo-Opo Form", combo: "Bestial Fury: Coeurl(cost:1 range3|roll:1d6)", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/MNK/snap-punch.png" },
                    { title: "Bootshine", type: "Primary, Physical", cost: 0, uses: 0, uses_max: 0, target: "Single", range: "1 square", check: "STR (d20 + 4)", cr: "Target's Defense", baseEffect: "Deals 2 damage to the target, grants Raptor Form. If this ability is used while under the effect of Opo-Opo Form and results in a direct hit, it automatically scores a critical as well.", directHit: "Deals an additional 1d6 damage.", stat: "STR", hitType: "Hit", damageType: "Damage", hitDie: "1d20cs20", baseValue: "2", dhValue: "1d6", effectSelf: "Raptor Form", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/MNK/bootshine.png" },
                    { title: "Twin Snakes", type: "Primary, Physical", condition: "Under the effect of Raptor Form", cost: 0, uses: 0, uses_max: 0, target: "Single", range: "1 square", check: "STR (d20 + 4)", cr: "Target's Defense", baseEffect: "Deals 2 damage to the target. Grants Coeurl Form, and 1 stack of Raptor's Fury.", directHit: "Deals an additional 2 damage.", stat: "STR", hitType: "Hit", damageType: "Damage", hitDie: "1d20cs20", baseValue: "2", dhValue: "2", restore: "1 range2", effectSelf: "Coeurl Form", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/MNK/twin-snakes.png" },
                    { title: "Demolish", type: "Primary, Physical", condition: "Under the effect of Coeurl Form", cost: 0, uses: 0, uses_max: 0, target: "Single", range: "1 square", check: "STR (d20 + 4)", cr: "Target's Defense", baseEffect: "Deals 2 damage to the target. Grants Opo-Opo Form and 2 stacks of Coeurl's Fury.", directHit: "Deals an additional 2 damage.", stat: "STR", hitType: "Hit", damageType: "Damage", hitDie: "1d20cs20", baseValue: "2", dhValue: "2", restore: "2 range3", effectSelf: "Opo-Opo Form", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/MNK/demolish.png" },
                    { title: "Arm of the Destroyer", type: "Primary, Physical", cost: 0, uses: 0, uses_max: 0, target: "All enemies within range", range: "A 3x3 area centered on this character", check: "STR (d20 + 4)", cr: "Target's Defense", baseEffect: "Deals 2 damage to all targets and grants Raptor Form.", directHit: "Deals an additional 2 damage.", stat: "STR", hitType: "Hit", damageType: "Damage", hitDie: "1d20cs20", baseValue: "2", dhValue: "2", effectSelf: "Raptor Form", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/MNK/arm-of-the-destroyer.png" },
                    { spacer: true },
                    { title: "Rockbreaker", type: "Primary, Physical", condition: "Under the effect of Coeurl Form", cost: 0, uses: 0, uses_max: 0, target: "All enemies within range", range: "A 3x3 area centered on this character", check: "STR (d20 + 4)", cr: "Target's Defense", baseEffect: "Deals 2 damage to all targets and grants Opo-Opo Form.", directHit: "Deals an additional 1d6 damage.", stat: "STR", hitType: "Hit", damageType: "Damage", hitDie: "1d20cs20", baseValue: "2", dhValue: "1d6", effectSelf: "Opo-Opo Form", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/MNK/rockbreaker.png" }
                ],
                secondary: [
                    { title: "Leg Sweep", type: "Secondary, Physical", cost: 0, uses: 1, uses_max: 1, target: "Single", range: "1 square", baseEffect: "Stuns the target until the end of this turn.", limitation: "Once per phase", hitType: "None", damageType: "Effect", effectTarget: "Stun", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/Melee/leg-sweep.png" },
                    { title: "Meditation", type: "Secondary", cost: 0, uses: 0, uses_max: 0, baseEffect: "Grants 1 Chakra.", hitType: "None", damageType: "Effect", restore: "1 Chakra", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/MNK/meditation.png" },
                    { title: "Steel Peak", type: "Secondary, Physical", cost: 3, resource: "Chakra", uses: 0, uses_max: 0, target: "Single", range: "1 square", baseEffect: "Deals 4 damage to the target.", hitType: "None", damageType: "Damage", baseValue: "4", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/MNK/steel-peak.png" },
                    { title: "Bloodbath", type: "Secondary", cost: 0, uses: 1, uses_max: 1, baseEffect: "Grants Drain(2) until the end of this turn.", limitation: "Once per phase", hitType: "None", damageType: "Effect", effectSelf: "Bloodbath(2)", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/Melee/bloodbath.png" }
                ],
                instant: [
                    { title: "Second Wind", type: "Instant", cost: 0, uses: 1, uses_max: 1, trigger: "When any character ends their turn", baseEffect: "Restores 1d6 + 2 HP", limitation: "Once per phase", hitType: "None", damageType: "Healing", baseValue: "1d6 + 2", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/dps/second-wind.png" },
                    { title: "Feint", type: "Instant, Physical", cost: 0, uses: 1, uses_max: 1, trigger: "Immediately before an ability used by an enemy is resolved.", target: "The enemy that triggered this ability.", range: "2 squares", baseEffect: "Reduces the damage dealt by the target's abilities by 2 until the end of this turn.", limitation: "Once per phase", hitType: "None", damageType: "Effect", effectTarget: "Feint", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/Melee/feint.png" }
                ],
                limit: [
                    { title: "Final Heaven", type: "Limit Break", cost: 0, uses: 1, uses_max: 1, condition: "Limit Breaks have been made available for this encounter.", trigger: "Any time", baseEffect: "Immediately perform a primary action.", hitType: "None", damageType: "Effect", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/General/limit-break.png" }
                ]
            }
        },
        nin: {
            job: "NIN",
            jobIcon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Jobs/NIN.png",
            role: "DPS / Ninja",
            level: 30,
            resources: { 
                hitPoints: 26, hitPoints_max: 26, magicPoints: 5, magicPoints_max: 5, 
                resource: "Mudra", resourceValue: 0, resourceValue_max: 3, 
                resource2: "none", resource2Value: 0, resource2Value_max: 0,
                resource3: "none", resource3Value: 0, resource3Value_max: 0,
                range1: 0, range1_max: 0, range2: 0, range2_max: 0, range3: 0, range3_max: 0, 
                resourceReset: "", hasBestial: "false", hasNadi: "false", hasOpo: "false", hasTechniques: "false" 
            },
            attributes: { str: 1, dex: 5, vit: 2, int: 1, mnd: 3, defense: 13, magicDefense: 12, vigilance: 13, speed: 5 },
            traits: [
                { title: "Sign Weaver", effect: "Certain effects grant you Mudra. You can have up to 1 Mudra at any given time. All Mudra are removed when you perform an action other than Ritual Weave." },
                { title: "Hide", effect: "At the start of an encounter, grants Hidden unless you were caught by surprise." },
                { title: "Hidden", effect: "While under the effect of Hidden, receive one advantage die on your ability checks. Hidden is removed when you take or deal damage or perform a primary or secondary action." },
                { title: "Ninjutsu Cooldown", effect: "Ninjutsu Cooldown is an enhancement, and cannot be removed by effects that remove enfeeblements. Ninjutsu Cooldown is removed at the end of your next turn." }
            ],
            abilities: {
                primary: [
                    { title: "Ninja Combo (Spinning Edge + Gust Slash)", type: "Primary, Physical", cost: 0, uses: 0, uses_max: 0, target: "Single", range: "1 square", check: "DEX (d20 + 5)", cr: "Target's Defense", baseEffect: "Deals 2 damage to the target. Combo: Aeolian Edge.", directHit: "Deals an additional 2d6 damage.", stat: "DEX", hitType: "Hit", damageType: "Damage", hitDie: "1d20cs20", baseValue: "2", dhValue: "2d6", combo: "Aeolian Edge", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/NIN/ninja-combo.png" },
                    { title: "Throwing Dagger", type: "Primary, Physical", cost: 0, uses: 0, uses_max: 0, target: "Single", range: "5 squares", check: "DEX (d20 + 5)", cr: "Target's Defense", baseEffect: "Deals 3 damage to the target.", directHit: "Deals an additional 2d6 damage.", stat: "DEX", hitType: "Hit", damageType: "Damage", hitDie: "1d20cs20", baseValue: "3", dhValue: "2d6", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/NIN/throwing-dagger.png" },
                    { title: "Ninjutsu", type: "Primary", cost: 0, uses: 0, uses_max: 0, condition: "1 or more Mudra and not under the effect of Ninjutsu Cooldown", target: "Single", baseEffect: "Immediately use one of your ninjutsu abilities. Some ninjutsu abilities can only be used if you spend 1 or more Mudra for this ability. Grants Ninjutsu Cooldown after resolving the ninjutsu ability's effects.", hitType: "None", damageType: "Effect", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/NIN/ninjutsu.png" },
                    { title: "Aeolian Edge", type: "Primary, Physical", cost: 0, uses: 0, uses_max: 0, target: "Single", range: "1 square", check: "DEX (d20 + 5)", cr: "Target's Defense", baseEffect: "Deals 2 damage to the target.", directHit: "Deals an additional 2d6 damage.", stat: "DEX", hitType: "Hit", damageType: "Damage", hitDie: "1d20cs20", baseValue: "2", dhValue: "2d6", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/NIN/aeolian-edge.png" }
                ],
                ninjutsu: [
                    { title: "Fuma Shuriken", type: "Primary, Phyical, Ninjutsu", cost: 1, resource: "Mudra", uses: 0, uses_max: 0, target: "Single", range: "12 squares", baseEffect: "Deals 10 damage to the target.", hitType: "None", damageType: "Damage", baseValue: "10", effectSelf: "Ninjutsu Cooldown", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/NIN/fuma-shuriken.png" }
                ],
                secondary: [
                    { title: "Leg Sweep", type: "Secondary, Physical", cost: 0, uses: 1, uses_max: 1, target: "Single", range: "1 square", baseEffect: "Stuns the target until the end of this turn.", limitation: "Once per phase", hitType: "None", damageType: "Effect", effectTarget: "Stun", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/Melee/leg-sweep.png" },
                    { title: "Mug", type: "Secondary, Physical", cost: 0, uses: 1, uses_max: 1, target: "Single", range: "1 square", baseEffect: "Increases the damage the target takes from abilities by 1 until the start of your next turn", limitation: "Once per phase", hitType: "None", damageType: "Effect", effectTarget: "Mug(1)", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/NIN/mug.png" },
                    { title: "Ritual Weave", type: "Secondary", cost: 0, uses: 0, uses_max: 0, baseEffect: "Grants 1 Mudra.", hitType: "None", damageType: "Effect", restore: "1 Mudra", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/NIN/ritual-weave.png" },
                    { title: "Bloodbath", type: "Secondary", cost: 0, uses: 1, uses_max: 1, baseEffect: "Grants Drain(2) until the end of this turn.", limitation: "Once per phase", hitType: "None", damageType: "Effect", effectSelf: "Bloodbath(2)", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/Melee/bloodbath.png" }
                ],
                instant: [
                    { title: "Shade Shift", type: "Instant", cost: 0, uses: 1, uses_max: 1, trigger: "Immediately after an ability check for an ability that targets you.", baseEffect: "Increases your Defense and Magic Defense by 1d6 for the ability check that triggered Shade Shift. Use this new value to determine if the ability scores a direct hit.", limitation: "Once per phase", hitType: "None", damageType: "Defense", baseValue: "1d6", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/NIN/shade-shift.png" },
                    { title: "Trick Attack", type: "Instant, Physical", cost: 0, uses: 0, uses_max: 0, condition: "Under the effect of Hidden", trigger: "Any time", target: "Single", range: "1 square", baseEffect: "Deals 2d6 damage to the target and grants one advantage die on your next ability check.", hitType: "None", damageType: "Damage", baseValue: "2d6", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/NIN/trick-attack.png" },
                    { title: "Feint", type: "Instant, Physical", cost: 0, uses: 1, uses_max: 1, trigger: "Immediately before an ability used by an enemy is resolved.", target: "The enemy that triggered this ability.", range: "2 squares", baseEffect: "Reduces the damage dealt by the target's abilities by 2 until the end of this turn.", limitation: "Once per phase", hitType: "None", damageType: "Effect", effectTarget: "Feint", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/Melee/feint.png" },
                    { title: "Second Wind", type: "Instant", cost: 0, uses: 1, uses_max: 1, trigger: "When any character ends their turn", baseEffect: "Restores 1d6 + 2 HP", limitation: "Once per phase", hitType: "None", damageType: "Healing", baseValue: "1d6 + 2", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/dps/second-wind.png" }
                ],
                limit: [
                    { title: "Chimatsuri", type: "Limit Break, Physical", cost: 0, uses: 1, uses_max: 1, condition: "Limit Breaks have been made available for this encounter.", trigger: "Any time", target: "Single", range: "1 square", baseEffect: "Deals 4d6 damage to the target and grants Hidden.", hitType: "None", damageType: "Damage", baseValue: "4d6", effectSelf: "Hidden", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/General/limit-break.png" }
                ]
            }
        },
        pld: {
            job: "PLD",
            jobIcon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Jobs/PLD.png",
            role: "Tank / Paladin",
            level: 30,
            resources: {
                hitPoints: 35, hitPoints_max: 35, magicPoints: 5, magicPoints_max: 5,
                resource: "", resourceValue: 0, resourceValue_max: 0, 
                resource2: "none", resource2Value: 0, resource2Value_max: 0, 
                resource3: "none", resource3Value: 0, resource3Value_max: 0, 
                range1: 0, range1_max: 0, range2: 0, range2_max: 0, range3: 0, range3_max: 0, 
                resourceReset: "", hasBestial: "false", hasNadi: "false", hasOpo: "false", hasTechniques: "false"
            },
            attributes: { str: 4, dex: 0, vit: 5, int: 1, mnd: 2, defense: 16, magicDefense: 13, vigilance: 12, speed: 5 },
            traits: [
                { title: "Combo", effect: "After resolving the effects of an ability with Combo, you may use one of the specified abilities at any point during your turn. You may move before doing so, and may choose a new target when using this additional ability." }
            ],
            abilities: {
                primary: [
                    { title: "Paladin Combo (Fast Blade + Riot Blade)", type: "Primary, Physical", cost: 0, uses: 0, uses_max: 0, target: "Single", range: "1 square", check: "STR (d20 + 4)", cr: "Target's Defense", baseEffect: "Deals 2 damage and inflicts Enmity on the target. Combo: Rage of Halone", directHit: "Deals an additional 1d6 damage.", stat: "STR", hitType: "Hit", damageType: "Damage", hitDie: "1d20cs20", baseValue: "2", dhValue: "1d6", effectTarget: "Enmity(5)", combo: "Rage of Halone", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/PLD/paladin-combo.png" },
                    { title: "Total Eclipse", type: "Primary, Physical", cost: 0, uses: 0, uses_max: 0, target: "All targets within range", range: "A 5x5 area centered on this character", check: "STR (d20 + 4)", cr: "Target's Defense", baseEffect: "Inflicts Enmity on all targets.", directHit: "Deals 2 damage to all targets.", stat: "STR", hitType: "Hit", damageType: "Damage", hitDie: "1d20cs20", baseValue: "", dhValue: "2", effectTarget: "Enmity(5)", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/PLD/total-eclipse.png" },
                    { title: "Shield Lob", type: "Primary, Physical", cost: 0, uses: 0, uses_max: 0, target: "Single", range: "5 squares", check: "STR (d20 + 4)", cr: "Target's Defense", baseEffect: "Deals 2 damage and inflicts Enmity on the target.", directHit: "Deals an additional 1d6 damage.", stat: "STR", hitType: "Hit", damageType: "Damage", hitDie: "1d20cs20", baseValue: "2", dhValue: "1d6", effectTarget: "Enmity(5)", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/PLD/shield-lob.png" },
                    { title: "Rage of Halone", type: "Primary, Physical", cost: 0, uses: 0, uses_max: 0, target: "Single", range: "1 square", check: "STR (d20 + 4)", cr: "Target's Defense", baseEffect: "Deals 2 damage and inflicts Enmity on the target.", directHit: "Deals an additional 1d6 damage.", stat: "STR", hitType: "Hit", damageType: "Damage", hitDie: "1d20cs20", baseValue: "2", dhValue: "1d6", effectTarget: "Enmity(5)", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/PLD/rage-of-halone.png" },
                    { title: "Shield Bash", type: "Primary, Physical", cost: 0, uses: 0, uses_max: 0, target: "Single", range: "1 square", check: "STR (d20 + 4)", cr: "Target's Defense", baseEffect: "Deals 3 damage, inflicts Enmity and stuns the target until the end of this turn.", directHit: "Deals an additional 1d6 damage.", stat: "STR", hitType: "Hit", damageType: "Damage", hitDie: "1d20cs20", baseValue: "3", dhValue: "1d6", effectTarget: "Stun & Enmity:Stun, Enmity(5)", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/PLD/shield-bash.png" }
                ],
                secondary: [
                    { title: "Rampart", type: "Secondary", cost: 0, uses: 1, uses_max: 1, baseEffect: "Reduces the damage you take from abilities by 2 until the start of your next turn.", limitation: "Once per phase", hitType: "None", damageType: "Effect", effectSelf: "Rampart(2)", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/Tank/rampart.png" },
                    { title: "Low Blow", type: "Secondary, Physical", cost: 0, uses: 0, uses_max: 0, target: "Single", range: "1 square", baseEffect: "Stuns the target until the end of this turn.", hitType: "None", damageType: "Effect", effectTarget: "Stun", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/Tank/low-blow.png" },
                    { title: "Spirits Within", type: "Secondary, Physical", cost: 0, uses: 2, uses_max: 2, target: "Single", range: "1 square", baseEffect: "Deals 2 damage and inflicts Enmity on the target.", hitType: "None", damageType: "Damage", baseValue: "2", effectTarget: "Enmity(5)", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/PLD/spirits-within.png" }
                ],
                instant: [
                    { title: "Sturdy Shield", type: "Instant", cost: 0, uses: 0, uses_max: 0, trigger: "Immediately after an ability check for an ability that targets you.", baseEffect: "Increases your Defense by 1d6 for the ability check that triggered Sturdy Shield. Use this new value to determine if the ability scores a direct hit.", limitation: "Once per round", hitType: "None", damageType: "Defense", baseValue: "1d6 + @{defense}[Defense]", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/PLD/sturdy-shield.png" },
                    { title: "Provoke", type: "Instant", cost: 0, uses: 1, uses_max: 1, trigger: "When an enemy begins their turn", target: "The enemy that triggered this ability", range: "10 squares", baseEffect: "Inflicts Enmity on the target.", limitation: "Once per phase", hitType: "None", damageType: "Effect", effectTarget: "Enmity(5)", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/Tank/provoke.png" },
                    { title: "Reprisal", type: "Instant", cost: 0, uses: 1, uses_max: 1, trigger: "Immediately before an ability used by an enemy within 2 squares is resolved", target: "All enemies within range", range: "A 5x5 area centered on this character", baseEffect: "Reduces the damage dealt by the abilities of all targets by 2 until the end of this round.", limitation: "Once per phase", hitType: "None", damageType: "Effect", effectTarget: "Reprisal(2)", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/Tank/reprisal.png" },
                    { title: "Fight or Flight", type: "Instant", cost: 0, uses: 1, uses_max: 1, trigger: "Any time during your turn", baseEffect: "Grants one advantage die on your next ability check this turn.", limitation: "Once per phase.", hitType: "None", damageType: "Effect", effectSelf: "Fight or Flight", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/PLD/fight-or-flight.png" },
                    { title: "Interject", type: "Instant", cost: 0, uses: 1, uses_max: 1, trigger: "When an adjacent enemy uses an invoked ability, or is using an invoked ability to generate a marker", target: "The enemy that triggered this ability", range: "1 square", baseEffect: "Interrupts the invoked ability that triggered Interject, negating it completely.", limitation: "Once per phase", hitType: "None", damageType: "Effect", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/Tank/interject.png" }
                ],
                limit: [
                    { title: "Last Bastion", type: "Limit Break, Physical", cost: 0, uses: 1, uses_max: 1, condition: "Limit Breaks have been made available for this encounter.", trigger: "Immediately before 1 or more allied adventurers take damage", baseEffect: "Halves the damage (rounded up) taken from the effect that triggered Last Bastion, then restores 3d6 HP and removes a single enfeeblement from all allies. Each ally may choose which enfeeblement to remove.", hitType: "None", damageType: "Healing", baseValue: "3d6", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/General/limit-break.png" }
                ]
            }
        },
        sch: {
            job: "SCH",
            jobIcon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Jobs/SCH.png",
            role: "Healer / Scholar",
            level: 30,
            resources: {
                hitPoints: 24, hitPoints_max: 24, magicPoints: 5, magicPoints_max: 5,
                resource: "", resourceValue: 0, resourceValue_max: 0, 
                resource2: "none", resource2Value: 0, resource2Value_max: 0, 
                resource3: "none", resource3Value: 0, resource3Value_max: 0, 
                range1: 0, range1_max: 0, range2: 0, range2_max: 0, range3: 0, range3_max: 0, 
                resourceReset: "", hasBestial: "false", hasNadi: "false", hasOpo: "false", hasTechniques: "false"
            },
            attributes: { str: 0, dex: 1, vit: 2, int: 4, mnd: 5, defense: 12, magicDefense: 15, vigilance: 15, speed: 5 },
            traits: [
                { title: "Summon Eos", effect: "At the start of an encounter, summon the faerie Eos in your starting square. Eos is resummoned any time you recover from being Knocked Out, as well at the start of a new phase if she isn't already present on the encounter map." },
                { title: "Eos", effect: "You can summon a pet (Eos) to aid you during encounters. Your pet is immune to all effects other than those caused by your traits and abilities, and can enter and end its movement in occupied squares. Other characters may also move through or end their turn in the same square as your pet. So long as your pet remains on the encounter map, you benefit from the effects of its traits.\n  During encounters, your pet takes its turn immediately before you. On its turn, a pet can perform a standard movement action to move up to its Speed and use one of its abilities. It cannot perform any other actions.\n  Your pet is immediately dismissed and removed from the encounter map when you are Knocked Out.\n  If your pet is already present on the encounter map, any effects that would summon a pet are ignored." }
            ],
            abilities: {
                primary: [
                    { title: "Ruin", type: "Primary, Magic, Invoked", cost: 1, uses: 0, uses_max: 0, resource: "MP", target: "Single", range: "10 squares", check: "MND (d20 + 5)", cr: "Target's Magic Defense", baseEffect: "Deals 2 damage to the target.", directHit: "Deals an additional 1d6 damage.", stat: "MND", hitType: "Hit", damageType: "Damage", hitDie: "1d20cs20", baseValue: "2", dhValue: "1d6", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/SCH/ruin.png" },
                    { title: "Resurrection", type: "Primary, Magic, Invoked", cost: 3, uses: 0, uses_max: 0, resource: "MP", target: "1 Knocked Out character", range: "5 squares*", check: "Special (d20, Critical)", baseEffect: "Removes Knocked Out from the target, then restores 1d6 + 2 HP, grants Transcendent, and afflicts them with Weakness. *This ability can also target a character outside the encounter map. When doing so, move the target to an empty square within range after resolving the ability's effects.", hitType: "Critical", damageType: "Healing", hitDie: "1d20cs20", baseValue: "1d6 + 2", effectTarget: "Raise", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/SCH/resurrection.png" },
                    { title: "Adloqium", type: "Primary, Magic, Invoked", cost: 2, uses: 0, uses_max: 0, resource: "MP", target: "Single", range: "10 squares", check: "Special (d20, Critical)", baseEffect: "Restores 1d6 + 3 HP and grants a barrier equalling the amount restored to the target.", hitType: "Critical", damageType: "Healing", hitDie: "1d20cs20", baseValue: "1d6 + 3", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/SCH/adloqium.png" },
                    { title: "Repose", type: "Primary, Magic, Invoked", cost: 2, uses: 0, uses_max: 0, resource: "MP", target: "Single", range: "10 squares", check: "MND (d20 + 4)", cr: "Target's Magic Defense", baseEffect: "Inflicts Sleep on target.", directHit: "Removes all markers generated by the target.", stat: "MND", hitType: "Hit", damageType: "Effect", hitDie: "1d20cs20", effectTarget: "Sleep", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/Healer/repose.png" }
                ],
                secondary: [
                    { title: "Bio II", type: "Secondary, Magic", cost: 1, uses: 0, uses_max: 0, resource: "MP", target: "Single", range: "10 squares", baseEffect: "Deals 1 damage and inflicts a DOT(3) on the target.", hitType: "None", damageType: "Damage", baseValue: "1", effectTarget: "Bio(3)", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/SCH/bio-ii.png" },
                    { title: "Heel", type: "Secondary", cost: 0, uses: 0, uses_max: 0, target: "Your pet", range: "The entire encounter map", baseEffect: "Move your pet to 1 square occupied by this character.", hitType: "None", damageType: "Effect", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/PET/heel.png" },
                    { title: "Lucid Dreaming", type: "Secondary", cost: 0, uses: 1, uses_max: 1, baseEffect: "Recover an additional 1 MP at the end of this round's [Adventurer Step].", limitation: "Once per phase", hitType: "None", damageType: "Effect", effectSelf: "Lucid Dreaming", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/Caster/lucid-dreaming.png" },
                    { title: "Physick", type: "Secondary, Magic, Invoked", cost: 1, uses: 0, uses_max: 0, resource: "MP", target: "Single", range: "10 squares", check: "Special (d20, Critical)", baseEffect: "Restores 1d6 HP to the target.", hitType: "Critical", damageType: "Healing", baseValue: "1d6", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/SCH/physick.png" },
                    { title: "Esuna", type: "Secondary, Magic, Invoked", cost: 1, uses: 0, uses_max: 0, resource: "MP", target: "Single", range: "10 squares", baseEffect: "Removes a single enfeeblement of the target's choosing.", hitType: "None", damageType: "Effect", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/Healer/esuna.png" }
                ],
                instant: [
                    { title: "Swiftcast", type: "Instant", cost: 0, uses: 1, uses_max: 1, trigger: "When any character ends their turn", baseEffect: "Immediately use one of your magic abilities.", limitation: "Once per phase", hitType: "None", damageType: "Effect", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/Caster/swiftcast.png" }
                ],
                limit: [
                    { title: "Angel Feathers", type: "Limit Break", cost: 0, uses: 1, uses_max: 1, trigger: "Any time", condition: "Limit Breaks have been made available for this encounter.", target: "All allied adventurers within range", range: "The entire encounter map*", baseEffect: "Removes all enfeeblements from all targets, fully restores their HP, and grants them a barrier of 3d6 HP. Angel Feathers can remove Knocked Out, Weakness and Brink of Death. *This ability also targets characters outside the encounter map. When doing so, move these targets to an empty square within 5 squares of this character after resolving the ability's effects.", hitType: "None", damageType: "Effect", baseValue: "3d6", effectTarget: "Angel Feathers:Clear Enfeeblements,Heal(999)", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/General/limit-break.png" }
                ]
            }
        },
        war: {
            job: "WAR",
            jobIcon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Jobs/WAR.png",
            role: "Tank / Warrior",
            level: 30,
            resources: {
                hitPoints: 35, hitPoints_max: 35, magicPoints: 5, magicPoints_max: 5,
                resource: "", resourceValue: 0, resourceValue_max: 0, 
                resource2: "none", resource2Value: 0, resource2Value_max: 0, 
                resource3: "none", resource3Value: 0, resource3Value_max: 0, 
                range1: 0, range1_max: 0, range2: 0, range2_max: 0, range3: 0, range3_max: 0, 
                resourceReset: "", hasBestial: "false", hasNadi: "false", hasOpo: "false", hasTechniques: "false"
            },
            attributes: { str: 4, dex: 2, vit: 5, int: 0, mnd: 1, defense: 15, magicDefense: 12, vigilance: 11, speed: 5 },
            traits: [
                { title: "Combo", effect: "After resolving the effects of an ability with Combo, you may use one of the specified abilities at any point during your turn. You may move before doing so, and may choose a new target when using this additional ability." }
            ],
            abilities: {
                primary: [
                    { title: "Warrior Combo (Heavy Swing + Maim)", type: "Primary, Physical", cost: 0, uses: 0, uses_max: 0, target: "Single", range: "1 square", check: "STR (d20 + 4)", cr: "Target's Defense", baseEffect: "Deals 2 damage and inflicts Enmity on the target. Combo: Storm's Path", directHit: "Deals an additional 1d6 damage.", stat: "STR", hitType: "Hit", damageType: "Damage", hitDie: "1d20cs20", baseValue: "2", dhValue: "1d6", effectTarget: "Enmity(5)", combo: "Storm's Path", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/WAR/warrior-combo.png" },
                    { title: "Overpower", type: "Primary, Physical", cost: 0, uses: 0, uses_max: 0, target: "All targets within range", range: "A 5x5 area centered on this character", check: "STR (d20 + 4)", cr: "Target's Defense", baseEffect: "Inflicts Enmity on all targets.", directHit: "Deals 2 damage to all targets.", stat: "STR", hitType: "Hit", damageType: "Damage", hitDie: "1d20cs20", baseValue: "", dhValue: "2", effectTarget: "Enmity(5)", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/WAR/overpower.png" },
                    { title: "Tomahawk", type: "Primary, Physical", cost: 0, uses: 0, uses_max: 0, target: "Single", range: "5 squares", check: "STR (d20 + 4)", cr: "Target's Defense", baseEffect: "Deals 2 damage and inflicts Enmity on the target.", directHit: "Deals an additional 1d6 damage.", stat: "STR", hitType: "Hit", damageType: "Damage", hitDie: "1d20cs20", baseValue: "2", dhValue: "1d6", effectTarget: "Enmity(5)", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/WAR/tomahawk.png" },
                    { title: "Storm's Path", type: "Primary, Physical", cost: 0, uses: 0, uses_max: 0, target: "Single", range: "1 square", check: "STR (d20 + 4)", cr: "Target's Defense", baseEffect: "Deals 2 damage and inflicts Enmity on the target. Restores 2 HP.", directHit: "Deals an additional 1d6 damage.", stat: "STR", hitType: "Hit", damageType: "Damage", hitDie: "1d20cs20", baseValue: "2", dhValue: "1d6", restore: "2 HP", effectTarget: "Enmity(5)", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/WAR/storms-path.png" }
                ],
                secondary: [
                    { title: "Berserk", type: "Secondary", cost: 0, uses: 3, uses_max: 3, baseEffect: "Your abilities deal an additional 2 damage until the end of this turn.", limitation: "Three times per phase", hitType: "None", damageType: "Effect", hitDie: "1d20cs20", effectSelf: "Berserk(2)", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/WAR/berserk.png" },
                    { title: "Rampart", type: "Secondary", cost: 0, uses: 1, uses_max: 1, baseEffect: "Reduces the damage you take from abilities by 2 until the start of your next turn.", limitation: "Once per phase", hitType: "None", damageType: "Effect", effectSelf: "Rampart(2)", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/Tank/rampart.png" },
                    { title: "Low Blow", type: "Secondary, Physical", cost: 0, uses: 0, uses_max: 0, target: "Single", range: "1 square", baseEffect: "Stuns the target until the end of this turn.", hitType: "None", damageType: "Effect", effectTarget: "Stun", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/Tank/low-blow.png" }
                ],
                instant: [
                    { title: "Provoke", type: "Instant", cost: 0, uses: 1, uses_max: 1, trigger: "When an enemy begins their turn", target: "The enemy that triggered this ability", range: "10 squares", baseEffect: "Inflicts Enmity on the target.", limitation: "Once per phase", hitType: "None", damageType: "Effect", effectTarget: "Enmity(5)", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/Tank/provoke.png" },
                    { title: "Reprisal", type: "Instant", cost: 0, uses: 1, uses_max: 1, trigger: "Immediately before an ability used by an enemy within 2 squares is resolved", target: "All enemies within range", range: "A 5x5 area centered on this character", baseEffect: "Reduces the damage dealt by the abilities of all targets by 2 until the end of this round.", limitation: "Once per phase", hitType: "None", damageType: "Effect", effectTarget: "Reprisal(2)", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/Tank/reprisal.png" },
                    { title: "Thrill of Battle", type: "Instant", cost: 0, uses: 1, uses_max: 1, trigger: "Immediately before you take damage", baseEffect: "Restores 1d6 + 2 HP and grants a barrier equaling the amount of HP restored that exceeds your Max HP.", hitType: "None", damageType: "Healing", baseValue: "1d6 + 2", effectSelf: "Thrill of Battle", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/WAR/thrill-of-battle.png" },
                    { title: "Interject", type: "Instant", cost: 0, uses: 1, uses_max: 1, trigger: "When an adjacent enemy uses an invoked ability, or is using an invoked ability to generate a marker", target: "The enemy that triggered this ability", range: "1 square", baseEffect: "Interrupts the invoked ability that triggered Interject, negating it completely.", limitation: "Once per phase", hitType: "None", damageType: "Effect", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/Tank/interject.png" }
                ],
                limit: [
                    { title: "Land Waker", type: "Limit Break, Physical", cost: 0, uses: 1, uses_max: 1, condition: "Limit Breaks have been made available for this encounter.", trigger: "Immediately before 1 or more allied adventurers take damage", baseEffect: "Makes you the sole target of all damage inflicted by the effect that triggered Land Waker and halves the damage you take (rounded up). If Land Waker was triggered by an effect caused by a character, you may deal damage equaling the amount of HP you lost to that character.", hitType: "None", damageType: "Effect", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/General/limit-break.png" }
                ]
            }
        },
        whm: {
            job: "WHM",
            jobIcon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Jobs/WHM.png",
            role: "Healer / White Mage",
            level: 30,
            resources: {
                hitPoints: 24, hitPoints_max: 24, magicPoints: 5, magicPoints_max: 5,
                resource: "", resourceValue: 0, resourceValue_max: 0, 
                resource2: "none", resource2Value: 0, resource2Value_max: 0, 
                resource3: "none", resource3Value: 0, resource3Value_max: 0, 
                range1: 0, range1_max: 0, range2: 0, range2_max: 0, range3: 0, range3_max: 0, 
                resourceReset: "", hasBestial: "false", hasNadi: "false", hasOpo: "false", hasTechniques: "false"
            },
            attributes: { str: 1, dex: 1, vit: 2, int: 3, mnd: 5, defense: 11, magicDefense: 14, vigilance: 15, speed: 5 },
            traits: [
            ],
            abilities: {
                primary: [
                    { title: "Stone II", type: "Primary, Magic, Earth-Aspected, Invoked", cost: 1, uses: 0, uses_max: 0, resource: "MP", target: "Single", range: "10 squares", check: "MND (d20 + 5)", cr: "Target's Magic Defense", baseEffect: "Deals 2 damage to the target.", directHit: "Deals an additional 1d6 damage.", stat: "MND", hitType: "Hit", damageType: "Damage", hitDie: "1d20cs20", baseValue: "2", dhValue: "1d6", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/WHM/stone-ii.png" },
                    { title: "Medica", type: "Primary, Magic, Invoked", cost: 2, uses: 0, uses_max: 0, resource: "MP", target: "All allies within range", range: "a 5x5 area centered on this character", check: "Special (d20, Critical)", baseEffect: "Restores 1d6 + 3 HP to all targets.", hitType: "Critical", damageType: "Healing", hitDie: "1d20cs20", baseValue: "1d6 + 3", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/WHM/medica.png" },
                    { title: "Raise", type: "Primary, Magic, Invoked", cost: 3, uses: 0, uses_max: 0, resource: "MP", target: "1 Knocked Out character", range: "5 squares*", check: "Special (d20, Critical)", baseEffect: "Removes Knocked Out from the target, then restores 1d6 + 3 HP, grants Transcendent, and afflicts them with Weakness. *This ability can also target a character outside the encounter map. When doing so, move the target to an empty square within range after resolving the ability's effects.", stat: "MND", hitType: "Critical", damageType: "Healing", hitDie: "1d20cs20", baseValue: "1d6 + 3", effectTarget: "Raise", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/WHM/raise.png" },
                    { title: "Repose", type: "Primary, Magic, Invoked", cost: 2, uses: 0, uses_max: 0, resource: "MP", target: "Single", range: "10 squares", check: "MND (d20 + 5)", cr: "Target's Magic Defense", baseEffect: "Inflicts Sleep on target.", directHit: "Removes all markers generated by the target.", stat: "MND", hitType: "Hit", damageType: "Effect", hitDie: "1d20cs20", effectTarget: "Sleep", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/Healer/repose.png" },
                    { title: "Cure II", type: "Primary, Magic, Invoked", cost: 2, uses: 0, uses_max: 0, resource: "MP", target: "Single", range: "10 squares", check: "MND (d20 + 5)", baseEffect: "Restores 2d6 + 7 HP", stat: "MND", hitType: "Critical", damageType: "Healing", hitDie: "1d20cs20", baseValue: "2d6 + 7", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/WHM/cure-ii.png" }
                ],
                secondary: [
                    { title: "Cure", type: "Secondary, Magic, Invoked", cost: 1, uses: 0, uses_max: 0, resource: "MP", target: "Single", range: "10 squares", check: "Special (d20, Critical)", baseEffect: "Restores 1d6 + 1 HP to the target.", stat: "MND", hitType: "Critical", damageType: "Healing", hitDie: "1d20cs20", baseValue: "1d6 + 1", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/WHM/cure.png" },
                    { title: "Esuna", type: "Secondary, Magic, Invoked", cost: 1, uses: 0, uses_max: 0, resource: "MP", target: "Single", range: "10 squares", baseEffect: "Removes a single enfeeblement of the target's choosing.", hitType: "None", damageType: "Effect", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/Healer/esuna.png" },
                    { title: "Presence of Mind", type: "Secondary", cost: 0, uses: 1, uses_max: 1, resource: "MP", baseEffect: "Immediately use one of your magic abilities.", limitation: "Once per phase", hitType: "None", damageType: "Effect", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/WHM/presence-of-mind.png" },
                    { title: "Aero", type: "Secondary, Magic, Wind-Aspected", cost: 1, uses: 0, uses_max: 0, resource: "MP", target: "Single", range: "10 squares", baseEffect: "Inflicts a DOT (3) on the target.", hitType: "None", damageType: "Effect", effectTarget: "Aero(3)", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/WHM/aero.png" },
                    { title: "Lucid Dreaming", type: "Secondary", cost: 0, uses: 1, uses_max: 1, baseEffect: "Recover an additional 1 MP at the end of this round's [Adventurer Step].", limitation: "Once per phase", hitType: "None", damageType: "Effect", effectSelf: "Lucid Dreaming", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/Caster/lucid-dreaming.png" }
                ],
                instant: [
                    { title: "Swiftcast", type: "Instant", cost: 0, uses: 1, uses_max: 1, trigger: "When any character ends their turn", baseEffect: "Immediately use one of your magic abilities.", limitation: "Once per phase", hitType: "None", damageType: "Effect", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/Caster/swiftcast.png" }
                ],
                limit: [
                    { title: "Pulse of Life", type: "Limit Break", cost: 0, uses: 1, uses_max: 1, trigger: "Any time", condition: "Limit Breaks have been made available for this encounter.", target: "All allied adventurers within range", range: "The entire encounter map*", baseEffect: "Removes all enfeeblements from all targets and fully restores their HP and MP. Pulse of Life can remove Knocked Out, Weakness and Brink of Death. *This ability also targets characters outside the encounter map. When doing so, move these targets to an empty square within 5 squares of this character after resolving the ability's effects.", hitType: "None", damageType: "Effect", effectTarget: "Pulse of Life:Clear Enfeeblements,Heal(999),Restore Magic(99)", icon: "https://raw.githubusercontent.com/p-dahlback/roll20-ffxiv-ttrpg/refs/heads/main/Images/Abilities/General/limit-break.png" }
                ]
            }
        }
    }
};

this.export.sheets = sheets;

// Build (version 1.0.0): Source/workers/main/setup/sheetSetup.js


const SheetSetup = function() {
    this.execute = function(sheet) {
        this.clearAllAbilitiesAndEffects(() => {
            engine.logd("Clear complete; initializing sheet");
            var attributes = {
                job: sheet.job,
                jobIcon: sheet.jobIcon,
                level: sheet.level ?? 30,
                role: sheet.role,
                sheet_type: "unique",
                team: "adventurer",
                size: "normal"
            };
            attributes.override = sheet.override ?? "auto";
            attributes.barrierPoints = 0;

            engine.logd("Preparing resources");
            for (let entry of Object.entries(sheet.resources)) {
                attributes[entry[0]] = entry[1];
            }

            engine.logd("Preparing base attributes");
            for (let entry of Object.entries(sheet.attributes)) {
                attributes[entry[0]] = entry[1];
                attributes[`${entry[0]}Effective`] = entry[1];
                attributes[`${entry[0]}Display`] = entry[1];
                attributes[`${entry[0]}Unblocked`] = entry[1];
                attributes[`${entry[0]}Override`] = 0;
            }
            attributes.mpRecovery = 2;
            attributes.mpRecoveryBlock = "off";

            if (sheet.traits) {
                engine.logd("Preparing traits");
                for (let trait of sheet.traits) {
                    let id = engine.generateId();
                    for (let entry of Object.entries(trait)) {
                        attributes[`repeating_traits_${id}_${entry[0]}`] = entry[1];
                        attributes[`repeating_traits_${id}_icon`] = sheet.jobIcon;
                        attributes[`repeating_traits_${id}_automatic`] = "1";
                        attributes[`repeating_traits_${id}_editable`] = "off";
                    }
                }
            }

            if (sheet.abilities) {
                engine.logd("Preparing abilities");
                for (let section of Object.entries(sheet.abilities)) {
                    for (let index in section[1]) {
                        let ability = section[1][index];
                        if (ability.spacer) {
                            continue;
                        }
                        let sectionName;
                        if (section[0] === "limit") {
                            sectionName = section[0];
                        } else {
                            let column = (index % 3) + 1;
                            sectionName = `${section[0]}${column}`;
                        }
                        let id = engine.generateId();
                        for (let entry of Object.entries(ability)) {
                            attributes[`repeating_${sectionName}_${id}_${entry[0]}`] = entry[1];
                        }
                        attributes[`repeating_${sectionName}_${id}_repeatingOverride`] = "auto";
                    }
                }
            }
            setAttrs(attributes);
        });
    };

    this.clearAllAbilitiesAndEffects = function(completion) {
        engine.logd(`Clearing abilities and effects`);
        let sections = abilitySections.concat(["traits", "effects"]);
        const ThreadLessPromise = class {
            constructor(count, completion) {
                this.count = count;
                this.completions = 0;
                this.completion = completion;
            }

            complete() {
                this.completions += 1;
                engine.logd(`Completed cleanup ${this.completions}/${this.count}`);
                if (this.completions >= this.count) {
                    this.completion();
                }
            }
        };
        let promise = new ThreadLessPromise(sections.length, completion);

        for (let section of sections) {
            getSectionIDs(`repeating_${section}`, ids => {
                let attributes = ids.map(id => `repeating_${section}_${id}_automatic`);
                getAttrs(attributes, values => {
                    for (let id of ids) {
                        if (section == "traits") {
                            // Only remove auto-added traits
                            if (values[`repeating_${section}_${id}_automatic`] === "1") {
                                removeRepeatingRow(`repeating_${section}_${id}`);
                            }
                        } else {
                            removeRepeatingRow(`repeating_${section}_${id}`);
                        }
                    }
                    promise.complete();
                });
            });
        }
    };
};

const sheetSetup = new SheetSetup();
this.export.SheetSetup = SheetSetup;
this.export.sheetSetup = sheetSetup;


})();

// Build: Source/workers/main.js



// Automatic sheet assignment
const imports = mainImports.export;

on("change:job", () => {
    getAttrs(["level", "job"], values => {
        let job = values.job.toLowerCase();
        let sheet = imports.sheets[job];
        if (!sheet) {
            let level = values.level ?? 30;
            log(`Setting up ${job} sheet for level ${level}`);
            let levelSheets = imports.sheets[`level${level}`];
            if (!levelSheets) {
                log(`No sheets found for level ${level}.`);
                return;
            }

            sheet = levelSheets[job];
            if (!sheet) {
                log(`No sheet found for ${job} at level ${level}.`);
                return;
            }
        }
        imports.sheetSetup.execute(sheet);
    });
});

on("change:team", () => {
    getAttrs(["team"], values => {
        if (values.team === "enemy") {
            // By default enemies add themselves to turn order by random roll
            setAttrs({
                turnOrderStyle: "roll"
            });
        }
    });
});

// MP Max
on("change:magicPoints", () => {
    imports.engine.getAttrsAndEffects(["magicPoints", "magicPoints_max"], (values, effects) => {
        var max = values.magicPoints_max;
        if (effects.mpMaxIncrease) {
            max += 1;
        }
        if (values.magicPoints <= max) {
            return;
        }
        log("Reset MP");
        setAttrs({
            magicPoints: values.magicPoints_max
        });
    });
});

// Stat rolls

on("clicked:rollStr", () => {
    imports.statRoll.roll("strEffective", "Strength");
});

on("clicked:rollDex", () => {
    imports.statRoll.roll("dexEffective", "Dexterity");
});

on("clicked:rollVit", () => {
    imports.statRoll.roll("vitEffective", "Vitality");
});

on("clicked:rollInt", () => {
    imports.statRoll.roll("intEffective", "Intelligence");
});

on("clicked:rollMnd", () => {
    imports.statRoll.roll("mndEffective", "Mind");
});

on("clicked:applyTurnOrder", () => {
    imports.turnOrder.apply();
});

on("clicked:rollTurnOrder", () => {
    imports.turnOrder.roll();
});

// Ability rolls

for (let section of imports.abilitySections) {
    on(`clicked:repeating_${section}:share`, eventInfo => {
        imports.abilityInfo.share(eventInfo);
    });
    on(`clicked:repeating_${section}:trigger`, eventInfo => {
        imports.abilityRolls.roll(eventInfo);
    });
    on(`clicked:repeating_${section}:rolldamage`, eventInfo => {
        imports.abilityRolls.rollDamage(false, eventInfo);
    });
    on(`clicked:repeating_${section}:rolldamagewithbonus`, eventInfo => {
        imports.abilityRolls.rollDamage(true, eventInfo);
    });
    for (let i = 0; i < 3; i++) {
        on(`clicked:repeating_${section}:runcombo${i + 1}`, eventInfo => {
            imports.abilityRolls.activateCombo(eventInfo, i);
        });
    }
}

// Effects

on("clicked:repeating_effects:share", eventInfo => {
    imports.effectInfo.share(eventInfo);
});

// Handle manual effect changes, since it could affect attributes and available abilities

on("change:repeating_effects:type change:repeating_effects:specialType", eventInfo => {
    imports.manualEffectTypeChange.resolve(eventInfo);
});

on("change:repeating_effects:value", eventInfo => {
    imports.manualEffectValueChange.resolve(eventInfo);
});

on("change:repeating_effects:curable", eventInfo => {
    imports.manualEffectCurableChange.resolve(eventInfo);
});

on("remove:repeating_effects", eventInfo => {
    imports.manualEffectRemoval.resolve(eventInfo);
});

// Rest

on("clicked:rest", () => {
    imports.rest.rest();
});

on("clicked:phase", () => {
    imports.rest.phase();
});

on("clicked:end", () => {
    imports.rest.end();
});

</script>

<script type="text/worker">

// Build (version 1.0.0), generated file toggles

const togglesImports = new (function() {
    this.export = {};

const workerName = "toggles"

// Build (version 1.0.0): Source/workers/common/abilitySections.js


const abilitySections = [
    "limit", 
    "song1", "song2", "song3", 
    "primary1", "primary2", "primary3", 
    "ninjutsu1", "ninjutsu2", "ninjutsu3", 
    "secondary1", "secondary2", "secondary3", 
    "instant1", "instant2", "instant3", 
    "technique1", "technique2", "technique3"
];

this.export.abilitySections = abilitySections;


})();

// Build: Source/workers/toggles.js



// Expand/collapse

const imports = togglesImports.export;
const itemSections = ["titles", "minions", "items"];

function toggleExpandedState(attributeName) {
    getAttrs([attributeName], values => {
        // Toggle
        const value = values[attributeName];
        var attributes = {};
        var newValue = "on";
        if (value == "on" || value == "1") {
            newValue = "off";
        } else if (value == "off" || value == "0") {
            newValue = "on";
        }
        attributes[attributeName] = newValue;
        setAttrs(attributes);
    });
}

function toggleExpandedStateInSection(eventInfo) {
    const sourceAttributes = eventInfo.sourceAttribute.split("_");
    const section = sourceAttributes[1];
    const rowId = sourceAttributes[2];
    toggleExpandedState(`repeating_${section}_${rowId}_repeatingExpandItem`);
}

function setCollapsedStateForSection(isExpanded, section) {
    getSectionIDs(`repeating_${section}`, ids => {
        var attributes = {};
        for (let id of ids) {
            attributes[`repeating_${section}_${id}_repeatingExpandItem`] = isExpanded ? "on" : "off";
        }
        if (Object.keys(attributes).length > 0) {
            setAttrs(attributes);
        }
    });
}

const toggleSections = ["traits", "effects"].concat(itemSections).concat(imports.abilitySections);
for (let section of toggleSections) {
    on(`clicked:repeating_${section}:info`, eventInfo => {
        toggleExpandedStateInSection(eventInfo);
    });
}

on("clicked:song_info clicked:primary_info clicked:ninjutsu_info clicked:secondary_info clicked:instant_info clicked:technique_info", eventInfo => {
    const actionComponents = eventInfo.htmlAttributes.name.split("_");
    const section = actionComponents[1];
    toggleExpandedState(`${section}HeaderExpandItem`);
});

on("clicked:expandAllEffects", () => {
    setCollapsedStateForSection(false, "effects");
});

on("clicked:collapseAllEffects", () => {
    setCollapsedStateForSection(true, "effects");
});

on("clicked:expandAllTraits", () => {
    setCollapsedStateForSection(false, "traits");
});

on("clicked:collapseAllTraits", () => {
    setCollapsedStateForSection(true, "traits");
});

on("clicked:expandAllItems", () => {
    for (let section of itemSections) {
        setCollapsedStateForSection(false, section);
    }
});

on("clicked:collapseAllItems", () => {
    for (let section of itemSections) {
        setCollapsedStateForSection(true, section);
    }
});

on("clicked:expandAllAbilities", () => {
    for (let section of imports.abilitySections) {
        setCollapsedStateForSection(false, section);
    }
    setAttrs({
        songHeaderExpandItem: "off",
        primaryHeaderExpandItem: "off",
        secondaryHeaderExpandItem: "off",
        instantHeaderExpandItem: "off",
        techniqueHeaderExpandItem: "off"
    });
});

on("clicked:collapseAllAbilities", () => {
    for (let section of imports.abilitySections) {
        setCollapsedStateForSection(true, section);
    }
    setAttrs({
        songHeaderExpandItem: "on",
        primaryHeaderExpandItem: "on",
        secondaryHeaderExpandItem: "on",
        instantHeaderExpandItem: "on",
        techniqueHeaderExpandItem: "on"
    });
});

</script>
